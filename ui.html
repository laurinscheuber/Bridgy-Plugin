<!doctype html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta
      http-equiv="Content-Security-Policy"
      content="default-src 'self'; script-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; connect-src 'self' https://gitlab.com https://*.gitlab.com https://gitlab.fhnw.ch https://*.gitlab.fhnw.ch https://api.github.com https://github.com https://cdnjs.cloudflare.com; img-src 'self' data:; font-src 'self' data: https://static.figma.com https://fonts.gstatic.com; object-src 'none'; base-uri 'self'; form-action 'self';"
    />
    <meta
      http-equiv="Permissions-Policy"
      content="camera=(), microphone=(), clipboard-write=(), display-capture=()"
    />
    <title>Bridgy UI</title>
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script>
      (function () {
        const originalWarn = console.warn;
        console.warn = function (...args) {
          if (
            args[0] &&
            typeof args[0] === 'string' &&
            args[0].includes('Potential permissions policy violation')
          ) {
            return;
          }
          originalWarn.apply(console, args);
        };
      })();
    </script>
    <style>
      :root{--primary-50:#f0f9ff;--primary-100:#e0e7ff;--primary-200:#c7d2fe;--primary-300:#c4b5fd;--primary-400:#8b5cf6;--primary-500:#7c3aed;--primary-600:#6366f1;--primary-700:#4c1d95;--neutral-0:#ffffff;--neutral-50:#fafafa;--neutral-100:#f5f5f5;--neutral-200:#e5e5e5;--neutral-300:#d4d4d4;--neutral-400:#a3a3a3;--neutral-500:#737373;--neutral-600:#525252;--neutral-700:#404040;--neutral-800:#262626;--neutral-900:#171717;--success-50:#f0fdf4;--success-400:#4ade80;--success-500:#22c55e;--success-600:#16a34a;--success-700:#15803d;--warning-50:#fefce8;--warning-500:#eab308;--warning-600:#ca8a04;--warning-700:#a16207;--error-50:#fef2f2;--error-500:#ef4444;--error-600:#dc2626;--error-700:#b91c1c;--orange-400:#fbbf24;--orange-500:#f59e0b;--orange-600:#d97706;--purple-bright:#a855f7;--purple-deeper:#9333ea;--purple-deepest:#6d28d9;--glass-white-light:rgba(255,255,255,0.03);--glass-white-medium:rgba(255,255,255,0.05);--glass-white-heavy:rgba(255,255,255,0.08);--glass-white-10:rgba(255,255,255,0.1);--glass-white-15:rgba(255,255,255,0.15);--glass-white-20:rgba(255,255,255,0.2);--glass-white-30:rgba(255,255,255,0.3);--glass-white-40:rgba(255,255,255,0.4);--glass-white-50:rgba(255,255,255,0.5);--glass-white-60:rgba(255,255,255,0.6);--glass-white-70:rgba(255,255,255,0.7);--glass-white-80:rgba(255,255,255,0.8);--glass-white-90:rgba(255,255,255,0.9);--glass-purple-light:rgba(139,92,246,0.08);--glass-purple-medium:rgba(139,92,246,0.15);--glass-purple-heavy:rgba(139,92,246,0.25);--glass-purple-05:rgba(139,92,246,0.05);--glass-purple-10:rgba(139,92,246,0.1);--glass-purple-20:rgba(139,92,246,0.2);--glass-purple-30:rgba(139,92,246,0.3);--glass-purple-40:rgba(139,92,246,0.4);--glass-purple-50:rgba(139,92,246,0.5);--glass-dark-light:rgba(0,0,0,0.2);--glass-dark-medium:rgba(0,0,0,0.4);--glass-dark-heavy:rgba(0,0,0,0.6);--glass-dark-15:rgba(0,0,0,0.15);--glass-dark-30:rgba(0,0,0,0.3);--glass-dark-50:rgba(0,0,0,0.5);--glass-dark-85:rgba(0,0,0,0.85);--opacity-overlay-light:0.05;--opacity-overlay-medium:0.1;--opacity-overlay-heavy:0.2;--opacity-glass-light:0.1;--opacity-glass-medium:0.2;--opacity-glass-heavy:0.3;--opacity-accent-light:0.2;--opacity-accent-medium:0.3;--opacity-accent-heavy:0.4;--opacity-accent-intense:0.6;--opacity-accent-max:0.7;--blur-light:none;--blur-medium:none;--blur-heavy:none;--blur-intense:none;--purple-light:var(--primary-300);--purple-medium:var(--primary-400);--purple-dark:var(--primary-500);--generate-color:var(--primary-400);--generate-hover:var(--primary-500);--commit-color:var(--orange-500);--commit-hover:var(--orange-600);--info-500:var(--primary-600);--warning-400:var(--warning-500);--gradient-main:linear-gradient(135deg,#0f172a 0%,#171638 100%);--gradient-button:var(--primary-500);--gradient-button-hover:var(--primary-600);--gradient-scrollbar:linear-gradient(135deg,var(--purple-medium) 0%,var(--purple-bright) 100%);--gradient-text:linear-gradient(    135deg,var(--neutral-0),var(--primary-100),var(--primary-200)  );--space-1:0.25rem;--space-2:0.5rem;--space-3:0.75rem;--space-4:1rem;--space-6:1.5rem;--space-8:2rem;--space-12:3rem;--space-px:1px;--space-0\.5:0.125rem;--space-1\.5:0.375rem;--space-2\.5:0.625rem;--space-5:1.25rem;--space-7:1.75rem;--space-9:2.25rem;--space-10:2.5rem;--padding-button:var(--space-4) var(--space-6);--padding-button-sm:var(--space-2) var(--space-4);--padding-card:var(--space-4);--padding-modal:var(--space-8);--padding-container:var(--space-6) var(--space-5);--text-xs:0.75rem;--text-sm:0.875rem;--text-base:1rem;--text-lg:1.125rem;--text-xl:1.25rem;--text-2xl:1.5rem;--font-normal:400;--font-medium:500;--font-semibold:600;--font-bold:700;--font-extrabold:800;--font-black:900;--leading-none:1;--leading-tight:1.2;--leading-snug:1.4;--leading-normal:1.5;--leading-relaxed:1.6;--radius-sm:0.375rem;--radius-md:0.5rem;--radius-lg:0.75rem;--radius-xl:1rem;--radius-2xs:0.25rem;--radius-xs:0.375rem;--radius-button:0.625rem;--radius-card:0.75rem;--radius-modal:0.9375rem;--radius-container:1.25rem;--radius-large:1.5625rem;--radius-pill:50px;--radius-full:50%;--icon-xs:0.75rem;--icon-sm:1rem;--icon-md:1.25rem;--icon-lg:1.5rem;--icon-xl:1.75rem;--icon-2xl:2rem;--shadow-sm:0 1px 2px 0 rgb(0 0 0 / 0.05);--shadow-md:0 4px 6px -1px rgb(0 0 0 / 0.1),0 2px 4px -2px rgb(0 0 0 / 0.1);--shadow-lg:0 10px 15px -3px rgb(0 0 0 / 0.1),0 4px 6px -4px rgb(0 0 0 / 0.1);--shadow-purple-light:0 0 20px var(--glass-purple-medium);--shadow-purple-medium:0 4px 15px var(--glass-purple-medium);--shadow-purple-heavy:0 4px 20px var(--glass-purple-heavy);--shadow-purple-intense:0 8px 25px var(--glass-purple-medium);--shadow-purple-glow:0 8px 30px rgba(139,92,246,var(--opacity-accent-max));--shadow-dark:0 8px 32px var(--glass-dark-medium);--shadow-dark-heavy:0 8px 32px var(--glass-dark-heavy);--shadow-dark-inset:inset 0 1px 3px var(--glass-dark-heavy);--shadow-dark-inset-heavy:inset 0 1px 5px var(--glass-dark-medium);--transition-fast:all 0.2s ease;--transition-normal:all 0.3s cubic-bezier(0.4,0,0.2,1);--transition-smooth:all 0.3s cubic-bezier(0.25,0.46,0.45,0.94);--transition-color:color 0.2s ease;--transition-opacity:opacity 0.5s ease-out;--z-hide:-1;--z-base:0;--z-docked:10;--z-dropdown:100;--z-sticky:1000;--z-modal:9999}*{box-sizing:border-box}body{font-family:'Inter',-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Helvetica Neue',Arial,sans-serif;margin:0;padding:0;color:var(--neutral-0);background:var(--neutral-900);font-size:var(--text-sm);line-height:var(--leading-snug);min-height:100vh;overflow-x:hidden}body.modal-open{overflow:hidden}input[type='checkbox'],input[type='radio']{accent-color:var(--primary-500)}::-webkit-scrollbar{width:6px;height:6px}::-webkit-scrollbar-track{background:transparent}::-webkit-scrollbar-thumb{background:var(--glass-white-20);border-radius:3px}::-webkit-scrollbar-thumb:hover{background:var(--glass-white-30)}::-webkit-scrollbar-thumb:active{background:var(--glass-white-40)}::-webkit-scrollbar-corner{background:transparent}html{scrollbar-width:thin;scrollbar-color:var(--purple-light) transparent}.modal-content::-webkit-scrollbar{width:8px}.modal-content::-webkit-scrollbar-thumb{background:linear-gradient(135deg,var(--purple-medium) 0%,var(--purple-bright) 100%);border-radius:6px;border:1px solid var(--glass-white-medium)}.modal-content::-webkit-scrollbar-thumb:hover{background:var(--gradient-button-hover)}::selection{background:var(--glass-purple-heavy);color:var(--neutral-0)}::-moz-selection{background:var(--glass-purple-heavy);color:var(--neutral-0)}input::selection,textarea::selection{background:var(--glass-purple-intense);color:var(--neutral-0)}input::-moz-selection,textarea::-moz-selection{background:var(--glass-purple-intense);color:var(--neutral-0)}.container{display:flex;flex-direction:column;gap:var(--space-2);max-width:100%;margin:0;padding:var(--space-3);background:transparent}.section{background:var(--glass-white-light);border:none;border-radius:var(--radius-xl);padding:var(--space-4)}.section:hover{background:var(--glass-white-medium)}h1,h2,h3,h4,h5,h6{margin:0;font-weight:var(--font-semibold);line-height:var(--leading-tight)}h2{font-size:var(--text-xl);color:var(--neutral-0);margin-bottom:var(--space-4);display:flex;align-items:center;gap:var(--space-2)}h3{font-size:var(--text-lg);color:var(--neutral-0);margin-bottom:var(--space-3)}h4{font-size:var(--text-base);color:var(--glass-white-90);margin-bottom:var(--space-2)}.header{background:var(--glass-white-heavy);backdrop-filter:var(--blur-intense);-webkit-backdrop-filter:var(--blur-intense);border:1px solid var(--glass-white-medium);border-radius:var(--radius-container);padding:var(--space-2);margin-bottom:var(--space-2);position:relative;overflow:visible;z-index:100}.beta-badge{display:inline-block;background:rgba(139,92,246,0.1);color:var(--purple-light);cursor:pointer;padding:2px 6px;border-radius:var(--radius-sm);font-size:10px;font-weight:var(--font-bold);letter-spacing:1.2px;text-transform:uppercase;border:1px solid var(--purple-medium);margin-left:var(--space-3);margin-top:-var(--space-2);vertical-align:top;z-index:var(--z-docked);transition:all 0.2s ease}.beta-badge:hover{background:rgba(139,92,246,0.2);transform:translateY(-1px)}.feedback-section{background:var(--glass-purple-light);border:1px solid var(--glass-purple-medium);border-radius:var(--radius-container);padding:var(--space-3);margin-bottom:var(--space-4);transition:all 0.3s ease}.feedback-close-btn{background:transparent;border:none;color:var(--glass-white-60);border-radius:var(--radius-modal);width:24px;height:24px;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all 0.2s ease;padding:0}.feedback-close-btn:hover{background:transparent;color:var(--neutral-0);transform:scale(1.1)}.feedback-close-btn .material-symbols-outlined{font-size:16px}.feedback-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:var(--space-3)}.feedback-title{display:flex;align-items:center;gap:var(--space-2);font-size:var(--text-base);font-weight:var(--font-semibold);color:var(--neutral-0)}.feedback-buttons{display:flex;gap:var(--space-2);margin-top:var(--space-3)}.feedback-button{flex:1;background:var(--glass-white-medium);border:1px solid var(--glass-white-10);padding:8px var(--space-3);border-radius:var(--radius-md);text-align:center;cursor:pointer;transition:all 0.2s ease;font-size:var(--text-sm);color:var(--glass-white-90);text-decoration:none;display:flex;flex-direction:column;align-items:center;gap:var(--space-1);box-shadow:none !important}.feedback-button:hover{background:var(--glass-purple-medium);border-color:var(--glass-purple-30);color:var(--neutral-0);box-shadow:none !important}.feedback-button-icon{font-size:var(--text-lg)}.feedback-description{font-size:var(--text-sm);color:var(--glass-white-80);line-height:1.5;margin-bottom:var(--space-2)}.feedback-website-link{display:inline-flex;align-items:center;gap:var(--space-1);color:var(--purple-light);text-decoration:none;font-size:var(--text-sm);font-weight:var(--font-medium);transition:color 0.2s ease}.feedback-website-link:hover{color:var(--purple-light);text-decoration:underline}.header-content{display:flex;justify-content:space-between;align-items:center;padding:0 var(--space-2)}.header-title{display:flex;align-items:center}.header-title h1{font-size:1.2rem;font-weight:800;margin:0;background:linear-gradient(135deg,var(--neutral-0),var(--primary-100),var(--primary-200));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}.header-subtitle{font-size:var(--text-xs);color:var(--glass-white-80);font-weight:var(--font-medium);margin-top:var(--space-1);display:block}.header-actions{display:flex;gap:var(--space-2);align-items:center}.refresh-button{display:flex;align-items:center;justify-content:center;background:transparent;color:var(--glass-white-80);border:1px solid transparent;border-radius:var(--radius-md);padding:var(--space-1);cursor:pointer;transition:var(--transition-fast);backdrop-filter:var(--blur-medium);height:32px;width:32px;min-width:32px;position:relative;overflow:visible;box-shadow:none !important}.refresh-button:hover{background:var(--glass-white-medium);border-color:var(--glass-white-heavy);transform:scale(1.05)}.refresh-button:active{transform:scale(0.95)}.content-padding{padding:var(--space-4)}.header-summary{display:flex;align-items:center;gap:4px;padding:2px 8px;background:var(--glass-purple-medium);border-radius:var(--radius-md);color:var(--glass-white-60);font-size:11px;font-weight:var(--font-medium)}.header-summary span{color:var(--glass-white-90);font-weight:var(--font-semibold)}.refresh-button svg{transition:var(--transition-fast)}.refresh-button:hover svg{transform:rotate(45deg)}.delete-variable-btn,.delete-btn{display:flex;align-items:center;justify-content:center;background:transparent !important;color:var(--neutral-0);border:none !important;border-radius:var(--radius-sm);padding:var(--space-1);cursor:pointer;transition:var(--transition-fast);width:32px;height:32px;box-shadow:none !important}.delete-variable-btn:hover,.delete-btn:hover{background:transparent !important;color:#ef4444 !important;transform:scale(1.1)}.delete-variable-btn:active,.delete-btn:active{transform:scale(0.9)}.delete-variable-btn svg,.delete-btn svg{transition:var(--transition-fast)}.tabs{display:flex;flex-direction:row;flex-wrap:nowrap;background:var(--glass-white-light);border:1px solid rgba(255,255,255,0.06);border-radius:var(--radius-lg);padding:4px;margin-bottom:var(--space-2);gap:3px;width:100%;overflow-x:auto}.tab{flex:1;padding:0.4rem 0.6rem;cursor:pointer;font-weight:var(--font-medium);font-size:var(--text-xs);text-align:center;color:var(--glass-white-70);background:transparent;border:none;border-radius:var(--radius-md);transition:all 0.3s ease;position:relative;overflow:hidden}.tab::before{content:'';position:absolute;top:0;left:0;right:0;bottom:0;background:linear-gradient(135deg,rgba(139,92,246,0.03) 0%,rgba(168,85,247,0.05) 100%);opacity:0;transition:opacity 0.2s ease;z-index:-1}.tab:hover{color:var(--purple-light);transform:translateY(-1px)}.tab:hover::before{opacity:0.3}.tab.active{color:var(--purple-light);background:rgba(139,92,246,0.1);border:1px solid var(--purple-medium);box-shadow:none;font-weight:var(--font-semibold)}.tab.active::before{opacity:0}.tab:not(.active):hover{background:var(--glass-purple-05);border-color:var(--glass-purple-light);transform:translateY(-2px) scale(1.02);box-shadow:0 8px 25px var(--glass-purple-medium);color:var(--purple-light)}.tab-content{display:none;background:transparent;padding:0;animation:fadeIn 0.2s ease-in-out}.tab-content.active{display:block}@keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}.sub-tabs{display:flex;background:var(--glass-dark-15);backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);border:1px solid var(--glass-white-10);border-radius:var(--radius-lg);padding:6px;margin-bottom:var(--space-5);gap:4px}.sub-tab{flex:1;padding:0.75rem 1rem;cursor:pointer;font-weight:var(--font-medium);font-size:var(--text-sm);text-align:center;color:var(--glass-white-60);background:transparent;border:none;border-radius:var(--radius-md);transition:all 0.2s ease;position:relative}.sub-tab:hover{color:var(--glass-white-80);background:var(--glass-white-medium);transform:translateY(-1px)}.sub-tab.active{color:var(--neutral-0);background:var(--primary-500);box-shadow:0 2px 8px var(--glass-purple-30);font-weight:var(--font-semibold)}.sub-tab-content{display:none;animation:fadeIn 0.3s ease-in-out}.sub-tab-content.active{display:block}.component-group{margin-bottom:var(--space-6);background:var(--neutral-0);border:1px solid var(--neutral-200);border-radius:var(--radius-container);overflow:hidden;box-shadow:var(--shadow-sm);transition:all 0.3s ease}.component-group:hover{box-shadow:var(--shadow-md);border-color:var(--primary-200)}.component-group-header{padding:var(--space-4) var(--space-6);background:linear-gradient(135deg,var(--neutral-50) 0%,var(--primary-50) 100%);border-bottom:1px solid var(--neutral-200);cursor:pointer;display:flex;justify-content:space-between;align-items:center;transition:var(--transition-fast)}.component-group-header:hover{background:linear-gradient(135deg,var(--primary-50) 0%,var(--primary-100) 100%)}.component-group-header.expanded{border-bottom-color:var(--primary-200)}.component-group-title{font-weight:var(--font-semibold);font-size:var(--text-lg);color:var(--neutral-0);display:flex;align-items:center;gap:var(--space-3)}.component-group-toggle{width:24px;height:24px;border-radius:var(--radius-md);background:var(--primary-100);color:var(--primary-600);display:flex;align-items:center;justify-content:center;font-size:var(--text-sm);font-weight:var(--font-semibold);transition:all 0.3s cubic-bezier(0.4,0,0.2,1)}.component-group-header.expanded .component-group-toggle{transform:rotate(90deg);background:var(--primary-500);color:var(--neutral-0)}.component-group-content{display:none;padding:var(--space-6);background:var(--glass-white-light);backdrop-filter:var(--blur-medium);color:var(--neutral-0)}.component-group-content.expanded{display:block;animation:slideDown 0.3s ease-out}@keyframes slideDown{from{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}.state-labels{margin-top:var(--space-3);display:flex;gap:var(--space-2);flex-wrap:wrap}.state-label{padding:var(--space-1) var(--space-3);background:var(--glass-purple-light);color:var(--purple-light);border-radius:var(--radius-sm);font-size:var(--text-xs);font-weight:var(--font-medium)}.badge{display:inline-flex;align-items:center;padding:var(--space-1) var(--space-3);font-size:var(--text-xs);font-weight:var(--font-semibold);border-radius:var(--radius-sm);margin-right:var(--space-2);text-transform:uppercase;letter-spacing:0.025em}.badge-component{background:var(--glass-purple-light);color:var(--purple-light)}.badge-component-set{background:rgba(34,197,94,0.15);color:var(--success-500)}.badge-state{background:var(--glass-purple-light);color:var(--purple-light)}.badge-type{background:rgba(251,191,36,0.15);color:var(--warning-400)}.badge-variant{background:var(--glass-purple-light);color:var(--purple-light);font-size:11px;margin-right:4px}.component-variables{margin-top:var(--space-4);padding:var(--space-4);background:var(--glass-dark-light);border-radius:var(--radius-container);border:1px solid rgba(255,255,255,0.06)}.variables-toggle{background:var(--glass-white-medium);border:1px solid var(--glass-white-10);padding:var(--space-2) var(--space-4);border-radius:var(--radius-button);cursor:pointer;font-size:var(--text-sm);color:var(--glass-white-90);margin-bottom:var(--space-3);transition:var(--transition-fast);font-weight:var(--font-medium)}.variables-toggle:hover{background:var(--glass-purple-medium);border-color:var(--glass-purple-30);color:var(--neutral-0)}.variables-list{display:none;background:var(--glass-white-light);backdrop-filter:var(--blur-medium);border-radius:var(--radius-md);padding:var(--space-4);margin-top:var(--space-2);border:1px solid var(--glass-white-medium)}.variables-list.expanded{display:block;animation:fadeIn 0.2s ease-out}.variable-item{display:flex;justify-content:space-between;align-items:center;padding:8px 12px;font-size:var(--text-sm);color:var(--neutral-0);background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.05);border-radius:8px;margin-bottom:4px}.variable-item:last-child{border-bottom:none}.variable-name{font-family:'SF Mono','Monaco','Inconsolata','Roboto Mono',monospace;color:var(--glass-white-90);font-weight:var(--font-medium)}.variable-value{font-family:'SF Mono','Monaco','Inconsolata','Roboto Mono',monospace;color:var(--purple-light);cursor:pointer;transition:color 0.2s ease}.variable-value:hover{color:var(--purple-light);text-decoration:underline}.variable-collection{margin-bottom:var(--space-2);background:transparent;backdrop-filter:none;border-radius:0;border:none;box-shadow:none;transition:all 0.3s cubic-bezier(0.4,0,0.2,1);overflow:visible}.collection-header{display:flex;align-items:center;gap:12px;padding:8px 12px;background:rgba(255,255,255,0.03);cursor:pointer;transition:var(--transition-fast);border:1px solid rgba(255,255,255,0.05);border-radius:8px;margin-bottom:4px}.collection-header:hover{background:rgba(255,255,255,0.05);border-color:rgba(255,255,255,0.08)}.collection-info{display:flex;align-items:center;gap:var(--space-2);flex:1}.collection-name-title{font-weight:var(--font-semibold);color:var(--neutral-0);font-size:13px;margin:0;display:flex;align-items:center;gap:8px;text-shadow:0 1px 2px var(--glass-dark-medium)}.collection-toggle-icon{font-size:20px;color:var(--glass-white-70);transition:transform 0.3s ease}.collection-header.collapsed .collection-toggle-icon{transform:rotate(-90deg)}.collection-content{padding:0;transition:all 0.4s ease}.collection-content.collapsed{display:none}.collection-actions-bar{display:flex;justify-content:flex-end;gap:var(--space-2);margin-bottom:var(--space-3);padding-bottom:var(--space-2);border-bottom:1px solid var(--glass-white-10)}.compact-action-btn{background:var(--glass-white-medium);border:1px solid var(--glass-white-10);color:var(--glass-white-70);padding:0;font-size:var(--text-xs);border-radius:var(--radius-md);cursor:pointer;transition:all 0.2s ease;display:flex;align-items:center;justify-content:center;width:32px;height:32px;box-shadow:none}.compact-action-btn:hover{background:var(--glass-purple-light);border-color:var(--glass-purple-heavy);color:var(--neutral-0)}.compact-action-btn .material-symbols-outlined{font-size:18px}table{width:100%;border-collapse:collapse;border-spacing:0;margin-top:var(--space-1.5);background:transparent;border-radius:0;overflow:visible;border:none;table-layout:auto}th{text-align:left;background:transparent;padding:var(--space-2);font-weight:var(--font-bold);color:var(--glass-white-60);border-bottom:2px solid var(--glass-white-medium);font-size:var(--text-xs);text-transform:uppercase;letter-spacing:0.05em}th:first-child{border-top-left-radius:12px;width:30%}th:nth-child(2){width:15%}th:last-child{border-top-right-radius:12px;width:32px;min-width:32px;max-width:32px;text-align:center;font-size:0}td{padding:var(--space-2\\.5) var(--space-3);border-bottom:1px solid var(--glass-white-light);vertical-align:middle;font-size:12px;color:var(--neutral-0);background:transparent;font-weight:var(--font-normal);line-height:var(--leading-snug)}td:last-child{width:32px;min-width:32px;max-width:32px;white-space:nowrap;text-align:center;padding:2px 4px}td:first-child{font-weight:var(--font-medium);color:var(--neutral-100);font-family:'SF Mono',Consolas,monospace;background:transparent;width:35%}td:nth-child(2){color:var(--purple-light);font-weight:var(--font-medium);font-size:10px;text-transform:unused;letter-spacing:0;background:transparent;width:15%}td:last-child{color:#f1f5f9;line-height:1.5}tr:hover td{background:var(--glass-purple-light);color:var(--neutral-0)}tr:hover td:first-child{background:var(--glass-purple-heavy);color:var(--neutral-0)}tr:hover td:nth-child(2){background:transparent;color:#e0e7ff}tr:last-child td:first-child{border-bottom-left-radius:12px}tr:last-child td:last-child{border-bottom-right-radius:12px}tr:last-child td{border-bottom:none}.color-preview{width:28px;height:28px;border-radius:var(--radius-md);display:inline-block;margin-right:var(--space-3);vertical-align:middle;border:2px solid var(--glass-white-heavy);box-shadow:0 4px 8px var(--glass-dark-light);transition:transform 0.2s ease}.color-preview:hover{transform:scale(1.1)}.import-structure-preview{margin:var(--space-5) 0;padding:var(--space-4);background:var(--glass-dark-30);border:1px solid var(--glass-purple-medium);border-radius:var(--radius-card);backdrop-filter:var(--blur-medium)}.import-structure-preview h4{margin:0 0 var(--space-4) 0;color:var(--text-primary);font-size:var(--text-lg);font-weight:600}.structure-tree{font-family:monospace;font-size:var(--text-sm);line-height:1.6}.collection-preview{margin-left:var(--space-2)}.collection-preview > .icon{color:var(--warning-400);margin-right:var(--space-2)}.collection-preview > .name{color:var(--text-primary);font-weight:600}.collection-preview > .type{color:var(--text-secondary);font-style:italic;margin-left:var(--space-2)}.group-preview{margin-left:var(--space-6);margin-top:var(--space-2);border-left:2px solid var(--glass-purple-light);padding-left:var(--space-3)}.group-preview > .icon{color:var(--info-400);margin-right:var(--space-2)}.group-preview > .name{color:var(--text-primary);font-weight:500}.group-preview > .count{color:var(--text-secondary);margin-left:var(--space-2)}.variable-list{margin-left:var(--space-8);margin-top:var(--space-2)}.variable-item{display:flex;align-items:center;margin-bottom:1px;padding:0}.variable-item .color-preview{width:14px;height:14px;border-radius:var(--radius-sm);margin-right:var(--space-2);border:1px solid var(--glass-white-heavy)}.variable-item .numeric-preview{background:var(--glass-purple-light);color:var(--text-primary);padding:2px 6px;border-radius:var(--radius-sm);font-size:11px;font-family:monospace;margin-right:var(--space-2);min-width:40px;text-align:center}.variable-item .var-name{color:var(--text-secondary);font-size:11px;font-family:monospace}.more-items{color:var(--text-tertiary);font-style:italic;font-size:11px;margin-top:var(--space-1)}.summary-stats{display:flex;gap:var(--space-3);margin-top:var(--space-4);padding-top:var(--space-4);border-top:1px solid var(--glass-purple-light)}.summary-item{background:var(--glass-purple-light);color:var(--text-primary);padding:4px 8px;border-radius:var(--radius-md);font-size:var(--text-sm);font-weight:500}.group-status{margin-top:var(--space-2);margin-left:var(--space-8)}.status-badge{display:inline-block;padding:2px 6px;border-radius:var(--radius-sm);font-size:11px;font-weight:500;margin-right:var(--space-1)}.status-badge.new{background:var(--success-500);color:white}.status-badge.existing{background:var(--neutral-500);color:white}.status-badge.overwrite{background:var(--warning-500);color:white}.status-badge.alias{background:var(--info-500);color:white}.import-controls{display:flex;gap:var(--space-2);margin-bottom:var(--space-4);flex-wrap:wrap}.import-group-container{margin-bottom:var(--space-2)}.import-group-header{display:flex;align-items:center;gap:var(--space-2);padding:var(--space-3);background:transparent;border:1px solid var(--glass-purple-light);border-radius:var(--radius-md);cursor:pointer;transition:var(--transition-fast)}.import-group-header:hover{background:var(--glass-dark-30);border-color:var(--glass-purple-medium)}.import-group-header .expand-icon{font-size:var(--text-sm);transition:var(--transition-fast);color:var(--text-secondary)}.import-group-content{max-height:500px;overflow-y:auto;transition:max-height 0.3s ease;border-left:1px solid var(--glass-purple-light);margin-left:var(--space-4);padding-left:var(--space-3)}.import-group-content.collapsed{max-height:0;overflow:hidden}.variables-table,.styles-table{margin-top:var(--space-3)}.variable-row{display:grid;grid-template-columns:1fr auto auto auto;gap:var(--space-3);padding:8px 12px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.05);border-radius:8px;margin-bottom:4px;align-items:center;transition:var(--transition-fast)}.variable-row:hover{background:rgba(255,255,255,0.05);border-color:rgba(255,255,255,0.08)}.variable-row:last-child{margin-bottom:0}.variable-row .checkbox-label{display:flex;align-items:center;gap:var(--space-2);margin:0;min-width:0}.variable-row .variable-name{font-family:monospace;font-size:12px;color:var(--neutral-0);word-break:break-all}.variable-row .variable-type{background:var(--glass-purple-light);color:var(--neutral-100);padding:calc(var(--space-1) / 2) var(--space-2);border-radius:var(--radius-sm);font-size:var(--text-xs);font-weight:500;text-transform:uppercase;white-space:nowrap}.variable-row .variable-value{font-family:monospace;font-size:12px;color:var(--neutral-100);display:flex;align-items:center;gap:2px;max-width:200px;word-break:break-all}.variable-row .delete-btn{background:transparent !important;color:var(--neutral-0);width:24px;height:24px;border-radius:var(--radius-sm);display:flex;align-items:center;justify-content:center;transition:all 0.2s ease;border:none !important;cursor:pointer;padding:0;box-shadow:none !important}.variable-row .delete-btn .material-symbols-outlined{font-size:16px;font-weight:300}.variable-row .delete-btn:hover{background:transparent !important;color:#ef4444 !important}.variable-row .color-preview{width:16px;height:16px;border-radius:var(--radius-sm);border:1px solid var(--glass-white-20);flex-shrink:0}.alias-badge{background:var(--info-500);color:white;padding:calc(var(--space-1) / 2) var(--space-1);border-radius:var(--radius-xs);font-size:var(--text-xs);font-weight:500;text-transform:uppercase}.variables-preview,.styles-preview{margin-top:var(--space-3)}.style-categories{margin-top:var(--space-3)}.style-category{display:flex;align-items:center;margin-bottom:var(--space-3);padding:var(--space-3);background:var(--glass-dark-light);border-radius:var(--radius-md);border-left:3px solid var(--info-500)}.style-icon{font-size:var(--text-lg);margin-right:var(--space-3)}.style-name{color:var(--text-primary);font-weight:600;margin-right:var(--space-2)}.style-count{color:var(--text-secondary);font-size:var(--text-sm);margin-right:var(--space-4)}.style-examples{flex:1}.style-example{display:inline-block;margin-right:var(--space-3);margin-bottom:var(--space-1)}.style-token-name{background:var(--glass-purple-light);color:var(--text-primary);padding:2px 6px;border-radius:var(--radius-sm);font-size:11px;font-family:monospace}.more-styles{color:var(--text-tertiary);font-style:italic;font-size:11px;display:inline-block}.style-summary{display:flex;gap:var(--space-3);margin-top:var(--space-4);padding-top:var(--space-4);border-top:1px solid var(--glass-purple-light)}.variable-collection{margin-bottom:var(--space-2)}.variable-subgroup{margin-bottom:var(--space-2);border:1px solid var(--glass-border);border-radius:var(--radius-md);overflow:hidden;transition:all 0.2s ease;background:rgba(255,255,255,0.02);margin-left:var(--space-3);margin-top:var(--space-1)}.variable-subgroup table{margin:0;border:none;border-radius:0 !important;box-shadow:none;background:transparent;border-collapse:collapse}.variable-subgroup th{border-radius:0 !important;background:var(--glass-purple-05)}.variable-subgroup th:first-child{border-top-left-radius:0}.variable-subgroup th:last-child{border-top-right-radius:0}.subgroup-content{padding:0}.subgroup-header{display:flex;align-items:center;gap:12px;padding:8px 12px;cursor:pointer;background:rgba(255,255,255,0.03);border:1px solid transparent;margin-bottom:0;border-radius:0;border-bottom:none;transition:var(--transition-fast)}.subgroup-header:hover{background:rgba(255,255,255,0.05);border-color:rgba(255,255,255,0.08)}.subgroup-title{margin:0;color:var(--neutral-0);font-size:13px;font-weight:var(--font-semibold);display:flex;align-items:center;gap:8px}.subgroup-toggle-icon{font-size:16px;color:var(--text-tertiary);transition:transform 0.2s ease;opacity:0.7}.subgroup-header.collapsed .subgroup-toggle-icon{transform:rotate(-90deg)}.subgroup-content.collapsed{display:none}.subgroup-stats{color:var(--glass-white-60);font-size:11px;padding:0;border-radius:0;min-width:unset;text-align:right;background:transparent;border:none;box-shadow:none;margin-left:var(--space-2);font-weight:var(--font-medium);letter-spacing:0.02em}.tab-summary{display:flex;align-items:center;gap:var(--space-3);padding:var(--space-3) var(--space-4);margin-bottom:var(--space-2);background:linear-gradient(135deg,var(--glass-purple-medium) 0%,rgba(99,102,241,0.1) 100%);border:1px solid var(--glass-purple-30);border-radius:var(--radius-lg);color:var(--glass-white-90);font-size:var(--text-sm);font-weight:var(--font-medium);backdrop-filter:var(--blur-light);box-shadow:0 2px 8px var(--glass-purple-10)}.tab-summary .material-symbols-outlined{color:var(--purple-light)}.tab-summary span:not(.material-symbols-outlined){color:var(--neutral-0);font-weight:var(--font-semibold)}.toolbar{display:flex;align-items:center;justify-content:space-between;gap:var(--space-2);padding:var(--space-2) var(--space-2);background:transparent;border-bottom:none;border-radius:0;margin-bottom:var(--space-4);margin-top:-8px;backdrop-filter:none;position:sticky;top:0;z-index:1000}.select-wrapper{position:relative;height:32px;display:flex;align-items:center}.toolbar-select{height:32px;appearance:none;-webkit-appearance:none;background:transparent    url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E")    no-repeat right 8px center;border:1px solid transparent;color:var(--glass-white-90);padding:0 32px 0 12px;border-radius:var(--radius-md);font-size:var(--text-xs);font-weight:var(--font-semibold);cursor:pointer;outline:none;transition:all 0.2s ease;backdrop-filter:var(--blur-medium)}.toolbar-select:hover{background-color:var(--glass-white-heavy);border-color:var(--glass-white-30)}.toolbar-select option{background-color:var(--neutral-900);color:var(--neutral-0);padding:8px}.toolbar-group{display:flex;align-items:center;gap:4px}.toolbar-btn-text{font-size:11px;font-weight:600;margin-left:4px;white-space:nowrap}.toolbar-summary{display:flex;align-items:center;gap:4px;padding:4px 10px;background:var(--glass-purple-medium);border-radius:var(--radius-md);color:var(--glass-white-80);font-size:11px;font-weight:var(--font-medium);white-space:nowrap}.toolbar-summary span{color:var(--neutral-0);font-weight:var(--font-semibold)}.search-actions{display:flex;gap:2px}.search-wrapper-collapsible{display:flex;align-items:center;width:0;overflow:hidden;transition:width 0.3s cubic-bezier(0.4,0,0.2,1),margin 0.3s ease;margin:0}.search-wrapper-collapsible.expanded{width:auto;flex:1;margin:0 var(--space-2);max-width:none}.search-input-wrapper{position:relative;display:flex;align-items:center}.search-icon{color:var(--glass-white-40);pointer-events:none;font-size:20px}.search-clear-btn{position:absolute;right:12px;background:transparent;border:none;color:var(--glass-white-40);cursor:pointer;display:none;align-items:center;justify-content:center;padding:4px;border-radius:var(--radius-modal);transition:all 0.2s ease}.search-clear-btn:hover{background:var(--glass-white-10);color:var(--neutral-0)}.search-input{width:100%;padding:6px 32px 6px 10px;border:1px solid var(--glass-purple-40);border-radius:var(--radius-md);font-size:var(--text-xs);transition:all 0.3s ease;background:var(--glass-white-medium);color:var(--neutral-0)}.search-input:focus{border-color:var(--purple-light);background:var(--glass-white-heavy);outline:none;box-shadow:0 0 0 2px var(--glass-purple-20)}.search-input-wrapper{position:relative}.component-list{max-height:700px;overflow-y:auto}.component-item,.component-set-header,.child-header,.quality-issue-card{padding:6px var(--space-3);min-height:36px;display:flex;align-items:center}.unified-list-item{min-height:0 !important;height:auto !important;padding:0 8px !important;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.05);border-radius:6px;margin-bottom:1px !important;transition:var(--transition-fast);color:var(--neutral-0);display:flex;align-items:center;gap:var(--space-2);line-height:1}.unified-list-item.variable-row{height:28px !important;min-height:28px !important;max-height:28px !important}.generate-all-variants-button,.commit-all-variants-button{width:28px !important;min-width:28px !important;height:24px !important;font-size:10px !important;overflow:hidden;transition:background-color 0.2s ease;display:flex;align-items:center;justify-content:center !important;padding:0 !important;white-space:nowrap;background:transparent !important;border:1px solid transparent !important;border-radius:4px !important}.generate-all-variants-button .material-symbols-outlined,.commit-all-variants-button .material-symbols-outlined{font-size:16px !important}.generate-all-variants-button:hover,.commit-all-variants-button:hover{background:transparent !important;border-color:transparent !important}.btn-icon-only{width:28px !important;min-width:28px !important;height:24px !important;padding:0 !important;justify-content:center !important;background:var(--glass-white-medium) !important;border:1px solid var(--glass-white-heavy) !important;color:var(--glass-white-90) !important;box-shadow:none !important;border-radius:4px !important}.btn-icon-only .material-symbols-outlined{font-size:16px !important}.nav-icon.node-focus-btn{width:28px !important;height:24px !important;border-radius:4px}.nav-icon.node-focus-btn .material-symbols-outlined{font-size:16px !important}.unified-list-item:hover{background:rgba(255,255,255,0.05);border-color:rgba(255,255,255,0.08)}.unified-list-item:last-child{margin-bottom:0}.unified-list-header{display:flex;align-items:center;padding:var(--space-2) var(--space-3);font-size:11px;font-weight:500;color:var(--text-secondary);border-bottom:1px solid var(--glass-white-light);gap:var(--space-3)}.variable-row,.variable-header{display:grid;grid-template-columns:25% 15% 1fr 50px 40px;gap:var(--space-2);width:100%;align-items:center}.variable-cell{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;font-size:12px;display:flex;align-items:center;height:100%;line-height:1;padding:0}.component-item,.component-set-header,.child-header,.quality-issue-card{padding:8px 12px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.05);border-radius:8px;margin-bottom:4px;display:flex;align-items:center;transition:var(--transition-fast)}.component-item:hover,.child-header:hover,.quality-issue-card:hover{background:rgba(255,255,255,0.05);border-color:rgba(255,255,255,0.08)}.component-set-header{padding:8px 12px;border-radius:8px;margin-bottom:4px;cursor:pointer;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.05);position:relative;z-index:2;transition:var(--transition-fast)}.component-set-header:hover{background:rgba(255,255,255,0.05);border-color:rgba(255,255,255,0.08)}.component-set-children{display:none;padding-left:var(--space-4);margin-top:4px;border-left:2px solid rgba(255,255,255,0.08);margin-left:14px}.component-set-children.expanded{display:block;animation:slideDown 0.2s ease-out}.list-badge,.badge,.component-meta .badge,.quality-issue-count{display:inline-flex;align-items:center;justify-content:center;height:20px;padding:0 8px;border-radius:12px;font-size:11px;font-weight:600;background:var(--glass-purple-medium);color:var(--purple-light);border:1px solid var(--glass-purple-20);white-space:nowrap;line-height:1}.badge-component-set{background:var(--glass-purple-heavy);color:var(--neutral-0);border-color:var(--glass-purple-light)}.badge-variant{background:var(--glass-white-10);color:var(--glass-white-70);border:none}.nav-icon,.action-icon,.node-focus-btn,.focus-btn,.icon-button{width:28px;height:28px;min-width:28px;border-radius:6px;display:flex;align-items:center;justify-content:center;padding:0;background:transparent !important;border:none !important;color:var(--neutral-0);cursor:pointer;transition:all 0.2s ease;box-shadow:none !important}.nav-icon:hover,.action-icon:hover,.node-focus-btn:hover,.focus-btn:hover{background:transparent !important;color:#a855f7 !important;border-color:transparent !important;transform:none}.nav-icon .material-symbols-outlined,.action-icon .material-symbols-outlined,.node-focus-btn .material-symbols-outlined{font-size:18px}.component-header-content{display:flex;align-items:center;gap:var(--space-3);flex:1;width:100%}.component-meta{display:flex;align-items:center;gap:8px;flex:1}.component-name{font-weight:500;font-size:13px;color:var(--neutral-0)}.component-actions{display:flex;gap:4px;margin-left:auto}.generate-all-variants-button,.commit-all-variants-button{width:32px !important;min-width:32px !important;height:28px !important;overflow:hidden;transition:background-color 0.2s ease;display:flex;align-items:center;justify-content:center !important;padding:0 !important;white-space:nowrap;background:transparent !important;border:1px solid transparent !important;border-radius:6px !important}.generate-all-variants-button:hover,.commit-all-variants-button:hover{background:transparent !important;border-color:transparent !important}.action-btn-label{opacity:0;transform:translateX(-10px);transition:all 0.2s ease;margin-left:8px;font-size:11px;font-weight:500;pointer-events:none}.generate-all-variants-button:hover .action-btn-label,.commit-all-variants-button:hover .action-btn-label{display:none}.btn-icon-only{width:32px !important;min-width:32px !important;height:28px !important;padding:0 !important;justify-content:center !important;background:var(--glass-white-medium) !important;border:1px solid var(--glass-white-heavy) !important;color:var(--glass-white-90) !important;box-shadow:none !important}.btn-icon-only:hover{width:32px !important;background:var(--glass-white-heavy) !important;color:var(--neutral-0) !important;border-color:var(--glass-white-30) !important;transform:translateY(-1px);box-shadow:0 4px 12px rgba(0,0,0,0.1) !important}.btn-icon-only .action-btn-label{display:none !important}.nav-icon.node-focus-btn{width:32px !important;height:28px !important;border-radius:6px}.child-component table{box-shadow:none;border-radius:0;margin:0}.component-regular{background:var(--glass-white-light);backdrop-filter:var(--blur-medium);padding:var(--space-4);border:1px solid var(--glass-white-medium);border-radius:var(--radius-container);margin-bottom:var(--space-3);color:var(--neutral-0);transition:all 0.2s cubic-bezier(0.4,0,0.2,1)}.component-regular:hover{transform:translateY(-1px);box-shadow:0 6px 20px var(--glass-purple-medium);border-color:var(--glass-purple-light)}.component-name{font-weight:var(--font-semibold);font-size:13px;margin-right:var(--space-3);color:var(--neutral-0)}.component-meta{display:flex;align-items:center;flex-wrap:wrap;gap:var(--space-2)}.component-styles{margin-top:var(--space-3);padding:var(--space-3);background:var(--glass-white-light);backdrop-filter:var(--blur-light);border-radius:var(--radius-button);font-size:var(--text-xs);color:rgba(255,255,255,0.85);overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:100%;cursor:pointer;transition:all 0.3s ease;position:relative;font-family:'SF Mono','Monaco','Inconsolata','Roboto Mono',monospace;border:1px solid var(--glass-white-medium)}.component-styles:hover{background:var(--glass-purple-10);border-color:var(--glass-purple-medium)}.component-styles.expanded{white-space:pre-wrap;overflow:auto;max-height:400px;border:1px solid var(--glass-purple-heavy);padding:var(--space-4);background:var(--glass-white-light);backdrop-filter:var(--blur-medium);box-shadow:0 8px 32px var(--glass-dark-light);color:var(--neutral-0)}.close-button{position:absolute;top:var(--space-2);right:var(--space-2);background:var(--glass-purple-light);border:1px solid var(--glass-purple-heavy);border-radius:var(--radius-sm);padding:var(--space-1) var(--space-2);font-size:var(--text-xs);cursor:pointer;display:none;color:var(--neutral-0);font-weight:var(--font-medium)}.close-button:hover{background:var(--glass-white-heavy);color:var(--neutral-0)}.component-styles.expanded .close-button{display:block}.style-content-wrapper{width:100%}.style-loading{display:flex;align-items:center;gap:8px;padding:16px;color:var(--neutral-400);font-size:14px;font-style:italic;background:rgba(255,255,255,0.02);border-radius:6px;border:1px dashed var(--neutral-600)}.loading-spinner{animation:pulse 1.5s ease-in-out infinite}@keyframes pulse{0%,100%{opacity:1}50%{opacity:0.5}}.expand-indicator{color:var(--purple-light);font-style:italic;cursor:pointer;font-weight:var(--font-medium)}.expand-indicator:hover{color:var(--purple-light);text-decoration:underline}.style-expanded{white-space:pre-wrap;word-break:break-word}.json-key{color:var(--warning-400);font-weight:var(--font-semibold)}.json-string{color:var(--success-500)}.notification-container{position:fixed;top:var(--space-4);right:var(--space-4);z-index:10000;max-width:400px;display:flex;flex-direction:column;pointer-events:none}.notification-container > *{pointer-events:auto}.notification{background:var(--neutral-800);backdrop-filter:var(--blur-intense);border:1px solid var(--glass-white-medium);border-radius:var(--radius-modal);padding:var(--space-4);margin-bottom:var(--space-3);box-shadow:0 4px 12px var(--glass-dark-50);border-left:3px solid;display:flex;align-items:flex-start;gap:var(--space-3);animation:slideIn 0.3s ease-out;transition:all 0.3s ease;position:relative;overflow:hidden;color:var(--neutral-0)}.notification.success{border-left-color:var(--success-500);background:linear-gradient(135deg,rgba(34,197,94,0.15) 0%,rgba(34,197,94,0.05) 100%),var(--neutral-800)}.notification.error{border-left-color:var(--error-500);background:linear-gradient(135deg,rgba(239,68,68,0.15) 0%,rgba(239,68,68,0.05) 100%),var(--neutral-800)}.notification.info{border-left-color:var(--purple-light);background:linear-gradient(135deg,rgba(139,92,246,0.15) 0%,rgba(139,92,246,0.05) 100%),var(--neutral-800)}.notification-icon{width:20px;height:20px;flex-shrink:0;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:bold;font-size:var(--text-sm);margin-top:var(--space-1);backdrop-filter:var(--blur-medium);box-shadow:0 4px 8px var(--glass-dark-light)}.notification.success .notification-icon{background:rgba(34,197,94,0.8);color:var(--neutral-0)}.notification.error .notification-icon{background:rgba(239,68,68,0.8);color:var(--neutral-0)}.notification.info .notification-icon{background:rgba(139,92,246,0.8);color:var(--neutral-0)}.notification-content{flex:1;min-width:0}.notification-title{font-weight:var(--font-semibold);margin-bottom:var(--space-1);font-size:var(--text-sm);color:var(--neutral-0)}.notification-message{font-size:var(--text-sm);color:rgba(255,255,255,0.85);line-height:1.4;word-break:break-word}.notification-close{background:transparent !important;backdrop-filter:none !important;border:none !important;font-size:var(--text-lg);color:var(--glass-white-70);cursor:pointer;padding:0;width:24px;height:24px;display:flex;align-items:center;justify-content:center;border-radius:var(--radius-modal);flex-shrink:0;transition:var(--transition-fast)}.notification-close:hover{background:transparent !important;color:var(--neutral-0);border-color:transparent !important;transform:scale(1.1)}@keyframes slideIn{from{transform:translateX(100%);opacity:0}to{transform:translateX(0);opacity:1}}.notification.fade-out{animation:fadeOut 0.3s ease-in forwards}@keyframes fadeOut{from{transform:translateX(0);opacity:1}to{transform:translateX(100%);opacity:0}}.notification-message a,.modal-notification-message a{color:var(--purple-light);font-weight:var(--font-semibold);text-decoration:none;display:inline-block;margin-top:var(--space-2);padding:var(--space-2) var(--space-3);background:var(--glass-purple-light);border:1px solid var(--glass-purple-heavy);border-radius:var(--radius-md);transition:var(--transition-fast);white-space:nowrap}.notification-message a:hover,.modal-notification-message a:hover{background:var(--glass-purple-medium);border-color:rgba(139,92,246,0.6);color:#ddd6fe;transform:translateX(2px)}.notification-message a::after,.modal-notification-message a::after{content:' â†’';margin-left:var(--space-1);transition:transform 0.2s ease;display:inline-block}.notification-message a:hover::after,.modal-notification-message a:hover::after{transform:translateX(3px)}.modal-notification{margin:var(--space-4) 0;padding:var(--space-4);border-radius:var(--radius-modal);border:1px solid var(--glass-white-heavy);border-left:3px solid;background:var(--glass-white-medium);backdrop-filter:var(--blur-intense);box-shadow:0 8px 32px var(--glass-dark-light);display:flex;align-items:flex-start;gap:var(--space-3);animation:slideInModal 0.3s ease-out;color:var(--neutral-0)}.modal-notification.success{border-left-color:var(--success-500);background:linear-gradient(135deg,rgba(34,197,94,0.1) 0%,var(--glass-white-light) 100%)}.modal-notification.error{border-left-color:var(--error-500);background:linear-gradient(135deg,rgba(239,68,68,0.1) 0%,var(--glass-white-light) 100%)}.modal-notification.info{border-left-color:var(--purple-light);background:linear-gradient(135deg,var(--glass-purple-10) 0%,var(--glass-white-light) 100%)}.modal-notification-icon{width:24px;height:24px;flex-shrink:0;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:bold;font-size:var(--text-base);margin-top:var(--space-1);backdrop-filter:var(--blur-medium);box-shadow:0 4px 8px var(--glass-dark-light)}.modal-notification.success .modal-notification-icon{background:rgba(34,197,94,0.8);color:var(--neutral-0)}.modal-notification.error .modal-notification-icon{background:rgba(239,68,68,0.8);color:var(--neutral-0)}.modal-notification.info .modal-notification-icon{background:rgba(139,92,246,0.8);color:var(--neutral-0)}.modal-notification-content{flex:1;min-width:0}.icon-btn-square{background:transparent;border:1px solid transparent;color:var(--glass-white-80);cursor:pointer;padding:0;border-radius:var(--radius-md);display:flex;align-items:center;justify-content:center;transition:all 0.2s ease;height:32px;width:32px;min-width:32px;backdrop-filter:var(--blur-medium);position:relative;z-index:1;box-shadow:none !important}.icon-btn-square:hover{background:var(--glass-white-heavy);color:var(--neutral-0);border-color:var(--glass-white-30);transform:translateY(-1px);box-shadow:0 4px 12px rgba(0,0,0,0.1);z-index:10}.icon-btn-wide{background:var(--glass-white-medium);border:1px solid var(--glass-white-heavy);color:var(--glass-white-80);cursor:pointer;padding:0;border-radius:var(--radius-md);display:flex;align-items:center;justify-content:center;transition:all 0.2s ease;height:32px;width:48px;backdrop-filter:var(--blur-medium);position:relative;z-index:1;box-shadow:none !important}.icon-btn-wide:hover{background:var(--glass-white-heavy);color:var(--neutral-0);border-color:var(--glass-white-30);transform:translateY(-1px);box-shadow:0 4px 12px rgba(0,0,0,0.1);z-index:10}.primary-action-btn{background:var(--glass-white-medium);border:1px solid var(--glass-white-heavy);color:var(--glass-white-90);cursor:pointer;padding:var(--space-2) var(--space-3);border-radius:var(--radius-md);display:flex;align-items:center;justify-content:center;gap:6px;transition:all 0.2s ease;height:32px;width:auto;backdrop-filter:var(--blur-medium);font-size:var(--text-xs);font-weight:var(--font-semibold);box-shadow:none}.btn-gradient-primary{background:linear-gradient(    135deg,var(--primary-600),var(--purple-medium),var(--purple-bright)  );color:var(--neutral-0);border:none;box-shadow:0 4px 15px var(--glass-purple-heavy)}.btn-gradient-primary:hover{background:linear-gradient(    135deg,var(--primary-600),var(--purple-medium),var(--purple-bright)  );transform:translateY(-1px);box-shadow:0 6px 20px var(--glass-purple-heavy);filter:brightness(1.1);color:var(--neutral-0);border:none}.primary-action-btn:hover{background:var(--glass-white-heavy);color:var(--neutral-0);border-color:var(--glass-white-30);transform:translateY(-1px);box-shadow:none}.primary-action-btn:disabled{opacity:0.5;cursor:not-allowed;transform:none;box-shadow:none;pointer-events:none}.settings-icon{background:var(--glass-white-medium);border:1px solid var(--glass-white-heavy);color:var(--glass-white-80);cursor:pointer;padding:0;border-radius:var(--radius-md);display:flex;align-items:center;justify-content:center;transition:all 0.2s ease;height:32px;width:32px;min-width:32px;backdrop-filter:var(--blur-medium);position:relative;z-index:1}.settings-icon:hover{background:var(--glass-white-heavy);color:var(--neutral-0);border-color:var(--glass-white-30);transform:translateY(-1px);box-shadow:0 4px 12px rgba(0,0,0,0.1);z-index:10}.compact-action-btn:disabled{opacity:0.5;cursor:not-allowed;pointer-events:none}.modal-notification-title{font-weight:var(--font-semibold);margin-bottom:var(--space-2);font-size:var(--text-base);color:var(--neutral-0)}.modal-notification-message{font-size:var(--text-sm);color:rgba(255,255,255,0.85);line-height:1.4;word-break:break-word}.modal-notification-message a{color:var(--purple-light);text-decoration:underline;font-weight:var(--font-medium)}.modal-notification-message a:hover{color:var(--purple-light);text-decoration:none}.modal-notification-close{background:var(--glass-white-medium);backdrop-filter:var(--blur-medium);border:1px solid var(--glass-white-heavy);font-size:var(--text-xl);color:var(--glass-white-70);cursor:pointer;padding:0;width:28px;height:28px;display:flex;align-items:center;justify-content:center;border-radius:var(--radius-modal);flex-shrink:0;transition:var(--transition-fast)}.modal-notification-close:hover{background:var(--glass-white-heavy);color:var(--neutral-0);border-color:var(--glass-white-30);transform:scale(1.1)}@keyframes slideInModal{from{transform:translateY(-10px);opacity:0}to{transform:translateY(0);opacity:1}}.json-number{color:var(--purple-light)}.json-boolean{color:#60a5fa}.json-null{color:var(--glass-white-60)}button{padding:var(--space-3) var(--space-4);background:linear-gradient(135deg,var(--purple-medium) 0%,var(--purple-bright) 100%);color:var(--neutral-0);border:1px solid var(--glass-white-heavy);border-radius:var(--radius-modal);font-weight:var(--font-semibold);cursor:pointer;transition:all 0.2s cubic-bezier(0.4,0,0.2,1);font-size:var(--text-sm);height:auto;min-height:40px;display:inline-flex;align-items:center;justify-content:center;gap:var(--space-2);box-shadow:0 8px 25px var(--glass-purple-medium);position:relative;backdrop-filter:var(--blur-medium)}button:hover{background:linear-gradient(135deg,#7c3aed 0%,#9333ea 100%);box-shadow:0 12px 35px var(--glass-purple-heavy);transform:translateY(-1px);border-color:var(--glass-white-30)}button:active{transform:translateY(0);box-shadow:0 6px 20px var(--glass-purple-medium)}button:disabled{background:var(--glass-white-medium);color:var(--glass-white-50);cursor:not-allowed;box-shadow:none;transform:none}.generate-all-variants-button{background:linear-gradient(135deg,var(--purple-medium),var(--purple-bright));color:var(--neutral-0) !important;box-shadow:0 4px 15px var(--glass-purple-medium)}.generate-all-variants-button:hover{background:transparent !important;color:#a855f7 !important;box-shadow:none !important;transform:translateY(-2px)}.commit-all-variants-button{background:linear-gradient(135deg,#f59e0b,var(--warning-400));color:var(--neutral-0) !important}.commit-all-variants-button:hover{background:linear-gradient(135deg,#d97706,#f59e0b);color:var(--neutral-0) !important;transform:translateY(-2px)}.commit-all-variants-button:disabled{background:var(--glass-white-medium) !important;color:var(--glass-white-50) !important;transform:none !important;cursor:not-allowed}.commit-all-variants-button:disabled:hover{background:var(--glass-white-medium) !important;color:var(--glass-white-50) !important;transform:none !important;cursor:not-allowed}.action-buttons{display:flex;gap:var(--space-3);margin-top:var(--space-4);flex-wrap:wrap}select{padding:1rem 1.5rem;border-radius:var(--radius-card);border:2px solid var(--glass-white-medium);background:var(--glass-white-light);backdrop-filter:var(--blur-medium);color:var(--neutral-0);font-size:var(--text-sm);transition:all 0.3s ease}select:focus{border-color:var(--glass-purple-50);outline:none;box-shadow:0 0 20px var(--glass-purple-medium);background:var(--glass-white-medium)}textarea{width:100%;padding:1rem 1.5rem;border:2px solid var(--glass-white-medium);border-radius:var(--radius-card);font-size:var(--text-sm);resize:vertical;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Helvetica Neue',Arial,sans-serif;transition:all 0.3s ease;background:var(--glass-white-light);backdrop-filter:var(--blur-medium);color:var(--neutral-0)}textarea:focus{border-color:var(--glass-purple-50);outline:none;box-shadow:0 0 20px var(--glass-purple-medium);background:var(--glass-white-medium)}input,input[type='text'],input[type='email'],input[type='password']{padding:0.75rem 1rem;border:1px solid var(--glass-white-10);border-radius:var(--radius-sm);font-size:var(--text-sm);transition:all 0.2s ease;background:var(--glass-white-medium);color:var(--neutral-0)}input::placeholder,textarea::placeholder{color:var(--glass-white-40)}input:focus,input[type='text']:focus,input[type='email']:focus,input[type='password']:focus{border-color:var(--primary-500);outline:none;box-shadow:0 0 0 2px rgba(124,58,237,0.2);background:var(--glass-white-heavy)}.modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:var(--glass-dark-85);z-index:1000;animation:fadeIn 0.2s ease-out}.modal-content{position:relative;background:#1e1e2e;margin:5% auto;padding:var(--space-6);width:90%;max-width:500px;max-height:90vh;border-radius:var(--radius-container);box-shadow:0 25px 50px var(--glass-dark-50);overflow-y:auto;display:flex;flex-direction:column;border:1px solid var(--glass-white-10);color:var(--neutral-0);animation:slideUp 0.3s cubic-bezier(0.4,0,0.2,1)}@keyframes slideUp{from{opacity:0;transform:translateY(20px) scale(0.95)}to{opacity:1;transform:translateY(0) scale(1)}}.modal-header{margin-bottom:var(--space-4);padding-bottom:var(--space-3);border-bottom:1px solid var(--glass-white-medium);background:var(--glass-purple-10);margin:calc(-1 * var(--space-6)) calc(-1 * var(--space-6)) var(--space-4);padding:var(--space-8) var(--space-6) var(--space-4);border-radius:var(--radius-container) 20px 0 0;display:flex;align-items:center;justify-content:space-between}.modal-header h3{margin:0;color:var(--neutral-0);font-size:var(--text-xl);font-weight:var(--font-bold)}.modal-body{margin-bottom:var(--space-4);overflow-y:auto;flex:1;min-height:0}.form-group{margin-bottom:var(--space-4)}.form-group label{display:block;margin-bottom:var(--space-2);color:var(--glass-white-90);font-weight:var(--font-semibold);font-size:var(--text-sm)}.form-group input{width:100%;padding:var(--space-3) var(--space-4);border:1px solid var(--neutral-300);border-radius:var(--radius-lg);font-size:var(--text-sm);transition:var(--transition-fast);box-shadow:var(--shadow-sm)}.form-group input:focus{border-color:var(--primary-500);outline:none;box-shadow:0 0 0 3px var(--primary-100)}.modal-footer{display:flex;justify-content:flex-end;gap:var(--space-3);padding-top:var(--space-4);border-top:1px solid var(--neutral-200)}.checkbox-group{display:flex;align-items:center;gap:var(--space-2);margin-bottom:var(--space-4)}.checkbox-group input[type='checkbox']{width:auto;margin-right:var(--space-2)}.close-modal{position:absolute;top:calc(var(--space-4) + 4px);right:var(--space-6);background:transparent !important;backdrop-filter:none !important;border:none !important;box-shadow:none !important;font-size:var(--text-lg);cursor:pointer;color:var(--glass-white-40);width:32px;height:32px;border-radius:var(--radius-button);display:flex;align-items:center;justify-content:center;transition:var(--transition-fast);font-weight:bold}.close-modal:hover{background:transparent !important;border-color:transparent !important;transform:scale(1.1);color:var(--neutral-0)}.success-message,.test-success-message{background:linear-gradient(135deg,var(--success-50) 0%,var(--success-100) 100%);color:var(--success-700);padding:var(--space-4);border-radius:var(--radius-lg);margin-top:var(--space-4);font-size:var(--text-sm);display:none;border:1px solid var(--success-200);box-shadow:var(--shadow-sm);font-weight:var(--font-medium)}.error-message{background:linear-gradient(135deg,var(--error-50) 0%,var(--error-100) 100%);color:var(--error-700);padding:var(--space-4);border-radius:var(--radius-lg);margin-top:var(--space-4);font-size:var(--text-sm);border:1px solid var(--error-200);box-shadow:var(--shadow-sm)}.error-message p{margin:0 0 var(--space-2) 0}.error-message p:last-child{margin-bottom:0}.error-help{color:var(--glass-white-80);font-size:var(--text-sm);font-style:italic;margin-top:var(--space-2)}.merge-request-link{margin-top:var(--space-4);display:inline-flex;align-items:center;gap:var(--space-2);text-decoration:none;color:var(--primary-600);font-weight:var(--font-semibold);padding:var(--space-2) var(--space-3);border-radius:var(--radius-md);transition:var(--transition-fast);background:var(--primary-50);border:1px solid var(--primary-200)}.merge-request-link:hover{background:var(--primary-100);text-decoration:none;transform:translateY(-1px)}.progress-bar-container{width:100%;height:8px;background:var(--neutral-200);border-radius:var(--radius-sm);margin:var(--space-4) 0 var(--space-2) 0;overflow:hidden;box-shadow:inset 0 1px 2px rgba(0,0,0,0.1)}.progress-bar{height:100%;width:0%;background:linear-gradient(90deg,var(--primary-500),var(--primary-600));border-radius:var(--radius-sm);transition:width 0.4s cubic-bezier(0.4,0,0.2,1);position:relative}.progress-bar::after{content:'';position:absolute;top:0;left:0;bottom:0;right:0;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.3),transparent);animation:shimmer 1s infinite}@keyframes shimmer{0%{transform:translateX(-100%);opacity:0}50%{opacity:1}100%{transform:translateX(100%);opacity:0}}.progress-status{font-size:var(--text-sm);color:var(--glass-white-80);margin-bottom:var(--space-4);font-style:italic;font-weight:var(--font-medium)}#commit-progress-container{background:var(--neutral-50);padding:var(--space-4);border-radius:var(--radius-lg);margin-bottom:var(--space-4);border:1px solid var(--neutral-200);box-shadow:var(--shadow-sm)}.credentials-display{display:flex;align-items:center;background:var(--neutral-50);padding:var(--space-4);border-radius:var(--radius-lg);margin-bottom:var(--space-4);border:1px solid var(--neutral-200);justify-content:space-between;box-shadow:var(--shadow-sm)}.credentials-display > div{font-size:var(--text-sm);margin-right:var(--space-3)}#project-id-display{font-weight:var(--font-semibold);color:var(--neutral-0)}#token-display{font-family:'SF Mono','Monaco','Inconsolata','Roboto Mono',monospace;color:var(--glass-white-80)}.security-note,.security-note-compact{background:linear-gradient(135deg,var(--warning-50) 0%,var(--warning-100) 100%);border:1px solid var(--warning-200);border-radius:var(--radius-lg);padding:var(--space-4);margin:var(--space-4) 0;font-size:var(--text-sm);box-shadow:var(--shadow-sm)}.security-note{display:none}.security-note-compact{font-style:italic;color:var(--warning-700);display:none}.security-note p{margin-top:0;font-weight:var(--font-semibold);color:var(--warning-700)}.security-note ul{margin-bottom:0;padding-left:var(--space-5)}.saved-info{margin-top:var(--space-4);padding-top:var(--space-4);border-top:1px dashed var(--warning-300);font-style:italic;color:var(--warning-700)}.units-section{margin-bottom:var(--space-8);background:var(--glass-white-light);backdrop-filter:var(--blur-medium);border-radius:var(--radius-xl);padding:var(--space-6);border:1px solid var(--glass-white-medium);box-shadow:0 8px 32px var(--glass-dark-light)}.units-section h4{margin-top:0;margin-bottom:var(--space-4);color:var(--neutral-0);font-size:var(--text-lg);font-weight:var(--font-bold)}.units-group{margin-bottom:var(--space-4);padding:var(--space-4);background:var(--glass-white-light);backdrop-filter:var(--blur-light);border-radius:var(--radius-lg);border:1px solid var(--glass-white-heavy);box-shadow:0 4px 15px rgba(0,0,0,0.1)}.units-group h5{margin-top:0;margin-bottom:var(--space-3);color:rgba(255,255,255,0.85);font-size:var(--text-base);font-weight:var(--font-semibold)}.unit-setting-row{display:flex;justify-content:space-between;align-items:center;padding:var(--space-2) 0;border-bottom:1px solid var(--glass-white-medium)}.unit-setting-row:last-child{border-bottom:none}.unit-setting-label{font-weight:var(--font-medium);color:var(--neutral-0);flex:1}.unit-setting-control{display:flex;align-items:center;gap:var(--space-2)}.unit-dropdown{padding:var(--space-2) var(--space-3);border-radius:var(--radius-md);border:1px solid var(--glass-white-heavy);background:var(--glass-white-light);backdrop-filter:var(--blur-light);color:var(--neutral-0);font-size:var(--text-sm);min-width:80px;transition:var(--transition-fast)}.unit-dropdown:focus{border-color:var(--glass-purple-50);outline:none;box-shadow:0 0 20px var(--glass-purple-medium);background:var(--glass-white-medium)}.default-unit-label{font-size:var(--text-xs);color:rgba(255,255,255,0.85);font-style:italic;background:var(--glass-purple-10);padding:4px 8px;border-radius:var(--radius-sm);border:1px solid var(--glass-purple-20);cursor:help;transition:var(--transition-fast)}.default-unit-label:hover{background:var(--glass-purple-medium);border-color:var(--glass-purple-30);color:rgba(255,255,255,1)}.default-unit-label strong{color:var(--primary-300);font-weight:600}.validation-issues{background:rgba(239,68,68,0.1);backdrop-filter:var(--blur-medium);border:2px solid rgba(239,68,68,0.3);border-left:6px solid var(--error-500);border-radius:var(--radius-container);padding:var(--space-6);margin-bottom:var(--space-8);box-shadow:0 8px 32px rgba(239,68,68,0.1)}.validation-issues h3{margin-top:0;margin-bottom:var(--space-4);color:#dc2626;font-size:16px;font-weight:var(--font-bold);display:flex;align-items:center;gap:var(--space-2)}.validation-issues h3::before{content:'âš ï¸';font-size:16px}.validation-issues-list{display:flex;flex-direction:column;gap:var(--space-2);margin-bottom:var(--space-3)}.validation-issue-item{display:flex;align-items:center;gap:var(--space-2);padding:var(--space-3);background:var(--glass-white-light);backdrop-filter:var(--blur-light);border:1px solid rgba(239,68,68,0.2);border-left:3px solid var(--error-500);border-radius:var(--radius-modal);font-size:var(--text-sm);box-shadow:var(--shadow-sm)}.validation-issue-item strong{color:var(--warning-400);font-weight:var(--font-semibold)}.issue-description{color:var(--glass-white-90);font-style:italic;margin-left:auto;margin-right:var(--space-2)}.issue-link{color:var(--purple-light);text-decoration:none;font-weight:var(--font-semibold);padding:var(--space-2) var(--space-3);border-radius:8px;transition:var(--transition-fast);background:var(--glass-purple-light);border:1px solid var(--glass-purple-heavy);display:flex;align-items:center;white-space:nowrap;font-size:12px;cursor:pointer;font-family:inherit}.issue-link:hover{background:var(--glass-purple-medium);color:#ddd6fe;text-decoration:none;transform:translateY(-1px);border-color:rgba(139,92,246,0.6)}.issue-link svg{transition:transform 0.2s ease}.issue-link:hover svg{transform:translateX(2px)}.validation-help{padding:var(--space-3);background:var(--glass-white-heavy);backdrop-filter:var(--blur-medium);border-radius:var(--radius-md);border:1px solid rgba(239,68,68,0.3)}.validation-help small{color:var(--glass-white-90);font-size:var(--text-sm);font-weight:var(--font-medium)}.has-validation-issues .subgroup-title{color:var(--error-200) !important;font-weight:var(--font-semibold)}.validation-warning{color:var(--error-500);margin-left:var(--space-2);font-size:var(--text-base)}.validation-alert{border-radius:12px;padding:16px;margin-bottom:16px;display:flex;align-items:center;justify-content:space-between}.validation-alert-warning{background:rgba(255,152,0,0.1);border:1px solid rgba(255,152,0,0.3)}.validation-alert-error{background:rgba(239,68,68,0.1);border:1px solid rgba(239,68,68,0.3)}.validation-alert-button{padding:8px 16px;border-radius:8px;cursor:pointer;font-weight:500;white-space:nowrap;border:1px solid;background:transparent;transition:all 0.2s ease}.validation-alert-button-warning{background:rgba(255,152,0,0.2);border-color:rgba(255,152,0,0.4);color:#ff9800}.validation-alert-button-warning:hover{background:rgba(255,152,0,0.3);border-color:rgba(255,152,0,0.6)}.validation-alert-button-error{background:rgba(239,68,68,0.2);border-color:rgba(239,68,68,0.4);color:#e74c3c}.validation-alert-button-error:hover{background:rgba(239,68,68,0.3);border-color:rgba(239,68,68,0.6)}@media (max-height:700px){.modal-content{margin:2% auto;max-height:96vh;padding:var(--space-6)}}@media (max-height:500px){.modal-content{margin:1% auto;max-height:98vh;padding:var(--space-4)}.modal-header{margin-bottom:var(--space-2)}.modal-body{margin-bottom:var(--space-2)}}@media (max-width:768px){.container{padding:var(--space-4)}.section{padding:var(--space-4)}.action-buttons{flex-direction:column}}@keyframes slideIn{from{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}.variable-import-tab{display:flex;flex-direction:column;gap:var(--space-6);height:100%;overflow-y:auto}.variable-import-header{text-align:center;padding:var(--space-4) 0;border-bottom:1px solid var(--glass-white-medium)}.variable-import-header h2{display:flex;align-items:center;justify-content:center;gap:var(--space-2);margin:0 0 var(--space-2) 0;color:var(--neutral-0);font-size:var(--text-xl);font-weight:var(--font-semibold)}.variable-import-header p{margin:0;color:var(--glass-white-80);font-size:var(--text-sm)}.import-section{background:var(--glass-white-light);backdrop-filter:var(--blur-medium);border:1px solid var(--glass-white-medium);border-radius:var(--radius-container);padding:var(--space-6);transition:var(--transition-fast)}.import-section h3{margin:0 0 var(--space-4) 0;color:var(--neutral-0);font-size:var(--text-lg);font-weight:var(--font-semibold);display:flex;align-items:center;gap:var(--space-2)}.input-tabs{display:flex;gap:var(--space-1);margin-bottom:var(--space-4);background:var(--glass-white-light);border-radius:var(--radius-card);padding:var(--space-1)}.input-tab{flex:1;padding:var(--space-2) var(--space-4);background:transparent;border:none;color:var(--glass-white-70);font-size:var(--text-sm);font-weight:var(--font-medium);border-radius:var(--radius-button);cursor:pointer;transition:var(--transition-fast)}.input-tab.active{background:var(--gradient-button);color:var(--neutral-0);box-shadow:var(--shadow-purple-light)}.input-tab:hover:not(.active){background:var(--glass-white-medium)}.input-content{display:none}.input-content.active{display:block}.input-format-selector{display:flex;gap:var(--space-4);margin-bottom:var(--space-4)}.input-format-selector label{display:flex;align-items:center;gap:var(--space-1);color:var(--glass-white-80);font-size:var(--text-sm);cursor:pointer}.input-format-selector input[type='radio']{accent-color:var(--purple-medium)}#token-input{width:100%;min-height:300px;background:rgba(255,255,255,0.02);border:1px solid var(--glass-white-medium);border-radius:var(--radius-card);padding:var(--space-4);color:var(--neutral-0);font-family:'SF Mono','Monaco','Inconsolata','Roboto Mono',monospace;font-size:var(--text-sm);line-height:var(--leading-relaxed);resize:vertical;transition:var(--transition-fast)}#token-input:focus{outline:none;border-color:var(--purple-medium);box-shadow:0 0 0 2px var(--glass-purple-light)}#token-input::placeholder{color:var(--glass-white-40)}.file-upload-area{border:2px dashed var(--glass-white-medium);border-radius:var(--radius-card);padding:var(--space-8);text-align:center;cursor:pointer;transition:var(--transition-fast)}.file-upload-area:hover{border-color:var(--purple-light);background:var(--glass-purple-light)}.file-upload-area.drag-over{border-color:var(--primary-500);background:var(--glass-purple-heavy);transform:scale(1.02);box-shadow:0 0 0 4px rgba(124,58,237,0.1)}.file-upload-area svg{color:var(--glass-white-50);margin-bottom:var(--space-3)}.file-upload-area p{margin:0;color:var(--glass-white-80);font-size:var(--text-sm)}.input-actions{display:flex;gap:var(--space-3);margin-top:var(--space-4)}.parse-status{margin-top:var(--space-4);padding:var(--space-3) var(--space-4);border-radius:var(--radius-button);font-size:var(--text-sm);font-weight:var(--font-medium)}.parse-status.info{background:rgba(96,165,250,0.1);border:1px solid rgba(96,165,250,0.3);color:#60a5fa}.parse-status.success{background:rgba(34,197,94,0.1);border:1px solid rgba(34,197,94,0.3);color:var(--success-500)}.parse-status.warning{background:rgba(251,191,36,0.1);border:1px solid rgba(251,191,36,0.3);color:var(--warning-400)}.parse-status.error{background:rgba(239,68,68,0.1);border:1px solid rgba(239,68,68,0.3);color:var(--error-500)}.diff-summary{margin-bottom:var(--space-4)}.diff-stats{display:flex;gap:var(--space-4);flex-wrap:wrap}.stat-item{background:var(--glass-white-medium);border-radius:var(--radius-card);padding:var(--space-3) var(--space-4);text-align:center;min-width:80px}.stat-number{display:block;font-size:var(--text-xl);font-weight:var(--font-bold);margin-bottom:var(--space-1)}.stat-label{display:block;font-size:var(--text-xs);opacity:0.8;text-transform:uppercase;letter-spacing:0.5px}.stat-item.new .stat-number{color:var(--success-500)}.options-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:var(--space-6)}.option-group{background:rgba(255,255,255,0.02);border-radius:var(--radius-card);padding:var(--space-4)}.option-group h4{margin:0 0 var(--space-3) 0;color:var(--neutral-0);font-size:var(--text-base);font-weight:var(--font-medium)}.checkbox-label{display:flex;align-items:center;gap:var(--space-2);color:var(--glass-white-90);font-size:var(--text-sm);cursor:pointer;margin-bottom:var(--space-2)}.checkbox-label:last-child{margin-bottom:0}.checkbox-label input[type='checkbox']{accent-color:var(--purple-medium);width:16px;height:16px}.input-group{margin-top:var(--space-3)}.input-group label{display:block;margin-bottom:var(--space-1);color:var(--glass-white-80);font-size:var(--text-sm);font-weight:var(--font-medium)}.input-group input[type='text']{width:100%;background:var(--glass-white-medium);border:1px solid var(--glass-white-medium);border-radius:var(--radius-button);padding:var(--space-2) var(--space-3);color:var(--neutral-0);font-size:var(--text-sm);transition:var(--transition-fast)}.input-group input[type='text']:focus{outline:none;border-color:var(--purple-medium);box-shadow:0 0 0 2px var(--glass-purple-light)}.import-actions{display:flex;gap:var(--space-3);margin-top:var(--space-4)}.btn-large{padding:var(--space-3) var(--space-6);font-size:var(--text-base);font-weight:var(--font-semibold);display:flex;align-items:center;gap:var(--space-2)}.import-progress{margin:var(--space-4) 0}.progress-bar{width:100%;height:8px;background:var(--glass-white-10);border-radius:var(--radius-pill);overflow:hidden;margin-bottom:var(--space-2)}.progress-fill{height:100%;background:var(--gradient-button);width:0%;transition:width 2s ease;border-radius:var(--radius-pill)}.progress-text{text-align:center;color:var(--glass-white-80);font-size:var(--text-sm)}.import-result{margin-top:var(--space-4)}.result-summary{padding:var(--space-4);border-radius:var(--radius-card);border:1px solid}.result-summary.success{background:rgba(34,197,94,0.1);border-color:rgba(34,197,94,0.3)}.result-summary h4{margin:0 0 var(--space-3) 0;color:var(--neutral-0);font-size:var(--text-lg);font-weight:var(--font-semibold)}.result-stats{display:flex;gap:var(--space-4);margin-bottom:var(--space-3)}.result-stats .stat{color:var(--glass-white-90);font-size:var(--text-sm);font-weight:var(--font-medium)}.apply-actions{display:flex;gap:var(--space-3);margin-top:var(--space-4)}.apply-summary{margin-bottom:var(--space-4);padding:var(--space-4);background:var(--glass-purple-05);border:1px solid var(--glass-purple-light);border-radius:var(--radius-card);color:var(--glass-white-90)}@keyframes fadeIn{from{opacity:0}to{opacity:1}}@keyframes shimmer{0%{transform:translateX(-100%);opacity:0}50%{opacity:1}100%{transform:translateX(100%);opacity:0}}#oauth-login-button{position:relative;overflow:hidden;transition:all 0.3s cubic-bezier(0.4,0,0.2,1)}#oauth-login-button::before{content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,var(--glass-white-heavy),transparent);transition:left 0.5s}#oauth-login-button:hover::before{left:100%}#oauth-login-button:hover{transform:translateY(-1px);box-shadow:0 4px 12px rgba(34,197,94,0.3)}#oauth-login-button:active{transform:translateY(0)}#oauth-status{animation:fadeIn 0.3s ease-out}.import-actions .btn svg,.btn-primary svg,.btn-large svg{display:inline-block;vertical-align:middle;margin-right:var(--space-2);stroke:currentColor;fill:none;flex-shrink:0}.import-actions .btn{display:flex;align-items:center;justify-content:center;gap:var(--space-2)}.import-section{display:flex;flex-direction:column;gap:var(--space-4)}.import-header{margin-bottom:var(--space-2)}.import-header h3{color:var(--neutral-0);margin-bottom:var(--space-1)}.import-header p{color:var(--glass-white-70);font-size:var(--text-sm);margin:0}.import-input-area textarea{width:100%;height:150px;background:var(--glass-dark-light);border:1px solid var(--glass-white-10);border-radius:var(--radius-md);color:var(--neutral-200);font-family:'Fira Code',monospace;font-size:var(--text-xs);padding:var(--space-3);resize:vertical;transition:all 0.2s ease}.import-input-area textarea:focus{outline:none;border-color:var(--primary-500);background:var(--glass-dark-30)}.import-actions-bar{display:flex;justify-content:space-between;align-items:center;gap:var(--space-3)}.import-options{flex:1}.select-input{width:100%;background:var(--glass-white-medium);border:1px solid var(--glass-white-10);border-radius:var(--radius-md);color:var(--neutral-0);padding:var(--space-2) var(--space-3);font-size:var(--text-sm)}.import-preview-section{background:var(--glass-dark-15);border:1px solid var(--glass-white-medium);border-radius:var(--radius-lg);padding:var(--space-4);margin-top:var(--space-4)}.import-preview-section.hidden{display:none}.preview-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:var(--space-3)}.preview-stats{display:flex;gap:var(--space-2)}.badge{padding:2px 8px;border-radius:12px;font-size:11px;font-weight:var(--font-bold);background:var(--glass-white-10);color:var(--glass-white-80)}.badge-success{background:rgba(34,197,94,0.2);color:#4ade80}.badge-warning{background:rgba(234,179,8,0.2);color:#facc15}.badge-danger{background:rgba(239,68,68,0.2);color:#f87171}.import-strategy-selector{margin-bottom:var(--space-4);padding:var(--space-3);background:var(--glass-white-light);border-radius:var(--radius-md);display:flex;align-items:center;gap:var(--space-4)}.radio-group{display:flex;gap:var(--space-4)}.radio-group label{display:flex;align-items:center;gap:var(--space-2);cursor:pointer;font-size:var(--text-sm);color:var(--neutral-200)}.preview-table-container{max-height:300px;overflow-y:auto;border:1px solid var(--glass-white-medium);border-radius:var(--radius-md);margin-bottom:var(--space-4)}.preview-table{width:100%;border-collapse:collapse;font-size:var(--text-xs)}.preview-table th{text-align:left;padding:var(--space-2) var(--space-3);background:var(--glass-white-medium);color:var(--glass-white-60);font-weight:var(--font-medium);position:sticky;top:0;backdrop-filter:blur(5px)}.preview-table td{padding:var(--space-2) var(--space-3);border-bottom:1px solid var(--glass-white-light);color:var(--neutral-200)}.preview-table tr:last-child td{border-bottom:none}.token-new{color:#4ade80}.token-update{color:#facc15}.token-conflict{color:#f87171}.token-ignore{color:var(--glass-white-30);text-decoration:line-through}.import-confirmation-actions{display:flex;justify-content:flex-end;gap:var(--space-3)}.btn-primary{background:var(--primary-500);color:white;border:none;padding:8px 16px;border-radius:var(--radius-md);cursor:pointer;font-weight:var(--font-medium);transition:all 0.2s}.btn-primary:hover:not(:disabled){background:var(--primary-600)}.btn-primary:disabled{opacity:0.5;cursor:not-allowed}.btn-secondary{background:transparent;color:var(--neutral-300);border:1px solid var(--glass-white-20);padding:8px 16px;border-radius:var(--radius-md);cursor:pointer;box-shadow:none;background-image:none}.btn-secondary:hover{border-color:var(--glass-white-40);color:var(--neutral-0)}.material-symbols-outlined{font-variation-settings:'FILL' 0,'wght' 400,'GRAD' 0,'opsz' 24;font-size:20px;display:inline-block;vertical-align:middle;line-height:1}.help-icon{font-size:14px;color:var(--text-secondary);margin-left:6px;cursor:help;vertical-align:middle;transition:color 0.2s}.help-icon:hover{color:var(--highlight)}[data-tooltip]{position:relative;overflow:visible}[data-tooltip]:not([data-tooltip='']):hover::after{content:attr(data-tooltip);position:absolute;top:100%;left:50%;transform:translateX(-50%) translateY(8px);background:#0f172a !important;color:#fff;padding:6px 10px;border-radius:6px;font-size:12px;font-weight:500;font-family:'Inter',sans-serif;line-height:1.4;white-space:normal;max-width:200px;text-align:center;text-transform:none;opacity:1;visibility:visible;pointer-events:none;z-index:9999;box-shadow:0 4px 6px -1px rgba(0,0,0,0.1),0 2px 4px -1px rgba(0,0,0,0.06);border:1px solid var(--glass-white-10);backdrop-filter:none !important;animation:tooltipFadeIn 0.15s ease-out}[data-tooltip]:not([data-tooltip='']):hover::before{content:'';position:absolute;top:100%;left:50%;transform:translateX(-50%);border-width:5px;border-style:solid;border-color:transparent transparent #0f172a transparent !important;opacity:1;visibility:visible;pointer-events:none;z-index:9999;animation:tooltipFadeIn 0.15s ease-out}@keyframes tooltipFadeIn{from{opacity:0;transform:translateX(-50%) translateY(0)}to{opacity:1;transform:translateX(-50%) translateY(8px)}}.header-summary{display:flex;align-items:center;gap:8px;background:transparent;padding:0;border:none}.summary-badge{display:flex;align-items:center;gap:6px;background:var(--glass-purple-medium);border:1px solid var(--glass-purple-heavy);padding:4px 10px;border-radius:20px;color:var(--neutral-0);font-size:13px;font-weight:500;transition:all 0.2s ease;cursor:default;position:relative;z-index:50}.summary-badge:hover{background:var(--glass-purple-heavy);border-color:var(--glass-purple-40);transform:translateY(-1px)}.summary-badge .material-symbols-outlined{font-size:16px;color:var(--purple-light)}.summary-badge span:last-child{font-feature-settings:'tnum';letter-spacing:0.02em}.provider-cards{display:flex;gap:var(--space-4);margin-bottom:var(--space-6);justify-content:center}.provider-card{flex:1;background:var(--glass-white-light);border:1px solid var(--glass-white-medium);border-radius:var(--radius-lg);padding:var(--space-4);cursor:pointer;transition:all 0.3s cubic-bezier(0.4,0,0.2,1);display:flex;flex-direction:column;align-items:center;text-align:center;gap:var(--space-3);min-width:120px;position:relative;overflow:hidden}.provider-card:hover{transform:translateY(-4px);background:var(--glass-white-medium);border-color:var(--glass-white-heavy);box-shadow:none}.provider-card.selected{background:linear-gradient(135deg,var(--glass-white-10),var(--glass-white-medium));border-color:var(--primary-400);box-shadow:none}.provider-card.selected::before{content:'';position:absolute;top:0;left:0;right:0;bottom:0;background:radial-gradient(circle at top right,var(--glass-purple-20),transparent 70%);pointer-events:none}.provider-icon{width:48px;height:48px;border-radius:12px;display:flex;align-items:center;justify-content:center;background:var(--glass-white-10);font-size:24px;margin-bottom:var(--space-1)}.settings-accordion{display:flex;flex-direction:column;gap:var(--space-3);opacity:1;transform:translateY(0);transition:all 0.5s cubic-bezier(0.4,0,0.2,1)}.hidden-section{display:none !important}.accordion-item{background:var(--glass-white-light);border:1px solid var(--glass-white-medium);border-radius:var(--radius-md);overflow:hidden;transition:border-color 0.3s ease}.accordion-item:hover{border-color:var(--glass-white-heavy)}.accordion-header{padding:14px 16px;display:flex;justify-content:space-between;align-items:center;cursor:pointer;background:var(--glass-white-light);user-select:none;transition:background 0.2s ease}.accordion-header:hover{background:rgba(255,255,255,0.06)}.accordion-title{display:flex;align-items:center;gap:var(--space-3);font-weight:var(--font-semibold);color:var(--neutral-0);font-size:var(--text-sm)}.accordion-icon{color:var(--glass-white-70);font-size:20px}.accordion-arrow{color:var(--glass-white-50);transition:transform 0.3s cubic-bezier(0.4,0,0.2,1);font-size:20px}.accordion-item.expanded .accordion-arrow{transform:rotate(180deg);color:var(--primary-300)}.accordion-item.expanded .accordion-header{border-bottom:1px solid var(--glass-white-medium);background:var(--glass-purple-05)}.accordion-item.expanded{border-color:var(--primary-500);box-shadow:0 4px 12px rgba(0,0,0,0.1)}.accordion-content{max-height:0;overflow:hidden;transition:max-height 0.4s cubic-bezier(0.4,0,0.2,1),padding 0.4s ease;padding:0 16px;opacity:0}.accordion-item.expanded .accordion-content{max-height:500px;padding:16px;opacity:1;transition-delay:0.1s}.settings-input-group{margin-bottom:var(--space-4)}.settings-input-group:last-child{margin-bottom:0}.settings-label{display:block;margin-bottom:var(--space-2);color:var(--glass-white-90);font-size:var(--text-xs);font-weight:var(--font-medium)}.settings-helper{margin-top:var(--space-1);font-size:11px;color:var(--glass-white-50);line-height:1.4}.toggle-switch{display:flex;align-items:center;gap:var(--space-3);cursor:pointer;padding:8px 0;overflow:visible !important;position:relative}.toggle-input{opacity:0;width:0;height:0}.toggle-slider{position:relative;cursor:pointer;width:40px;height:22px;background-color:var(--glass-white-20);transition:0.3s;border-radius:22px}.toggle-slider:before{position:absolute;content:'';height:16px;width:16px;left:3px;bottom:3px;background-color:white;transition:0.3s cubic-bezier(0.4,0,0.2,1);border-radius:50%}.toggle-input:checked + .toggle-slider{background-color:var(--primary-500)}.toggle-input:checked + .toggle-slider:before{transform:translateX(18px)}.guide-progress-container{margin-bottom:24px;background:var(--glass-white-medium);border-radius:var(--radius-lg);padding:16px;border:1px solid var(--glass-white-10)}.guide-progress-header{display:flex;justify-content:space-between;margin-bottom:8px;font-size:13px;font-weight:600;color:#fff}.guide-progress-percentage{color:var(--primary-400)}.guide-progress-track{width:100%;height:8px;background:var(--glass-white-10);border-radius:4px;overflow:hidden}.guide-progress-fill{height:100%;background:linear-gradient(90deg,#818cf8 0%,var(--purple-light) 100%);width:0%;transition:width 0.5s cubic-bezier(0.4,0,0.2,1)}.guide-checklist{display:flex;flex-direction:column;gap:12px}.guide-item{display:flex;align-items:flex-start;gap:12px;padding:16px;background:var(--glass-white-light);border:1px solid var(--glass-white-heavy);border-radius:var(--radius-lg);transition:all 0.2s ease}.guide-item:hover{background:rgba(255,255,255,0.06);border-color:rgba(255,255,255,0.15)}.guide-item.completed{background:rgba(34,197,94,0.05);border-color:rgba(34,197,94,0.2)}.guide-item.completed .guide-title{text-decoration:line-through;color:var(--glass-white-50)}.notification-toast{position:fixed;top:20px;right:20px;max-width:320px;background:rgba(15,23,42,0.95);backdrop-filter:blur(12px);border:1px solid rgba(255,255,255,0.1);border-left:3px solid var(--primary-500);border-radius:8px;padding:12px 16px;z-index:10000;box-shadow:0 10px 40px rgba(0,0,0,0.5),0 2px 10px rgba(0,0,0,0.3);transition:all 0.3s cubic-bezier(0.16,1,0.3,1);transform:translateX(120%);color:white}.btn-loading{position:relative;color:transparent !important;pointer-events:none}.btn-loading::after{content:'';position:absolute;top:50%;left:50%;width:14px;height:14px;margin-left:-7px;margin-top:-7px;border:2px solid rgba(255,255,255,0.3);border-radius:50%;border-top-color:white;animation:spin 0.8s linear infinite}.btn-success{background:var(--success-600) !important;color:white !important;pointer-events:none;border-color:var(--success-500) !important;display:inline-flex;align-items:center;justify-content:center;gap:4px}.guide-item.completed .guide-status{background:rgba(34,197,94,0.2);color:#4ade80}.guide-checkbox-container{width:18px;height:18px;flex:0 0 18px;min-width:18px;position:relative;margin-top:3px;margin-right:12px}.guide-checkbox{appearance:none;-webkit-appearance:none;width:18px !important;height:18px !important;border:2px solid var(--glass-white-30);border-radius:4px;background:transparent;cursor:pointer;transition:all 0.2s;position:relative;display:block;margin:0 !important;padding:0 !important;box-shadow:none !important}.guide-checkbox:checked{background:var(--primary-500);border-color:var(--primary-500)}.guide-checkbox:checked:disabled{background:var(--primary-500);border-color:var(--primary-500);opacity:0.7;cursor:not-allowed}.guide-checkbox:checked::after{content:'check';font-family:'Material Symbols Outlined';font-size:14px;color:white;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-weight:700}.guide-checkbox:disabled{border-color:var(--glass-white-10);background:var(--glass-white-medium);cursor:not-allowed}.guide-content{flex:1}.guide-title{font-size:14px;font-weight:600;color:#fff;margin-bottom:4px;transition:color 0.2s}.guide-description{font-size:12px;color:var(--glass-white-60);line-height:1.4;margin-bottom:8px}.guide-actions{display:flex;gap:8px;margin-top:8px}.guide-action-btn{background:var(--glass-purple-medium);border:1px solid var(--glass-purple-30);color:var(--purple-light);font-size:11px;font-weight:600;padding:4px 10px;border-radius:4px;cursor:pointer;transition:all 0.2s}.guide-action-btn:hover{background:var(--glass-purple-30)}.guide-status{font-size:10px;font-weight:600;text-transform:uppercase;padding:3px 8px;border-radius:99px;background:var(--glass-white-10);color:var(--glass-white-60);letter-spacing:0.5px;border:1px solid var(--glass-white-10);display:inline-flex;align-items:center}.guide-item.completed .guide-status{background:rgba(34,197,94,0.1);color:#4ade80;border-color:rgba(34,197,94,0.2)}.quality-nodes-list{display:flex;flex-direction:column;gap:4px}.quality-node-item{background:var(--glass-white-light);border-radius:var(--radius-sm);overflow:hidden;transition:background 0.2s ease}.quality-node-item:hover{background:rgba(255,255,255,0.06)}.node-header{display:flex;align-items:center;gap:8px;padding:6px 8px;cursor:pointer;height:32px}.quality-issue-header{cursor:pointer;transition:background 0.2s ease;border-radius:6px}.quality-issue-header:hover{background:rgba(255,255,255,0.05)}.quality-issue-chevron{transition:transform 0.2s ease;color:rgba(255,255,255,0.5);transform:rotate(0deg)}.quality-issue-card.expanded .quality-issue-chevron{transform:rotate(90deg);color:rgba(255,255,255,0.9)}.quality-issue-card.expanded .quality-issue-header{background:rgba(255,255,255,0.05);border-bottom-left-radius:0;border-bottom-right-radius:0}.node-icon{font-size:16px;color:var(--glass-white-40)}.node-name{flex:1;font-size:12px;color:var(--glass-white-90);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;font-weight:500}.subgroup-stats{color:var(--glass-white-60);font-size:11px;padding:0;border-radius:0;min-width:unset;text-align:right}.node-count{background:var(--glass-purple-20);color:var(--purple-light);font-size:10px;font-weight:600;padding:1px 6px;border-radius:99px;min-width:20px;text-align:center}.node-toggle-icon{font-size:16px;color:var(--glass-white-40);transition:transform 0.2s ease}.node-focus-btn{background:transparent !important;border:none !important;color:var(--neutral-0);cursor:pointer;padding:4px;border-radius:4px;display:flex;align-items:center;justify-content:center;transition:all 0.2s;opacity:1;box-shadow:none !important}.node-focus-btn:hover{background:transparent !important;color:#a855f7 !important;opacity:1;transform:scale(1.1)}.node-focus-btn .material-symbols-outlined{font-size:16px}.node-instances{background:var(--glass-dark-15);border-top:1px solid var(--glass-white-light)}.instance-row{display:flex;align-items:center;justify-content:space-between;padding:4px 8px 4px 32px;height:28px;border-bottom:1px solid var(--glass-white-light)}.instance-row:last-child{border-bottom:none}.instance-label{font-size:11px;color:var(--glass-white-50);font-style:italic}.quality-collection.variable-collection{background:transparent;border:none;box-shadow:none;overflow:visible}.quality-skeleton-loader{padding:var(--space-4);animation:fadeIn 0.3s ease}.skeleton-group{margin-bottom:var(--space-4)}.skeleton-header{display:flex;align-items:center;gap:var(--space-2);margin-bottom:var(--space-3)}.skeleton-icon{width:18px;height:18px;border-radius:4px;background:var(--glass-white-10);animation:skeleton-pulse 1.5s infinite ease-in-out}.skeleton-title{height:14px;width:120px;border-radius:4px;background:var(--glass-white-10);animation:skeleton-pulse 1.5s infinite ease-in-out;animation-delay:0.1s}.skeleton-content{padding-left:26px}.skeleton-row{height:32px;width:100%;border-radius:var(--radius-md);margin-bottom:var(--space-2);background:var(--glass-white-05);animation:skeleton-pulse 1.5s infinite ease-in-out;animation-delay:0.2s}.skeleton-row.short{width:60%}.scanning-text{display:flex;align-items:center;justify-content:center;gap:var(--space-3);color:var(--glass-white-50);margin-top:var(--space-6);font-size:13px}.loading-spinner.small{width:16px;height:16px;border-width:2px}@keyframes skeleton-pulse{0%{opacity:0.3}50%{opacity:0.7}100%{opacity:0.3}}.quality-collection .collection-content{background:transparent;backdrop-filter:none;border:none;border-top:none;border-bottom-left-radius:0;border-bottom-right-radius:0;box-shadow:none}.token-fix-select{appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23a78bfa' d='M6 8L2 4h8z'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 8px center;padding-right:28px;height:fit-content}.token-fix-select:focus{outline:none;border-color:#8b5cf6;box-shadow:0 0 0 2px rgba(139,92,246,0.2)}.custom-select{position:relative;flex:1;min-width:0}.custom-select-trigger{display:flex;align-items:center;justify-content:space-between;width:100%;padding:6px 12px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:rgba(255,255,255,0.9);font-size:12px;cursor:pointer;transition:all 0.2s ease;min-height:28px}.custom-select-trigger:hover{background:rgba(255,255,255,0.08);border-color:rgba(255,255,255,0.2)}.custom-select-trigger.active{border-color:#8b5cf6;box-shadow:0 0 0 2px rgba(139,92,246,0.2)}.custom-select-trigger .trigger-text{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.custom-select-trigger .trigger-icon{font-size:16px;color:#a78bfa;margin-left:8px;transition:transform 0.2s ease}.custom-select-trigger.active .trigger-icon{transform:rotate(180deg)}.custom-select-menu{position:absolute;top:calc(100% + 4px);left:0;width:100%;max-height:250px;overflow-y:auto;background:#1e1e1e;border:1px solid rgba(255,255,255,0.1);border-radius:8px;z-index:1000;box-shadow:0 10px 25px -5px rgba(0,0,0,0.5),0 8px 10px -6px rgba(0,0,0,0.5);display:none;backdrop-filter:blur(12px);padding:4px}.custom-select-menu{background:rgba(30,30,30,0.95)}.custom-select-menu.show{display:block;animation:dropdownIn 0.2s ease-out}@keyframes dropdownIn{from{opacity:0;transform:translateY(-8px)}to{opacity:1;transform:translateY(0)}}.custom-select-group-header{padding:8px 12px 4px 12px;font-size:10px;font-weight:700;text-transform:uppercase;color:rgba(255,255,255,0.4);letter-spacing:0.05em}.custom-select-group-header.exact{color:#a78bfa}.custom-select-group-header.near{color:#2dd4bf}.custom-select-option{padding:8px 12px;font-size:12px;color:rgba(255,255,255,0.8);cursor:pointer;border-radius:4px;transition:all 0.1s ease;display:flex;align-items:center;justify-content:space-between}.custom-select-option:hover{background:rgba(255,255,255,0.08);color:#fff}.custom-select-option.selected{background:rgba(139,92,246,0.15);color:#c084fc}.custom-select-option.create-new{font-weight:600;color:#a78bfa;border-top:1px solid rgba(255,255,255,0.05);margin-top:4px;padding-top:10px}.custom-select-divider{height:1px;background:rgba(255,255,255,0.05);margin:4px 8px}.secondary-action-btn{flex:1;padding:6px 12px;border-radius:4px;font-size:11px;font-weight:600;background:transparent;border:1px solid var(--purple-bright);color:var(--glass-white-90)}.secondary-action-btn:hover:not(:disabled){transform:translateY(-1px);box-shadow:0 4px 12px rgba(139,92,246,0.3);background:transparent}.token-fix-apply-btn,.secondary-action-btn{transition:all 0.2s ease}.token-fix-apply-btn:hover:not(:disabled){background:linear-gradient(135deg,#7c3aed 0%,#6d28d9 100%);transform:translateY(-1px);box-shadow:0 4px 12px rgba(139,92,246,0.3)}.token-fix-apply-btn:active:not(:disabled){transform:translateY(0);box-shadow:0 2px 6px rgba(139,92,246,0.3)}.occurrence-checkbox{accent-color:#8b5cf6;width:14px;height:14px}.occurrence-checkbox:hover{cursor:pointer}input[type='checkbox']:indeterminate{background-color:#8b5cf6;border-color:#8b5cf6}.quality-issue-card{background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.05);border-radius:var(--radius-modal);transition:all 0.2s ease}.quality-issue-card.expanded{background:rgba(139,92,246,0.1);border-color:#8b5cf6;box-shadow:0 0 0 1px rgba(139,92,246,0.2)}.quality-issue-card:hover{border-color:rgba(139,92,246,0.2);background:rgba(255,255,255,0.03)}.plugin-loading-spinner{width:24px;height:24px;border:2px solid rgba(255,255,255,0.1);border-top-color:var(--primary-500);border-radius:50%;animation:spin 1s linear infinite;margin-bottom:12px}@keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}.content-loading{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:40px 0;color:var(--text-secondary)}.plugin-loading-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background-color:var(--neutral-800);z-index:9999;display:flex;align-items:center;justify-content:center;flex-direction:column}.plugin-loading-content{display:flex;flex-direction:column;align-items:center;gap:16px;width:200px}.plugin-loading-title{font-size:18px;font-weight:600;color:#fff;margin-bottom:4px}.plugin-loading-status{font-size:12px;color:rgba(255,255,255,0.6);text-align:center}.plugin-loading-progress{width:100%;height:4px;background:rgba(255,255,255,0.1);border-radius:2px;overflow:hidden;margin-top:8px}.plugin-loading-progress-bar{height:100%;background:var(--primary-500);width:0%;transition:width 0.3s ease}.match-badge{display:inline-flex;align-items:center;justify-content:center;padding:2px 6px;border-radius:4px;font-size:10px;font-weight:500;margin-left:6px;line-height:1.2}.match-badge-exact{background-color:rgba(34,197,94,0.1);color:var(--success-500);border:1px solid rgba(34,197,94,0.2)}.match-badge-near{background-color:rgba(234,179,8,0.1);color:var(--warning-500);border:1px solid rgba(234,179,8,0.2)}.hidden{display:none !important}.expand-btn{background:transparent;border:none;cursor:pointer;padding:4px;border-radius:4px;color:var(--glass-white-60);transition:all 0.2s ease;display:flex;align-items:center;justify-content:center}.expand-btn:hover{background:var(--glass-white-10);color:var(--neutral-0)}.expand-btn svg{transition:transform 0.2s ease}.expand-btn.expanded svg{transform:rotate(180deg)}.component-instances{margin-left:14px;padding-left:14px;border-left:1px solid var(--glass-white-10);margin-top:4px;width:100%}.tailwind-icon{width:14px;height:14px;margin-left:6px;display:inline-flex;align-items:center;justify-content:center}.tailwind-icon svg{width:100%;height:100%}.mixed-value-icon{color:#fbbf24;font-size:14px;margin-left:6px;cursor:help;display:inline-flex;align-items:center;justify-content:center}.mixed-value-warning-variable{color:#fbbf24;margin-left:6px;font-size:14px;vertical-align:middle}.quality-list-item{padding:6px 12px}.stats-summary{display:flex;gap:var(--space-3);padding:var(--space-4);margin-bottom:var(--space-4);background:var(--glass-white-light);border-radius:var(--radius-card);border:1px solid var(--glass-white-10)}.stat-box{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:var(--space-3);background:var(--glass-purple-10);border-radius:var(--radius-sm);border:1px solid var(--glass-purple-20)}.stat-value{font-size:24px;font-weight:700;color:var(--purple-light);line-height:1;margin-bottom:4px}.stat-label{font-size:11px;font-weight:500;color:var(--glass-white-60);text-transform:uppercase;letter-spacing:0.5px}.component-list{display:flex;flex-direction:column}.component-info{display:flex;align-items:center;gap:var(--space-2);flex:1;min-width:0}.component-name{flex:1;min-width:0}.component-actions{display:flex;align-items:center;gap:var(--space-2)}.hidden{display:none !important}.expand-btn{background:transparent;border:none;cursor:pointer;padding:4px;border-radius:4px;color:var(--glass-white-60);transition:all 0.2s ease;display:flex;align-items:center;justify-content:center}.expand-btn:hover{background:var(--glass-white-10);color:var(--neutral-0)}.expand-btn svg{transition:transform 0.2s ease}.expand-btn.expanded svg{transform:rotate(180deg)}.component-instances{margin-left:14px;padding-left:14px;border-left:1px solid var(--glass-white-10);margin-top:4px;width:100%}.form-group{margin-bottom:var(--space-4)}.input-field,.select-field{width:100%;padding:12px 16px;background:rgba(30,41,59,0.6);border:1px solid rgba(139,92,246,0.3);border-radius:12px;color:var(--neutral-0);font-size:14px;outline:none;transition:var(--transition-fast)}.input-field:focus,.select-field:focus{border-color:var(--primary-400);background:rgba(30,41,59,0.8)}.input-variable-name{width:100%;background:linear-gradient(135deg,rgba(46,32,80,0.8) 0%,rgba(35,25,60,0.8) 100%);background-clip:padding-box;border:2px solid var(--primary-400);box-shadow:0 4px 12px rgba(0,0,0,0.2);border-radius:12px;padding:14px 16px;font-size:16px;font-weight:500;color:var(--neutral-0);transition:var(--transition-normal)}.input-variable-name:focus{box-shadow:0 0 0 4px rgba(139,92,246,0.3),0 8px 24px rgba(139,92,246,0.15);border-color:#a78bfa;background:linear-gradient(135deg,rgba(56,38,95,0.9) 0%,rgba(45,32,75,0.9) 100%)}.modal-footer-seamless{padding-top:0;border-top:none;display:flex;justify-content:flex-end;gap:var(--space-2)}.btn-secondary-glass{background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);color:var(--neutral-300);padding:10px 24px;border-radius:var(--radius-md);cursor:pointer;transition:var(--transition-fast)}.btn-secondary-glass:hover{background:rgba(255,255,255,0.1);color:var(--neutral-0)}.btn-primary-gradient{background:linear-gradient(135deg,var(--primary-400) 0%,var(--primary-500) 100%);box-shadow:0 4px 12px rgba(124,58,237,0.4);border:none;padding:10px 24px;color:white;border-radius:var(--radius-md);cursor:pointer;transition:var(--transition-fast)}.btn-primary-gradient:hover{transform:translateY(-1px);box-shadow:0 6px 16px rgba(124,58,237,0.5)}.issue-body{display:none;padding:0 12px 12px 12px;border-top:1px solid rgba(255,255,255,0.05)}.issue-fix-section{margin-top:12px;margin-bottom:8px;background:rgba(139,92,246,0.05);padding:8px;border-radius:6px;border:1px solid rgba(139,92,246,0.1)}.issue-fix-header{display:flex;align-items:center;gap:8px;margin-bottom:6px}.issue-fix-icon{font-size:16px;color:#a78bfa}.issue-fix-label{font-size:11px;color:rgba(255,255,255,0.7);font-weight:500;text-transform:uppercase}.btn-create-variable{width:100%;padding:8px 12px;display:flex;align-items:center;justify-content:center;gap:8px;font-size:12px;background:var(--primary-500);color:white;border:none;border-radius:4px;cursor:pointer;transition:var(--transition-fast)}.btn-create-variable:hover{background:var(--primary-600)}.fix-actions-row{display:flex;gap:8px;align-items:center}.select-fix-variable{flex:1;padding:6px 8px;background:rgba(0,0,0,0.3);border:1px solid rgba(139,92,246,0.3);border-radius:4px;color:rgba(255,255,255,0.9);font-size:12px;cursor:pointer}.btn-apply-fix{padding:6px 12px;background:linear-gradient(135deg,var(--primary-400) 0%,var(--primary-500) 100%);border:none;border-radius:4px;color:white;font-size:11px;font-weight:600;cursor:pointer;white-space:nowrap;transition:var(--transition-fast)}.btn-apply-fix:disabled{opacity:0.5;cursor:not-allowed;filter:grayscale(0.5)}.nodes-list-header{display:flex;align-items:center;margin-bottom:6px;padding-bottom:4px;border-bottom:1px dashed rgba(255,255,255,0.1)}.label-checkbox{display:flex;align-items:center;gap:8px;cursor:pointer;font-size:11px;color:rgba(255,255,255,0.7);flex:1}.label-text-uppercase{font-weight:500;text-transform:uppercase;font-size:10px;letter-spacing:0.5px}@keyframes spin{100%{transform:rotate(360deg)}}.quality-gauge-wrapper:hover .gauge-label{opacity:1 !important}.quality-gauge-wrapper:hover .gauge-segment{stroke-width:8 !important}.gauge-segment{cursor:help;transition:stroke-width 0.3s ease,filter 0.3s ease}.quality-legend .legend-item{transition:transform 0.2s ease}.quality-legend .legend-item:hover{transform:translateX(4px)}.page-selector-wrapper{position:relative;display:inline-block;min-width:120px}.page-selector-btn{display:flex;align-items:center;gap:8px;padding:6px 12px;background:rgba(255,255,255,0.06);border:1px solid rgba(255,255,255,0.12);border-radius:8px;color:white;font-size:11px;font-weight:600;cursor:pointer;transition:all 0.2s cubic-bezier(0.4,0,0.2,1);user-select:none;box-shadow:0 2px 8px rgba(0,0,0,0.2)}.page-selector-btn:hover{background:rgba(255,255,255,0.1);border-color:rgba(255,255,255,0.25);transform:translateY(-1px)}.page-selector-btn:active{transform:translateY(0)}.page-selector-dropdown{position:absolute;top:100%;left:0;margin-top:8px;width:260px;background:#1a1a1a;border:1px solid rgba(255,255,255,0.15);border-radius:12px;box-shadow:0 16px 48px rgba(0,0,0,0.7);z-index:1000;display:none;flex-direction:column;overflow:hidden;animation:dropdownFadeIn 0.2s ease-out}@keyframes dropdownFadeIn{from{opacity:0;transform:translateY(-4px)}to{opacity:1;transform:translateY(0)}}.page-selector-dropdown.show{display:flex}.page-selector-search{display:flex;align-items:center;gap:10px;padding:12px 14px;border-bottom:1px solid rgba(255,255,255,0.08);background:rgba(255,255,255,0.02)}.page-selector-search input{background:none;border:none;color:white;font-size:12px;flex:1;outline:none;padding:4px 0}.page-selector-search input::placeholder{color:rgba(255,255,255,0.25)}.page-list-scroll{max-height:240px;overflow-y:auto;padding:4px 0}.page-list-scroll::-webkit-scrollbar{width:6px}.page-list-scroll::-webkit-scrollbar-thumb{background:rgba(255,255,255,0.15);border-radius:3px}.dropdown-item{display:flex;align-items:center;gap:12px;padding:10px 14px;cursor:pointer;transition:all 0.15s ease}.dropdown-item:hover{background:rgba(255,255,255,0.06)}.dropdown-item.select-all-item{border-bottom:1px solid rgba(255,255,255,0.06);padding:12px 14px;background:rgba(255,255,255,0.02)}.dropdown-item input[type="checkbox"]{width:18px;height:18px;margin:0;accent-color:#8b5cf6;cursor:pointer;border-radius:4px}.dropdown-item label{color:rgba(255,255,255,0.9);font-size:12px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;user-select:none;cursor:pointer}.page-selector-footer{display:flex;gap:10px;padding:12px;border-top:1px solid rgba(255,255,255,0.08);background:rgba(255,255,255,0.03)}.multi-page-footer-btn{flex:1;padding:8px;border-radius:6px;font-size:11px;font-weight:700;cursor:pointer;border:none;transition:all 0.2s ease;text-transform:uppercase;letter-spacing:0.5px}.multi-page-footer-btn.cancel{background:rgba(255,255,255,0.08);color:rgba(255,255,255,0.7)}.multi-page-footer-btn.cancel:hover{background:rgba(255,255,255,0.12);color:white}.multi-page-footer-btn.apply{background:#8b5cf6;color:white;box-shadow:0 4px 12px rgba(139,92,246,0.3)}.multi-page-footer-btn.apply:hover{background:#7c3aed;transform:translateY(-1px);box-shadow:0 6px 16px rgba(139,92,246,0.4)}.page-scope-badge{font-size:9px;color:#a78bfa;background:rgba(139,92,246,0.2);padding:2px 8px;border-radius:12px;font-weight:800;text-transform:uppercase;margin-right:6px;letter-spacing:0.5px}.total-score-ring{opacity:1;transition:opacity 0.4s cubic-bezier(0.4,0,0.2,1)}.gauge-category{opacity:0;pointer-events:none;transition:opacity 0.4s cubic-bezier(0.4,0,0.2,1)}.quality-gauge-svg:hover .total-score-ring{opacity:0}.quality-gauge-svg:hover .gauge-category{opacity:1;pointer-events:all}.gauge-category:hover .gauge-label{opacity:1 !important}.gauge-category:hover path{stroke-width:12px !important;filter:drop-shadow(0 0 8px rgba(255,255,255,0.2))}.gauge-category path{transition:all 0.3s cubic-bezier(0.4,0,0.2,1)}.gauge-label text{transition:transform 0.3s ease}.gauge-category:hover .gauge-label text{transform:scale(1.1)}@keyframes scoreCelebration{0%{transform:scale(1)}50%{transform:scale(1.2);color:#22c55e}100%{transform:scale(1);color:#22c55e}}.score-celebration{animation:scoreCelebration 0.6s cubic-bezier(0.175,0.885,0.32,1.275)}body.edit-mode .header{border-color:var(--primary-500);box-shadow:0 0 15px rgba(124,58,237,0.1)}#header-quality-display{transition:opacity 0.3s ease}#finish-improving-btn{background:var(--success-600);border:1px solid var(--success-500);color:white;transition:all 0.2s ease}#finish-improving-btn:hover{background:var(--success-500);transform:translateY(-1px);box-shadow:0 4px 12px rgba(34,197,94,0.3)}#finish-improving-btn:active{transform:translateY(0)}.quality-header{transition:opacity 0.3s ease,transform 0.3s ease}body.edit-mode .quality-header{opacity:0;transform:translateY(-20px);pointer-events:none}.edit-mode-header{display:flex;align-items:center;justify-content:space-between;background:var(--glass-purple-heavy);border:1px solid var(--purple-medium);border-radius:var(--radius-lg);padding:8px 16px;margin-bottom:var(--space-2);box-shadow:0 4px 20px rgba(139,92,246,0.15);animation:slideDownFade 0.3s ease-out}@keyframes slideDownFade{from{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}.edit-mode-title{display:flex;align-items:center;gap:8px;font-weight:600;color:white;font-size:13px}.edit-mode-title .material-symbols-outlined{font-size:18px;color:var(--purple-light)}#edit-mode-gauge-container{display:flex;align-items:center;justify-content:center}.finish-btn{background:var(--success-600);border:1px solid var(--success-500);padding:6px 16px;height:32px;border-radius:16px;font-size:12px;font-weight:600;color:white;display:flex;align-items:center;gap:6px;cursor:pointer;transition:all 0.2s ease;box-shadow:0 2px 8px rgba(34,197,94,0.3)}.finish-btn:hover{background:var(--success-500);transform:translateY(-1px);box-shadow:0 4px 12px rgba(34,197,94,0.4)}.finish-btn:active{transform:translateY(0)}.celebration-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(15,23,42,0.95);backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);z-index:var(--z-modal);display:flex;align-items:center;justify-content:center;animation:fadeIn 0.4s ease-out}.celebration-content{background:linear-gradient(145deg,rgba(30,41,59,0.9),rgba(15,23,42,0.95));border:1px solid var(--glass-white-10);border-radius:var(--radius-xl);padding:40px;text-align:center;max-width:400px;width:90%;box-shadow:0 20px 50px rgba(0,0,0,0.5),0 0 30px rgba(139,92,246,0.2);transform:scale(0.9);animation:popIn 0.5s cubic-bezier(0.175,0.885,0.32,1.275) forwards}@keyframes popIn{to{transform:scale(1)}}.celebration-icon{font-size:48px;margin-bottom:16px;animation:bounce 1s infinite alternate}@keyframes bounce{from{transform:translateY(0)}to{transform:translateY(-10px)}}.celebration-title{font-size:24px;font-weight:800;color:white;margin-bottom:8px;background:linear-gradient(135deg,#fff,#c4b5fd);-webkit-background-clip:text;background-clip:text;-webkit-text-fill-color:transparent}.celebration-subtitle{font-size:14px;color:var(--glass-white-70);margin-bottom:32px}.celebration-score-comparison{display:flex;align-items:center;justify-content:center;gap:20px;margin-bottom:32px}.score-box{display:flex;flex-direction:column;align-items:center}.score-label{font-size:11px;text-transform:uppercase;letter-spacing:1px;color:var(--glass-white-50);margin-bottom:4px}.score-value{font-size:32px;font-weight:800;color:white}.score-box.highlight .score-value{color:var(--success-500);text-shadow:0 0 20px rgba(34,197,94,0.4)}.score-arrow{color:var(--glass-white-30)}.celebration-stats-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:32px;text-align:left}.stat-item{background:var(--glass-white-05);padding:12px;border-radius:var(--radius-md);border:1px solid var(--glass-white-05)}.stat-value{font-size:18px;font-weight:700;color:white;display:block}.stat-label{font-size:11px;color:var(--glass-white-60)}.celebration-close-btn{width:100%;padding:12px;font-size:14px}
    </style>
  </head>
  <body>
    <!-- Initial Loading Overlay -->
<div id="plugin-loading-overlay" class="plugin-loading-overlay">
  <div class="plugin-loading-content">
    <div class="plugin-loading-spinner"></div>
    <div class="plugin-loading-title">Bridgy</div>
    <div id="plugin-loading-status" class="plugin-loading-status">Initializing plugin...</div>
    <div class="plugin-loading-progress">
      <div id="plugin-loading-progress-bar" class="plugin-loading-progress-bar"></div>
    </div>
  </div>
</div>

<!-- Notification Container -->


<div class="container">
  <!-- Modern Header -->
  <header class="header">
    <div class="header-content">
      <div class="header-title">
        <h1>Bridgy</h1>
        <div
          class="beta-badge"
          onclick="toggleFeedback()"
          style="cursor: pointer"
          data-tooltip="Click to show feedback"
        >
          BETA
        </div>
      </div>
      <div class="header-actions">
        <button
          id="refresh-btn"
          onclick="refreshData()"
          class="refresh-button"
          data-tooltip="Refresh variables and components"
        >
          <span class="material-symbols-outlined">refresh</span>
        </button>
        <button
          id="units-icon-btn"
          onclick="openUnitsModal()"
          class="icon-btn-square"
          data-tooltip="Units Configuration"
        >
          <span class="material-symbols-outlined">straighten</span>
        </button>
        <button
          id="help-icon-btn"
          onclick="openUserGuide()"
          class="icon-btn-square"
          data-tooltip="User Guide"
        >
          <span class="material-symbols-outlined">help</span>
        </button>
        <button
          id="settings-icon-btn"
          onclick="openSettingsModal()"
          class="icon-btn-square"
          data-tooltip="Settings"
        >
          <span class="material-symbols-outlined">settings</span>
        </button>
<!-- Repo button moved to settings -->
      </div>
    </div>
  </header>

  <!-- Toggleable Feedback Section -->
  <div id="feedback-section" class="feedback-section" style="display: none">
    <div class="feedback-header">
      <div class="feedback-title">
        Welcome to Bridgy BETA!
      </div>
      <div style="display: flex; align-items: center; gap: var(--space-2)">
        <a href="https://bridgy-plugin.com/" target="_blank" class="feedback-website-link">
          Visit our website
        </a>
        <button class="feedback-close-btn" onclick="dismissFeedback()" title="Dismiss">
          <span class="material-symbols-outlined">close</span>
        </button>
      </div>
    </div>
    <p class="feedback-description">
      Thank you for trying Bridgy! We're actively improving based on your feedback.
    </p>
    <div class="feedback-buttons">
      <button class="feedback-button" onclick="openGitHubFeedback('bug')">
        <span>Report Bug</span>
      </button>
      <button class="feedback-button" onclick="openGitHubFeedback('feature')">
        <span>Request Feature</span>
      </button>
      <button class="feedback-button" onclick="openGitHubFeedback('general')">
        <span>General Feedback</span>
      </button>
    </div>
  </div>

  <!-- Edit Mode Header (Replaces Tabs) -->
  <div id="edit-mode-header" class="edit-mode-header" style="display: none;">
    <div class="edit-mode-title">
        <span class="material-symbols-outlined">build_circle</span>
        <span>Improvement Session</span>
    </div>
    
    <div id="edit-mode-gauge-container">
        <!-- Gauge injected here -->
    </div>
    
    <button
      id="finish-improving-btn"
      class="primary-action-btn finish-btn"
      onclick="finishImproving()"
      title="Finish and see results"
    >
      <span class="material-symbols-outlined">check_circle</span>
      <span class="toolbar-btn-text">Finish Improving</span>
    </button>
  </div>

  <div class="tabs" id="main-tabs">
    <div class="tab active" data-tab="quality">Quality</div>
    <div class="tab" data-tab="variables">Variables</div>
    <div class="tab" data-tab="stats">Components</div>
  </div>

  <div class="tab-content" id="variables-content">
    <div class="content-padding">
      <div id="variables-warning-container"></div>

      <div class="toolbar">
        <div class="toolbar-group">
          <button id="export-css-button" class="primary-action-btn" disabled title="Download CSS">
            <span class="material-symbols-outlined">download</span>
            <span class="toolbar-btn-text">Download</span>
          </button>
          <button
            id="commit-repo-button"
            class="primary-action-btn"
            disabled
            title="Commit to repository"
          >
            <span class="material-symbols-outlined">commit</span>
            <span class="toolbar-btn-text">Commit</span>
          </button>
          <button
            id="import-icon-button"
            class="primary-action-btn"
            onclick="openImportModal()"
            title="Import variables"
          >
            <span class="material-symbols-outlined">input</span>
            <span class="toolbar-btn-text">Import</span>
          </button>
        </div>

        <div id="variable-search-wrapper" class="search-wrapper-collapsible">
          <div class="search-input-wrapper" style="flex: 1">
            <input
              type="text"
              class="search-input"
              id="variable-search"
              placeholder="Search variables..."
            />
            <button
              class="search-clear-btn"
              id="clear-variable-search"
              onclick="clearSearch('variable-search')"
            >
              <span class="material-symbols-outlined" style="font-size: 16px">close</span>
            </button>
          </div>
        </div>

        <div class="toolbar-group">
          <button
            class="icon-btn-square"
            onclick="toggleSearchBar('variable-search-wrapper')"
            data-tooltip="Search variables"
          >
            <span class="material-symbols-outlined">search</span>
          </button>
          <button class="icon-btn-square" onclick="expandAllVariables()" data-tooltip="Expand all">
            <span class="material-symbols-outlined">unfold_more</span>
          </button>
          <button
            class="icon-btn-square"
            onclick="collapseAllVariables()"
            data-tooltip="Collapse all"
          >
            <span class="material-symbols-outlined">unfold_less</span>
          </button>
        </div>
      </div>

      <!-- Tab Header -->
      <div class="tab-header" style="margin-bottom: var(--space-2)">
        <div style="display: flex; align-items: baseline; gap: 12px; margin-bottom: 8px">
          <h2
            style="
              color: rgba(255, 255, 255, 0.9);
              display: flex;
              align-items: center;
              gap: 10px;
              font-size: 1.2rem;
              margin: 0;
            "
          >
            Variables
          </h2>
          <div id="variables-summary" class="header-summary">
            <span id="variables-count">0 vars</span> â€¢ <span id="collections-count">0 cols</span>
          </div>
        </div>
      </div>

      <div id="variables-container">
        <div class="content-loading">
          <div class="content-loading-spinner"></div>
          <div class="content-loading-text">Loading variables...</div>
        </div>
      </div>
    </div>
  </div>

  <div class="tab-content active" id="quality-content">
    <div class="content-padding">
      <!-- Tab Header -->

      <div id="quality-page-selector-container" style="display: flex; align-items: center; gap: 8px; margin-bottom: 24px; min-height: 32px; padding-left: 8px;">
        <div style="font-size: 11px; opacity: 0.5;">Checking Pages...</div>
      </div>

      <div class="quality-header" style="display: flex; justify-content: center; align-items: center; margin-bottom: 48px; gap: 64px; padding: 0 16px; min-height: 200px;">
        <!-- Left: Score Gauge -->
        <div id="quality-header-left" style="display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 4px;">
          <div id="quality-score-gauge-container" style="position: relative; width: 150px; height: 150px; display: flex; align-items: center; justify-content: center;">
            <!-- Dynamic Gauge will be injected here -->
          </div>
          <div style="text-align: center;">
            <div style="font-size: 10px; text-transform: uppercase; letter-spacing: 1.2px; opacity: 0.4; font-weight: 700;">Design System</div>
            <div style="font-size: 18px; font-weight: 800; color: white; letter-spacing: -0.2px; margin-top: -1px;">Quality Score</div>
            <div id="quality-summary-stats" style="font-size: 11px; color: rgba(255, 255, 255, 0.5); font-weight: 500; margin-top: 4px;">0 nodes â€¢ 0 issues</div>
          </div>
        </div>

        <!-- Right: Actions & Info -->
        <div id="quality-header-right" style="display: flex; flex-direction: column; justify-content: center; gap: 32px; padding: 0;">
          <!-- Legend centered vertically relative to Gauge -->
          <div class="quality-legend" id="quality-legend" style="display: flex; flex-direction: column; gap: 8px;">
            <div class="legend-item" style="display: flex; align-items: center; gap: 10px;">
              <div style="width: 10px; height: 10px; border-radius: 3px; background: #ef4444; border: 1px solid rgba(255,255,255,0.15);"></div>
              <span style="font-size: 11px; color: rgba(255,255,255,0.6); font-weight: 600;">0 - 39 (Needs Attention)</span>
            </div>
            <div class="legend-item" style="display: flex; align-items: center; gap: 10px;">
              <div style="width: 10px; height: 10px; border-radius: 3px; background: #fbbf24; border: 1px solid rgba(255,255,255,0.15);"></div>
              <span style="font-size: 11px; color: rgba(255,255,255,0.6); font-weight: 600;">40 - 74 (Progressing)</span>
            </div>
            <div class="legend-item" style="display: flex; align-items: center; gap: 10px;">
              <div style="width: 10px; height: 10px; border-radius: 3px; background: #22c55e; border: 1px solid rgba(255,255,255,0.15);"></div>
              <span style="font-size: 11px; color: rgba(255,255,255,0.6); font-weight: 600;">75 - 100 (Well Maintained)</span>
            </div>
          </div>

          <!-- Button positioned below legend -->
          <button
            class="btn-primary"
            style="padding: 0 24px; font-size: 11px; height: 34px; border-radius: 17px; text-transform: uppercase; letter-spacing: 1px; font-weight: 800; background: #8b5cf6; color: white; border: none; box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3); cursor: pointer; transition: all 0.2s ease;"
            onclick="handleImproveDesignSystem()"
            id="improve-design-btn"
          >
            Improve Score
          </button>
        </div>
      </div>


      <div id="quality-dashboard-container">
        <!-- 1. Missing Variables -->
        <div id="token-coverage-results">
          <div class="content-loading" style="display: none">
            <div class="content-loading-spinner"></div>
            <div class="content-loading-text">Analyzing variables...</div>
          </div>
        </div>

        <!-- 2. Variable Hygiene -->
        <div id="variable-hygiene-results-placeholder"></div>

        <!-- 3. Component Hygiene -->
        <div id="component-hygiene-results-placeholder"></div>

        <!-- 4. Tailwind Readiness -->
        <div id="tailwind-readiness-results-placeholder"></div>
      </div>
    </div>
  </div>

  <div class="tab-content" id="stats-content">
    <div class="content-padding">
      <!-- Tab Header -->
      <div class="tab-header" style="margin-bottom: var(--space-2)">
        <div style="display: flex; align-items: baseline; gap: 12px; margin-bottom: 8px">
          <h2
            style="
              color: rgba(255, 255, 255, 0.9);
              display: flex;
              align-items: center;
              gap: 10px;
              font-size: 1.2rem;
              margin: 0;
            "
          >
            Components
          </h2>
        </div>
        <p style="color: rgba(255, 255, 255, 0.6); font-size: 12px; margin: 0">
          Overview of all components and their usage frequency in the current document.
        </p>
      </div>

      <div id="stats-summary-container" style="margin-bottom: 24px;">
        <!-- Summary cards will be injected here -->
      </div>

      <div class="toolbar" style="margin-bottom: 24px;">
        <div class="toolbar-group">
          <!-- Multi-page Selector -->
          <div id="stats-page-selector-container" style="display: flex; align-items: center; gap: 8px;">
            <!-- Will be injected by JS -->
          </div>
        </div>

        <div id="stats-search-wrapper" class="search-wrapper-collapsible" style="display: flex; flex: 1; justify-content: flex-end;">
          <div class="search-input-wrapper" style="max-width: 200px;">
            <input
              type="text"
              class="search-input"
              id="stats-search"
              placeholder="Search components..."
            />
            <button
              class="search-clear-btn"
              id="clear-stats-search"
              onclick="clearSearch('stats-search')"
            >
              <span class="material-symbols-outlined" style="font-size: 16px">close</span>
            </button>
          </div>
        </div>

        <div class="toolbar-group">
          <button
            class="icon-btn-square"
            onclick="toggleSearchBar('stats-search-wrapper')"
            data-tooltip="Search components"
          >
            <span class="material-symbols-outlined">search</span>
          </button>
        </div>
      </div>

      <div id="stats-container">
        <div class="content-loading">
          <div class="plugin-loading-spinner"></div>
          <div class="content-loading-text">Loading stats...</div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- GitLab Commit Modal -->
<div id="gitlab-modal" class="modal">
  <div class="modal-content">
    <button class="close-modal" onclick="closeGitLabModal()">
      <span class="material-symbols-outlined">close</span>
    </button>
    <div class="modal-header">
      <h3>Commit to Repository</h3>
    </div>
    <div class="modal-body">
      <p>
        Configuration is managed in the Config tab. You can go there to set up your repository
        settings.
      </p>

      <div class="form-group">
        <label for="commit-message">Change Message</label>
        <textarea
          id="commit-message"
          rows="4"
          placeholder="Optional: Describe the changes"
        ></textarea>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn-secondary" onclick="closeGitLabModal()">Cancel</button>
      <button
        id="commit-submit-button"
        class="btn-primary"
        onclick="commitToGitLab()"
      >
        Commit
      </button>
    </div>
  </div>
</div>

<!-- Settings Modal -->
<div id="settings-modal" class="modal" style="display: none">
  <div class="modal-content">
    <button class="close-modal" onclick="closeSettingsModal()">
      <span class="material-symbols-outlined">close</span>
    </button>
    <div class="modal-header">
      <h3>Settings</h3>
    </div>
    <div class="modal-body">
      <h4>Repository Configuration</h4>
      <!-- New UX: 1. Provider Selection -->
      <div class="provider-cards">
        <div class="provider-card" id="card-gitlab" onclick="selectProvider('gitlab')">
          <div class="provider-icon" style="color: #fc6d26">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
              <path
                d="M22.65 14.39L12 22.13 1.35 14.39a.84.84 0 0 1-.3-.94l1.22-3.78 2.44-7.51A.42.42 0 0 1 4.82 2a.43.43 0 0 1 .41.26l2.47 7.6h8.6l2.47-7.6a.43.43 0 0 1 .41-.26.42.42 0 0 1 .11.02l2.44 7.51 1.22 3.78a.84.84 0 0 1-.3.94z"
              />
            </svg>
          </div>
          <div style="font-weight: 600; color: #fff">GitLab</div>
        </div>

        <div class="provider-card" id="card-github" onclick="selectProvider('github')">
          <div class="provider-icon" style="color: #fff">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
              <path
                d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0 0 24 12c0-6.63-5.37-12-12-12Z"
              />
            </svg>
          </div>
          <div style="font-weight: 600; color: #fff">GitHub</div>
        </div>
      </div>

      <input type="hidden" id="config-provider" value="" />

      <!-- New UX: 2. Staged Disclosure Accordion -->
      <div class="settings-accordion" id="settings-accordion">
        <!-- SECTION 1: CONNECTION -->
        <div class="accordion-item hidden-section" id="section-connection">
          <div class="accordion-header" onclick="toggleAccordion('section-connection')">
            <div class="accordion-title">
              <span class="material-symbols-outlined accordion-icon">link</span>
              Connection & Access
            </div>
            <span class="material-symbols-outlined accordion-arrow">expand_more</span>
          </div>
          <div class="accordion-content">
            <!-- GitLab URL -->
            <div class="settings-input-group" id="gitlab-url-group">
              <label class="settings-label" for="config-gitlab-url">GitLab Instance URL</label>
              <input
                type="text"
                id="config-gitlab-url"
                placeholder="https://gitlab.company.com (leave empty for GitLab.com)"
              />
              <div class="settings-helper">
                Supports Enterprise/Self-Hosted. Leave empty for GitLab.com
              </div>
            </div>

            <!-- GitHub URL -->
            <div class="settings-input-group" id="github-url-group" style="display: none">
              <label class="settings-label" for="config-github-url">GitHub Enterprise URL</label>
              <input
                type="text"
                id="config-github-url"
                placeholder="https://github.com (leave empty for Cloud)"
              />
              <div class="settings-helper">
                Enter custom URL for Enterprise, or leave empty for GitHub.com
              </div>
            </div>

            <!-- Project ID -->
            <div class="settings-input-group">
              <label class="settings-label" for="config-project-id" id="project-id-label"
                >Project ID / Repository</label
              >
              <div style="display: flex; gap: 8px">
                <input
                  type="text"
                  id="config-project-id"
                  style="flex: 1"
                  placeholder="e.g. 24267 or owner/repo"
                />
                <button
                  id="browse-repos-button"
                  onclick="browseRepositories()"
                  class="compact-action-btn"
                  title="Browse Repositories"
                  style="width: auto; padding: 0 12px; gap: 4px"
                >
                  <span class="material-symbols-outlined" style="font-size: 16px">search</span>
                  Browse
                </button>
                <a
                  id="settings-repo-link"
                  class="compact-action-btn"
                  href="javascript:void(0)"
                  target="_blank"
                  style="display: none; width: auto; padding: 0 12px; gap: 4px; text-decoration: none; color: inherit;"
                  title="Open Repository"
                >
                  <span class="material-symbols-outlined" style="font-size: 16px">open_in_new</span>
                  Open
                </a>
              </div>
            </div>

            <!-- Auth Token -->
            <div class="settings-input-group">
              <label class="settings-label" for="config-token" id="token-label">Access Token</label>
              <div style="display: flex; gap: 8px">
                <input
                  type="password"
                  id="config-token"
                  style="flex: 1"
                  placeholder="Enter Personal/Project Access Token"
                />
                <button
                  id="oauth-login-button"
                  onclick="startOAuthFlow()"
                  class="compact-action-btn"
                  style="
                    width: auto;
                    padding: 0 12px;
                    gap: 4px;
                    display: none;
                    background: rgba(34, 197, 94, 0.1);
                    border-color: rgba(34, 197, 94, 0.3);
                    color: #4ade80;
                  "
                >
                  <span class="material-symbols-outlined" style="font-size: 16px">security</span>
                  OAuth
                </button>
              </div>
              <div class="settings-helper">Recommended: Use a scoped project access token.</div>
              <div
                id="oauth-status"
                style="margin-top: 4px; display: none; color: #4ade80; font-size: 11px"
              >
                âœ“ OAuth login available
              </div>
            </div>
          </div>
        </div>

        <!-- SECTION 2: PROJECT STRUCTURE -->
        <div class="accordion-item hidden-section" id="section-structure">
          <div class="accordion-header" onclick="toggleAccordion('section-structure')">
            <div class="accordion-title">
              <span class="material-symbols-outlined accordion-icon">folder_open</span>
              Project Structure
            </div>
            <span class="material-symbols-outlined accordion-arrow">expand_more</span>
          </div>
          <div class="accordion-content">
            <div class="settings-input-group">
              <label class="settings-label" for="config-file-path">Variables File Path</label>
              <input type="text" id="config-file-path" placeholder="src/styles/variables.css" />
              <div class="settings-helper">Where should we write the CSS variables?</div>
            </div>

            <div class="settings-input-group">
              <label class="settings-label" for="config-test-file-path"
                >Component Test Template</label
              >
              <input
                type="text"
                id="config-test-file-path"
                placeholder="components/{componentName}/{componentName}.spec.ts"
              />
              <div class="settings-helper">Use {componentName} as placeholder.</div>
            </div>
          </div>
        </div>

        <!-- SECTION 3: WORKFLOW -->
        <div class="accordion-item" id="section-workflow">
          <div class="accordion-header" onclick="toggleAccordion('section-workflow')">
            <div class="accordion-title">
              <span class="material-symbols-outlined accordion-icon">call_split</span>
              Workflow & Export
            </div>
            <span class="material-symbols-outlined accordion-arrow">expand_more</span>
          </div>
          <div class="accordion-content">
            <div class="settings-input-group">
              <label class="settings-label" for="config-export-format">Export Format</label>
              <select id="config-export-format" style="width: 100%">
                <option value="css">CSS Variables (Standard)</option>
                <option value="scss">SCSS Variables</option>
                <option value="tailwind-v4">Tailwind v4 (@theme)</option>
              </select>
            </div>

            <div class="settings-input-group">
              <label class="settings-label" for="config-strategy">Commit Strategy</label>
              <select id="config-strategy" style="width: 100%">
                <option value="merge-request" selected>Create Merge Request / Pull Request</option>
                <option value="direct">Commit Directly to Branch</option>
              </select>
            </div>

            <div class="settings-input-group" id="config-branch-section">
              <label class="settings-label" for="config-branch">CSS Variables Branch</label>
              <div style="display: flex; gap: 8px">
                <input
                  type="text"
                  id="config-branch"
                  placeholder="feature/design-tokens"
                  style="flex: 1"
                />
                <button
                  onclick="browseBranches()"
                  class="compact-action-btn"
                  title="Browse Branches"
                  style="width: auto; padding: 0 10px"
                >
                  <span class="material-symbols-outlined" style="font-size: 16px">list</span>
                </button>
              </div>
            </div>

            <div class="settings-input-group" id="config-test-branch-section">
              <label class="settings-label" for="config-test-branch">Test Branch Prefix</label>
              <input type="text" id="config-test-branch" placeholder="feature/test-{component}" />
            </div>
          </div>
        </div>

        <!-- SECTION 4: TEAM & ADVANCED -->
        <div class="accordion-item" id="section-advanced">
          <div class="accordion-header" onclick="toggleAccordion('section-advanced')">
            <div class="accordion-title">
              <span class="material-symbols-outlined accordion-icon">settings_suggest</span>
              Team & Advanced
            </div>
            <span class="material-symbols-outlined accordion-arrow">expand_more</span>
          </div>
          <div class="accordion-content">
            <label class="toggle-switch">
              <input type="checkbox" id="config-save-token" class="toggle-input" checked />
              <div class="toggle-slider"></div>
              <span style="font-size: 13px; color: rgba(255, 255, 255, 0.9)"
                >Save Token locally (Recommended)</span
              >
            </label>

            <label class="toggle-switch">
              <input type="checkbox" id="config-share-team" class="toggle-input" checked />
              <div class="toggle-slider"></div>
              <span style="font-size: 13px; color: rgba(255, 255, 255, 0.9)"
                >Share configuration with team</span
              >
            </label>

            <!-- Config Metadata -->
            <div
              id="config-metadata"
              style="
                margin-top: 16px;
                background: rgba(255, 255, 255, 0.05);
                border-radius: 8px;
                padding: 10px;
                font-size: 11px;
                color: rgba(255, 255, 255, 0.6);
                display: none;
              "
            >
              <div style="display: flex; align-items: center; gap: 8px">
                <span class="material-symbols-outlined" style="font-size: 14px">history</span>
                <span id="config-metadata-text">Last saved: Never</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Feedback Section - ALWAYS VISIBLE (Outside Accordion) -->
      <div
        id="settings-feedback-section"
        style="
          border-top: 1px solid rgba(139, 92, 246, 0.2);
          padding-top: var(--space-4);
          margin-top: var(--space-4);
        "
      >
        <h4 style="margin-bottom: var(--space-2)">Feedback & Support</h4>
        <p style="font-size: 13px; color: rgba(255, 255, 255, 0.7); margin-bottom: var(--space-3)">
          We're actively improving Bridgy based on your feedback!
        </p>
        <div style="display: flex; gap: var(--space-2); flex-wrap: wrap">
          <button
            class="feedback-button"
            onclick="openGitHubFeedback('bug')"
            style="flex: 1; min-width: 100px"
          >
            <span>Report Bug</span>
          </button>
          <button
            class="feedback-button"
            onclick="openGitHubFeedback('feature')"
            style="flex: 1; min-width: 100px"
          >
            <span>Request Feature</span>
          </button>
          <button
            class="feedback-button"
            onclick="openGitHubFeedback('general')"
            style="flex: 1; min-width: 100px"
          >
            <span>General Feedback</span>
          </button>
        </div>

        <!-- User Guide and Website Links -->
        <div
          style="
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: var(--space-3);
          "
        >
          <button
            onclick="openUserGuide()"
            style="
              background: transparent;
              border: 1px solid rgba(139, 92, 246, 0.3);
              color: #a78bfa;
              padding: 6px 12px;
              border-radius: 20px;
              font-size: 11px;
              cursor: pointer;
              box-shadow: none !important;
            "
          >
            Open User Guide
          </button>

          <a
            href="https://bridgy-plugin.com/"
            target="_blank"
            style="
              display: inline-flex;
              align-items: center;
              gap: 4px;
              color: #c4b5fd;
              font-size: 13px;
              text-decoration: none;
            "
          >
            Visit Website
            <span class="material-symbols-outlined" style="font-size: 14px">open_in_new</span>
          </a>
        </div>
      </div>
    </div>
    <div
      class="modal-footer"
      style="display: flex; justify-content: space-between; align-items: center"
    >
      <button
        onclick="showResetConfirmation()"
        style="
          background: #dc3545;
          color: white;
          border: none;
          padding: 8px 12px;
          border-radius: var(--radius-lg);
          cursor: pointer;
          display: flex;
          align-items: center;
          gap: 6px;
        "
        title="Reset all configuration"
      >
        <svg
          width="14"
          height="14"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <polyline points="3,6 5,6 21,6"></polyline>
          <path
            d="M19,6V20A2,2 0 0,1 17,20H7A2,2 0 0,1 5,20V6M8,6V4A2,2 0 0,1 10,4H14A2,2 0 0,1 16,4V6"
          ></path>
          <line x1="10" y1="11" x2="10" y2="17"></line>
          <line x1="14" y1="11" x2="14" y2="17"></line>
        </svg>
        Reset
      </button>
      <div>

        <button onclick="saveConfiguration()" class="btn-primary-gradient">Save Configuration</button>
      </div>
    </div>
  </div>
</div>

<!-- Celebration Overlay -->
<div id="celebration-overlay" class="celebration-overlay" style="display: none;">
    <div class="celebration-content">
        <div class="celebration-icon">ðŸŽ‰</div>
        <h2 class="celebration-title">Great Job!</h2>
        <p class="celebration-subtitle">You've improved the Design System Quality.</p>
        
        <!-- Gauge Container -->
        <div id="celebration-gauge-container" style="margin-bottom: 24px; display: flex; justify-content: center;"></div>
        
        <div class="celebration-score-comparison">
            <div class="score-box">
                <span class="score-label">From</span>
                <span class="score-value" id="celebration-score-start">0</span>
            </div>
            <div class="score-arrow">
                <span class="material-symbols-outlined">arrow_forward</span>
            </div>
            <div class="score-box highlight">
                <span class="score-label">To</span>
                <span class="score-value" id="celebration-score-end">0</span>
            </div>
        </div>
        
        <div class="celebration-stats-grid" id="celebration-stats-grid">
            <!-- Stats injected here -->
        </div>
        
        <button class="btn-primary-gradient celebration-close-btn" onclick="closeCelebration()">
            Back to Dashboard
        </button>
    </div>
</div>

<!-- User Guide Modal -->
<div id="user-guide-modal" class="modal" style="display: none">
  <div class="modal-content" style="max-width: 800px">
    <button class="close-modal" onclick="closeUserGuide()">
      <span class="material-symbols-outlined">close</span>
    </button>
    <div class="modal-header">
      <h3>Bridgy - User Guide</h3>
    </div>

    <div class="modal-body" style="padding: 24px; max-height: 70vh; overflow-y: auto">

      <!-- Welcome Banner -->
      <div style="background: linear-gradient(135deg, rgba(88, 28, 135, 0.8), rgba(124, 58, 237, 0.6)); border-radius: 12px; padding: 20px; margin-bottom: 24px; border: 1px solid rgba(139, 92, 246, 0.3);">
        <h4 style="margin: 0 0 8px 0; font-size: 16px; color: white">Welcome to Bridgy!</h4>
        <p style="margin: 0; font-size: 13px; color: rgba(255, 255, 255, 0.9); line-height: 1.5">
          Bridgy helps you build and maintain a healthy design system. It analyzes your Figma file, shows you where things can be improved, exports your design tokens as code, and connects directly to your Git repository.
        </p>
      </div>

      <!-- What is a Design System? -->
      <h4 style="margin: 0 0 16px 0; font-size: 14px; color: var(--text-primary); display: flex; align-items: center; gap: 8px;">
        <span class="material-symbols-outlined" style="font-size: 18px; color: rgba(255, 255, 255, 0.8)">palette</span>
        What is a Design System?
      </h4>
      <div style="background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 8px; padding: 16px; margin-bottom: 24px; font-size: 12px; color: rgba(255, 255, 255, 0.7); line-height: 1.7;">
        <p style="margin: 0 0 10px 0;">
          A design system is a collection of reusable decisions &mdash; colors, spacing values, typography styles, and components &mdash; that keep your product looking and feeling consistent. Think of it like a shared toolkit: instead of picking a new shade of blue every time, everyone on the team uses the same one.
        </p>
        <p style="margin: 0 0 10px 0;">
          In Figma, these decisions are stored as <strong style="color: rgba(255,255,255,0.9);">variables</strong> (your design tokens) and <strong style="color: rgba(255,255,255,0.9);">components</strong> (reusable UI building blocks). A well-maintained design system means:
        </p>
        <ul style="margin: 0; padding-left: 16px; list-style-type: disc; color: rgba(255, 255, 255, 0.7);">
          <li><strong style="color: rgba(255,255,255,0.85);">Consistency</strong> &mdash; every screen uses the same colors, spacing, and type</li>
          <li><strong style="color: rgba(255,255,255,0.85);">Speed</strong> &mdash; designers build faster by reusing existing pieces</li>
          <li><strong style="color: rgba(255,255,255,0.85);">Fewer bugs</strong> &mdash; developers get exact values instead of guessing from mockups</li>
          <li><strong style="color: rgba(255,255,255,0.85);">Easier updates</strong> &mdash; change a token once, and it updates everywhere</li>
        </ul>
      </div>

      <!-- What Bridgy Analyzes -->
      <h4 style="margin: 0 0 16px 0; font-size: 14px; color: var(--text-primary); display: flex; align-items: center; gap: 8px;">
        <span class="material-symbols-outlined" style="font-size: 18px; color: rgba(255, 255, 255, 0.8)">search</span>
        What Bridgy Analyzes
      </h4>
      <div style="background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 8px; padding: 16px; margin-bottom: 24px; font-size: 12px; color: rgba(255, 255, 255, 0.7); line-height: 1.6;">
        <p style="margin: 0 0 12px 0; color: var(--text-primary); font-weight: 500;">Bridgy scans your Figma file and checks four areas:</p>
        <div style="display: grid; gap: 12px;">

          <div style="padding: 10px 12px; background: rgba(255,255,255,0.02); border-radius: 6px; border-left: 3px solid #a78bfa;">
            <strong style="color: #a78bfa; display: block; margin-bottom: 4px;">Token Coverage (40% of score)</strong>
            <p style="margin: 0;">
              Are your layers using variables (tokens) for colors, spacing, and radii, or are values hard-coded? Hard-coded values break consistency &mdash; if you later decide to tweak your brand blue, you'd have to find and change every instance manually. High token coverage means your file is connected to your design system, not working around it.
            </p>
          </div>

          <div style="padding: 10px 12px; background: rgba(255,255,255,0.02); border-radius: 6px; border-left: 3px solid #a78bfa;">
            <strong style="color: #a78bfa; display: block; margin-bottom: 4px;">Unused Components (20% of score)</strong>
            <p style="margin: 0;">
              Components are reusable UI pieces (buttons, cards, inputs). Over time, some become outdated or replaced but never cleaned up. Unused components clutter your library, confuse team members who might pick the wrong one, and slow down Figma. Bridgy finds components and variants that have zero instances in your file.
            </p>
          </div>

          <div style="padding: 10px 12px; background: rgba(255,255,255,0.02); border-radius: 6px; border-left: 3px solid #a78bfa;">
            <strong style="color: #a78bfa; display: block; margin-bottom: 4px;">Unused Variables (20% of score)</strong>
            <p style="margin: 0;">
              Variables (design tokens) that exist in your collections but aren't applied to anything. They might be leftovers from an older design direction, duplicates, or placeholders that were never finished. Removing them keeps your token library lean and avoids confusion about which values are actually in use.
            </p>
          </div>

          <div style="padding: 10px 12px; background: rgba(255,255,255,0.02); border-radius: 6px; border-left: 3px solid #a78bfa;">
            <strong style="color: #a78bfa; display: block; margin-bottom: 4px;">Tailwind Readiness (20% of score)</strong>
            <p style="margin: 0;">
              If you export in Tailwind v4 format, Bridgy checks that your variable names follow Tailwind conventions (e.g. <code style="background: rgba(255,255,255,0.08); padding: 1px 4px; border-radius: 3px;">--color-primary</code>). This ensures your tokens map cleanly to utility classes. When Tailwind format is not selected, this weight is redistributed among the other categories.
            </p>
          </div>

        </div>
      </div>

      <!-- Understanding Your Score -->
      <h4 style="margin: 0 0 16px 0; font-size: 14px; color: var(--text-primary); display: flex; align-items: center; gap: 8px;">
        <span class="material-symbols-outlined" style="font-size: 18px; color: rgba(255, 255, 255, 0.8)">speed</span>
        Understanding Your Score
      </h4>
      <div style="background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 8px; padding: 16px; margin-bottom: 24px; font-size: 12px; color: rgba(255, 255, 255, 0.7); line-height: 1.6;">
        <p style="margin: 0 0 14px 0;">
          Your Design Quality Score is a number from 0 to 100. It combines the four areas above into a single health check for your design system.
        </p>

        <!-- Score tiers -->
        <div style="display: flex; flex-direction: column; gap: 8px; margin-bottom: 14px;">
          <div style="display: flex; align-items: center; gap: 10px; padding: 8px 12px; background: rgba(239, 68, 68, 0.08); border-radius: 6px; border-left: 3px solid #ef4444;">
            <strong style="color: #ef4444; min-width: 48px;">0 &ndash; 39</strong>
            <div>
              <strong style="color: rgba(255,255,255,0.9);">Needs Attention</strong>
              <span style="color: rgba(255,255,255,0.5);"> &mdash; many hard-coded values, unused artifacts piling up. Start by binding your most-used colors and spacing to variables.</span>
            </div>
          </div>
          <div style="display: flex; align-items: center; gap: 10px; padding: 8px 12px; background: rgba(251, 191, 36, 0.08); border-radius: 6px; border-left: 3px solid #fbbf24;">
            <strong style="color: #fbbf24; min-width: 48px;">40 &ndash; 74</strong>
            <div>
              <strong style="color: rgba(255,255,255,0.9);">Progressing</strong>
              <span style="color: rgba(255,255,255,0.5);"> &mdash; your system is taking shape. Focus on cleaning up unused components and extending token coverage to remaining hard-coded properties.</span>
            </div>
          </div>
          <div style="display: flex; align-items: center; gap: 10px; padding: 8px 12px; background: rgba(34, 197, 94, 0.08); border-radius: 6px; border-left: 3px solid #22c55e;">
            <strong style="color: #22c55e; min-width: 48px;">75 &ndash; 100</strong>
            <div>
              <strong style="color: rgba(255,255,255,0.9);">Well Maintained</strong>
              <span style="color: rgba(255,255,255,0.5);"> &mdash; strong token adoption, clean component library. Keep it up by reviewing the dashboard after major changes.</span>
            </div>
          </div>
        </div>

        <div style="padding: 8px 12px; background: rgba(139, 92, 246, 0.1); border-radius: 6px;">
          <em style="font-size: 11px; color: rgba(255,255,255,0.6);">A perfect 100 is rarely the goal. A score in the green range means your system is healthy and your team can move fast with confidence.</em>
        </div>
      </div>

      <!-- Ignoring Items -->
      <h4 style="margin: 0 0 16px 0; font-size: 14px; color: var(--text-primary); display: flex; align-items: center; gap: 8px;">
        <span class="material-symbols-outlined" style="font-size: 18px; color: rgba(255, 255, 255, 0.8)">visibility_off</span>
        Ignoring Items
      </h4>
      <div style="background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 8px; padding: 16px; margin-bottom: 24px; font-size: 12px; color: rgba(255, 255, 255, 0.7); line-height: 1.6;">
        <p style="margin: 0 0 10px 0;">
          Not every unused variable or component is a problem. Lo-fi design tokens, placeholder components, or items reserved for a future phase are perfectly fine to keep around. Instead of deleting them, you can <strong style="color: rgba(255,255,255,0.9);">ignore</strong> them.
        </p>
        <ul style="margin: 0 0 10px 0; padding-left: 16px; list-style-type: disc;">
          <li>Click the <span class="material-symbols-outlined" style="font-size: 13px; vertical-align: middle;">visibility_off</span> icon next to any variable, collection, component, or component set to ignore it.</li>
          <li>Ignored items are removed from the unused list and <strong style="color: rgba(255,255,255,0.9);">no longer count against your score</strong>.</li>
          <li>A small <strong style="color: rgba(255,255,255,0.9);">"N ignored"</strong> badge appears in the section header. Click it to see all ignored items and restore any of them.</li>
          <li>Your ignore choices persist across sessions &mdash; close and reopen the plugin, and they'll still be there.</li>
        </ul>
        <p style="margin: 0; color: rgba(255,255,255,0.5); font-style: italic; font-size: 11px;">
          Tip: Ignoring an entire collection or component set hides all its children at once.
        </p>
      </div>

      <!-- Key Features -->
      <h4 style="margin: 0 0 16px 0; font-size: 14px; color: var(--text-primary); display: flex; align-items: center; gap: 8px;">
        <span class="material-symbols-outlined" style="font-size: 18px; color: rgba(255, 255, 255, 0.8)">stars</span>
        Key Features
      </h4>
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 24px">
        <div style="background: rgba(255, 255, 255, 0.03); padding: 12px; border-radius: 8px; border: 1px solid rgba(255, 255, 255, 0.05);">
          <h5 style="margin: 0 0 4px 0; font-size: 13px; color: #a78bfa">Quality Dashboard</h5>
          <p style="margin: 0; font-size: 11px; color: rgba(255, 255, 255, 0.6); line-height: 1.4">
            A live health check for your design system. See your score, drill into each category, and fix issues in one click.
          </p>
        </div>
        <div style="background: rgba(255, 255, 255, 0.03); padding: 12px; border-radius: 8px; border: 1px solid rgba(255, 255, 255, 0.05);">
          <h5 style="margin: 0 0 4px 0; font-size: 13px; color: #a78bfa">Variables Export</h5>
          <p style="margin: 0; font-size: 11px; color: rgba(255, 255, 255, 0.6); line-height: 1.4">
            Export Figma variables as CSS custom properties, SCSS, or Tailwind v4 theme config &mdash; ready for development.
          </p>
        </div>
        <div style="background: rgba(255, 255, 255, 0.03); padding: 12px; border-radius: 8px; border: 1px solid rgba(255, 255, 255, 0.05);">
          <h5 style="margin: 0 0 4px 0; font-size: 13px; color: #a78bfa">Test Generation</h5>
          <p style="margin: 0; font-size: 11px; color: rgba(255, 255, 255, 0.6); line-height: 1.4">
            Generate component tests from your Figma designs to ensure code matches the design spec.
          </p>
        </div>
        <div style="background: rgba(255, 255, 255, 0.03); padding: 12px; border-radius: 8px; border: 1px solid rgba(255, 255, 255, 0.05);">
          <h5 style="margin: 0 0 4px 0; font-size: 13px; color: #a78bfa">Git Integration</h5>
          <p style="margin: 0; font-size: 11px; color: rgba(255, 255, 255, 0.6); line-height: 1.4">
            Commit CSS variables and component tests directly to GitHub or GitLab with automatic merge/pull request creation.
          </p>
        </div>
        <div style="background: rgba(255, 255, 255, 0.03); padding: 12px; border-radius: 8px; border: 1px solid rgba(255, 255, 255, 0.05);">
          <h5 style="margin: 0 0 4px 0; font-size: 13px; color: #a78bfa">Token Coverage Map</h5>
          <p style="margin: 0; font-size: 11px; color: rgba(255, 255, 255, 0.6); line-height: 1.4">
            See exactly which layers have hard-coded values, which tokens would match, and apply them in one click.
          </p>
        </div>
        <div style="background: rgba(255, 255, 255, 0.03); padding: 12px; border-radius: 8px; border: 1px solid rgba(255, 255, 255, 0.05);">
          <h5 style="margin: 0 0 4px 0; font-size: 13px; color: #a78bfa">Import Variables</h5>
          <p style="margin: 0; font-size: 11px; color: rgba(255, 255, 255, 0.6); line-height: 1.4">
            Paste CSS or SCSS and import variables back into Figma &mdash; great for syncing a developer's changes into the design file.
          </p>
        </div>
      </div>

      <!-- Getting Started -->
      <h4 style="margin: 0 0 16px 0; font-size: 14px; color: var(--text-primary); display: flex; align-items: center; gap: 8px;">
        <span class="material-symbols-outlined" style="font-size: 18px; color: rgba(255, 255, 255, 0.8)">assignment</span>
        Getting Started
      </h4>
      <div class="collaboration-guide" style="display: flex; flex-direction: column; gap: 12px; margin-bottom: 24px">
        <!-- Step 1 -->
        <div class="guide-step-card" style="background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 8px; padding: 16px;">
          <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 10px">
            <div style="background: var(--purple-600); color: white; width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 13px;">1</div>
            <h4 style="margin: 0; font-size: 14px; color: var(--text-primary)">Check your score</h4>
          </div>
          <p style="margin: 0; margin-left: 36px; font-size: 13px; color: rgba(255, 255, 255, 0.7); line-height: 1.6;">
            Open the Quality tab. Bridgy scans your file automatically and shows your Design Quality Score. Expand each category to see the details.
          </p>
        </div>
        <!-- Step 2 -->
        <div class="guide-step-card" style="background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 8px; padding: 16px;">
          <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 10px">
            <div style="background: var(--purple-600); color: white; width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 13px;">2</div>
            <h4 style="margin: 0; font-size: 14px; color: var(--text-primary)">Clean up</h4>
          </div>
          <p style="margin: 0; margin-left: 36px; font-size: 13px; color: rgba(255, 255, 255, 0.7); line-height: 1.6;">
            Delete or ignore unused variables and components. Apply suggested tokens to hard-coded layers. Each fix improves your score in real time.
          </p>
        </div>
        <!-- Step 3 -->
        <div class="guide-step-card" style="background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 8px; padding: 16px;">
          <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 10px">
            <div style="background: var(--purple-600); color: white; width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 13px;">3</div>
            <h4 style="margin: 0; font-size: 14px; color: var(--text-primary)">Export & sync</h4>
          </div>
          <p style="margin: 0; margin-left: 36px; font-size: 13px; color: rgba(255, 255, 255, 0.7); line-height: 1.6;">
            Export your variables as CSS (or Tailwind/SCSS). Connect to GitHub or GitLab in the Settings tab and commit changes directly from Figma &mdash; no copy-pasting needed.
          </p>
        </div>
      </div>

      <!-- Workflow Strategies -->
      <h4 style="margin: 0 0 16px 0; font-size: 14px; color: var(--text-primary); display: flex; align-items: center; gap: 8px;">
        <span class="material-symbols-outlined" style="font-size: 18px; color: rgba(255, 255, 255, 0.8)">settings</span>
        Git Workflow Strategies
      </h4>
      <div style="display: flex; flex-direction: column; gap: 12px; margin-bottom: 24px">
        <div style="background: rgba(255, 255, 255, 0.03); border-left: 3px solid #34d399; padding: 12px; border-radius: 0 8px 8px 0;">
          <h5 style="margin: 0 0 4px 0; font-size: 13px; color: #34d399">Merge / Pull Request (Recommended)</h5>
          <p style="margin: 0; font-size: 12px; color: rgba(255, 255, 255, 0.7); line-height: 1.5">
            Each commit creates a merge or pull request for review. Multiple commits to the same feature are grouped together. Best for teams that want a review step before changes go live.
          </p>
        </div>
        <div style="background: rgba(255, 255, 255, 0.03); border-left: 3px solid #fbbf24; padding: 12px; border-radius: 0 8px 8px 0;">
          <h5 style="margin: 0 0 4px 0; font-size: 13px; color: #fbbf24">Direct Commit</h5>
          <p style="margin: 0; font-size: 12px; color: rgba(255, 255, 255, 0.7); line-height: 1.5">
            Changes go straight to the main branch. Faster, but skips the review step. Good for small teams or solo projects where you trust every change.
          </p>
        </div>
      </div>

      <!-- Tips -->
      <div style="background: rgba(139, 92, 246, 0.1); border: 1px solid rgba(139, 92, 246, 0.3); border-radius: 12px; padding: 16px;">
        <h4 style="margin: 0 0 12px 0; font-size: 14px; color: #c4b5fd; display: flex; align-items: center; gap: 8px;">
          <span class="material-symbols-outlined" style="font-size: 18px">lightbulb</span>
          Tips for a Healthy Design System
        </h4>
        <ul style="margin: 0; padding-left: 20px; font-size: 12px; color: rgba(255, 255, 255, 0.8); line-height: 1.7; list-style-type: circle;">
          <li><strong style="color: rgba(255,255,255,0.95);">Name variables with slashes</strong> (e.g. <code style="background: rgba(255,255,255,0.08); padding: 1px 4px; border-radius: 3px;">color/primary</code>) to create groups &mdash; it keeps things organized and easy to browse.</li>
          <li><strong style="color: rgba(255,255,255,0.95);">Use variables everywhere</strong> &mdash; even for spacing and radii, not just colors. The more you tokenize, the easier global updates become.</li>
          <li><strong style="color: rgba(255,255,255,0.95);">Review the dashboard regularly</strong>, especially after big design changes. A quick check prevents unused items from piling up.</li>
          <li><strong style="color: rgba(255,255,255,0.95);">Ignore, don't delete, if you're unsure</strong> &mdash; you can always restore ignored items later. Deleted items are gone permanently.</li>
          <li><strong style="color: rgba(255,255,255,0.95);">Write clear commit messages</strong> (e.g. "Update brand colors for accessibility") so developers know exactly what changed and why.</li>
        </ul>
      </div>

      <div style="text-align: right; margin-top: 24px; padding-top: 16px; border-top: 1px solid rgba(255, 255, 255, 0.1);">
        <button onclick="closeUserGuide()" class="btn-primary" style="padding: 8px 24px">
          Got It!
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Reset Confirmation Modal -->
<div id="reset-confirmation-modal" class="modal" style="display: none">
  <div class="modal-content" style="max-width: 500px">
    <button class="close-modal" onclick="closeResetConfirmation()">
      <span class="material-symbols-outlined">close</span>
    </button>
    <div class="modal-header">
      <h3 style="color: #dc3545; display: flex; align-items: center; gap: 10px">
        <svg
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <circle cx="12" cy="12" r="10"></circle>
          <line x1="15" y1="9" x2="9" y2="15"></line>
          <line x1="9" y1="9" x2="15" y2="15"></line>
        </svg>
        Reset Configuration
      </h3>
    </div>
    <div class="modal-body">
      <div
        style="
          background: rgba(251, 191, 36, 0.1);
          backdrop-filter: blur(10px);
          border: 1px solid rgba(251, 191, 36, 0.3);
          border-radius: 15px;
          padding: 16px;
          margin-bottom: 20px;
          box-shadow: 0 8px 32px rgba(251, 191, 36, 0.1);
        "
      >
        <p style="margin: 0; color: #fbbf24; font-weight: 500">
          âš ï¸ Warning: This action cannot be undone!
        </p>
      </div>

      <p style="margin-bottom: 16px; line-height: 1.5">
        This will permanently delete
        <strong>all configuration data</strong> for this Figma project, including:
      </p>

      <ul style="margin: 0 0 20px 20px; line-height: 1.6; color: rgba(255, 255, 255, 0.85)">
        <li>GitLab Project ID and access token</li>
        <li>File path and branch settings</li>
        <li>Strategy preferences (commit vs merge request)</li>
        <li>All saved metadata (who saved, when)</li>
      </ul>

      <p style="margin: 0; color: rgba(255, 255, 255, 0.8); font-style: italic">
        After reset, you'll need to reconfigure everything from scratch.
      </p>
    </div>
    <div class="modal-footer">
      <button onclick="closeResetConfirmation()">Cancel</button>
      <button
        onclick="confirmReset()"
        style="
          background: #dc3545;
          color: white;
          border: none;
          padding: 10px 16px;
          border-radius: var(--radius-lg);
          cursor: pointer;
          font-weight: 500;
        "
      >
        Yes, Reset Everything
      </button>
    </div>
  </div>
</div>

<!-- Repository Browser Modal -->
<div id="repository-browser-modal" class="modal" style="display: none">
  <div class="modal-content" style="max-width: 600px">
    <button class="close-modal" onclick="closeRepositoryBrowser()">
      <span class="material-symbols-outlined">close</span>
    </button>
    <div class="modal-header">
      <h3>Select Repository</h3>
    </div>
    <div class="modal-body">
      <div class="search-container" style="margin-bottom: 16px">
        <input
          type="text"
          id="repo-search"
          class="search-input"
          placeholder="Search repositories..."
          onkeyup="filterRepositories()"
          style="width: 100%"
        />
      </div>
      <div id="repo-list-container" style="max-height: 400px; overflow-y: auto">
        <div class="content-loading">
          <div class="content-loading-spinner"></div>
          <div class="content-loading-text">Loading repositories...</div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Branch Browser Modal -->
<div id="branch-browser-modal" class="modal" style="display: none">
  <div class="modal-content" style="max-width: 500px">
    <button class="close-modal" onclick="closeBranchBrowser()">
      <span class="material-symbols-outlined">close</span>
    </button>
    <div class="modal-header">
      <h3>Select Branch</h3>
    </div>
    <div class="modal-body">
      <div class="search-container" style="margin-bottom: 16px">
        <input
          type="text"
          id="branch-search"
          class="search-input"
          placeholder="Search branches..."
          onkeyup="filterBranches()"
          style="width: 100%"
        />
      </div>
      <div id="branch-list-container" style="max-height: 300px; overflow-y: auto">
        <div class="content-loading">
          <div class="content-loading-spinner"></div>
          <div class="content-loading-text">Loading branches...</div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Success message (hidden by default) -->
<div id="success-message" class="success-message" style="display: none">
  <p>Successfully committed to GitLab repository!</p>
</div>

<!-- Import Variables Modal -->
<div id="import-modal" class="modal" style="display: none">
  <div class="modal-content" style="max-width: 800px">
    <button class="close-modal" onclick="closeImportModal()">
      <span class="material-symbols-outlined">close</span>
    </button>
    <div class="modal-header">
      <h3>Import Variables</h3>
    </div>
    <div class="modal-body">
      <div id="variable-import-container">
        <div class="import-section">
          <div class="import-header">
            <p>Paste CSS, SCSS, or Tailwind configuration to import variables.</p>
          </div>

          <div class="import-input-area">
            <textarea
              id="import-input"
              placeholder="Paste your code here...&#10;CSS/SCSS: :root { --primary: #3b82f6; }&#10;Tailwind Config: { theme: { colors: { primary: '#3b82f6' } } }"
              spellcheck="false"
            ></textarea>
          </div>

          <div class="import-actions-bar">
            <div class="import-options">
              <select id="import-collection-select" class="select-input">
                <!-- Populated dynamically -->
                <option value="">New Collection...</option>
              </select>
            </div>
            <button id="preview-import-btn" class="btn-primary" disabled>Preview Import</button>
          </div>

          <!-- Preview Section (Hidden by default) -->
          <div id="import-preview-section" class="import-preview-section hidden">
            <div class="preview-header">
              <h4 style="display: flex; align-items: center; gap: 8px">
                <span
                  class="material-symbols-outlined"
                  style="font-size: 18px; color: var(--purple-light)"
                  >preview</span
                >
                Import Preview
              </h4>
              <div class="preview-stats">
                <span
                  id="preview-stat-total"
                  class="badge"
                  style="display: flex; align-items: center; gap: 4px"
                >
                  <span class="material-symbols-outlined" style="font-size: 14px">functions</span>
                  <span>0</span>
                </span>
                <span
                  id="preview-stat-new"
                  class="badge badge-success"
                  style="display: flex; align-items: center; gap: 4px"
                >
                  <span class="material-symbols-outlined" style="font-size: 14px">add_circle</span>
                  <span>0</span>
                </span>
                <span
                  id="preview-stat-update"
                  class="badge badge-warning"
                  style="display: flex; align-items: center; gap: 4px"
                >
                  <span class="material-symbols-outlined" style="font-size: 14px">sync</span>
                  <span>0</span>
                </span>
                <span
                  id="preview-stat-conflict"
                  class="badge badge-danger"
                  style="display: flex; align-items: center; gap: 4px"
                >
                  <span class="material-symbols-outlined" style="font-size: 14px">warning</span>
                  <span>0</span>
                </span>
              </div>
            </div>

            <div
              class="preview-toolbar"
              style="
                display: flex;
                gap: 2px;
                margin-bottom: 12px;
                padding: 8px;
                background: rgba(0, 0, 0, 0.2);
                border-radius: var(--radius-md);
                align-items: center;
              "
            >
              <button
                class="compact-action-btn"
                id="select-all-import"
                data-tooltip="Select All"
                style="
                  display: flex;
                  align-items: center;
                  justify-content: center;
                  width: 32px;
                  height: 32px;
                  padding: 0;
                "
              >
                <span class="material-symbols-outlined" style="font-size: 18px">select_all</span>
              </button>
              <button
                class="compact-action-btn"
                id="deselect-all-import"
                data-tooltip="Deselect All"
                style="
                  display: flex;
                  align-items: center;
                  justify-content: center;
                  width: 32px;
                  height: 32px;
                  padding: 0;
                "
              >
                <span class="material-symbols-outlined" style="font-size: 18px">deselect</span>
              </button>
              <div
                style="border-left: 1px solid rgba(255, 255, 255, 0.1); height: 16px; margin: 0 4px"
              ></div>
              <button
                class="compact-action-btn"
                id="expand-all-import"
                data-tooltip="Expand All Groups"
                style="width: 32px; height: 32px; justify-content: center"
              >
                <span class="material-symbols-outlined" style="font-size: 18px">unfold_more</span>
              </button>
              <button
                class="compact-action-btn"
                id="collapse-all-import"
                data-tooltip="Collapse All Groups"
                style="width: 32px; height: 32px; justify-content: center"
              >
                <span class="material-symbols-outlined" style="font-size: 18px">unfold_less</span>
              </button>
            </div>

            <div
              class="import-settings"
              style="
                margin-bottom: 16px;
                background: rgba(255, 255, 255, 0.03);
                padding: 12px;
                border-radius: var(--radius-md);
                border: 1px solid rgba(255, 255, 255, 0.05);
              "
            >
              <h5
                style="
                  margin: 0 0 12px 0;
                  font-size: 11px;
                  text-transform: uppercase;
                  letter-spacing: 0.5px;
                  opacity: 0.6;
                  font-weight: 600;
                "
              >
                Settings
              </h5>

              <div style="display: flex; flex-direction: column; gap: 8px">
                <label class="toggle-switch">
                  <input type="checkbox" class="toggle-input" id="organize-by-categories" checked />
                  <div class="toggle-slider"></div>
                  <span class="settings-label" style="margin-bottom: 0"
                    >Organize by categories</span
                  >
                  <span
                    class="material-symbols-outlined"
                    style="font-size: 14px; opacity: 0.4; cursor: help"
                    data-tooltip="Group variables into categories based on their names (e.g. 'color/primary' -> 'color' group)"
                    >help</span
                  >
                </label>

                <label class="toggle-switch">
                  <input
                    type="checkbox"
                    class="toggle-input"
                    id="overwrite-existing"
                    onchange="
                      document.getElementById('overwrite-warning').style.display = this.checked
                        ? 'flex'
                        : 'none'
                    "
                  />
                  <div class="toggle-slider"></div>
                  <span class="settings-label" style="margin-bottom: 0"
                    >Overwrite existing variables</span
                  >
                  <span
                    class="material-symbols-outlined"
                    style="font-size: 14px; opacity: 0.4; cursor: help"
                    data-tooltip="If checked, existing variables with the same name will be overwritten."
                    >help</span
                  >
                </label>
              </div>

              <div
                id="overwrite-warning"
                class="info-banner warning"
                style="
                  margin-top: 12px;
                  display: none;
                  font-size: 11px;
                  padding: 8px 12px;
                  border-radius: 6px;
                  background: rgba(234, 179, 8, 0.1);
                  color: #facc15;
                  align-items: flex-start;
                  gap: 8px;
                  line-height: 1.4;
                "
              >
                <span class="material-symbols-outlined" style="font-size: 16px">warning</span>
                <span
                  >Existing variables with the exact same name will be updated with new
                  values.</span
                >
              </div>
            </div>

            <div class="preview-table-container" style="max-height: 250px">
              <table class="preview-table">
                <thead>
                  <tr>
                    <th style="width: 40%">Variable</th>
                    <th style="width: 15%">Type</th>
                    <th style="width: 30%">Value</th>
                    <th style="width: 15%">Status</th>
                  </tr>
                </thead>
                <tbody id="preview-table-body">
                  <!-- Populated dynamically -->
                </tbody>
              </table>
            </div>

            <div class="import-confirmation-actions" style="margin-top: 12px">
              <button id="cancel-import-btn" class="btn-secondary">Cancel</button>
              <button
                id="confirm-import-btn"
                class="btn-primary"
                style="display: flex; align-items: center; gap: 6px"
              >
                <span class="material-symbols-outlined" style="font-size: 18px">upload</span>
                Import Variables
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Units Configuration Modal -->
<div id="units-modal" class="modal" style="display: none">
  <div class="modal-content" style="max-width: 700px">
    <button class="close-modal" onclick="closeUnitsModal()">
      <span class="material-symbols-outlined">close</span>
    </button>
    <div class="modal-header">
      <h3>Variable Units Settings</h3>
    </div>
    <div class="modal-body">
      <p style="color: rgba(255, 255, 255, 0.8); margin-bottom: 16px">
        Configure units for numeric variables. Collections override defaults, groups override
        collections.
      </p>
      <div style="display: flex; gap: 10px; margin-bottom: 16px">
        <button
          id="reset-units-button-modal"
          style="background-color: #f44336"
          onclick="window.resetUnitsSettings()"
        >
          Reset to Smart Defaults
        </button>
        <button id="save-units-button-modal" disabled onclick="saveUnitsAndCloseModal()">
          Save Unit Settings
        </button>
      </div>
      <div id="units-settings-container">
        <div class="loading">Loading unit settings...</div>
      </div>
    </div>
  </div>
</div>

<!-- Error message (hidden by default) -->
<div id="error-message" class="error-message" style="display: none">
  <p>
    <strong>Error committing to GitLab:</strong>
    <span id="error-details"></span>
  </p>
  <p class="error-help">Please check your credentials and try again.</p>
</div>

<!-- Create Variable Modal -->
<div id="create-variable-modal" class="modal">
  <div class="modal-content">
    <button class="close-modal" onclick="closeCreateVariableModal()">
      <span class="material-symbols-outlined">close</span>
    </button>
    <div class="modal-header">
      <h3>Create New Variable</h3>
    </div>
    <div class="modal-body">
      <p>
        Create a new variable for value:
        <strong
          id="create-var-value-display"
          style="color: var(--purple-light); font-family: monospace"
        ></strong>
      </p>

      <!-- Collection Section -->
      <div class="form-group">
        <label for="create-var-collection">Collection</label>
        <select
          id="create-var-collection"
          onchange="handleCollectionChange()"
          class="select-field"
        >
          <!-- Populated by JS -->
        </select>
        <input
          type="text"
          id="create-var-new-collection"
          placeholder="New Collection Name"
          class="input-field"
          style="display: none; margin-top: 4px;"
        />
        <div class="settings-helper">Select target collection</div>
      </div>

      <!-- Group Section -->
      <div class="form-group">
        <label for="create-var-group">Group</label>
        <select
          id="create-var-group"
          onchange="handleGroupChange()"
          class="select-field"
        >
          <option value="">(No Group)</option>
          <option value="create-new">Create New Group...</option>
        </select>
        <input
          type="text"
          id="create-var-new-group"
          class="input-field"
          placeholder="New Group Name (e.g. colors/primary)"
          style="display: none; margin-top: 4px;"
        />
        <div class="settings-helper">Select existing group or create new</div>
      </div>

      <!-- Variable Name Section -->
      <div class="form-group">
        <label for="create-var-name">Variable Name</label>
            <input 
              type="text" 
              id="create-var-name" 
              placeholder="e.g. primary-500" 
              oninput="this.value = this.value.replace(/\./g, '-')"
              class="input-variable-name"
            />
        <div class="settings-helper" style="margin-top: 8px;">Final variable name (will be combined with group)</div>
      </div>

      <input type="hidden" id="create-var-issue-id" />
    </div>
    <div class="modal-footer modal-footer-seamless">
      <button onclick="closeCreateVariableModal()" class="btn-secondary-glass">Cancel</button>
      <button onclick="submitCreateVariable()" class="btn-primary-gradient">Create Variable</button>
    </div>
  </div>
</div>

<!-- Notification Container (Moved to end for stacking context) -->
<div id="notification-container" class="notification-container"></div>

    <script>
      var Y=Object.defineProperty,X=Object.defineProperties;var ee=Object.getOwnPropertyDescriptors;var _=Object.getOwnPropertySymbols;var te=Object.prototype.hasOwnProperty,ne=Object.prototype.propertyIsEnumerable;var Q=(e,t,n)=>t in e?Y(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,D=(e,t)=>{for(var n in t||(t={}))te.call(t,n)&&Q(e,n,t[n]);if(_)for(var n of _(t))ne.call(t,n)&&Q(e,n,t[n]);return e},O=(e,t)=>X(e,ee(t));var j=(e,t,n)=>new Promise((s,o)=>{var i=r=>{try{l(n.next(r))}catch(d){o(d)}},a=r=>{try{l(n.throw(r))}catch(d){o(d)}},l=r=>r.done?s(r.value):Promise.resolve(r.value).then(i,a);l((n=n.apply(e,t)).next())});var W,Z,K,J;window.onerror=function(e,t,n,s,o){return console.error("[GlobalErrorHandler]",e,t,n,s,o),!0},window.addEventListener("unhandledrejection",function(e){console.error("[GlobalErrorHandler] Unhandled promise rejection:",e.reason),e.preventDefault()});class SecurityUtils{static sanitizeHTML(t){if(typeof t!="string")return"";let n=t.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"").replace(/<iframe\b[^<]*(?:(?!<\/iframe>)<[^<]*)*<\/iframe>/gi,"").replace(/on\w+\s*=\s*["'][^"']*["']/gi,o=>o.includes("toggleSubgroup(")||o.includes("toggleComponentSet(")||o.includes("toggleStyles(")||o.includes("scrollToGroupById(")||o.includes("generateTest(")||o.includes("deleteVariable(")||o.includes("deleteUnusedVariable(")||o.includes("deleteStyle(")||o.includes("deleteComponent(")||o.includes("focusOnComponent(")||o.includes("console.log(")||o.includes("alert(")||o.includes("simulateImport(")||o.includes("clearInput(")||o.includes("copyToClipboard(")||o.includes("handleFileUpload(")||o.includes("switchToQualityTab(")||o.includes("dismissFeedback(")||o.includes("closeNotification(")||o.includes("toggleCollection(")||o.includes("expandAllSubgroups(")||o.includes("collapseAllSubgroups(")||o.includes("clearSearch(")||o.includes("scrollToVariable(")||o.includes("updateTailwindRenameButtonState(")||o.includes("openRenameTailwindVariableDialog(")||o.includes("expandAllImportGroups(")||o.includes("collapseAllImportGroups(")||o.includes("selectAllVariables(")||o.includes("expandAllStyleGroups(")||o.includes("collapseAllStyleGroups(")||o.includes("selectAllStyles(")?o:"").replace(/on\w+\s*=\s*[^>\s]+/gi,o=>o.includes("toggleSubgroup(")||o.includes("toggleComponentSet(")||o.includes("toggleStyles(")||o.includes("scrollToGroupById(")||o.includes("generateTest(")||o.includes("deleteVariable(")||o.includes("deleteUnusedVariable(")||o.includes("deleteStyle(")||o.includes("deleteComponent(")||o.includes("focusOnComponent(")||o.includes("alert(")||o.includes("simulateImport(")||o.includes("clearInput(")||o.includes("copyToClipboard(")||o.includes("handleFileUpload(")||o.includes("switchToQualityTab(")||o.includes("dismissFeedback(")||o.includes("closeNotification(")||o.includes("toggleCollection(")||o.includes("expandAllSubgroups(")||o.includes("collapseAllSubgroups(")||o.includes("clearSearch(")||o.includes("expandAllVariables(")||o.includes("collapseAllVariables(")||o.includes("toggleSearchBar(")||o.includes("expandAllComponents(")||o.includes("collapseAllComponents(")||o.includes("toggleFeedback(")||o.includes("scrollToVariable(")||o.includes("deleteStyle(")||o.includes("updateTailwindActionButtonsState(")||o.includes("applyTailwindNamespace(")||o.includes("expandAllImportGroups(")||o.includes("collapseAllImportGroups(")||o.includes("selectAllVariables(")||o.includes("expandAllStyleGroups(")||o.includes("collapseAllStyleGroups(")||o.includes("selectAllStyles(")?o:"").replace(/javascript\s*:/gi,"").replace(/vbscript\s*:/gi,"").replace(/\bsrc\s*=\s*["']?\s*data:/gi,'src="').replace(/\bhref\s*=\s*["']?\s*data:/gi,'href="');const s=["p","br","strong","em","b","i","u","span","div","h1","h2","h3","h4","h5","h6","ul","ol","li","code","pre","blockquote","button","svg","path","circle","polyline","line","rect","ellipse","polygon","g","select","option","table","thead","tbody","tr","th","td","a","input","label","textarea"];return n=n.replace(/<\/?([a-zA-Z][a-zA-Z0-9]*)(\s[^>]*)?>/g,(o,i,a)=>{const l=i.toLowerCase();if(s.indexOf(l)===-1)return"";if(l==="a"&&a){let r="";const d=a.match(/\shref="([^"]*)"/);d&&d[1]&&d[1].startsWith("https://")&&(r+=` href="${d[1]}"`);const p=a.match(/\starget="([^"]*)"/);return p&&(p[1]==="_blank"||p[1]==="_self")&&(r+=` target="${p[1]}"`),`<${i}${r}>`}return o}),n}static escapeHTML(t){if(typeof t!="string")return"";const n={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"};return t.replace(/[&<>"'/]/g,s=>n[s])}static isValidGitLabURL(t){if(typeof t!="string")return!1;try{const n=new URL(t);return n.protocol!=="https:"?!1:[/^gitlab\.com$/,/^.*\.gitlab\.com$/,/^.*\.gitlab\.io$/,/gitlab/i].some(o=>o.test(n.hostname))}catch(n){return!1}}static encryptData(t,n){if(typeof t!="string"||typeof n!="string")throw new Error("Data and key must be strings");const s=new TextEncoder().encode(n),o=new TextEncoder().encode(t),i=new Uint8Array(o.length);for(let a=0;a<o.length;a++)i[a]=o[a]^s[a%s.length];return btoa(String.fromCharCode(...i))}static decryptData(t,n){if(typeof t!="string"||typeof n!="string")throw new Error("Encrypted data and key must be strings");try{const s=new Uint8Array(atob(t).split("").map(a=>a.charCodeAt(0))),o=new TextEncoder().encode(n),i=new Uint8Array(s.length);for(let a=0;a<s.length;a++)i[a]=s[a]^o[a%o.length];return new TextDecoder().decode(i)}catch(s){throw new Error("Failed to decrypt data - invalid format or key")}}static generateEncryptionKey(){const t=typeof figma!="undefined"&&figma.root?figma.root.id:"default",n=Math.random().toString(36).substring(2,15),s=Math.floor(Date.now()/(1e3*60*60*24));return btoa(`${t}:${n}:${s}`).slice(0,32)}}class UIHelper{static createBadge(t,n="default"){return`<span class="list-badge badge-${n}">${t}</span>`}static createNavIcon(t,n="Navigate",s="filter_center_focus"){return`
            <button class="nav-icon node-focus-btn" data-component-id="${t}" title="${n}">
              <span class="material-symbols-outlined">${s}</span>
            </button>
          `}static createActionBtn(t,n,s={},o=!1){const i=o?"icon-btn-wide":"compact-action-btn",a=Object.entries(s).map(([l,r])=>`${l}="${r}"`).join(" ");return`
              <button class="${i} ${s.class||""}" ${a} title="${n}">
                <span class="material-symbols-outlined">${t}</span>
                <span class="action-btn-label">${n}</span>
              </button>
            `}static renderEmptyState(t){return`<div class="no-items">${t}</div>`}static createQualityLoader(){return`
            <div id="quality-unified-loader" style="display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 48px 0;">
              <div class="plugin-loading-spinner"></div>
              <div style="margin-top: 12px; font-size: 13px; opacity: 0.7;">Analyzing design system...</div>
            </div>
          `}}function buildGitLabApiUrl(e){if(!e)return"https://gitlab.com/api/v4";const t=e.replace(/\/+$/,"");return t.endsWith("/api/v4")?t:`${t}/api/v4`}function buildGitLabWebUrl(e){return e?e.replace(/\/+$/,"").replace(/\/api\/v4$/,""):"https://gitlab.com"}function isRepositoryConfigured(){return window.gitSettings&&window.gitSettings.projectId&&window.gitSettings.projectId.trim()&&window.gitSettings.token&&window.gitSettings.token.trim()?!0:window.gitlabSettings&&window.gitlabSettings.projectId&&window.gitlabSettings.projectId.trim()&&window.gitlabSettings.gitlabToken&&window.gitlabSettings.gitlabToken.trim()}function updateCommitButtonStates(){var l;const e=variablesData&&variablesData.some(r=>r.variables.length>0),t=isRepositoryConfigured(),s=((l=window.gitlabSettings)==null?void 0:l.exportFormat)==="tailwind-v4"&&tailwindV4Validation&&!tailwindV4Validation.isValid,o=document.getElementById("commit-repo-button");if(o){const r=e&&t;o.disabled=!r,t?e?s?o.title="Commit variables (Warning: Tailwind v4 namespace issues detected)":o.title="Commit variables to GitLab repository":o.title="No variables available to commit":o.title="Configure GitLab settings in the Settings tab to enable commits"}const i=document.getElementById("export-css-button");i&&e&&(i.disabled=!1,s?i.title="Export variables (Warning: Tailwind v4 namespace issues detected)":i.title="Export variables to CSS file"),document.querySelectorAll(".commit-all-variants-button").forEach(r=>{r.disabled=!t,t?r.title="Generate and commit component test to repository":r.title="Configure GitLab settings in the Settings tab to enable commits"})}let loadingProgress=0;const loadingSteps=["Initializing plugin...","Loading GitLab settings...","Scanning document structure...","Collecting variables and tokens...","Processing components...","Finalizing interface..."];function updatePluginLoadingProgress(e,t){const n=document.getElementById("plugin-loading-status"),s=document.getElementById("plugin-loading-progress-bar");n&&s&&(n.textContent=e,s.style.width=t+"%")}function hidePluginLoadingOverlay(){const e=document.getElementById("plugin-loading-overlay");e&&(e.classList.add("fade-out"),setTimeout(()=>{e.style.display="none"},500))}function showContentLoading(e,t){const n=document.getElementById(e);n&&(n.innerHTML=`
            <div class="content-loading">
              <div class="content-loading-spinner"></div>
              <div class="content-loading-text">${t}</div>
            </div>
          `)}function showButtonLoading(e,t){if(e&&!e.classList.contains("loading")){if((e.classList.contains("generate-all-variants-button")||t.includes("Generating"))&&!t.includes("Committing")){try{localStorage.setItem("bridgy_last_export_test","true")}catch(n){console.warn("localStorage access failed:",n)}typeof refreshUserGuide=="function"&&refreshUserGuide()}e.dataset.originalHtml=e.innerHTML,e.textContent=t,e.classList.add("loading"),e.disabled=!0}}function hideButtonLoading(e){e&&e.classList.contains("loading")&&(e.dataset.originalHtml?e.innerHTML=e.dataset.originalHtml:e.textContent=e.dataset.originalText||e.textContent,e.classList.remove("loading"),e.disabled=!1)}function hideContentLoading(e){const t=document.getElementById(e);t&&t.querySelector(".content-loading")&&(t.innerHTML="")}window.MultiPageSelector={pages:[],selectedPageIds:new Set,pendingPageIds:new Set,isOpen:!1,filterQuery:"",init(){this.render(),setTimeout(()=>{console.log("MultiPageSelector: Requesting pages..."),parent.postMessage({pluginMessage:{type:"get-pages"}},"*")},500),document.addEventListener("click",e=>{this.isOpen&&!e.target.closest(".page-selector-wrapper")&&this.cancelSelection()})},handlePagesList(e,t){console.log("MultiPageSelector: Received pages",e),this.pages=e,this.selectedPageIds=new Set(e.map(n=>n.id)),this.pendingPageIds=new Set(this.selectedPageIds),this.render()},toggle(){this.isOpen?this.cancelSelection():this.open()},open(){this.isOpen=!0,this.filterQuery="",this.pendingPageIds=new Set(this.selectedPageIds),this.render()},close(){this.isOpen=!1,this.render()},applySelection(){this.selectedPageIds=new Set(this.pendingPageIds),this.close(),resetQualityState(),analyzeTokenCoverage(null,null,!1,!0),analyzeStats()},cancelSelection(){this.close()},updatePendingSelection(e,t){t?this.pendingPageIds.add(e):this.pendingPageIds.delete(e),this.render()},setFilterQuery(e){this.filterQuery=e.toLowerCase(),this.render()},toggleSelectAll(e){const t=this.getFilteredPages();e?t.forEach(n=>this.pendingPageIds.add(n.id)):t.forEach(n=>this.pendingPageIds.delete(n.id)),this.render()},getFilteredPages(){return this.filterQuery?this.pages.filter(e=>e.name.toLowerCase().includes(this.filterQuery)):this.pages},getSelectedIds(){return Array.from(this.selectedPageIds)},render(){const e=[document.getElementById("quality-page-selector-container"),document.getElementById("stats-page-selector-container")],t=this.pages.length>0&&this.selectedPageIds.size===this.pages.length,n=this.pages.length===0?"Checking Pages...":t?"All Pages":this.selectedPageIds.size===1?"1 Page":this.selectedPageIds.size===0?"No Pages":`${this.selectedPageIds.size} Pages`,s=this.getFilteredPages(),o=s.length>0&&s.every(a=>this.pendingPageIds.has(a.id)),i=`
      <div class="page-selector-wrapper">
        <div class="page-selector-btn" onclick="MultiPageSelector.toggle()">
          <span style="font-weight: 600;">${n}</span>
          <span class="material-symbols-outlined" style="font-size: 16px; opacity: 0.5;">${this.isOpen?"expand_less":"expand_more"}</span>
        </div>
        <div class="page-selector-dropdown ${this.isOpen?"show":""}" onclick="event.stopPropagation();">
          <div class="page-selector-search">
            <span class="material-symbols-outlined" style="font-size: 16px; opacity: 0.5;">search</span>
            <input type="text" placeholder="Search pages..." value="${this.filterQuery}" 
                   oninput="MultiPageSelector.setFilterQuery(this.value)"
                   onclick="event.stopPropagation()">
          </div>
          
          <div class="dropdown-item select-all-item">
            <input type="checkbox" id="select-all-pages" 
                   ${o?"checked":""} 
                   onchange="MultiPageSelector.toggleSelectAll(this.checked)">
            <label for="select-all-pages" style="cursor: pointer; flex: 1; margin: 0; font-weight: 600;">(Select All)</label>
          </div>

          <div class="page-list-scroll">
            ${s.map(a=>`
              <div class="dropdown-item">
                <input type="checkbox" id="page-${a.id}" 
                       ${this.pendingPageIds.has(a.id)?"checked":""} 
                       onchange="MultiPageSelector.updatePendingSelection('${a.id}', this.checked)">
                <label for="page-${a.id}" style="cursor: pointer; flex: 1; margin: 0; display: flex; align-items: center; gap: 8px;">
                  <span class="material-symbols-outlined" style="font-size: 16px; opacity: 0.5;">description</span>
                  <span>${a.name}</span>
                </label>
              </div>
            `).join("")}
            ${s.length===0?'<div style="padding: 12px; text-align: center; opacity: 0.5; font-size: 11px;">No pages found</div>':""}
          </div>

          <div class="page-selector-footer">
            <button class="multi-page-footer-btn cancel" onclick="MultiPageSelector.cancelSelection()">Cancel</button>
            <button class="multi-page-footer-btn apply" 
                    ${this.pendingPageIds.size===0?'disabled style="opacity: 0.5; cursor: not-allowed;"':""} 
                    onclick="MultiPageSelector.applySelection()">Apply</button>
          </div>
        </div>
      </div>
    `;e.forEach(a=>{if(a&&(a.innerHTML=i,this.isOpen)){const l=a.querySelector(".page-selector-search input");l&&document.activeElement!==l&&this.filterQuery===""&&setTimeout(()=>l.focus(),10)}})}},window.isEditMode=!1,window.editSessionStart=null,window.toggleEditMode=function(e){window.isEditMode=e;const t=document.body,n=document.getElementById("edit-mode-header"),s=document.getElementById("main-tabs"),o=document.querySelector(".quality-header");e?(t&&t.classList.add("edit-mode"),window.qualityAnalysisState?window.editSessionStart={score:window.qualityAnalysisState.score||0,totalIssues:window.qualityAnalysisState.tokenIssues||0,subScores:window.qualityAnalysisState.subScores?JSON.parse(JSON.stringify(window.qualityAnalysisState.subScores)):{}}:window.editSessionStart={score:0,totalIssues:0,subScores:{}},n&&(n.style.display="flex"),s&&(s.style.display="none"),o&&(o.style.display="none",o.setAttribute("aria-hidden","true")),updateHeaderGauge()):(t&&t.classList.remove("edit-mode"),n&&(n.style.display="none"),s&&(s.style.display="flex"),o&&(o.style.display="flex",o.removeAttribute("aria-hidden")),window.editSessionStart=null)};function updateHeaderGauge(){const e=document.getElementById("edit-mode-gauge-container");e&&window.qualityAnalysisState&&(e.innerHTML=`
            <div style="position: relative; width: 60px; height: 60px; display: flex; align-items: center; justify-content: center;">
                ${renderSegmentedGauge(window.qualityAnalysisState.subScores,window.qualityAnalysisState.weights,60,{showLabels:!1,showCenterText:!1,strokeWidth:6})}
                <div style="position: absolute; font-weight: 800; font-size: 16px; color: white;">
                    ${window.qualityAnalysisState.score||0}
                </div>
            </div>
        `,setTimeout(()=>{const n=e.querySelector("#score-gauge-circle-fill");if(n){const s=parseFloat(n.getAttribute("r")),o=2*Math.PI*s,i=window.qualityAnalysisState.score||0,a=o-i/100*o;n.style.transition="stroke-dashoffset 1s ease-out",n.style.strokeDashoffset=a}},50))}function getGradeLabel(e){return e>=75?"Well Maintained":e>=40?"Progressing":"Needs Attention"}window.finishImproving=function(){const e=window.editSessionStart||{score:0,totalIssues:0,subScores:{}},t=window.qualityAnalysisState||{score:0,tokenIssues:0,subScores:{}},n=e.score||0,s=t.score||0,o=s-n,i=Math.max(0,e.totalIssues-(t.tokenIssues||0)),a=document.getElementById("celebration-overlay"),l=document.getElementById("celebration-score-start"),r=document.getElementById("celebration-score-end"),d=document.getElementById("celebration-stats-grid"),p=document.getElementById("celebration-gauge-container");if(l&&(l.textContent=n),r&&(r.textContent=s),p&&(p.innerHTML=`
            <div style="position: relative; width: 120px; height: 120px; display: flex; align-items: center; justify-content: center;">
                ${renderSegmentedGauge(t.subScores,t.weights||{},120,{showLabels:!1,showCenterText:!1})}
                <div style="position: absolute; font-weight: 800; font-size: 32px; color: white;">
                    ${s}
                </div>
            </div>
        `),d){let u="";o>0&&(u+=`
                <div class="stat-item">
                    <span class="stat-value" style="color: var(--success-400);">+${o}</span>
                    <span class="stat-label">Points Gained</span>
                </div>
            `),i>0?u+=`
                 <div class="stat-item">
                    <span class="stat-value">${i}</span>
                    <span class="stat-label">Issues Fixed</span>
                </div>
            `:o===0&&(u+=`
                 <div class="stat-item">
                    <span class="stat-value">0</span>
                    <span class="stat-label">Issues Fixed</span>
                </div>
            `);let g=0;if(t.subScores&&e.subScores)for(const[f,w]of Object.entries(t.subScores)){const y=e.subScores[f]||0;if(w>y){const b=w-y,S=formatCategoryLabel(f);u+=`
                        <div class="stat-item">
                            <span class="stat-value" style="color: var(--success-400);">+${b.toFixed(0)}%</span>
                            <span class="stat-label">${S}</span>
                        </div>
                    `,g++}}o===0&&i===0&&g===0&&(u+=`
            <div class="stat-item">
                <span class="stat-value">Solid!</span>
                <span class="stat-label">Status Quo</span>
            </div>
             <div class="stat-item">
                <span class="stat-value">Ready</span>
                <span class="stat-label">Next Steps</span>
            </div>
        `),d.innerHTML=u}a&&(a.style.display="flex",setTimeout(()=>{const u=document.getElementById("celebration-gauge-container");if(u&&t.weights){const g=u.querySelector("#score-gauge-circle-fill");if(g){const f=parseFloat(g.getAttribute("r")),w=2*Math.PI*f,y=w-s/100*w;g.style.transition="stroke-dashoffset 1s ease-out",g.style.strokeDashoffset=y}}animateValue("celebration-score-start",0,n,1e3),animateValue("celebration-score-end",0,s,1500)},100))};function formatCategoryLabel(e){return{tokenCoverage:"Variables",variableHygiene:"Hygiene",componentHygiene:"Components",tailwindReadiness:"Tailwind"}[e]||e}window.closeCelebration=function(){const e=document.getElementById("celebration-overlay");e&&(e.style.display="none"),toggleEditMode(!1)},document.addEventListener("DOMContentLoaded",function(){window.MultiPageSelector.init(),console.log("Available elements:",{componentsContainer:!!document.getElementById("stats-container"),variablesContainer:!!document.getElementById("variables-container")}),updatePluginLoadingProgress(loadingSteps[0],10),typeof setupQualitySearch=="function"&&setupQualitySearch(),initSearchFeatures();const e=document.getElementById("stats-search");e&&e.addEventListener("input",function(t){typeof window.filterStats=="function"&&window.filterStats(t.target.value)})}),window.handleImproveDesignSystem=function(){toggleEditMode(!0);const e="token-coverage-section",t=document.getElementById(e);if(t){const n=t.querySelector(".section-content-collapsible");n&&(n.style.display==="none"||window.getComputedStyle(n).display==="none")&&typeof toggleQualitySection=="function"&&toggleQualitySection(e)}setTimeout(()=>{const n=document.querySelector(".quality-section-collapsible .quality-collection .collection-header");n&&n.classList.contains("collapsed")&&n.click(),setTimeout(()=>{var o,i;const s=document.querySelector(".quality-issue-card .quality-issue-header");if(s){const a=(i=(o=s.getAttribute("onclick"))==null?void 0:o.match(/'([^']+)'/))==null?void 0:i[1];if(a){const l=document.getElementById(`${a}-body`);l&&(l.style.display==="none"||window.getComputedStyle(l).display==="none")&&s.click()}s.scrollIntoView({behavior:"smooth",block:"center"}),setTimeout(()=>{var r,d;const l=(d=(r=s.getAttribute("onclick"))==null?void 0:r.match(/'([^']+)'/))==null?void 0:d[1];if(l){const p=document.querySelector(`#${l}-custom-select .custom-select-trigger`);p&&p.click()}},300)}},400)},400)};function initSearchFeatures(){[{inputId:"variable-search",clearBtnId:"clear-variable-search"},{inputId:"quality-search",clearBtnId:"clear-quality-search"},{inputId:"stats-search",clearBtnId:"clear-stats-search"}].forEach(({inputId:t,clearBtnId:n})=>{const s=document.getElementById(t),o=document.getElementById(n);s&&o&&(s.addEventListener("input",function(){this.value&&this.value.length>0?o.style.display="flex":o.style.display="none"}),s.value&&s.value.length>0?o.style.display="flex":o.style.display="none")})}let lastNavigationTime=0,lastNavigatedComponentId=null;window.selectComponent=function(e){console.log("Selecting component:",e);const t=Date.now();if(e===lastNavigatedComponentId&&t-lastNavigationTime<1e3){console.log("Ignoring duplicate navigation request");return}lastNavigationTime=t,lastNavigatedComponentId=e,parent.postMessage({pluginMessage:{type:"select-component",componentId:e}},"*")},window.refreshData=function(){console.log("Refresh triggered");const e=document.getElementById("refresh-btn");if(e){e.disabled=!0,e.style.opacity="0.6";const s=e.querySelector(".material-symbols-outlined");s&&(s.style.animation="spin 1s linear infinite")}const t=document.querySelector(".tab-content.active"),n=t?t.id:"variables-content";if(console.log("Active tab for refresh:",n),n==="stats-content"){if(typeof window.refreshStats=="function"){const s=showLoading("Refreshing Stats","Updating component usage data...");window.refreshStats(s)}else console.error("refreshStats function not found");resetRefreshButton(e,1e3);return}if(n==="quality-content"){window.pendingQualityRefresh=!0,window.qualityScanPerformed=!1,window.tokenFixInProgress=!1,resetQualityState(),parent.postMessage({pluginMessage:{type:"refresh-data"}},"*"),window.currentRefreshNotification=showLoading("Analyzing","Syncing variables & running analysis..."),resetRefreshButton(e,3e3);return}console.log("Refreshing variables and components data..."),window.qualityScanPerformed=!1,window.statsScanPerformed=!1,parent.postMessage({pluginMessage:{type:"refresh-data"}},"*"),window.currentRefreshNotification=showLoading("Refreshing","Syncing variables from Figma..."),resetRefreshButton(e,2e3)};function resetRefreshButton(e,t){e&&setTimeout(()=>{e.disabled=!1,e.style.opacity="1";const n=e.querySelector(".material-symbols-outlined");n&&(n.style.animation="none")},t)}window.refreshStats=function(e){e?window.currentStatsNotification=e:window.currentStatsNotification=showLoading("Refreshing Stats","Updating component usage data..."),console.log("Refreshing stats...");const t=document.getElementById("stats-container");t&&(t.innerHTML=`
      <div class="content-loading">
        <div class="plugin-loading-spinner"></div>
        <div class="content-loading-text">Refreshing usage data...</div>
      </div>
    `),analyzeStats()},window.filterStats=function(e){if(!componentStatsData)return;let t=componentStatsData;window.activeStatsFilter==="unused"&&(t=t.filter(o=>o.count===0));const n=e?e.toLowerCase().trim():"";if(!n){renderStats(componentStatsData,window.activeStatsFilter==="unused"?t:null);return}const s=t.filter(o=>{const i=o.name.toLowerCase().includes(n),a=o.instances.some(l=>l.name.toLowerCase().includes(n)||l.parentName.toLowerCase().includes(n));return i||a});renderStats(componentStatsData,s)},window.dismissFeedback=function(){const e=document.querySelector(".feedback-section");e&&(e.style.opacity="0",e.style.transform="translateY(-20px)",setTimeout(()=>{e.style.display="none"},300),parent.postMessage({pluginMessage:{type:"set-client-storage",key:"feedback_dismissed",value:!0}},"*"))};function showNotification(e,t,n,s){s=s||5e3;const o=document.getElementById("notification-container"),i=document.createElement("div");i.className=`notification ${e}`;let a=e==="success"?"\u2713":"\u2715";e==="loading"&&(a='<span class="material-symbols-outlined spin">sync</span>');const r=n.includes("<a ")&&n.includes("</a>")?SecurityUtils.sanitizeHTML(n):SecurityUtils.escapeHTML(n);return i.innerHTML=SecurityUtils.sanitizeHTML(`
          <div class="notification-icon">${e==="loading"?a:SecurityUtils.escapeHTML(a)}</div>
          <div class="notification-content">
            <div class="notification-title">${SecurityUtils.escapeHTML(t)}</div>
            <div class="notification-message">${r}</div>
          </div>
          <button class="notification-close" onclick="closeNotification(this.parentElement)">\xD7</button>
        `),o.appendChild(i),s>0&&setTimeout(()=>{closeNotification(i)},s),i}function showLoading(e,t){return showNotification("loading",e,t,0)}function updateNotification(e,t,n,s,o){if(!e)return;e.className=`notification ${t}`;let i="\u2139";t==="success"&&(i="\u2713"),t==="error"&&(i="\u2715"),t==="loading"&&(i='<span class="material-symbols-outlined spin">sync</span>');const l=s.includes("<a ")&&s.includes("</a>")?SecurityUtils.sanitizeHTML(s):SecurityUtils.escapeHTML(s);return e.querySelector(".notification-icon").innerHTML=SecurityUtils.escapeHTML(i),t==="loading"&&(e.querySelector(".notification-icon").innerHTML=i),e.querySelector(".notification-title").textContent=n,e.querySelector(".notification-message").innerHTML=l,o>0&&setTimeout(()=>{closeNotification(e)},o),e}function showSuccess(e,t,n){return n=n||5e3,showNotification("success",e,t,n)}function showError(e,t,n){return n=n||0,showNotification("error",e,t,n)}function closeNotification(e){e&&(e.classList.add("fade-out"),setTimeout(()=>{e.parentElement&&e.parentElement.removeChild(e)},300))}function clearAllNotifications(){const e=document.getElementById("notification-container");for(;e.firstChild;)e.removeChild(e.firstChild)}function showModalNotification(e,t,n,s){const o=document.getElementById(e);if(!o)return;const i=o.querySelector(".modal-footer");if(!i)return;const a=o.querySelector(".modal-notification");a&&a.remove();const l=t==="success"?"\u2713":"\u2715",d=s.includes("<a ")&&s.includes("</a>")?SecurityUtils.sanitizeHTML(s):SecurityUtils.escapeHTML(s),p=document.createElement("div");return p.className=`modal-notification ${t}`,p.innerHTML=SecurityUtils.sanitizeHTML(`
          <div class="modal-notification-icon">${SecurityUtils.escapeHTML(l)}</div>
          <div class="modal-notification-content">
            <div class="modal-notification-title">${SecurityUtils.escapeHTML(n)}</div>
            <div class="modal-notification-message">${d}</div>
          </div>
          <button class="modal-notification-close" onclick="this.parentElement.remove()">\xD7</button>
        `),i.parentNode.insertBefore(p,i),p}function showModalSuccess(e,t,n){return showModalNotification(e,"success",t,n)}function showModalError(e,t,n){return showModalNotification(e,"error",t,n)}function showInlineNotification(e,t,n,s,o){if(!e)return;o=o||1e4;const i=e.querySelector(".inline-notification");i&&i.remove();const a=t==="success"?"\u2713":"\u2715",l=document.createElement("div");return l.className=`inline-notification ${t}`,l.style.cssText=`
          margin: var(--space-4) 0;
          padding: var(--space-4);
          border-radius: var(--radius-lg);
          border-left: 4px solid ${t==="success"?"var(--success-500)":"var(--error-500)"};
          display: flex;
          align-items: flex-start;
          gap: var(--space-3);
          animation: slideInModal 0.3s ease-out;
          background: ${t==="success"?"linear-gradient(135deg, var(--success-50) 0%, var(--neutral-0) 100%)":"linear-gradient(135deg, var(--error-50) 0%, var(--neutral-0) 100%)"};
        `,l.innerHTML=SecurityUtils.sanitizeHTML(`
          <div style="
            width: 24px;
            height: 24px;
            flex-shrink: 0;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: var(--text-base);
            margin-top: var(--space-1);
            background: ${t==="success"?"var(--success-500)":"var(--error-500)"};
            color: var(--neutral-0);
          ">${SecurityUtils.escapeHTML(a)}</div>
          <div style="flex: 1; min-width: 0;">
            <div style="
              font-weight: 600;
              margin-bottom: var(--space-2);
              font-size: var(--text-base);
              color: ${t==="success"?"var(--success-700)":"var(--error-700)"};
            ">${SecurityUtils.escapeHTML(n)}</div>
            <div style="
              font-size: var(--text-sm);
              color: rgba(255, 255, 255, 0.85);
              line-height: 1.4;
              word-break: break-word;
            ">${SecurityUtils.escapeHTML(s)}</div>
          </div>
          <button onclick="this.parentElement.remove()" style="
            background: none;
            border: none;
            font-size: var(--text-xl);
            color: var(--neutral-400);
            cursor: pointer;
            padding: 0;
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--radius-sm);
            flex-shrink: 0;
            transition: all 0.2s ease;
          ">\xD7</button>
        `),e.appendChild(l),o>0&&setTimeout(()=>{l.parentElement&&l.remove()},o),l}function showInlineSuccess(e,t,n,s){return showInlineNotification(e,"success",t,n,s)}function showInlineError(e,t,n,s){return showInlineNotification(e,"error",t,n,s)}function resizePlugin(e,t){}function resizeForCurrentContent(){}function updateRepositoryLink(){const e=document.getElementById("settings-repo-link");let t=window.gitSettings;if(!t&&window.gitlabSettings&&(t={provider:"gitlab",projectId:window.gitlabSettings.projectId,baseUrl:window.gitlabSettings.gitlabUrl,token:window.gitlabSettings.gitlabToken}),!e||!t||!t.projectId){e&&(e.style.display="none");return}e.style.display="inline-flex",setFallbackRepositoryLink(t,e),t.token&&t.token.trim()&&t.provider==="gitlab"&&fetchProjectInfo(t.projectId,t.token,!0)}function fetchProjectInfo(e,t,n=!1){return j(this,null,function*(){var o,i,a,l,r,d,p,u;const s=document.getElementById("settings-repo-link");if(!s){console.error("Repository link button not found in DOM");return}try{if(!e||!t)throw new Error("Project ID and token are required for fetching project information");let g,f={"Content-Type":"application/json"},w=!1;const y=document.getElementById("config-provider"),b=((o=window.gitSettings)==null?void 0:o.provider)||(y?y.value:"gitlab");if(b==="github"){w=!0;const C=((i=window.gitSettings)==null?void 0:i.baseUrl)||((a=document.getElementById("config-github-url"))==null?void 0:a.value)||"https://api.github.com";let M=C;C==="https://github.com"||C==="https://www.github.com"||!C?M="https://api.github.com":C.includes("/api/v3")?M=C:M=`${C}/api/v3`,g=`${M}/repos/${e}`,f.Authorization=`token ${t}`,f.Accept="application/vnd.github.v3+json"}else{const C=((l=window.gitSettings)==null?void 0:l.baseUrl)||((r=window.gitlabSettings)==null?void 0:r.gitlabUrl);g=`${buildGitLabApiUrl(C)}/projects/${encodeURIComponent(e)}`,f["PRIVATE-TOKEN"]=t}const S=new AbortController,x=setTimeout(()=>S.abort(),5e3),k=yield fetch(g,{headers:f,signal:S.signal});if(clearTimeout(x),k.ok){const C=yield k.json();if(w)s.href=C.html_url,s.title=`Open GitHub Repository: ${C.full_name}`;else{if(!C.web_url)throw new Error("Invalid project data received from GitLab API");const M=`${C.web_url}/-/merge_requests`;s.href=M,s.title=`Open Merge Requests for ${C.path_with_namespace||C.name||"project"}`}s.style.opacity="1",s.style.pointerEvents="auto"}else{let C=`API error: ${k.status} ${k.statusText}`;k.status===401||k.status===403?C="Authentication failed. Please check your token.":k.status===404&&(C="Project/Repository not found. Please check your ID."),n||console.warn(C);const M={provider:b,projectId:e,baseUrl:((d=window.gitSettings)==null?void 0:d.baseUrl)||(b==="gitlab"?(p=window.gitlabSettings)==null?void 0:p.gitlabUrl:"")};setFallbackRepositoryLink(M,s)}}catch(g){n||(console.error("Error fetching project information:",g),g.name==="AbortError"?showError("Connection Timeout","Unable to connect to GitLab. Please check your connection."):g.message.includes("Failed to fetch")||g.message.includes("NetworkError")?showError("Network Error","Unable to connect to GitLab. Please check your internet connection."):showError("GitLab Error",g.message||"Unable to fetch project information from GitLab."));const f={provider:"gitlab",projectId:e,baseUrl:(u=window.gitlabSettings)==null?void 0:u.gitlabUrl};setFallbackRepositoryLink(f,s)}})}function setFallbackRepositoryLink(e,t){try{if(!e||!e.projectId){t.style.opacity="0.5",t.style.pointerEvents="none",t.title="Unable to determine project URL";return}const n=e.provider||"gitlab";let s,o;if(n==="github")s=`${e.baseUrl||"https://github.com"}/${e.projectId}`,o=`Open GitHub Repository: ${e.projectId}`;else{const i=buildGitLabWebUrl(e.baseUrl);i&&e.projectId&&(e.projectId.includes("/")?(s=`${i}/${encodeURIComponent(e.projectId)}/-/merge_requests`,o=`Open GitLab Merge Requests for ${e.projectId}`):(s=`${i}/projects/${encodeURIComponent(e.projectId)}`,o=`Open GitLab Project ${e.projectId} (configure namespace/project format for direct merge request access)`))}s?(t.href=s,t.style.opacity="1",t.style.pointerEvents="auto",t.title=o):(t.style.opacity="0.5",t.style.pointerEvents="none",t.title="Unable to determine project URL")}catch(n){console.error("Error setting fallback repository link:",n),t.style.opacity="0.5",t.style.pointerEvents="none",t.title="Repository link unavailable"}}window.saveUnitsSettings=function(){const e={},t={};document.querySelectorAll(".unit-dropdown").forEach(s=>{const o=s.dataset.type,i=s.value;if(i!==""){if(o==="collection"){const a=s.dataset.name;e[a]=i}else if(o==="group"){const a=s.dataset.collection,l=s.dataset.group,r=`${a}/${l}`;t[r]=i}}}),parent.postMessage({pluginMessage:{type:"update-unit-settings",collections:e,groups:t}},"*")},window.resetUnitsSettings=function(){const e=[],t=document.querySelectorAll(".unit-dropdown");t.forEach(s=>{var r,d;const o=s.dataset.type,i=s.closest(".unit-setting-row"),a=(r=i==null?void 0:i.querySelector(".unit-setting-label"))==null?void 0:r.textContent,l=(d=i==null?void 0:i.querySelector(".default-unit-label strong"))==null?void 0:d.textContent;a&&l&&e.push(`\u2022 ${a}: ${l}`)});const n=`Are you sure you want to reset all unit settings to smart defaults?

This will apply these defaults:
${e.slice(0,5).join(`
`)}${e.length>5?`
... and ${e.length-5} more`:""}`;confirm(n)&&(t.forEach(s=>{s.value=""}),window.saveUnitsSettings())},window.qualityScanPerformed=!1,window.statsScanPerformed=!1,window.qualityAnalysisResumed=!1,window.qualityAnalysisState={totalNodes:0,totalIssues:0,tokenIssues:0,variableIssues:0,componentIssues:0,subScores:{tokenCoverage:100,tailwindReadiness:100,componentHygiene:100,variableHygiene:100},weights:{tokenCoverage:"40%",tailwindReadiness:"20%",componentHygiene:"20%",variableHygiene:"20%"}},document.querySelectorAll(".tab").forEach(e=>{e.addEventListener("click",()=>{document.querySelectorAll(".tab").forEach(n=>n.classList.remove("active")),document.querySelectorAll(".tab-content").forEach(n=>n.classList.remove("active")),e.classList.add("active");const t=document.getElementById(e.dataset.tab+"-content");if(t&&t.classList.add("active"),e.dataset.tab==="quality"&&!window.qualityScanPerformed){console.log("First visit to Quality tab - Triggering initial scan...");try{resetQualityState()}catch(n){console.error("Error resetting quality state:",n)}setTimeout(()=>{try{analyzeTokenCoverage("SMART_SCAN"),window.qualityScanPerformed=!0}catch(n){console.error("Error triggering quality analysis:",n)}},50)}if(e.dataset.tab==="stats"&&!window.statsScanPerformed){console.log("First visit to Stats tab - Triggering scan...");const n=document.getElementById("stats-container");n&&(n.innerHTML=`
                      <div class="content-loading">
                        <div class="plugin-loading-spinner"></div>
                        <div class="content-loading-text">Counting component usage...</div>
                      </div>
                     `),setTimeout(()=>{try{analyzeStats(),window.statsScanPerformed=!0}catch(s){console.error("Error triggering stats analysis:",s)}},50)}})});let variablesData=[],stylesData={},variableReferences={},componentsData=[],componentUsageData={},currentCSSData=null,componentSetsData=[],selectionData=null,tailwindV4Validation=null,analysisScope="ALL",componentStatsData=[],statsSortState={column:"count",direction:"desc"};const AVAILABLE_UNITS=["","px","rem","em","%","vw","vh","vmin","vmax","pt","pc","in","cm","mm","ex","ch","fr","none"];function findVariableNameById(e){if(variableReferences&&variableReferences[e])return variableReferences[e];for(const t of variablesData)for(const n of t.variables)if(n.id===e)return n.name;return null}function scrollToVariable(e){const t=document.getElementById(`var-${e}`);t&&(t.scrollIntoView({behavior:"smooth",block:"center"}),t.style.backgroundColor="rgba(139, 92, 246, 0.2)",t.style.border="2px solid #8b5cf6",setTimeout(()=>{t.style.backgroundColor="",t.style.border=""},2e3))}function scrollToGroup(e,t){const n=document.getElementById(`group-${e}-${t}`);n&&(n.scrollIntoView({behavior:"smooth",block:"center"}),n.style.backgroundColor="rgba(139, 92, 246, 0.2)",n.style.border="2px solid #8b5cf6",setTimeout(()=>{n.style.backgroundColor="",n.style.border=""},2e3))}function scrollToGroupById(e){const t=document.getElementById(e);t&&(t.scrollIntoView({behavior:"smooth",block:"center"}),t.style.backgroundColor="rgba(139, 92, 246, 0.2)",t.style.border="2px solid #8b5cf6",setTimeout(()=>{t.style.backgroundColor="",t.style.border=""},2e3))}setTimeout(()=>{window.gitlabSettingsLoaded||checkAndShowUserGuide()},2e3),window.onmessage=e=>{var t,n,s,o,i,a,l,r,d,p,u,g,f,w,y,b,S,x,k,C,M,P,I,E,T,V,L;try{if(!e||!e.data||!e.data.pluginMessage)return;const c=e.data.pluginMessage;if(console.log("UI: Received message from plugin:",c.type),!c||typeof c!="object"||!c.type){console.warn("Received invalid message structure from plugin:",c);return}const N=document.getElementById("export-css-button"),F=document.getElementById("commit-repo-button");if(N||console.warn("Export button not found in DOM during message handling"),F||console.warn("Commit button not found in DOM during message handling"),c.type==="gitlab-settings-loaded")updatePluginLoadingProgress(loadingSteps[1],25),window.gitlabSettings=c.settings,window.gitlabSettingsLoaded=!0,loadConfigurationTab(),updateRepositoryLink(),updateCommitButtonStates(),checkAndShowUserGuide();else if(c.type==="git-settings-loaded")updatePluginLoadingProgress(loadingSteps[1],25),window.gitSettings=c.settings,window.gitlabSettings=c.settings,window.gitlabSettingsLoaded=!0,loadConfigurationTab(),updateRepositoryLink(),updateCommitButtonStates(),checkAndShowUserGuide();else if(c.type==="pages-list")window.MultiPageSelector.handlePagesList(c.pages,c.currentPageId);else if(c.type==="gitlab-settings-saved"||c.type==="git-settings-saved"){if(window.gitlabSettings&&(c.savedAt&&(window.gitlabSettings.savedAt=c.savedAt),c.savedBy&&(window.gitlabSettings.savedBy=c.savedBy),c.savedAt&&c.savedBy))try{const m=new Date(c.savedAt),h=m.toLocaleDateString()+" "+m.toLocaleTimeString(),v=window.SecurityUtils&&window.SecurityUtils.escapeHTML?window.SecurityUtils.escapeHTML:q=>q.replace(/[&<>'"]/g,H=>({"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;"})[H]),A=window.SecurityUtils&&window.SecurityUtils.sanitizeHTML?window.SecurityUtils.sanitizeHTML:q=>q,$=`Last updated by: <strong>${v(c.savedBy)}</strong> on ${v(h)}`,B=document.getElementById("security-note-compact"),z=document.getElementById("security-note-full");if(B&&(B.innerHTML=A($),B.style.display="block"),z){const q=z.querySelector(".saved-info");q&&(q.innerHTML=A($))}}catch(m){console.error("Error updating saved info:",m)}updateRepositoryLink()}else if(c.type==="repositories-loaded")displayRepositories(c.repositories);else if(c.type==="repositories-error"){const m=document.getElementById("repo-list-container");m.innerHTML=`
            <div style="text-align: center; padding: 20px; color: #ef4444;">
              <div style="font-weight: 500; margin-bottom: 8px;">Error loading repositories</div>
              <div style="font-size: 12px; color: rgba(255, 255, 255, 0.6);">${c.error}</div>
            </div>
          `}else if(c.type==="branches-loaded")displayBranches(c.branches);else if(c.type==="branches-error"){const m=document.getElementById("branch-list-container");m.innerHTML=`
            <div style="text-align: center; padding: 20px; color: #ef4444;">
              <div style="font-weight: 500; margin-bottom: 8px;">Error loading branches</div>
              <div style="font-size: 12px; color: rgba(255, 255, 255, 0.6);">${c.error}</div>
            </div>
          `}else if(c.type==="oauth-status")displayOAuthStatus(c.status);else if(c.type==="oauth-url")window.open(c.url,"_blank","width=600,height=700,scrollbars=yes,resizable=yes"),showNotification("info","OAuth","Complete authentication in the popup window",5e3);else if(c.type==="oauth-callback")handleOAuthCallback(c.data);else if(c.type==="document-data"){updatePluginLoadingProgress(loadingSteps[3],75),variablesData=c.variablesData,stylesData=c.stylesData,variableReferences=c.variableReferences||{},componentsData=c.componentsData,parent.postMessage({pluginMessage:{type:"validate-tailwind-v4"}},"*"),window.globalVariablesData=c.variablesData;try{console.log("[DEBUG] document-data handler calling renderVariables"),renderVariables(c.variablesData,stylesData),console.log("[DEBUG] document-data handler renderVariables completed")}catch(v){console.error("[DEBUG] document-data renderVariables crashed:",v)}if(c.feedbackDismissed){const v=document.querySelector(".feedback-section");v&&(v.style.display="none")}const m=variablesData&&variablesData.some(v=>v.variables.length>0),h=stylesData&&(stylesData.textStyles&&stylesData.textStyles.length>0||stylesData.paintStyles&&stylesData.paintStyles.length>0||stylesData.effectStyles&&stylesData.effectStyles.length>0||stylesData.gridStyles&&stylesData.gridStyles.length>0);m||h?N.disabled=!1:N.disabled=!0,updateCommitButtonStates(),updatePluginLoadingProgress("Analyzing token coverage...",90),typeof analyzeTokenCoverage=="function"?setTimeout(()=>{analyzeTokenCoverage("INITIAL_LOAD")},100):(console.warn("analyzeTokenCoverage missing, hiding overlay manually"),hidePluginLoadingOverlay())}else if(c.type==="component-stats-data"){console.log("UI: Received component stats data",c.stats),componentStatsData=c.stats;const m=document.getElementById("stats-container");m&&(typeof renderStats=="function"?renderStats(c.stats):(console.error("renderStats function not found!"),m.innerHTML='<div style="padding: 20px; text-align: center; color: var(--error-500);">Error: Stats renderer not initialized.</div>'))}else if(c.type==="component-stats-error"){console.error("UI: Component stats error",c.error);const m=document.getElementById("stats-container");m&&(m.innerHTML=`<div style="padding: 20px; text-align: center; color: var(--error-500);">Error: ${c.error}</div>`)}else if(c.type==="document-data-error"){console.error("Error loading components:",c.error);const m=document.getElementById("stats-container");m&&(m.innerHTML=`
              <div style="color: #ef4444; background: #fef2f2; border: 1px solid #fecaca; border-radius: 8px; padding: 16px; margin: 16px;">
                <h3 style="margin: 0 0 8px 0; font-size: 14px; font-weight: 600;">Error Loading Components</h3>
                <p style="margin: 0; font-size: 13px;">${c.error}</p>
                <p style="margin: 8px 0 0 0; font-size: 12px; opacity: 0.8;">Check the developer console for more details.</p>
              </div>
            `),c.variablesData&&(variablesData=c.variablesData,renderVariables(variablesData,stylesData)),variablesData&&variablesData.some(h=>h.variables.length>0)?(N.disabled=!1,F.disabled=!1):(N.disabled=!0,F.disabled=!0),setTimeout(()=>{checkAndShowUserGuide()},1e3)}else if(c.type==="variable-deleted")console.log(`Variable deleted successfully: ${c.variableName}`),showNotification("success","Variable Deleted",`Variable "${c.variableName}" deleted successfully`);else if(c.type==="item-ignored"||c.type==="item-unignored")typeof analyzeTokenCoverage=="function"&&analyzeTokenCoverage("SMART_SCAN",null,!0);else if(c.type==="style-deleted")console.log(`Style deleted successfully: ${c.styleName}`),showNotification("success","Style Deleted",`Style "${c.styleName}" deleted successfully`);else if(c.type==="delete-error")console.error("Error deleting variable:",c.error),showNotification("error","Delete Failed",`Failed to delete variable: ${c.error}`),document.querySelectorAll(".delete-variable-btn[disabled]").forEach(h=>{h.disabled=!1,h.style.cursor="pointer",h.innerHTML=`
              <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                <path d="M6.5 1h3a.5.5 0 0 1 .5.5v1H6v-1a.5.5 0 0 1 .5-.5zM11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3A1.5 1.5 0 0 0 5 1.5v1H2.5a.5.5 0 0 0 0 1h.538l.853 10.66A2 2 0 0 0 5.883 16h4.234a2 2 0 0 0 1.992-1.84l.853-10.66h.538a.5.5 0 0 0 0-1H11zm1.958 1H3.042l.846 10.58a1 1 0 0 0 .996.92h4.234a1 1 0 0 0 .996-.92L11.958 3.5zM6.5 5.5a.5.5 0 0 1 1 0v6a.5.5 0 0 1-1 0v-6zm2 0a.5.5 0 0 1 1 0v6a.5.5 0 0 1-1 0v-6z"/>
              </svg>
            `});else if(c.type==="css-export"){if(currentCSSData=c.cssData,c.shouldDownload){const m=c.exportFormat||"css";downloadCSS(c.cssData,m);const h=document.getElementById("export-css-button");h&&hideButtonLoading(h),renderVariables(variablesData,stylesData)}}else if(c.type==="angular-export-data"){const m=c.language||"angular";downloadComponentsZip(c.files,m)}else if(c.type==="test-generated")if(c.forCommit){if(!window.gitlabSettings){showError("Configuration Required","Please configure your GitLab settings in the Settings tab first."),document.querySelectorAll("button.loading").forEach(v=>{v.textContent==="Committing..."&&(v.classList.remove("loading"),v.textContent=v.dataset.originalText||"Commit Test",v.disabled=!1)}),openSettingsModal();return}const m=`feat: add component test for ${c.componentName}`;parent.postMessage({pluginMessage:{type:"commit-component-test",provider:window.gitlabSettings.provider||"gitlab",gitlabUrl:window.gitlabSettings.gitlabUrl,baseUrl:window.gitlabSettings.baseUrl,projectId:window.gitlabSettings.projectId,token:window.gitlabSettings.token||window.gitlabSettings.gitlabToken,gitlabToken:window.gitlabSettings.token||window.gitlabSettings.gitlabToken,commitMessage:m,componentName:c.componentName,testContent:c.testContent,testFilePath:window.gitlabSettings.testFilePath||"components/{componentName}.spec.ts",branchName:window.gitlabSettings.testBranchName||"feature/component-tests"}},"*")}else downloadTest(c.componentName,c.testContent),document.querySelectorAll("button.loading").forEach(h=>{if(h.textContent==="Generating test..."||h.textContent==="Generating..."){h.classList.remove("loading"),h.dataset.timeoutId&&(clearTimeout(parseInt(h.dataset.timeoutId)),delete h.dataset.timeoutId),h.textContent=h.dataset.originalText||"Generate Test",h.disabled=!1;const v=h.parentElement.nextElementSibling;v&&v.classList.contains("test-success-message")&&(v.textContent="Test generated successfully!",v.style.display="block",setTimeout(()=>{v.style.display="none"},3e3))}});else if(c.type==="collections-loaded"){const m=c.collections||[];console.log("Received existing collections:",m),typeof updateExistingCollectionsDropdown=="function"?updateExistingCollectionsDropdown(m):console.warn("updateExistingCollectionsDropdown function not found")}else if(c.type==="commit-progress"){const m=document.getElementById("commit-progress"),h=document.getElementById("progress-status");m&&h&&(m.style.width=`${c.progress}%`,c.message&&(h.textContent=c.message))}else if(c.type==="variable-created"){console.log("Received variable-created:",c.variable);const{name:m,id:h,key:v}=c.variable,A=c.context&&c.context.issueId;A&&(window.pendingFixIssueId=A),analyzeTokenCoverage(),typeof showNotification=="function"&&showNotification("success","Variable Created",`Variable '${m}' created.`)}else if(c.type==="variable-group-renamed"){if(console.log("Variable group renamed successfully:",c),typeof showNotification=="function"&&showNotification("success","Variables Renamed",`${c.renamedCount} variable${c.renamedCount!==1?"s":""} renamed from "${c.oldGroupName}" to "${c.newGroupName}".`),window.tailwindProcessingItemId){const m=document.getElementById(`${window.tailwindProcessingItemId}-card`);m?(m.style.transition="opacity 0.3s ease-out, max-height 0.3s ease-out, margin 0.3s ease-out, padding 0.3s ease-out",m.style.opacity="0",m.style.maxHeight="0",m.style.marginBottom="0",m.style.paddingTop="0",m.style.paddingBottom="0",m.style.overflow="hidden",setTimeout(()=>{if(m.style.display="none",window.tailwindActiveCollectionId){const h=document.getElementById(window.tailwindActiveCollectionId);if(h){const v=h.querySelector(".subgroup-stats");if(v){const B=parseInt(v.textContent)||0,z=Math.max(0,B-1);if(v.textContent=z.toString(),v.style.transition="transform 0.2s ease-out, background-color 0.2s ease-out",v.style.transform="scale(1.2)",v.style.backgroundColor="rgba(139, 92, 246, 0.3)",setTimeout(()=>{v.style.transform="scale(1)",v.style.backgroundColor=""},200),z===0){const q=h.querySelector(".collection-content > div");if(q&&!q.querySelector(".tailwind-success-message")){const H=document.createElement("div");H.className="tailwind-success-message",H.style.cssText=`
                              text-align: center; 
                              padding: 24px; 
                              color: rgba(34, 197, 94, 0.9); 
                              font-size: 13px;
                              background: rgba(34, 197, 94, 0.1);
                              border: 1px solid rgba(34, 197, 94, 0.2);
                              border-radius: 8px;
                              margin: 8px 0;
                              animation: fadeIn 0.3s ease-in;
                            `,H.innerHTML=`
                              <span class="material-symbols-outlined" style="font-size: 32px; display: block; margin-bottom: 8px; opacity: 0.8;">check_circle</span>
                              <strong>All issues resolved!</strong>
                              <div style="font-size: 11px; margin-top: 4px; opacity: 0.7;">Great job! All variables in this section are now Tailwind v4 compatible.</div>
                            `,q.appendChild(H)}}}const A=h.querySelector(".collection-content"),$=h.querySelector(".collection-header");A&&A.classList.contains("collapsed")&&A.classList.remove("collapsed"),$&&$.classList.contains("collapsed")&&$.classList.remove("collapsed")}}window.tailwindScrollPosition!==void 0&&(window.scrollTo(0,window.tailwindScrollPosition),delete window.tailwindScrollPosition),delete window.tailwindProcessingItemId,delete window.tailwindActiveCollectionId,delete window.tailwindFixInProgress,delete window.tailwindFixedGroupName},300)):(delete window.tailwindProcessingItemId,delete window.tailwindActiveCollectionId,delete window.tailwindFixInProgress,delete window.tailwindFixedGroupName,window.tailwindScrollPosition!==void 0&&delete window.tailwindScrollPosition)}}else if(c.type==="variable-group-rename-error"){if(console.error("Error renaming variable group:",c.error),typeof showNotification=="function"&&showNotification("error","Rename Failed",c.error||"Failed to rename variable group"),window.tailwindScrollPosition!==void 0&&(window.scrollTo(0,window.tailwindScrollPosition),delete window.tailwindScrollPosition),window.tailwindProcessingItemId){const m=document.getElementById(`${window.tailwindProcessingItemId}-add-prefix-btn`),h=document.getElementById(`${window.tailwindProcessingItemId}-replace-btn`);m&&(m.disabled=!1,m.style.opacity="1",m.style.pointerEvents="auto",m.innerHTML='<span class="material-symbols-outlined" style="font-size: 14px; vertical-align: middle;">add</span> Add Prefix'),h&&(h.disabled=!1,h.style.opacity="1",h.style.pointerEvents="auto",h.innerHTML='<span class="material-symbols-outlined" style="font-size: 14px; vertical-align: middle;">find_replace</span> Replace')}delete window.tailwindProcessingItemId,delete window.tailwindActiveCollectionId,delete window.tailwindFixInProgress,delete window.tailwindFixedGroupName}else if(c.type==="error")console.error("Plugin Error:",c.message),showError("Plugin Error",c.message),document.querySelectorAll("button.loading").forEach(h=>{h.classList.remove("loading"),h.textContent=h.dataset.originalText||(h.classList.contains("generate-all-variants-button")?"Generate Test for All Variants":"Generate Test"),h.disabled=!1}),N.disabled=!0,renderVariables(variablesData,stylesData),renderComponents(componentsData);else if(c.type==="component-selected")c.switchedPage?showNotification("success","Navigation",`Navigated to "${c.componentName}" on page "${c.pageName}"`,3e3):console.log("Navigated to component:",c.componentName);else if(c.type==="component-selection-error"){const m=c.message||"Failed to select component",h=c.pageName||"unknown page";showError("Navigation Failed",`Could not navigate to component on "${h}". ${m}`,8e3)}else if(c.type==="commit-success")if(c.mergeRequestUrl){const m=c.message+` <a href="${c.mergeRequestUrl}" target="_blank">View Merge Request \u2192</a>`;showModalSuccess("gitlab-modal","Merge Request Created!",m);const h=document.getElementById("commit-submit-button");h.textContent="Close",h.classList.remove("loading"),h.disabled=!1,h.onclick=closeGitLabModal}else showSuccess("Commit Successful",c.message||"Successfully committed to GitLab repository!"),closeGitLabModal(),resetCommitButton();else if(c.type==="commit-error"){let m="";if(c.errorType==="auth")m="This is a permission issue. Please check your config.";else if(c.errorType==="network"){const h=((t=window.gitlabSettings)==null?void 0:t.provider)||"gitlab",v=h==="github"?"GitHub":"GitLab",A=((n=window.gitlabSettings)==null?void 0:n.baseUrl)||(h==="github"?"https://github.com":"https://gitlab.com");m=`<a href="${(s=window.gitlabSettings)!=null&&s.projectId?h==="github"?`${A}/${window.gitlabSettings.projectId}`:`${A}/${window.gitlabSettings.projectId}`:A}" target="_blank" style="color: var(--primary-600); text-decoration: underline;">Test ${v} connection in browser \u2192</a>`}else c.errorType==="api"?c.statusCode===404?m="Please verify your project ID is correct and you have access to this project.":c.statusCode===429?m="Too many requests. Please wait a few minutes before trying again.":m="Please check your GitLab settings and try again.":m="Please check your credentials and settings, then try again.";showModalError("gitlab-modal","Commit Failed",`${c.error} ${m}`),resetCommitButton()}else if(c.type==="test-commit-success"){const m=document.querySelectorAll("button.loading");let h=!1;if(m.forEach(v=>{if(v.textContent==="Committing test..."||v.textContent==="Committing..."){v.classList.remove("loading"),v.dataset.timeoutId&&(clearTimeout(parseInt(v.dataset.timeoutId)),delete v.dataset.timeoutId),v.textContent=v.dataset.originalText||"Commit Test",v.disabled=!1,h=!0;let A="Component test committed successfully!";c.mergeRequestUrl&&(A+=`
              <div style="margin-top: 8px; display: flex; align-items: center; gap: 8px;">
                <a href="${c.mergeRequestUrl}" target="_blank" class="btn-secondary" style="font-size: 11px; padding: 4px 8px; height: auto; text-decoration: none;">View Merge Request</a>
                <button onclick="copyToClipboard('${c.mergeRequestUrl}')" class="btn-secondary" style="font-size: 11px; padding: 4px 8px; height: auto; display: flex; align-items: center; gap: 4px;">
                  <span class="material-symbols-outlined" style="font-size: 14px;">content_copy</span> Copy Link
                </button>
              </div>`);const $=c.mergeRequestUrl?"Merge Request Created!":"Commit Successful";showSuccess($,A,1e4)}}),!h){const v=c.mergeRequestUrl?`Component test committed successfully! <a href="${c.mergeRequestUrl}" target="_blank" style="color: var(--success-600); text-decoration: underline;">View Merge Request</a>`:"Component test committed successfully!",A=c.mergeRequestUrl?"Merge Request Created!":"Commit Successful";showSuccess(A,v,8e3)}}else if(c.type==="test-commit-error"){const m=document.querySelectorAll("button.loading");let h=!1;if(m.forEach(v=>{var A,$,B;if(v.textContent==="Committing..."){v.classList.remove("loading"),v.textContent=v.dataset.originalText||"Commit Test",v.disabled=!1,h=!0;const z=v.closest(".component-item")||v.parentElement;let q="";if(c.errorType==="auth")q="This is a permission issue. Please check your config";else if(c.errorType==="network"){const U=((A=window.gitlabSettings)==null?void 0:A.provider)||"gitlab",R=U==="github"?"GitHub":"GitLab",G=(($=window.gitlabSettings)==null?void 0:$.baseUrl)||(U==="github"?"https://github.com":"https://gitlab.com");q=`<a href="${(B=window.gitlabSettings)!=null&&B.projectId?U==="github"?`${G}/${window.gitlabSettings.projectId}`:`${G}/${window.gitlabSettings.projectId}`:G}" target="_blank" style="color: var(--primary-600); text-decoration: underline;">Test ${R} connection \u2192</a>`}else c.errorType==="api"?c.statusCode===404?q="Please verify your project ID and permissions.":c.statusCode===429?q="Rate limit exceeded. Please try again later.":q="Please check your GitLab settings.":q="Please check your credentials and try again.";const H=`${c.error}<br><small>${q}</small>`;showInlineError(z,"Commit Failed",H,15e3)}}),!h){let v="";if(c.errorType==="auth")v="This is a permission issue. Please check your config";else if(c.errorType==="network"){const A=((o=window.gitlabSettings)==null?void 0:o.provider)||"gitlab",$=A==="github"?"GitHub":"GitLab",B=((i=window.gitlabSettings)==null?void 0:i.baseUrl)||(A==="github"?"https://github.com":"https://gitlab.com");v=`<a href="${(a=window.gitlabSettings)!=null&&a.projectId?A==="github"?`${B}/${window.gitlabSettings.projectId}`:`${B}/${window.gitlabSettings.projectId}`:B}" target="_blank" style="color: var(--primary-600); text-decoration: underline;">Test ${$} connection \u2192</a>`}else c.errorType==="api"?v="Please check your GitLab settings and try again.":v="Please check your credentials and settings, then try again.";showError("Test Commit Failed",`${c.error} ${v}`)}}else if(c.type==="unit-settings-data")unitsData=c.data,renderUnitsSettings(unitsData);else if(c.type==="unit-settings-updated"){if(c.success){const m=document.getElementById("save-units-button"),h=document.getElementById("save-units-button-modal");[m,h].forEach(v=>{if(v){const A=v.textContent;v.textContent="Saved!",v.style.backgroundColor="#28a745",v.disabled=!0,setTimeout(()=>{v.textContent=A,v.style.backgroundColor=""},2e3)}})}}else if(c.type==="tailwind-v4-validation"){if(tailwindV4Validation=c.validation,window.tailwindV4Validation=c.validation,!window.tailwindFixInProgress){if(variablesData&&variablesData.length>0)try{console.log("[DEBUG] tailwind-v4-validation handler calling renderVariables"),renderVariables(variablesData,stylesData),console.log("[DEBUG] tailwind-v4-validation handler renderVariables completed")}catch(m){console.error("[DEBUG] tailwind-v4-validation renderVariables crashed:",m)}}updateCommitButtonStates()}else if(c.type==="component-styles-loaded"){const m=c.componentId,h=c.styles,v=c.textElements,A=document.querySelector(`[data-component-id="${m}"]`);if(A){const $=A.parentElement.querySelector(".component-meta"),B=$&&((l=$.querySelector(".component-name"))==null?void 0:l.textContent)||"Component",z=formatStyles(h,v,B);A.innerHTML=z+'<button class="close-button" onclick="event.stopPropagation(); toggleStyles(this.parentElement)">Close</button>',delete A.dataset.originalContent}}else if(c.type!=="refresh-complete"){if(c.type==="variable-group-renamed")c.success&&(showSuccess("Fix Applied",`Renamed to "${c.newGroupName}"`,3e3),window.pendingQualityRefresh=!0,window.refreshData(),window.justFixedTailwind=!0);else if(c.type==="variable-group-rename-error")showNotification("error","Rename Failed",c.error||"Failed to rename variable group");else if(c.type==="refresh-error")showNotification("error","Refresh Failed",c.error||"Failed to refresh data"),console.error("Data refresh failed:",c.error);else if(c.type==="refresh-success"){window.currentRefreshNotification?(updateNotification(window.currentRefreshNotification,"success","Refreshed","Variables and styles synced successfully",3e3),window.currentRefreshNotification=null):showSuccess("Refreshed","Variables and styles synced successfully",3e3),c.variables&&(window.variablesData=c.variables),c.styles&&(window.stylesData=c.styles),c.components&&(window.componentsData=c.components);try{renderVariables(window.variablesData)}catch(m){console.error("[DEBUG] renderVariables crashed:",m)}window.pendingQualityRefresh&&(console.log("Triggering pending quality analysis..."),window.pendingQualityRefresh=!1,typeof analyzeTokenCoverage=="function"&&analyzeTokenCoverage("SMART_SCAN",null,!1,!0))}else if(c.type==="quality-report"){console.log("UI received quality-report",c.report),window._qualityAnalysisInFlight=!1;try{const m=c.report;window.qualityAnalysisState&&(window.qualityAnalysisState.totalNodes=((r=m.meta)==null?void 0:r.totalNodes)||0,window.lastTokenCoverageResult=(d=m.metrics)==null?void 0:d.tokenCoverage,window.componentHygieneData=(p=m.metrics)==null?void 0:p.componentHygiene,window.variableHygieneData=(u=m.metrics)==null?void 0:u.variableHygiene,window.qualityAnalysisState.tokenIssues=((f=(g=m.metrics)==null?void 0:g.tokenCoverage)==null?void 0:f.totalIssues)||0,window.qualityAnalysisState.componentIssues=((y=(w=m.metrics)==null?void 0:w.componentHygiene)==null?void 0:y.unusedCount)||0,window.qualityAnalysisState.variableIssues=((S=(b=m.metrics)==null?void 0:b.variableHygiene)==null?void 0:S.unusedCount)||0,(x=m.score)!=null&&x.breakdown&&(window.qualityAnalysisState.subScores=m.score.breakdown),updateQualityScoreUI()),(C=(k=m.metrics)==null?void 0:k.tailwindReadiness)!=null&&C.validation&&(window.tailwindV4Validation=m.metrics.tailwindReadiness.validation,((P=(M=m.score)==null?void 0:M.breakdown)==null?void 0:P.tailwindReadiness)!==void 0&&(window.tailwindV4Validation.readinessScore=m.score.breakdown.tailwindReadiness));const h=document.getElementById("quality-unified-loader");h&&h.remove(),(I=m.metrics)!=null&&I.tokenCoverage&&displayTokenCoverageResults(m.metrics.tokenCoverage),(E=m.metrics)!=null&&E.componentHygiene&&displayComponentHygieneSection(m.metrics.componentHygiene),(T=m.metrics)!=null&&T.variableHygiene&&displayVariableHygieneSection(m.metrics.variableHygiene),window.currentAnalysisNotification&&(updateNotification(window.currentAnalysisNotification,"success","Analysis Complete","Quality scan finished",3e3),window.currentAnalysisNotification=null),updatePluginLoadingProgress("Ready!",100),hidePluginLoadingOverlay(),window.pendingImproveDesignSystem&&(window.pendingImproveDesignSystem=!1,setTimeout(()=>handleImproveDesignSystem(),300))}catch(m){console.error("Error processing quality-report:",m),updatePluginLoadingProgress("Ready",100),hidePluginLoadingOverlay()}}else if(c.type==="quality-report-error")window._qualityAnalysisInFlight=!1,console.error("Quality Analysis Error:",c.error),showNotification("error","Analysis Failed",c.error),updatePluginLoadingProgress("Error",100),hidePluginLoadingOverlay();else if(c.type==="component-stats-data"){console.log(`Component deleted successfully: ${c.componentName}`);const m=c.componentType||"component";let h="Component Deleted",v="";m==="variant"?(h="Variant Deleted",v=`Variant "${c.componentName}" deleted successfully`):m==="component set"?(h="Component Set Deleted",v=`Component set "${c.componentName}" and all its variants deleted successfully`):v=`Component "${c.componentName}" deleted successfully`,showNotification("success",h,v);const A=window.scrollY||document.documentElement.scrollTop;if(c.componentId){const $=(V=document.querySelector(`[data-component-id="${c.componentId}"]`))==null?void 0:V.closest(".quality-issue-card");$?($.style.transition="opacity 0.3s ease-out, max-height 0.3s ease-out, margin 0.3s ease-out, padding 0.3s ease-out",$.style.opacity="0",$.style.maxHeight="0",$.style.marginBottom="0",$.style.paddingTop="0",$.style.paddingBottom="0",$.style.overflow="hidden",setTimeout(()=>{var B;if($.style.display="none",window.scrollTo(0,A),window.componentHygieneData){const z=window.componentHygieneData.unusedComponents.findIndex(q=>q.id===c.componentId);if(z!==-1){window.componentHygieneData.unusedComponents.splice(z,1),window.componentHygieneData.unusedCount=window.componentHygieneData.unusedComponents.length;const q=window.componentHygieneData.totalComponents,H=window.componentHygieneData.unusedCount;window.componentHygieneData.hygieneScore=q===0?100:Math.round((q-H)/q*100);const U=document.getElementById("unused-components-section");if(U){const R=U.querySelector('h2 span[style*="font-size: 14px"]');R&&(R.textContent=`${window.componentHygieneData.hygieneScore}%`);const G=U.querySelector('p[style*="font-size: 12px"]');G&&(G.textContent=`${H} unused component${H!==1?"s":""} found out of ${q} total. Remove unused components to improve your design system hygiene.`)}if(H===0){const R=(B=document.getElementById("unused-components-section"))==null?void 0:B.closest("#component-hygiene-section");R&&(R.style.transition="opacity 0.3s ease-out",R.style.opacity="0",setTimeout(()=>{R.style.display="none"},300))}}}},300)):window.scrollTo(0,A)}}else if(c.type==="batch-variants-deleted"){console.log(`Batch deletion complete: ${c.successCount} succeeded, ${c.failCount} failed`),c.successCount>0&&showNotification("success","Variants Deleted",`Successfully deleted ${c.successCount} unused variant${c.successCount>1?"s":""}${c.failCount>0?` (${c.failCount} failed)`:""}`),c.failCount>0&&c.successCount===0&&showNotification("error","Delete Failed",`Failed to delete ${c.failCount} variant${c.failCount>1?"s":""}`);const m=window.scrollY||document.documentElement.scrollTop;if(c.componentId&&c.deletedAll){const h=(L=document.querySelector(`[data-component-id="${c.componentId}"]`))==null?void 0:L.closest(".quality-issue-card");h?(h.style.transition="opacity 0.3s ease-out, max-height 0.3s ease-out, margin 0.3s ease-out, padding 0.3s ease-out",h.style.opacity="0",h.style.maxHeight="0",h.style.marginBottom="0",h.style.paddingTop="0",h.style.paddingBottom="0",h.style.overflow="hidden",setTimeout(()=>{var v;if(h.style.display="none",window.scrollTo(0,m),window.componentHygieneData){const A=window.componentHygieneData.unusedComponents.findIndex($=>$.id===c.componentId);if(A!==-1){window.componentHygieneData.unusedComponents.splice(A,1),window.componentHygieneData.unusedCount=window.componentHygieneData.unusedComponents.length;const $=window.componentHygieneData.totalComponents,B=window.componentHygieneData.unusedCount;window.componentHygieneData.hygieneScore=$===0?100:Math.round(($-B)/$*100);const z=document.getElementById("unused-components-section");if(z){const q=z.querySelector('h2 span[style*="font-size: 14px"]');q&&(q.textContent=`${window.componentHygieneData.hygieneScore}%`);const H=z.querySelector('p[style*="font-size: 12px"]');H&&(H.textContent=`${B} unused component${B!==1?"s":""} found out of ${$} total. Remove unused components to improve your design system hygiene.`)}if(B===0){const q=(v=document.getElementById("unused-components-section"))==null?void 0:v.closest("#component-hygiene-section");q&&(q.style.transition="opacity 0.3s ease-out",q.style.opacity="0",setTimeout(()=>{q.style.display="none"},300))}}}},300)):window.scrollTo(0,m)}else window.scrollTo(0,m)}else if(c.type==="delete-component-error")console.error("Error deleting component:",c.error),showNotification("error","Delete Failed",`Failed to delete: ${c.error}`);else if(c.type==="token-coverage-error"){const m=document.getElementById("token-coverage-results");m.innerHTML=`
            <div style="text-align: center; padding: 40px; background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: 12px;">
              <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="color: #ef4444; margin-bottom: 16px;">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="15" y1="9" x2="9" y2="15"></line>
                <line x1="9" y1="9" x2="15" y2="15"></line>
              </svg>
              <h3 style="color: #ef4444; margin-bottom: 8px;">Analysis Failed</h3>
              <p style="color: rgba(255, 255, 255, 0.8);">${c.error||"Failed to analyze token coverage"}</p>
            </div>
          `,showNotification(c.error||"Failed to analyze token coverage"),hidePluginLoadingOverlay()}else if(c.type==="apply-token-result"){if(window.lastApplyButtonId){const h=document.getElementById(window.lastApplyButtonId);if(h){if(h.classList.remove("btn-loading"),c.success){if(h.classList.add("btn-success"),h.innerHTML='<span class="material-symbols-outlined" style="font-size: 14px; vertical-align: middle;">check</span> Applied',window.tokenFixIssueId){const v=document.getElementById(`${window.tokenFixIssueId}-card`);v?(v.style.transition="opacity 0.3s ease-out, max-height 0.3s ease-out, margin 0.3s ease-out, padding 0.3s ease-out",v.style.opacity="0",v.style.maxHeight="0",v.style.marginBottom="0",v.style.paddingTop="0",v.style.paddingBottom="0",v.style.overflow="hidden",setTimeout(()=>{v.style.display="none";let A=v.nextElementSibling;for(;A&&(!A.classList.contains("quality-issue-card")||A.style.display==="none");)A=A.nextElementSibling;if(A&&A.id){const $=A.id.replace("-card","");console.log("Auto-advancing to next issue:",$),window.toggleIssueCard&&(window.toggleIssueCard($),setTimeout(()=>{A.scrollIntoView({behavior:"smooth",block:"center"})},100))}if(window.tokenFixActiveCollectionId){const $=document.getElementById(window.tokenFixActiveCollectionId);if($){const B=$.querySelector(".subgroup-stats");if(B){const H=parseInt(B.textContent)||0,U=Math.max(0,H-1);if(B.textContent=U.toString(),B.style.transition="transform 0.2s ease-out, background-color 0.2s ease-out",B.style.transform="scale(1.2)",B.style.backgroundColor="rgba(139, 92, 246, 0.3)",setTimeout(()=>{B.style.transform="scale(1)",B.style.backgroundColor=""},200),U===0){const R=$.querySelector(".collection-content > div");if(R&&!R.querySelector(".token-coverage-success-message")){const G=document.createElement("div");G.className="token-coverage-success-message",G.style.cssText=`
                              text-align: center; 
                              padding: 24px; 
                              color: rgba(34, 197, 94, 0.9); 
                              font-size: 13px;
                              background: rgba(34, 197, 94, 0.1);
                              border: 1px solid rgba(34, 197, 94, 0.2);
                              border-radius: 8px;
                              margin: 8px 0;
                              animation: fadeIn 0.3s ease-in;
                            `,G.innerHTML=`
                              <span class="material-symbols-outlined" style="font-size: 32px; display: block; margin-bottom: 8px; opacity: 0.8;">check_circle</span>
                              <strong>All issues in this category resolved!</strong>
                              <div style="font-size: 11px; margin-top: 4px; opacity: 0.7;">Excellent work! All elements in this category now use design tokens.</div>
                            `,R.appendChild(G)}}}const z=$.querySelector(".collection-content"),q=$.querySelector(".collection-header");z&&z.classList.contains("collapsed")&&z.classList.remove("collapsed"),q&&q.classList.contains("collapsed")&&q.classList.remove("collapsed")}}window.tokenFixScrollPosition!==void 0&&(window.scrollTo(0,window.tokenFixScrollPosition),delete window.tokenFixScrollPosition),delete window.tokenFixIssueId,delete window.tokenFixActiveCollectionId,delete window.tokenFixInProgress,typeof analyzeTokenCoverage=="function"&&analyzeTokenCoverage("SMART_SCAN",null,!0)},300)):(delete window.tokenFixIssueId,delete window.tokenFixActiveCollectionId,delete window.tokenFixInProgress,window.tokenFixScrollPosition!==void 0&&delete window.tokenFixScrollPosition,typeof analyzeTokenCoverage=="function"&&analyzeTokenCoverage("SMART_SCAN",null,!0))}}else h.disabled=!1,h.innerHTML='<span class="material-symbols-outlined" style="font-size: 14px; vertical-align: middle;">check</span> Apply',updateIssueApplyButtonState(window.lastApplyButtonId.replace("-apply-btn","")),window.tokenFixScrollPosition!==void 0&&(window.scrollTo(0,window.tokenFixScrollPosition),delete window.tokenFixScrollPosition),delete window.tokenFixIssueId,delete window.tokenFixActiveCollectionId,delete window.tokenFixInProgress;setTimeout(()=>{c.success&&h.classList.contains("btn-success")&&(h.classList.remove("btn-success"),h.innerHTML='<span class="material-symbols-outlined" style="font-size: 14px; vertical-align: middle;">check</span> Apply',updateIssueApplyButtonState(window.lastApplyButtonId.replace("-apply-btn",""))),window.lastApplyButtonId=null},2e3)}}!!window.lastApplyButtonId&&c.success||(c.success?showNotification("success","Token Applied",`Successfully applied token to ${c.successCount} node${c.successCount!==1?"s":""}`):showNotification("error","Application Failed",c.error||"Failed to apply token")),window.qualityTabRendered&&window.currentRefreshNotification&&(window.currentRefreshNotification.update("success","Analysis Complete","Quality analysis finished."),window.currentRefreshNotification=null)}}}catch(c){console.error("Error handling plugin message:",c);try{c.message&&c.message.includes("DOM")?showError("Interface Error","A user interface error occurred. Please refresh the plugin."):c.message&&c.message.includes("settings")?showError("Settings Error","Error processing settings. Please try again."):showError("Plugin Error","An unexpected error occurred. Please try again.")}catch(N){console.error("Failed to show error message:",N)}}};function renderVariables(e,t=null){var u,g,f,w,y,b,S,x,k,C,M,P;console.log("[DEBUG] renderVariables ENTER",{dataLength:e?e.length:0,hasStylesData:!!t,stylesKeys:t?Object.keys(t):[]}),t&&console.log("DEBUG: stylesData counts:",{paint:t.paintStyles?t.paintStyles.length:0,text:t.textStyles?t.textStyles.length:0,effect:t.effectStyles?t.effectStyles.length:0,grid:t.gridStyles?t.gridStyles.length:0});let n=0;const s=e.length;e.forEach(I=>{n+=I.variables?I.variables.length:0}),typeof updateVariablesSummary=="function"?updateVariablesSummary(n,s):window.updateVariablesSummary&&window.updateVariablesSummary(n,s);const o=document.getElementById("variables-container"),i=t&&(t.textStyles&&t.textStyles.length>0||t.paintStyles&&t.paintStyles.length>0||t.effectStyles&&t.effectStyles.length>0||t.gridStyles&&t.gridStyles.length>0);if(e.length===0&&!i){o.innerHTML="";const I=document.createElement("div");I.className="no-items",I.textContent="No variables or styles found.",o.appendChild(I);return}let a="";const l=[];let r=[];e.forEach(I=>{if(I.variables.length>0){const E=new Map,T=[];I.variables.forEach(V=>{const L=V.name.match(/^([^\/]+)\//);if(L){const c=L[1];E.has(c)||E.set(c,[]),E.get(c).push(V)}else T.push(V)}),E.forEach((V,L)=>{let c=!1,N=!1;if(V.forEach(F=>{F.valuesByMode.forEach(m=>{typeof m.value=="object"&&m.value.type==="VARIABLE_ALIAS"?N=!0:c=!0})}),c&&N){const F=`group-${I.name.replace(/[^a-zA-Z0-9]/g,"-")}-${L.replace(/[^a-zA-Z0-9]/g,"-")}`;l.push({collection:I.name,group:L,displayName:L.replace(/-/g," ").replace(/\b\w/g,m=>m.toUpperCase()),issue:"mixed-values-and-links",sanitizedId:F})}})}});const d=window.tailwindV4Validation;d&&!d.isValid&&d.invalidGroups.length>0&&(r=[],e.forEach(I=>{const E=new Map;I.variables.forEach(T=>{const V=T.name.match(/^([^\/]+)\//);if(V){const L=V[1];E.has(L)||E.set(L,[]),E.get(L).push(T)}}),E.forEach((T,V)=>{if(d.invalidGroups.indexOf(V)!==-1){const L=`group-${I.name.replace(/[^a-zA-Z0-9]/g,"-")}-${V.replace(/[^a-zA-Z0-9]/g,"-")}`;r.push({collection:I.name,group:V,displayName:V.replace(/-/g," ").replace(/\b\w/g,c=>c.toUpperCase()),sanitizedId:L})}})}));const p=document.getElementById("variables-warning-container");if(p){p.innerHTML="";let I="";(r.length>0||l.length>0)&&(I+=`
                    <div class="validation-alert validation-alert-warning" style="background: rgba(139, 92, 246, 0.1); border-color: rgba(139, 92, 246, 0.3);">
                      <div style="display: flex; align-items: center; gap: 12px;">
                        <div>
                          <strong style="color: white; display: block; margin-bottom: 4px;">Issues in Design System found</strong>
                          <small style="color: rgba(255, 255, 255, 0.7);">Some issues were found with your variables</small>
                        </div>
                      </div>
                      <button type="button" onclick="switchToQualityTab()" class="btn-primary" style="background: var(--purple-medium) !important; box-shadow: none !important; border: none !important;">
                        Improve design system
                      </button>
                    </div>
                  `),p.innerHTML=I}if(e.forEach(I=>{if(I.variables.length>0){const E=new Map,T=[];I.variables.forEach(L=>{const c=L.name.match(/^([^\/]+)\//);if(c){const N=c[1];E.has(N)||E.set(N,[]),E.get(N).push(L)}else T.push(L)});const V=`collection-${I.name.replace(/[^a-zA-Z0-9]/g,"-")}`;if(a+=`
              <div class="variable-collection" id="${V}" data-collection-id="${V}">
                <div class="collection-header" onclick="toggleCollection('${V}')">
                  <span class="material-symbols-outlined collection-toggle-icon">expand_more</span>
                  <div class="collection-info">
                    <h3 class="collection-name-title">${I.name}</h3>
                  </div>
                  <span class="subgroup-stats">${I.variables.length}</span>
                </div>
                <div class="collection-content" id="${V}-content">
            `,T.length>0){const L="Ungrouped",c=`group-${V}-ungrouped`;a+=`
                <div class="variable-subgroup">
                  <div class="subgroup-header collapsed" onclick="toggleSubgroup('${c}')">
                    <span class="material-symbols-outlined subgroup-toggle-icon">expand_more</span>
                    <div style="display: flex; align-items: center; gap: 8px; flex: 1;">
                      <span class="subgroup-title">${L}</span>
                    </div>
                    <span class="subgroup-stats">${T.length}</span>
                  </div>
                  <div class="subgroup-content collapsed" id="${c}-content">
              `;const N=T.map(F=>O(D({},F),{collection:I.name}));a+=renderVariableTable(N),a+=`
                  </div>
                </div>
              `}E.forEach((L,c)=>{var H,U;const N=c.replace(/-/g," ").replace(/\b\w/g,R=>R.toUpperCase());let F=!1,m=!1;L.forEach(R=>{R.valuesByMode.forEach(G=>{typeof G.value=="object"&&G.value.type==="VARIABLE_ALIAS"?m=!0:F=!0})});const h=F&&m,v=((H=window.gitSettings)==null?void 0:H.exportFormat)==="tailwind-v4"||((U=window.gitlabSettings)==null?void 0:U.exportFormat)==="tailwind-v4",A=window.tailwindV4Validation,$=v&&A&&!A.isValid&&A.invalidGroups.indexOf(c)!==-1,B=v&&A&&A.groups.some(R=>R.name===c&&R.isValid),z=`${V}-group-${c.replace(/[^a-zA-Z0-9]/g,"-")}`;a+=`
                <div class="variable-subgroup ${h||$?"has-validation-issues":""}" id="${z}">
                  <div class="subgroup-header" onclick="toggleSubgroup('${z}')">
                    <span class="material-symbols-outlined subgroup-toggle-icon">expand_more</span>
                    <div class="subgroup-title" style="flex: 1;">
                      ${N}
                      ${B?`<span class="tailwind-icon" title="Valid Tailwind v4 namespace">
                              <svg viewBox="0 0 54 33" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd" clip-rule="evenodd" d="M27 0C19.8 0 15.3 3.6 13.5 10.8C16.2 7.2 19.35 5.85 22.95 6.75C25.004 7.263 26.472 8.754 28.097 10.403C30.744 13.09 33.808 16.2 40.5 16.2C47.7 16.2 52.2 12.6 54 5.4C51.3 9 48.15 10.35 44.55 9.45C42.496 8.937 41.028 7.446 39.403 5.797C36.756 3.11 33.692 0 27 0ZM13.5 16.2C6.3 16.2 1.8 19.8 0 27C2.7 23.4 5.85 22.05 9.45 22.95C11.504 23.464 12.972 24.954 14.597 26.603C17.244 29.29 20.308 32.4 27 32.4C34.2 32.4 38.7 28.8 40.5 21.6C37.8 25.2 34.65 26.55 31.05 25.65C28.996 25.137 27.528 23.646 25.903 21.997C23.256 19.31 20.192 16.2 13.5 16.2Z" fill="#38bdf8"/>
                              </svg>
                             </span>`:""}
                      ${h?'<span class="material-symbols-outlined mixed-value-icon" title="Mixed values and links">alt_route</span>':""}
                      ${$?`<span class="tailwind-icon" title="Invalid Tailwind namespace">
                              <svg viewBox="0 0 54 33" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd" clip-rule="evenodd" d="M27 0C19.8 0 15.3 3.6 13.5 10.8C16.2 7.2 19.35 5.85 22.95 6.75C25.004 7.263 26.472 8.754 28.097 10.403C30.744 13.09 33.808 16.2 40.5 16.2C47.7 16.2 52.2 12.6 54 5.4C51.3 9 48.15 10.35 44.55 9.45C42.496 8.937 41.028 7.446 39.403 5.797C36.756 3.11 33.692 0 27 0ZM13.5 16.2C6.3 16.2 1.8 19.8 0 27C2.7 23.4 5.85 22.05 9.45 22.95C11.504 23.464 12.972 24.954 14.597 26.603C17.244 29.29 20.308 32.4 27 32.4C34.2 32.4 38.7 28.8 40.5 21.6C37.8 25.2 34.65 26.55 31.05 25.65C28.996 25.137 27.528 23.646 25.903 21.997C23.256 19.31 20.192 16.2 13.5 16.2Z" fill="#f87171"/>
                              </svg>
                             </span>`:""}                    </div>
                    <span class="subgroup-stats">${L.length}</span>
                  </div>
                  <div class="subgroup-content collapsed" id="${z}-content">
              `;const q=L.map(R=>O(D({},R),{collection:I.name}));a+=renderVariableTable(q),a+=`
                  </div>
                </div>
              `}),a+=`
                </div>
              </div>
            `}}),t&&(((u=t.textStyles)==null?void 0:u.length)>0||((g=t.paintStyles)==null?void 0:g.length)>0||((f=t.effectStyles)==null?void 0:f.length)>0||((w=t.gridStyles)==null?void 0:w.length)>0)){const E=(((y=t.textStyles)==null?void 0:y.length)||0)+(((b=t.paintStyles)==null?void 0:b.length)||0)+(((S=t.effectStyles)==null?void 0:S.length)||0)+(((x=t.gridStyles)==null?void 0:x.length)||0);let T=0;(k=t.paintStyles)!=null&&k.length&&T++,(C=t.textStyles)!=null&&C.length&&T++,(M=t.effectStyles)!=null&&M.length&&T++,(P=t.gridStyles)!=null&&P.length&&T++,a+=`
                    <div class="tab-header" style="margin-top: 32px; margin-bottom: 16px;">
                        <div style="display: flex; align-items: baseline; gap: 12px; margin-bottom: 8px;">
                            <h2 style="color: rgba(255, 255, 255, 0.9); display: flex; align-items: center; gap: 10px; font-size: 1.2rem; margin: 0;">
                                Styles
                            </h2>
                            <div class="header-summary">
                                <div class="summary-badge" data-tooltip="Total Styles">
                                   <span>${E} Styles</span>
                                </div>
                                <div class="summary-badge" data-tooltip="Categories">
                                   <span>${T} Categories</span>
                                </div>
                            </div>
                        </div>
                    </div>
                `,a+=renderStylesAsCollection(t)}console.log("[DEBUG] renderVariables updating DOM innerHTML (length: "+a.length+")"),o.innerHTML=SecurityUtils.sanitizeHTML(a),console.log("[DEBUG] renderVariables DOM update complete"),window.collapseAllVariables&&(console.log("[DEBUG] calling collapseAllVariables from renderVariables"),window.collapseAllVariables(),console.log("[DEBUG] collapseAllVariables returned"))}function renderStylesAsCollection(e){if(!e||e.textStyles.length===0&&e.paintStyles.length===0&&e.effectStyles.length===0&&(!e.gridStyles||e.gridStyles.length===0))return"";let t="";return e.paintStyles&&e.paintStyles.length>0&&(t+=renderStyleGroup("Color",e.paintStyles,"paint","collection-figma-styles-paint")),e.textStyles&&e.textStyles.length>0&&(t+=renderStyleGroup("Text",e.textStyles,"text","collection-figma-styles-text")),e.effectStyles&&e.effectStyles.length>0&&(t+=renderStyleGroup("Effect",e.effectStyles,"effect","collection-figma-styles-effect")),e.gridStyles&&e.gridStyles.length>0&&(t+=renderStyleGroup("Layout guide",e.gridStyles,"grid","collection-figma-styles-grid")),t}function formatDecimal(e){return typeof e!="number"?e:parseFloat(e.toFixed(2))}function renderStyleGroup(e,t,n,s){const o=t.length,i=n==="text"?"text_fields":n==="paint"?"colorize":n==="effect"?"bolt":"grid_on",a={},l=[];t.forEach(p=>{const u=p.name.split("/");if(u.length>1){const g=u[0].trim();a[g]||(a[g]=[]),a[g].push(p)}else l.push(p)});const r=Object.keys(a).sort();let d=`
            <div class="variable-collection" id="${s}" data-collection-id="${s}">
                <div class="collection-header" onclick="toggleCollection('${s}')">
                    <span class="material-symbols-outlined collection-toggle-icon">expand_more</span>
                    <div class="collection-info">
                        <h3 class="collection-name-title">${e}</h3>
                    </div>
                    <span class="subgroup-stats">${o}</span>
                </div>
                <div class="collection-content" id="${s}-content">
        `;if(r.forEach(p=>{const u=a[p],g=`${s}-group-${p.replace(/[^a-zA-Z0-9]/g,"-")}`;d+=`
                <div class="variable-subgroup">
                    <div class="subgroup-header collapsed" onclick="toggleSubgroup('${g}')">
                        <span class="material-symbols-outlined subgroup-toggle-icon">expand_more</span>
                        <div style="display: flex; align-items: center; gap: 8px; flex: 1;">
                            <span class="subgroup-title">${p}</span>
                        </div>
                        <span class="subgroup-stats">${u.length}</span>
                    </div>
                    <div class="subgroup-content collapsed" id="${g}-content">
                        ${renderStyleTable(u,n,!0)} 
                    </div>
                </div>
            `}),l.length>0)if(r.length>0){const p=`${s}-ungrouped`;d+=`
                    <div class="variable-subgroup">
                        <div class="subgroup-header collapsed" onclick="toggleSubgroup('${p}')">
                            <span class="material-symbols-outlined subgroup-toggle-icon">expand_more</span>
                            <div style="display: flex; align-items: center; gap: 8px; flex: 1;">
                                <span class="subgroup-title">Ungrouped</span>
                            </div>
                            <span class="subgroup-stats">${l.length}</span>
                        </div>

                        <div class="subgroup-content collapsed" id="${p}-content">
                            ${renderStyleTable(l,n,!0)}
                        </div>
                    </div>
                `}else d+=renderStyleTable(l,n,!1);return d+=`
                </div>
            </div>
        `,d}function renderStyleTable(e,t,n=!1){let s=`
                <div class="variable-list">
                <div class="unified-list-header variable-header">
                    <div class="variable-cell">Name</div>
                    <div class="variable-cell">Type</div>
                    <div class="variable-cell">Values</div>
                    <div class="variable-cell" style="text-align: center;">Usage</div>
                    <div class="variable-cell"></div>
                </div>
        `;return e.forEach(o=>{const i=o.name.replace(/[^a-zA-Z0-9]/g,"-").toLowerCase();let a=o.name;if(n){const r=a.indexOf("/");r!==-1&&(a=a.substring(r+1))}let l="";if(t==="paint"){const r=o.paints[0];if(r)if(r.type==="SOLID"){const{r:d,g:p,b:u}=r.color,g=r.opacity!==void 0?r.opacity:1;let f="";if(!(o.boundVariables&&o.boundVariables.paints&&o.boundVariables.paints[0])){const y=findVariableMatchingValue(r.color,"paint");y&&(f=`
                                 <span class="material-symbols-outlined" 
                                       style="font-size: 14px; color: #fbbf24; cursor: help; margin-left: 6px;" 
                                       title="Value matches variable '${y.name}'">link_off</span>`)}l=`
                            <div style="display:flex; align-items:center; gap:8px;">
                                <span class="color-preview" style="background-color: rgba(${Math.round(d*255)},${Math.round(p*255)},${Math.round(u*255)},${g})"></span>
                                <span style="font-family: monospace; font-size: 10px;">rgba(${Math.round(d*255)}, ${Math.round(p*255)}, ${Math.round(u*255)}, ${formatDecimal(g)})</span>
                                ${f}
                            </div>`}else if(["GRADIENT_LINEAR","GRADIENT_RADIAL","GRADIENT_ANGULAR","GRADIENT_DIAMOND"].includes(r.type)){let d="";if(r.gradientStops&&r.gradientStops.length>0){const p=r.gradientStops.map(u=>{const{r:g,g:f,b:w,a:y}=u.color;return`rgba(${Math.round(g*255)}, ${Math.round(f*255)}, ${Math.round(w*255)}, ${y}) ${Math.round(u.position*100)}%`}).join(", ");d=`linear-gradient(135deg, ${p})`,r.type==="GRADIENT_RADIAL"&&(d=`radial-gradient(circle, ${p})`)}l=`
                            <div style="display:flex; align-items:center; gap:8px;">
                                <span class="color-preview" style="background: ${d}"></span>
                                <span style="font-size: 11px; opacity: 0.8;">${r.type.replace("GRADIENT_","")}</span>
                            </div>`}else r.type==="IMAGE"?l=`
                            <div style="display:flex; align-items:center; gap:8px;">
                                <span class="color-preview" style="background: #555; display: flex; align-items: center; justify-content: center;">
                                    <span class="material-symbols-outlined" style="font-size: 12px; color: #fff;">image</span>
                                </span>
                                <span style="font-size: 11px; opacity: 0.8;">Image</span>
                            </div>`:l=`<div>${r.type}</div>`;else l='<div style="opacity: 0.5;">No Paint</div>'}else if(t==="text"){let r="";(o.boundVariables||{}).fontSize||findVariableMatchingValue(o.fontSize,"number")&&(r="\u26A0\uFE0F"),l=`<div>${o.fontName.family} ${o.fontName.style} / ${formatDecimal(o.fontSize)}px ${r?`<span title="Font Size matches a variable" style="cursor:help; font-size: 12px;">${r}</span>`:""}</div>`}else if(t==="effect")if(o.effects&&o.effects.length>0){const r=o.effects[0];if(["DROP_SHADOW","INNER_SHADOW"].includes(r.type)){const{r:d,g:p,b:u,a:g}=r.color,f=`rgba(${Math.round(d*255)}, ${Math.round(p*255)}, ${Math.round(u*255)}, ${g})`,w=r.offset,y=r.radius,b=r.spread||0;let S="";const x=o.boundVariables&&o.boundVariables.effects&&o.boundVariables.effects[0];if(!(x&&x.color)){const P=findVariableMatchingValue(r.color,"paint");P&&(S=`
                               <span class="material-symbols-outlined" 
                                     style="font-size: 14px; color: #fbbf24; cursor: help; margin-left: 6px;" 
                                     title="Value matches variable '${P.name}'">link_off</span>`)}l=`
                            <div style="display:flex; align-items:center; gap:8px;">
                                <div style="width: 16px; height: 16px; background: #fff; border-radius: 4px; box-shadow: ${`${r.type==="INNER_SHADOW"?"inset ":""}${w.x}px ${w.y}px ${y}px ${b}px ${f}`}; border: 1px solid rgba(255,255,255,0.1);"></div>
                                <span style="font-size: 11px; opacity: 0.8;">${r.type.replace("_"," ")}</span>
                                ${S}
                            </div>
                       `}else r.type==="LAYER_BLUR"||r.type==="BACKGROUND_BLUR"?l=`
                            <div style="display:flex; align-items:center; gap:8px;">
                                <span class="material-symbols-outlined" style="font-size: 16px; opacity: 0.7;">blur_on</span>
                                <span style="font-size: 11px; opacity: 0.8;">${r.type.replace("_"," ")}: ${r.radius}px</span>
                            </div>`:l=`<div>${o.effects.length} effect(s)</div>`}else l='<div style="opacity: 0.5;">No Effects</div>';else t==="grid"&&(l=`<div>${o.layoutGrids.length} grid(s)</div>`);s+=`
                <div class="unified-list-item variable-row" id="style-${i}">
                    <div class="variable-cell" style="font-weight: 500; color: #fff;">${a}</div>
                    <div class="variable-cell" style="color: rgba(255, 255, 255, 0.4); font-size: 11px; letter-spacing: 0.5px;">${t==="paint"?"Color":t==="text"?"Text":t==="effect"?"Effect":t==="grid"?"Layout guide":t}</div>
                    <div class="variable-cell">${l}</div>
                    <div class="variable-cell" style="display: flex; justify-content: center;">
                        <span class="subgroup-stats" title="Used in ${o.usageCount||0} layers">${o.usageCount||0}</span>
                    </div>
                    <div class="variable-cell" style="display: flex; justify-content: flex-end;">
                      <button class="icon-button delete-btn" onclick="deleteStyle('${o.id}', '${o.name.replace(/'/g,"\\'")}', '${t}')" title="Delete style">
                        <span class="material-symbols-outlined">delete</span>
                      </button>
                    </div>
                </div>
            `}),s+="</div>",s}function findVariableMatchingValue(e,t){if(!window.globalVariablesData||!e)return null;const n=(s,o,i)=>{if(i==="paint"||i==="color"){if(typeof s!="object"||typeof o!="object")return!1;if(s.r!==void 0&&o.r!==void 0){const a=Math.abs(s.r-o.r)<.001,l=Math.abs(s.g-o.g)<.001,r=Math.abs(s.b-o.b)<.001,d=s.a!==void 0?s.a:1,p=o.a!==void 0?o.a:1,u=Math.abs(d-p)<.001;return a&&l&&r&&u}return!1}else return(i==="number"||typeof e=="number")&&typeof s=="number"&&typeof o=="number"?Math.abs(s-o)<.01:s===o};for(const s of window.globalVariablesData)for(const o of s.variables){let i=!1;if(t==="paint"&&o.resolvedType==="COLOR"&&(i=!0),t==="number"&&o.resolvedType==="FLOAT"&&(i=!0),t==="string"&&o.resolvedType==="STRING"&&(i=!0),!!i){for(const a of o.valuesByMode)if((a.value&&typeof a.value!="object"||a.value&&a.value.type!=="VARIABLE_ALIAS")&&n(e,a.value,t))return o}}return null}function renderVariableTable(e){let t=`
            <div class="variable-list">
              <div class="unified-list-header variable-header">
                  <div class="variable-cell">Name</div>
                  <div class="variable-cell">Type</div>
                  <div class="variable-cell">Values</div>
                  <div class="variable-cell" style="text-align: center;">Usage</div>
                  <div class="variable-cell"></div>
              </div>
        `;return e.forEach(n=>{const s=n.name.replace(/[^a-zA-Z0-9]/g,"-").toLowerCase(),o=n.name.replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(/"/g,"&quot;");t+=`
            <div class="unified-list-item variable-row" id="var-${s}">
              <div class="variable-cell" style="font-weight: 500; color: #fff; display: flex; align-items: center;">${n.name}</div>
              <div class="variable-cell" style="color: rgba(255, 255, 255, 0.4); font-size: 11px; text-transform: uppercase; letter-spacing: 0.5px;">${n.resolvedType==="FLOAT"?"NUMBER":n.resolvedType}</div>
              <div class="variable-cell">
          `,n.valuesByMode.forEach(i=>{var r;const a=i.value,l=n.valuesByMode.length>1;if(typeof a=="object"&&a.type==="VARIABLE_ALIAS"){const d=findVariableNameById(a.id),p=d?d.replace(/[^a-zA-Z0-9]/g,"-").toLowerCase():null;t+=`
                <div>
                  ${l?`<span style="opacity:0.5; font-size:11px;">${i.modeName}:</span> `:""}<span 
                    style="color: rgba(255,255,255,0.9); cursor: pointer; border-bottom: 1px dashed rgba(255,255,255,0.4);" 
                    onclick="scrollToVariable('${p}')"
                    title="Click to jump to ${d}"
                  >${d||a.id}</span>
                </div>
              `}else if(n.resolvedType==="COLOR"&&typeof a=="object"&&a.r!==void 0){const d=Math.round(a.r*255),p=Math.round(a.g*255),u=Math.round(a.b*255),g=(r=a.a)!=null?r:1;t+=`
                <div style="display: flex; align-items: center; gap: 6px;">
                  <span class="color-preview" style="background-color: rgba(${d},${p},${u},${g}); width: 14px; height: 14px; border-radius: 4px; display: inline-block;"></span>
                  <span>${l?i.modeName+": ":""}rgba(${d},${p},${u},${formatDecimal(g)})</span>
                </div>
              `}else{const d=typeof a=="string"?a:typeof a=="number"?formatDecimal(a):JSON.stringify(a);t+=`<div>${l?i.modeName+": ":""}${d}</div>`}}),t+=`</div>
              
              <!-- Usage badge -->
              <div class="variable-cell" style="display: flex; justify-content: center;">
                 <span class="subgroup-stats" title="Used in ${n.usageCount||0} layers">${n.usageCount||0}</span>
              </div>
              
              <div class="variable-cell" style="display: flex; justify-content: flex-end;">
                <button class="icon-button delete-btn" onclick="deleteVariable('${n.id}', '${o}')" title="Delete variable">
                  <span class="material-symbols-outlined">delete</span>
                </button>
              </div>
            </div>
          `}),t+=`
            </div>
        `,t}function parseComponentName(e){const t={name:e,variants:[]},n=e.match(/([A-Za-z]+)=([^,]+)/g);return n&&(n.forEach(s=>{const[o,i]=s.split("=");o&&i&&t.variants.push({property:o.trim(),value:i.trim()})}),t.name=e.replace(/,?\s*([A-Za-z]+)=([^,]+)/g,"").trim(),t.name=t.name.replace(/^,\s*|,\s*$/g,"").trim()),t}function parseTextStyleName(e){const t={name:e,type:null,state:null,size:null},n=e.match(/Type=([^,]+)/i);n&&n[1]&&(t.type=n[1].trim());const s=e.match(/State=([^,]+)/i);s&&s[1]&&(t.state=s[1].trim());const o=e.match(/Size=([^,]+)/i);return o&&o[1]&&(t.size=o[1].trim()),t}function formatTextElements(e){return!e||e.length===0,""}function formatStyles(e,t,n){if(!e)return"";try{let s=e;typeof e=="string"&&(s=JSON.parse(e));let o=D({},s);if(t&&t.length>0){const l=parseTextStyleName(n||"");t.forEach((r,d)=>{const p=t.length>1?`text_${d+1}_`:"text_",u=[l.state?`State=${l.state}`:null,l.size?`Size=${l.size}`:null].filter(Boolean).join(", ");r.textStyles&&Object.keys(r.textStyles).forEach(g=>{const f=r.textStyles[g];if(f){const w=u?`${p}${g} (${u})`:`${p}${g}`;o[w]=f}})})}const i=JSON.stringify(o,null,2),a=highlightJson(i);return i.length>300?`<div class="style-content-wrapper">
              <div class="style-collapsed">${a.substring(0,300)+"... <span class='expand-indicator'>(Click to expand)</span>"}</div>
              <div class="style-expanded" style="display: none;">${a}</div>
            </div>`:a}catch(s){return console.error("Error in formatStyles:",s),String(e)}}window.copyToClipboard=function(e){const t=document.createElement("textarea");t.value=e,t.setAttribute("readonly",""),t.style.position="absolute",t.style.left="-9999px",document.body.appendChild(t),t.select();try{document.execCommand("copy"),showNotification("success","Copied!","Link copied to clipboard")}catch(n){console.error("Failed to copy text: ",n),showNotification("error","Error","Failed to copy link")}document.body.removeChild(t)};function highlightJson(e){return e=e.replace(/^\s*{\s*/,`{
  `),e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g,function(t){let n="json-number";return/^"/.test(t)?/:$/.test(t)?n="json-key":n="json-string":/true|false/.test(t)?n="json-boolean":/null/.test(t)&&(n="json-null"),'<span class="'+n+'">'+t+"</span>"})}function getVariableValue(e){let t,n;if(e.valuesByMode&&Array.isArray(e.valuesByMode)){const s=e.valuesByMode[0];if(!s)return null;t=s.value,n=e.resolvedType||e.type}else if(e.valuesByMode&&typeof e.valuesByMode=="object"){const s=Object.keys(e.valuesByMode);if(s.length===0)return null;t=e.valuesByMode[s[0]],n=e.resolvedType}else return null;if(typeof t=="object"&&t.type==="VARIABLE_ALIAS"){const s=findVariableById(t.id);return s?getVariableValue(s):null}if(n==="COLOR"&&typeof t=="object"&&t.r!==void 0){const s=Math.round(t.r*255),o=Math.round(t.g*255),i=Math.round(t.b*255),a=t.a!==void 0?t.a:1;return`rgba(${s}, ${o}, ${i}, ${a})`}else{if(n==="FLOAT")return`${t}px`;if(n==="STRING")return String(t)}return t}function findVariableById(e){for(const t of variablesData)for(const n of t.variables)if(n.id===e)return n;return null}function deleteVariable(e,t){if(confirm(`Are you sure you want to delete the variable "${t}"?`)){parent.postMessage({pluginMessage:{type:"delete-variable",variableId:e}},"*");const n=document.querySelector(`[onclick*="${e}"]`);n&&(n.innerHTML='<svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><circle cx="12" cy="12" r="3"><animate attributeName="opacity" dur="1s" values="1;0;1" repeatCount="indefinite"/></circle></svg>',n.disabled=!0,n.style.cursor="not-allowed")}}function deleteStyle(e,t,n){if(confirm(`Are you sure you want to delete the style "${t}"?`)){parent.postMessage({pluginMessage:{type:"delete-style",styleId:e,styleType:n}},"*");const s=document.querySelector(`[onclick*="${e}"]`);s&&(s.innerHTML='<svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><circle cx="12" cy="12" r="3"><animate attributeName="opacity" dur="1s" values="1;0;1" repeatCount="indefinite"/></circle></svg>',s.disabled=!0,s.style.cursor="not-allowed")}}function deleteComponent(e,t,n="component",s=null){let o="",i=n;if(n==="set"?o=`Are you sure you want to delete the entire component set "${t}" and all its variants?

This action cannot be undone.`:n==="variant"?o=`Are you sure you want to delete the variant "${t}"?

This will only delete this specific variant, not the entire component set.

This action cannot be undone.`:o=`Are you sure you want to delete the component "${t}"?

This action cannot be undone.`,confirm(o)){parent.postMessage({pluginMessage:{type:"delete-component",componentId:e,componentType:i,parentId:s}},"*");const a=document.querySelector(`button[onclick*="deleteComponent"][data-component-id="${e}"]`);a&&(a.innerHTML='<svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><circle cx="12" cy="12" r="3"><animate attributeName="opacity" dur="1s" values="1;0;1" repeatCount="indefinite"/></circle></svg>',a.disabled=!0,a.style.cursor="not-allowed")}}function focusOnComponent(e){if(console.log("focusOnComponent called with:",e),!e){console.warn("focusOnComponent: No componentId provided");return}parent.postMessage({pluginMessage:{type:"focus-node",nodeId:e}},"*")}function deleteUnusedVariable(e,t){const n=`Are you sure you want to delete the variable "${t}"?

This action cannot be undone.`;if(confirm(n)){parent.postMessage({pluginMessage:{type:"delete-variable",variableId:e}},"*");const s=document.querySelector(`button[data-variable-id="${e}"]`);s&&(s.innerHTML='<svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><circle cx="12" cy="12" r="3"><animate attributeName="opacity" dur="1s" values="1;0;1" repeatCount="indefinite"/></circle></svg>',s.disabled=!0,s.style.cursor="not-allowed");const o=s.closest(".quality-issue-card").id;if(o){const i=document.getElementById(o);i&&(i.style.transition="opacity 0.3s ease-out, max-height 0.3s ease-out, margin 0.3s ease-out, padding 0.3s ease-out",i.style.opacity="0",i.style.maxHeight="0",i.style.marginBottom="0",i.style.paddingTop="0",i.style.paddingBottom="0",i.style.overflow="hidden",setTimeout(()=>{i.style.display="none",analyzeTokenCoverage("SMART_SCAN",null,!0)},300))}}}function deleteAllUnusedVariants(e,t,n){const s=n.split(","),i=`Are you sure you want to delete all ${s.length} unused variants from "${t}"?

This will remove:
${s.length} unused variants

The component set and used variants will remain.

This action cannot be undone.`;if(confirm(i)){parent.postMessage({pluginMessage:{type:"delete-all-unused-variants",componentId:e,variantIds:s}},"*");const a=document.querySelector(`button[data-component-id="${e}"].delete-btn`);a&&(a.innerHTML='<svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><circle cx="12" cy="12" r="3"><animate attributeName="opacity" dur="1s" values="1;0;1" repeatCount="indefinite"/></circle></svg>',a.disabled=!0,a.style.cursor="not-allowed")}}function ignoreItem(e,t,n){parent.postMessage({pluginMessage:{type:"ignore-item",itemType:e,itemId:t}},"*");const s=document.querySelector(`[data-ignore-id="${t}"]`);s&&(s.style.transition="opacity 0.3s ease-out, max-height 0.3s ease-out, margin 0.3s ease-out, padding 0.3s ease-out",s.style.opacity="0",s.style.maxHeight="0",s.style.marginBottom="0",s.style.overflow="hidden",setTimeout(()=>{s.style.display="none"},300)),setTimeout(()=>{typeof analyzeTokenCoverage=="function"&&analyzeTokenCoverage("SMART_SCAN",null,!0)},400)}function unignoreItem(e,t){parent.postMessage({pluginMessage:{type:"unignore-item",itemType:e,itemId:t}},"*"),setTimeout(()=>{typeof analyzeTokenCoverage=="function"&&analyzeTokenCoverage("SMART_SCAN",null,!0)},200)}function toggleIgnoredPanel(e){const t=document.getElementById(e);t&&(t.style.display=t.style.display==="none"?"block":"none")}function renderComponentVariables(e){const t=Math.random().toString(36).substr(2,9);let n=`
          <div class="component-variables">
            <button class="variables-toggle" onclick="toggleVariablesList('${t}')">
              Show Variables (${e.variables.length})
            </button>
            <div class="variables-list" id="variables-${t}">
        `;return e.variables.forEach(s=>{const o=getVariableDisplayValue(s),i=s.valuesByMode[0];let a=o;if(i&&i.value&&typeof i.value=="object"&&i.value.type==="VARIABLE_ALIAS"){const l=findVariableById(i.value.id);l&&(a=`<span style="color: #c4b5fd; cursor: pointer; text-decoration: underline;" onclick="scrollToVariable('${l.name.replace(/[^a-zA-Z0-9]/g,"-").toLowerCase()}')" title="Click to jump to ${l.name}">${o}</span>`)}n+=`
            <div class="variable-item">
              <span class="variable-name">${s.name}</span>
              <span class="variable-value">${a}</span>
            </div>
          `}),n+=`
            </div>
          </div>
        `,n}function getVariableDisplayValue(e){if(e.valuesByMode.length>1)return e.valuesByMode.map(t=>{const n=t.value;if(typeof n=="object"&&n.type==="VARIABLE_ALIAS"){const s=findVariableById(n.id);return`${t.modeName}: ${s?s.name:n.id}`}return`${t.modeName}: ${formatSingleValue(n,e.resolvedType)}`}).join(", ");{const t=e.valuesByMode[0];if(!t)return"No value";const n=t.value;if(typeof n=="object"&&n.type==="VARIABLE_ALIAS"){const s=findVariableById(n.id);return s?s.name:n.id}return formatSingleValue(n,e.resolvedType)}}function formatSingleValue(e,t){if(t==="COLOR"&&typeof e=="object"&&e.r!==void 0){const n=Math.round(e.r*255),s=Math.round(e.g*255),o=Math.round(e.b*255);return e.a!=null&&e.a<1?`rgba(${n}, ${s}, ${o}, ${e.a.toFixed(2)})`:`rgb(${n}, ${s}, ${o})`}return t==="FLOAT"?`${e}px`:t==="STRING"?`"${e}"`:String(e)}function renderComponents(e){const t=document.getElementById("components-container");let n=0,s=0;if(e&&e.length>0&&e.forEach(i=>{i.type==="COMPONENT_SET"&&(s++,n+=i.children?i.children.length:0),n++}),window.updateComponentsSummary&&window.updateComponentsSummary(n,s),!e||e.length===0){t.innerHTML="",t.appendChild(document.createRange().createContextualFragment(UIHelper.renderEmptyState("No components found in this document.")));return}let o='<div class="component-list">';e.forEach((i,a)=>{if(i.type==="COMPONENT_SET"){const l=parseComponentName(i.name);o+=`
            <div class="component-set">
              <div class="component-set-header" data-index="${a}">
                  <div class="component-set-toggle">
                    <span class="material-symbols-outlined component-set-toggle-icon">expand_more</span>
                  </div>
                  <div class="component-header-content">
                    <div class="component-meta">
                      <span class="component-name">${l.name}</span>
                      ${UIHelper.createBadge("Component Set","component-set")}
                    </div>
                  </div>
                  <div class="component-actions">
                    ${UIHelper.createActionBtn("download","",{"data-component-id":i.id,"data-component-name":i.name,"data-action":"generate",class:"generate-all-variants-button btn-icon-only","data-tooltip":"Generate variants"})}
                    ${UIHelper.createActionBtn("commit","",{"data-component-id":i.id,"data-component-name":i.name,"data-action":"commit",class:"commit-all-variants-button btn-icon-only","data-tooltip":"Commit variants"})}
                    ${UIHelper.createNavIcon(i.id,"Navigate to component")}
                  </div>
              </div>
              <div class="component-set-children" id="children-${a}">
            `,i.children&&i.children.length>0&&i.children.forEach(r=>{const d=parseComponentName(r.name);o+=`
                <div class="child-component">
                  <div class="child-header">
                    ${UIHelper.createNavIcon(r.id,"Navigate to variant")}
                    <div class="component-meta">
                      <span class="component-name">${d.name}</span>
                      ${d.variants.length>0?d.variants.map(p=>UIHelper.createBadge(`${p.property}=${p.value}`,"variant")).join(""):UIHelper.createBadge("Variant","component")}
                    </div>
                  </div>
                </div>
                `}),o+=`
              </div>
              <div class="test-success-message">Test generated successfully!</div>
            </div>
            `}else{const l=parseComponentName(i.name);o+=`
            <div class="component-regular">
              <div class="component-header-content">
                ${UIHelper.createNavIcon(i.id,"Navigate to component","target")}
                <div class="component-meta">
                  <span class="component-name">${l.name}</span>
                  ${l.variants.length>0?l.variants.map(r=>UIHelper.createBadge(`${r.property}=${r.value}`,"variant")).join(""):UIHelper.createBadge("Component","component")}
                </div>
                <div class="component-actions">
                  ${UIHelper.createActionBtn("download","Generate",{"data-component-id":i.id,"data-component-name":i.name,"data-action":"generate",class:"generate-all-variants-button"})}
                  ${UIHelper.createActionBtn("commit","Commit",{"data-component-id":i.id,"data-component-name":i.name,"data-action":"commit",class:"commit-all-variants-button"})}
                </div>
              </div>
              <div class="test-success-message">Test generated successfully!</div>
            </div>
            `}}),o+="</div>",t.innerHTML=SecurityUtils.sanitizeHTML(o),t.addEventListener("click",function(i){const a=i.target.closest(".nav-icon");if(a){const d=a.getAttribute("data-component-id");d&&window.selectComponent(d);return}const l=i.target.closest(".generate-all-variants-button, .commit-all-variants-button");if(l){const d=l.getAttribute("data-component-id"),p=l.getAttribute("data-component-name"),u=l.getAttribute("data-action");d&&p&&generateTest(d,p,l,!0,u==="commit");return}const r=i.target.closest(".component-set-header");if(r){const d=r.getAttribute("data-index");d!==null&&window.toggleComponentSet(d)}}),window.toggleComponentSet=function(i){const a=document.querySelector(`.component-set-header[data-index="${i}"]`),l=document.getElementById(`children-${i}`);if(!a||!l){console.warn(`[UI] toggleComponentSet: Elements not found for index ${i}`);return}l.classList.contains("expanded")?(l.classList.remove("expanded"),a.classList.remove("expanded")):(l.classList.add("expanded"),a.classList.add("expanded"))},window.expandAllComponents=function(){document.querySelectorAll(".component-set-header:not(.expanded)").forEach(a=>{const l=a.getAttribute("data-index");l!==null&&window.toggleComponentSet(l)})},window.collapseAllComponents=function(){document.querySelectorAll(".component-set-header.expanded").forEach(a=>{const l=a.getAttribute("data-index");l!==null&&window.toggleComponentSet(l)})},window.toggleStyles=function(i){const a=!i.classList.contains("expanded");i.classList.toggle("expanded");const l=i.querySelector(".style-content-wrapper");if(l){const r=l.querySelector(".style-collapsed"),d=l.querySelector(".style-expanded");i.classList.contains("expanded")?(r&&(r.style.display="none"),d&&(d.style.display="block")):(r&&(r.style.display="block"),d&&(d.style.display="none"))}if(a&&i.dataset.componentId){const r=i.dataset.componentId;if(i.innerHTML.includes("{}")||i.innerHTML.includes("{ }")){const p=document.createElement("div");p.className="style-loading",p.innerHTML='<span class="loading-spinner">\u23F3</span> Loading component styles...';const u=i.innerHTML;i.innerHTML=p.outerHTML,parent.postMessage({pluginMessage:{type:"load-component-styles",componentId:r}},"*"),i.dataset.originalContent=u}}i.classList.contains("expanded")&&setTimeout(()=>{i.scrollIntoView({behavior:"smooth",block:"nearest"})},100)}}function downloadCSS(e,t="css"){let n="text/css",s="css";t==="scss"?(n="text/scss",s="scss"):t==="tailwind-v4"&&(n="text/css",s="css");const o=new Blob([e],{type:n}),i=URL.createObjectURL(o),a=document.createElement("a");a.href=i,a.download=`figma-variables.${s}`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(i)}const exportCssButton=document.getElementById("export-css-button");exportCssButton&&exportCssButton.addEventListener("click",()=>{var e;try{const t=((e=window.gitlabSettings)==null?void 0:e.exportFormat)||"css";if(!["css","scss","tailwind-v4"].includes(t.toLowerCase())){showError("Export Failed","Invalid export format. Please select CSS, SCSS, or Tailwind v4.");return}const n=t==="tailwind-v4"?"Tailwind v4":t.toUpperCase();showButtonLoading(exportCssButton,`Generating ${n}...`),showContentLoading("variables-container","Processing variables and generating stylesheet..."),parent.postMessage({pluginMessage:{type:"export-css",shouldDownload:!0,exportFormat:t}},"*"),typeof userGuideState!="undefined"&&userGuideState&&(userGuideState.lastExportVars=!0,typeof saveUserGuideState=="function"&&saveUserGuideState()),typeof refreshUserGuide=="function"&&refreshUserGuide(),setTimeout(()=>{exportCssButton.disabled&&(exportCssButton.disabled=!1,updateExportButtonText())},5e3)}catch(t){console.error("Error initiating CSS export:",t),showError("Export Failed","An unexpected error occurred while exporting. Please try again."),exportCssButton.disabled=!1,updateExportButtonText()}});function updateExportButtonText(){const e=document.getElementById("export-css-button");e.innerHTML='<span class="material-symbols-outlined">download</span><span class="toolbar-btn-text">Download</span>'}function generateTest(e,t,n,s=!1,o=!1){var i,a,l,r,d,p,u,g;try{if(!e||!t||!n)throw new Error("Missing required parameters for test generation");if(!n.parentElement)throw new Error("Button element is not properly attached to DOM");if(typeof t!="string"||t.trim().length===0)throw new Error("Invalid component name provided");const f=o?"Committing test...":"Generating test...";n.dataset.originalText||(n.dataset.originalText=n.textContent),showButtonLoading(n,f);const w=n.parentElement.nextElementSibling;w&&w.classList.contains("test-success-message")&&(w.style.display="none");const y=setTimeout(()=>{console.warn("Test generation timed out"),n.classList.remove("loading"),n.textContent=n.dataset.originalText||"Generate Test",n.disabled=!1,showError("Generation Timeout","Test generation took too long. Please try again.")},6e4);if(n.dataset.timeoutId=y,o){try{localStorage.setItem("bridgy_last_export_test","true")}catch(b){console.warn("localStorage access failed:",b)}typeof refreshUserGuide=="function"&&refreshUserGuide(),parent.postMessage({pluginMessage:{type:"commit-component-test",componentId:e,componentName:t,settings:window.gitlabSettings,provider:((i=window.gitlabSettings)==null?void 0:i.provider)||"gitlab",token:((a=window.gitlabSettings)==null?void 0:a.token)||((l=window.gitlabSettings)==null?void 0:l.gitlabToken),gitlabToken:((r=window.gitlabSettings)==null?void 0:r.token)||((d=window.gitlabSettings)==null?void 0:d.gitlabToken),projectId:(p=window.gitlabSettings)==null?void 0:p.projectId,baseUrl:(u=window.gitlabSettings)==null?void 0:u.baseUrl,commitMessage:`test: add component test for ${t}`,type:"generate-test",componentId:e,componentName:t,generateAllVariants:s,forCommit:o,provider:((g=window.gitlabSettings)==null?void 0:g.provider)||"gitlab"}},"*")}else parent.postMessage({pluginMessage:{type:"generate-test",componentId:e,componentName:t,generateAllVariants:s,forCommit:o}},"*")}catch(f){console.error("Error in generateTest:",f)}}function downloadComponentsZip(e,t){if(!e||e.length===0){showError("Export Failed","No components available to export");return}const n=new JSZip;e.forEach(s=>{const o=n.folder(s.kebabName),i=s.kebabName;if(t==="angular")o.file(`${i}.component.html`,s.angularHtml),o.file(`${i}.component.ts`,s.angularTs),o.file(`${i}.component.scss`,`// Styles for ${s.name}
.${i} {
  // Add your styles here
}`);else if(t==="typescript")o.file(`${i}.component.ts`,s.angularTs);else if(t==="javascript"){const a=s.angularTs.replace(/: [A-Za-z<>[\]]+/g,"").replace(/interface [^}]+}/g,"");o.file(`${i}.component.js`,a)}}),n.generateAsync({type:"blob"}).then(s=>{try{const o=URL.createObjectURL(s),i=document.createElement("a");i.href=o,i.download=`figma-components-${t}.zip`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(o),showSuccess("Download Complete",`Components exported successfully as ${t.toUpperCase()} files.`)}catch(o){console.error("Error downloading ZIP file:",o),showError("Download Failed","Failed to download the exported files. Please try again.")}}).catch(s=>{console.error("Error generating ZIP file:",s),showError("Export Failed","Failed to generate the export files. Please try again.")})}function downloadTest(e,t){const n=e.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,""),s=new Blob([t],{type:"text/javascript"}),o=URL.createObjectURL(s),i=document.createElement("a");i.href=o,i.download=`${n}.component.spec.ts`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(o)}const variableSearchElement=document.getElementById("variable-search");variableSearchElement&&variableSearchElement.addEventListener("input",e=>{const t=e.target.value.toLowerCase(),n=document.getElementById("clear-variable-search");n&&(n.style.display=t?"flex":"none");const s=variablesData.map(i=>O(D({},i),{variables:i.variables.filter(a=>a.name.toLowerCase().includes(t)||a.resolvedType&&a.resolvedType.toLowerCase().includes(t)?!0:a.valuesByMode&&Array.isArray(a.valuesByMode)?a.valuesByMode.some(l=>{const r=l.value;if(l.modeName&&l.modeName.toLowerCase().includes(t))return!0;if(typeof r=="object"&&r&&r.type==="VARIABLE_ALIAS"){const d=findVariableById(r.id);if(d&&d.name.toLowerCase().includes(t))return!0}if(a.resolvedType==="COLOR"&&typeof r=="object"&&r&&r.r!==void 0){const d=Math.round(r.r*255),p=Math.round(r.g*255),u=Math.round(r.b*255),g=r.a!==void 0?r.a:1;if(`rgba(${d},${p},${u},${g})`.includes(t)||`rgb(${d},${p},${u})`.includes(t)||`#${((1<<24)+(d<<16)+(p<<8)+u).toString(16).slice(1)}`.toLowerCase().includes(t)||t===d.toString()||t===p.toString()||t===u.toString())return!0}return!!(typeof r=="number"&&(r.toString().includes(t)||`${r}px`.includes(t)||t.includes("px")&&t.replace("px","")===r.toString())||typeof r=="string"&&r.toLowerCase().includes(t))}):!1)})).filter(i=>i.variables.length>0);let o=null;stylesData&&(o={paintStyles:stylesData.paintStyles?stylesData.paintStyles.filter(i=>i.name.toLowerCase().includes(t)):[],textStyles:stylesData.textStyles?stylesData.textStyles.filter(i=>i.name.toLowerCase().includes(t)):[],effectStyles:stylesData.effectStyles?stylesData.effectStyles.filter(i=>i.name.toLowerCase().includes(t)):[],gridStyles:stylesData.gridStyles?stylesData.gridStyles.filter(i=>i.name.toLowerCase().includes(t)):[]}),renderVariables(s,o),t&&typeof expandAllVariables=="function"&&expandAllVariables()}),window.clearSearch=function(e){const t=document.getElementById(e);t&&(t.value="",t.dispatchEvent(new Event("input")),t.focus())};const componentSearchElement=document.getElementById("component-search");componentSearchElement&&componentSearchElement.addEventListener("input",e=>{const t=e.target.value.toLowerCase(),n=document.getElementById("clear-component-search");n&&(n.style.display=t?"flex":"none");const s=componentsData.filter(o=>!!(o.name.toLowerCase().includes(t)||o.type&&o.type.toLowerCase().includes(t)||o.pageName&&o.pageName.toLowerCase().includes(t)||o.children&&o.children.some(i=>i.name.toLowerCase().includes(t)||i.type&&i.type.toLowerCase().includes(t))));renderComponents(s)});function openSettingsModal(){document.getElementById("settings-modal").style.display="block",document.body.classList.add("modal-open"),loadConfigurationTab(),setTimeout(()=>{onProviderChange()},200)}function closeSettingsModal(){document.getElementById("settings-modal").style.display="none",document.body.classList.remove("modal-open")}function openImportModal(){document.getElementById("import-modal").style.display="block",document.body.classList.add("modal-open"),initializeVariableImportTab()}function closeImportModal(){document.getElementById("import-modal").style.display="none",document.body.classList.remove("modal-open")}function openUnitsModal(){document.getElementById("units-modal").style.display="block",document.body.classList.add("modal-open"),loadUnitsSettings()}function saveUnitsAndCloseModal(){window.saveUnitsSettings(),closeUnitsModal()}function closeUnitsModal(){document.getElementById("units-modal").style.display="none",document.body.classList.remove("modal-open")}function switchToQualityTab(){document.querySelectorAll(".tab").forEach(n=>n.classList.remove("active")),document.querySelectorAll(".tab-content").forEach(n=>n.classList.remove("active"));const e=document.querySelector('.tab[data-tab="quality"]'),t=document.getElementById("quality-content");e&&t&&(e.classList.add("active"),t.classList.add("active"),document.getElementById("token-coverage-section")?handleImproveDesignSystem():(window.pendingImproveDesignSystem=!0,setTimeout(()=>{console.log("Auto-triggering Smart Scan from warning button..."),typeof analyzeTokenCoverage=="function"?analyzeTokenCoverage("SMART_SCAN"):console.warn("analyzeTokenCoverage function not found")},100)))}function startQualityAnalysis(e,t,n=!1,s=!1){console.log("[DEBUG] startQualityAnalysis ENTER",{scopeOverride:e,hasNotification:!!t,isBackground:n,forceRefresh:s});try{const o=e||"PAGE";if(window.lastSmartScanTime&&Date.now()-window.lastSmartScanTime<5e3&&o==="PAGE"&&!e){console.warn("[DEBUG] Blocked redundant PAGE scan because SMART_SCAN completed recently."),updatePluginLoadingProgress("Ready",100),hidePluginLoadingOverlay();return}if(window._qualityAnalysisInFlight&&!n){console.warn("[DEBUG] Blocked overlapping analysis request \u2014 one is already in flight.");return}if(o==="SMART_SCAN"&&(window.lastSmartScanTime=Date.now()),window.isBackgroundAnalysis=n,t&&(window.currentAnalysisNotification=t),window.QualityAnimationController&&typeof window.QualityAnimationController.reset=="function"&&(n||(console.log("[DEBUG] Resetting QualityAnimationController"),window.QualityAnimationController.reset())),!n){console.log("[DEBUG] Setting up unified quality loader");const r=document.getElementById("token-coverage-results");r&&(r.innerHTML="");const d=document.getElementById("component-hygiene-results-placeholder");d&&(d.innerHTML="");const p=document.getElementById("variable-hygiene-results-placeholder");p&&(p.innerHTML="");const u=document.getElementById("tailwind-readiness-results-placeholder");u&&(u.innerHTML="");const g=document.getElementById("quality-dashboard-container");g&&!document.getElementById("quality-unified-loader")&&g.insertAdjacentHTML("afterbegin",UIHelper.createQualityLoader())}const i=MultiPageSelector?MultiPageSelector.getSelectedIds():[],a=i&&i.length>0?i:null;let l=e||"PAGE";a&&!e&&(l="ALL"),console.log("[DEBUG] Sending analyze-quality-report message",{finalScope:l,pageIds:a,format:window.gitlabSettings?window.gitlabSettings.exportFormat:"css"}),window._qualityAnalysisInFlight=!0,parent.postMessage({pluginMessage:{type:"analyze-quality-report",scope:l,pageIds:a,exportFormat:window.gitlabSettings?window.gitlabSettings.exportFormat:"css",forceRefresh:s}},"*"),console.log("[DEBUG] Message posted successfully")}catch(o){console.error("[DEBUG] Error in startQualityAnalysis:",o),window._qualityAnalysisInFlight=!1}}const analyzeTokenCoverage=startQualityAnalysis;function analyzeStats(){console.log("analyzeStats called");const e=MultiPageSelector?MultiPageSelector.getSelectedIds():[],t=e&&e.length>0?e:null;parent.postMessage({pluginMessage:{type:"get-component-usage",pageIds:t}},"*")}function getScoreColor(e){return e==null?"#ffffff":e<40?"#ef4444":e<75?"#fbbf24":"#22c55e"}function updateAnalysisScope(e){analysisScope!==e&&(analysisScope=e,analyzeTokenCoverage(null,null,!1,!0))}window.activeStatsFilter=null,window.toggleStatsSort=function(e){statsSortState.column===e?statsSortState.direction=statsSortState.direction==="asc"?"desc":"asc":(statsSortState.column=e,e==="name"?statsSortState.direction="asc":statsSortState.direction="desc"),applyStatsView()},window.toggleUnusedFilter=function(){componentStatsData&&(window.activeStatsFilter==="unused"?window.activeStatsFilter=null:window.activeStatsFilter="unused",applyStatsView())};function applyStatsView(){const e=document.getElementById("stats-search"),t=e?e.value:"";if(t&&window.filterStats)window.filterStats(t);else if(window.activeStatsFilter==="unused"){const n=componentStatsData.filter(s=>s.count===0);renderStats(componentStatsData,n)}else renderStats(componentStatsData)}window.filterByUnused=window.toggleUnusedFilter;function renderStats(e,t=null){const n=document.getElementById("stats-container"),s=document.getElementById("stats-summary-container");if(!n)return;const o=e?e.length:0,i=e?e.reduce((g,f)=>g+f.count,0):0,a=e?e.filter(g=>g.count===0).length:0;let l=0,r=0,d=0;if(t&&(l=t.length,r=t.reduce((g,f)=>g+f.count,0),d=t.filter(g=>g.count===0).length),s&&(s.innerHTML=`
      <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px;">
        <div onclick="window.filterStats(null)" style="background: rgba(255,255,255,0.03); padding: 12px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.05); cursor: pointer; text-align: center; transition: all 0.2s ease;" onmouseover="this.style.background='rgba(255,255,255,0.06)'" onmouseout="this.style.background='rgba(255,255,255,0.03)'">
          <div style="font-size: 24px; font-weight: 600; color: white; margin-bottom: 4px;">
              ${t?`${l} <span style="font-size: 14px; color: #a855f7; margin-left: 2px;">/ ${o}</span>`:o}
          </div>
          <div style="font-size: 11px; color: rgba(255,255,255,0.5); text-transform: uppercase; letter-spacing: 0.5px;">Components</div>
        </div>
        <div onclick="window.filterStats(null)" style="background: rgba(255,255,255,0.03); padding: 12px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.05); cursor: pointer; text-align: center; transition: all 0.2s ease;" onmouseover="this.style.background='rgba(255,255,255,0.06)'" onmouseout="this.style.background='rgba(255,255,255,0.03)'">
          <div style="font-size: 24px; font-weight: 600; color: white; margin-bottom: 4px;">
              ${t?`${r} <span style="font-size: 14px; color: #a855f7; margin-left: 2px;">/ ${i}</span>`:i}
          </div>
          <div style="font-size: 11px; color: rgba(255,255,255,0.5); text-transform: uppercase; letter-spacing: 0.5px;">Local Instances</div>
        </div>
        <div onclick="window.toggleUnusedFilter()" style="background: ${window.activeStatsFilter==="unused"?"rgba(168, 85, 247, 0.2)":"rgba(255,255,255,0.03)"}; padding: 12px; border-radius: 8px; border: ${window.activeStatsFilter==="unused"?"1px solid rgba(168, 85, 247, 0.4)":"1px solid rgba(255,255,255,0.05)"}; cursor: pointer; text-align: center; transition: all 0.2s ease;" onmouseover="this.style.background='rgba(255,255,255,0.06)'" onmouseout="this.style.background='${window.activeStatsFilter==="unused"?"rgba(168, 85, 247, 0.2)":"rgba(255,255,255,0.03)"}'">
          <div style="font-size: 24px; font-weight: 600; color: white; margin-bottom: 4px;">
              ${t&&window.activeStatsFilter==="unused"?`${d} <span style="font-size: 14px; color: #a855f7; margin-left: 2px;">/ ${a}</span>`:a}
          </div>
          <div style="font-size: 11px; color: rgba(255,255,255,0.5); text-transform: uppercase; letter-spacing: 0.5px;">Unused Components</div>
        </div>
      </div>
    `),!e||e.length===0){n.innerHTML=`
      <div class="empty-state">
        <div class="empty-icon">\u{1F4CA}</div>
        <div class="empty-text">No local components found in this file</div>
        <div class="empty-subtext">Components defined in this file will appear here</div>
      </div>
    `;return}let p=`
    <!-- Stats Table -->
    <div class="stats-table">
        <!-- Table Header -->
        <div style="display: grid; grid-template-columns: 1fr 60px 100px 40px; gap: 12px; padding: 0 12px 8px 12px; border-bottom: 1px solid rgba(255,255,255,0.1); margin-bottom: 8px; align-items: center;">
            <div style="font-size: 11px; font-weight: 600; color: rgba(255,255,255,0.5); text-transform: uppercase; cursor: pointer; display: flex; align-items: center; gap: 4px; white-space: nowrap;" onclick="toggleStatsSort('name')">
              Component Name ${statsSortState.column==="name"?statsSortState.direction==="asc"?'<span style="display:inline-block">\u2191</span>':'<span style="display:inline-block">\u2193</span>':""}
            </div>
            <div style="font-size: 11px; font-weight: 600; color: rgba(255,255,255,0.5); text-transform: uppercase; text-align: right; cursor: pointer; display: flex; align-items: center; justify-content: flex-end; gap: 4px; white-space: nowrap;" onclick="toggleStatsSort('variantCount')">
              Variants ${statsSortState.column==="variantCount"?statsSortState.direction==="asc"?'<span style="display:inline-block">\u2191</span>':'<span style="display:inline-block">\u2193</span>':""}
            </div>
            <div style="font-size: 11px; font-weight: 600; color: rgba(255,255,255,0.5); text-transform: uppercase; text-align: right; cursor: pointer; display: flex; align-items: center; justify-content: flex-end; gap: 4px; white-space: nowrap;" onclick="toggleStatsSort('count')">
              Instances ${statsSortState.column==="count"?statsSortState.direction==="asc"?'<span style="display:inline-block">\u2191</span>':'<span style="display:inline-block">\u2193</span>':""}
            </div>
            <div></div> <!-- Actions spacer -->
        </div>

        <div class="component-list" style="display: flex; flex-direction: column; gap: 4px;">
  `,u=t?[...t]:[...e];u.sort((g,f)=>{let w=g[statsSortState.column],y=f[statsSortState.column];return typeof w=="string"&&(w=w.toLowerCase()),typeof y=="string"&&(y=y.toLowerCase()),w<y?statsSortState.direction==="asc"?-1:1:w>y?statsSortState.direction==="asc"?1:-1:0}),u.forEach(g=>{const f=g.variantCount>1?g.variantCount:"-";p+=`
      <div class="unified-list-item variable-row component-item" data-id="${g.id}" style="display: grid; grid-template-columns: 1fr 60px 100px 40px; gap: 12px; align-items: center; padding: 0 12px; height: 28px; background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.05); border-radius: 4px; margin-bottom: 4px;">
        
        <!-- Name Column -->
        <div style="display: flex; align-items: center; gap: 8px; min-width: 0;">
            <div class="component-icon-wrapper" style="display: flex; align-items: center; justify-content: center; color:  #a855f7; flex-shrink: 0;">
                     <svg width="12" height="12" viewBox="0 0 12 12" fill="none"  style="rotate: 45deg"><path d="M1 1h4v4H1zM7 1h4v4H7zM1 7h4v4H1zM7 7h4v4H7z" stroke="currentColor" stroke-width="1"/></svg>

            </div>
            <span class="component-name text-truncate" title="${g.name}" style="font-size: 13px; font-weight: 500; color: rgba(255,255,255,0.9);">
                ${g.name}
            </span>
        </div>

        <!-- Variants Column -->
        <div style="text-align: right; font-size: 12px; color: rgba(255,255,255,0.6);">
            ${f}
        </div>

        <!-- Instances Column -->
        <div style="text-align: right; font-size: 12px; font-weight: 500; color: rgba(255,255,255,0.9);">
            ${g.count.toLocaleString()}
        </div>
      </div>
    `}),p+="</div></div>",n.innerHTML=p}function renderTailwindReadinessSection(e){const t="tailwind-readiness-section",n=window.qualitySectionStates&&window.qualitySectionStates[t]===!0,s=e&&e.readinessScore||0,o=e&&e.totalInvalid||0,i=e&&e.totalVariables||0,a=o>0;let l=`
    <!-- Section Divider -->
    <div style="height: 1px; background: rgba(255, 255, 255, 0.08); margin: 16px 0;"></div>
    
    <!-- Tailwind Readiness Collapsible Section -->
    <div id="${t}" class="quality-section-collapsible" style="margin-bottom: 16px;">
      <div class="section-header-collapsible" onclick="toggleQualitySection('${t}')" style="cursor: pointer; padding: 8px 0; display: flex; align-items: center; gap: 12px; user-select: none;">
        <span class="material-symbols-outlined section-chevron" style="font-size: 20px; color: rgba(255,255,255,0.4); transition: transform 0.3s ease; ${n?"":"transform: rotate(-90deg);"}">expand_more</span>
        <!-- Stats -->
        ${renderCategoryStats(s,o,i,"Tailwind Incompatible Variables")}
      </div>
      <div class="section-content-collapsible" style="display: ${n?"block":"none"};">
        <p style="color: rgba(255, 255, 255, 0.6); font-size: 12px; margin: 0 0 16px 32px;">
          Variables that need Tailwind v4 compatible namespaces. Fix them individually or by group.
        </p>
  `;if(a){const r=e.invalidGroups||[],d=(e.groups||[]).filter(g=>r.includes(g.name)),p=d.filter(g=>g.isStandalone),u=d.filter(g=>!g.isStandalone);if(p.length>0){const g="tailwind-standalone-group",f=window.justFixedTailwind===!0;l+=`
          <div id="${g}" class="variable-collection quality-collection" style="margin-bottom: 12px;">
            <div class="collection-header header ${f?"":"collapsed"}" onclick="toggleCollection('${g}')">
              <span class="material-symbols-outlined collection-toggle-icon">expand_more</span>
              <div class="collection-info">
                <div class="collection-name-title" style="display: flex; align-items: center; gap: 8px; font-size: 13px;">
                  Standalone Variables
                </div>
              </div>
              <span class="subgroup-stats">${p.length}</span>
            </div>
            <div id="${g}-content" class="collection-content ${f?"":"collapsed"}">
              <div style="padding: 12px;">
        `,p.forEach((w,y)=>{const b=`tailwind-standalone-${y}`,S=SecurityUtils.escapeHTML(w.name);l+=`
            <div id="${b}-card" class="quality-issue-card" style="margin-bottom: 8px; display: block; padding: 10px; background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.05); border-radius: 6px;">
              <div style="display: flex; justify-content: space-between; align-items: center; gap: 12px;">
                <div style="flex: 1; min-width: 0;">
                  <div style="font-weight: 500; color: rgba(255, 255, 255, 0.9); font-size: 13px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                    ${S}
                  </div>
       
                </div>
                <div style="display: flex; gap: 6px; align-items: center;">
                   <select 
                    id="${b}-namespace-select" 
                    class="token-fix-select" 
                    style="padding: 6px 8px; background: rgba(0, 0, 0, 0.3); border: 1px solid rgba(139, 92, 246, 0.3); border-radius: 4px; color: rgba(255, 255, 255, 0.9); font-size: 12px; cursor: pointer;"
                    onchange="updateTailwindActionButtonsState('${b}', true)"
                  >
                    <option value="">Select namespace...</option>
                    ${getTailwindNamespaceOptions(w.name)}
                  </select>
                  <button 
                    id="${b}-add-prefix-btn" 
                    class="token-fix-apply-btn" 
                    onclick="applyTailwindNamespace('${SecurityUtils.escapeHTML(w.name)}', '${b}', 1, 'add-prefix', '${w.variableId}');refreshData()"
                      style="flex: 1; padding: 6px 12px; background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); border: none; border-radius: 4px; color: white; font-size: 11px; font-weight: 600; cursor: pointer; white-space: nowrap; opacity: 0.5; pointer-events: none;"
                    disabled
                    title="Add namespace prefix"
                  >
                    <span class="material-symbols-outlined">add</span>
                    Add prefix
              </button>
            </div>
          </div>
        </div>
      `}),l+=`
          </div>
        </div>
      </div>
    `}if(u.length>0){const g="tailwind-invalid-groups",f=window.justFixedTailwind===!0;l+=`
      <div id="${g}" class="variable-collection quality-collection" style="margin-bottom: 12px;">
        <div class="collection-header header ${f?"":"collapsed"}" onclick="toggleCollection('${g}')">
          <span class="material-symbols-outlined collection-toggle-icon">expand_more</span>
          <div class="collection-info">
            <div class="collection-name-title" style="display: flex; align-items: center; gap: 8px; font-size: 13px;">
              Invalid Groups
            </div>
          </div>
          <span class="subgroup-stats">${u.length}</span>
        </div>
        <div id="${g}-content" class="collection-content ${f?"":"collapsed"}">
          <div style="padding: 12px;">
    `,u.forEach((w,y)=>{const b=`tailwind-group-${y}`,S=SecurityUtils.escapeHTML(w.name),x=`${w.variableCount} variable${w.variableCount!==1?"s":""}`;l+=`
        <div id="${b}-card" class="quality-issue-card" style="margin-bottom: 8px; display: block; padding: 12px; background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.05); border-radius: 8px;">
          <div style="display: flex; justify-content: space-between; align-items: flex-start; gap: 12px;">
            <div style="flex: 1;">
              <div style="font-weight: 600; color: rgba(255, 255, 255, 0.9); font-size: 13px; margin-bottom: 4px;">
                ${S}
              </div>
              <div style="font-size: 11px; color: rgba(255, 255, 255, 0.5);">
                ${x}
              </div>
            </div>
            <div style="display: flex; flex-direction: row; gap: 8px; align-items: center; min-width: 300px;">
              <select 
                id="${b}-namespace-select" 
                class="token-fix-select" 
                style="padding: 6px 8px; background: rgba(0, 0, 0, 0.3); border: 1px solid rgba(139, 92, 246, 0.3); border-radius: 4px; color: rgba(255, 255, 255, 0.9); font-size: 12px; cursor: pointer;"
                onchange="updateTailwindActionButtonsState('${b}', false)"
              >
                <option value="">Select namespace...</option>
                ${getTailwindNamespaceOptions(w.name)}
              </select>
              <div style="display: flex; gap: 8px;">
                <button 
                  id="${b}-replace-btn" 
                  class="secondary-action-btn" 
                  onclick="applyTailwindNamespace('${SecurityUtils.escapeHTML(w.name)}', '${b}', ${w.variableCount}, 'replace', null)"
                  disabled
                  title="Replace existing group with namespace (e.g., group/var \u2192 namespace/var)"
                >
                  <span class="material-symbols-outlined" style="font-size: 14px; vertical-align: middle;">find_replace</span>
                  Replace
                </button>
                <button 
                  id="${b}-add-prefix-btn" 
                  class="token-fix-apply-btn" 
                  onclick="applyTailwindNamespace('${SecurityUtils.escapeHTML(w.name)}', '${b}', ${w.variableCount}, 'add-prefix', null)"
                  style="flex: 1; padding: 6px 12px; background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); border: none; border-radius: 4px; color: white; font-size: 11px; font-weight: 600; cursor: pointer; white-space: nowrap; opacity: 0.5; pointer-events: none;"
                  disabled
                  title="Add namespace as additional prefix (e.g., group/var \u2192 namespace/group/var)"
                >
                  <span class="material-symbols-outlined" style="font-size: 14px; vertical-align: middle;">add</span>
                  Add Prefix
                </button>
                
              </div>
            </div>
          </div>
        </div>
      `}),l+=`
          </div>
        </div>
      </div>
    `}}return l+=`
      </div>
    </div>
  `,l}function displayComponentHygieneSection(e){if(!e||!document.getElementById("quality-dashboard-container"))return;const n="component-hygiene-section",s="unused-components-section",o=window.qualitySectionStates&&window.qualitySectionStates[s]===!0;window.qualityAnalysisState&&(window.qualityAnalysisState.subScores.componentHygiene=(e.subScores?e.subScores.componentHygiene:0)||0,window.qualityAnalysisState.componentIssues=e.unusedComponentCount||e.unusedCount||0,updateQualityScoreUI());let i=`
    <!-- Section Divider -->
    <div style="height: 1px; background: rgba(255, 255, 255, 0.08); margin: 16px 0;"></div>
    
    <!-- Unused Components Collapsible Section -->
    <div id="${s}" class="quality-section-collapsible" style="margin-bottom: 16px;">
      <div class="section-header-collapsible" onclick="toggleQualitySection('${s}')" style="cursor: pointer; padding: 8px 0; display: flex; align-items: center; gap: 12px; user-select: none;">
        <span class="material-symbols-outlined section-chevron" style="font-size: 20px; color: rgba(255,255,255,0.4); transition: transform 0.3s ease; ${o?"":"transform: rotate(-90deg);"}">expand_more</span>
        <!-- Stats -->
        ${renderCategoryStats((e.subScores?e.subScores.componentHygiene:0)||0,e.unusedComponentCount||e.unusedCount||0,e.totalComponents||0,"Unused Components")}
        ${e.ignoredCount>0?`
          <span onclick="event.stopPropagation(); toggleIgnoredPanel('component-ignored-panel')"
                style="font-size: 10px; color: rgba(255,255,255,0.4); background: rgba(255,255,255,0.06); padding: 2px 8px; border-radius: 10px; cursor: pointer; margin-left: 4px;"
                title="Click to manage ignored items">
            ${e.ignoredCount} ignored
          </span>
        `:""}
      </div>
      <div class="section-content-collapsible" style="display: ${o?"block":"none"};">
        <p style="color: rgba(255, 255, 255, 0.6); font-size: 12px; margin: 0 0 16px 32px;">
          ${e.unusedComponentCount||e.unusedCount||0} unused component${(e.unusedComponentCount||e.unusedCount)!==1?"s":""} found out of ${e.totalComponents||0} total. Remove unused components to improve your design system hygiene.
        </p>
        <div style="padding-left: 0;">
  `;const a=e.unusedComponents.filter(d=>d.type==="COMPONENT_SET"&&d.unusedVariants&&d.unusedVariants.length>0),l=e.unusedComponents.filter(d=>!(d.type==="COMPONENT_SET"&&d.unusedVariants&&d.unusedVariants.length>0));if(a.forEach((d,p)=>{const u=`component-set-group-${p}`,g=SecurityUtils.escapeHTML(d.name),f=d.unusedVariants.map(w=>w.id).join(",");i+=`
      <div class="variable-collection" style="margin-bottom: 8px;">
        <div class="collection-header collapsed"
             onclick="this.classList.toggle('collapsed'); const content = document.getElementById('${u}-content'); content.style.display = content.style.display === 'none' ? 'block' : 'none'; const icon = this.querySelector('.collection-toggle-icon'); icon.style.transform = this.classList.contains('collapsed') ? 'rotate(-90deg)' : 'rotate(0deg)';"
             style="display: flex; align-items: center; gap: 10px; cursor: pointer; padding: 4px 10px; background: rgba(255,255,255,0.03); border-radius: 6px; border: 1px solid rgba(255,255,255,0.05);">
          <span class="material-symbols-outlined collection-toggle-icon" style="font-size: 16px; color: rgba(255,255,255,0.4); transition: transform 0.2s; transform: rotate(-90deg);">expand_more</span>
          <span style="font-size: 11px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; color: rgba(255,255,255,0.5); flex: 1;">${g}</span>
          <span style="font-size: 10px; color: rgba(255,255,255,0.3); padding: 1px 6px;">${d.unusedVariantCount}/${d.totalVariants}</span>
          <button
            class="icon-button ignore-btn"
            onclick="event.stopPropagation(); ignoreItem('component-set', '${d.id}', '${g}')"
            title="Ignore entire component set"
            style="flex-shrink: 0; width: 18px; height: 18px; min-width: 18px;"
          >
            <span class="material-symbols-outlined" style="font-size: 12px;">visibility_off</span>
          </button>
          <button
            class="icon-button delete-btn"
            data-component-id="${d.id}"
            onclick="event.stopPropagation(); deleteAllUnusedVariants('${d.id}', '${g}', '${f}')"
            title="Delete all ${d.unusedVariantCount} unused variants"
            style="flex-shrink: 0; width: 18px; height: 18px; min-width: 18px;"
          >
            <span class="material-symbols-outlined" style="font-size: 12px;">delete</span>
          </button>
        </div>
        <div id="${u}-content" style="display: none; padding: 4px 0 4px 0;">
    `,d.unusedVariants.forEach(w=>{const y=SecurityUtils.escapeHTML(w.name);i+=`
        <div class="quality-issue-card" data-ignore-id="${w.id}" style="margin-bottom: 2px; padding: 0 10px; min-height: 20px; background: rgba(255, 255, 255, 0.02); border: 1px solid rgba(255, 255, 255, 0.03); border-radius: 4px; display: flex; align-items: center;">
          <div style="display: flex; justify-content: space-between; align-items: center; gap: 12px; width: 100%;">
            <div style="flex: 1; min-width: 0; font-weight: 500; color: rgba(255, 255, 255, 0.9); font-size: 12px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
              ${y}
            </div>
            <div style="display: flex; gap: 2px; align-items: center; flex-shrink: 0;">
              <button class="icon-button focus-btn" onclick="event.stopPropagation(); focusOnComponent('${w.id}')" title="Focus on variant">
                <span class="material-symbols-outlined" style="font-size: 14px;">filter_center_focus</span>
              </button>
              <button class="icon-button ignore-btn" onclick="event.stopPropagation(); ignoreItem('component', '${w.id}', '${y}')" title="Ignore variant">
                <span class="material-symbols-outlined" style="font-size: 14px;">visibility_off</span>
              </button>
              <button class="icon-button delete-btn" data-component-id="${w.id}" onclick="event.stopPropagation(); deleteComponent('${w.id}', '${y}', 'variant', '${d.id}')" title="Delete variant">
                <span class="material-symbols-outlined" style="font-size: 14px;">delete</span>
              </button>
            </div>
          </div>
        </div>
      `}),i+="</div></div>"}),l.length>0&&(a.length>0&&(i+=`
        <div style="margin-bottom: 8px;">
          <div style="display: flex; align-items: center; gap: 10px; padding: 6px 10px;">
            <span style="font-size: 11px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; color: rgba(255,255,255,0.5); flex: 1;">Standalone Components</span>
            <span style="font-size: 10px; color: rgba(255,255,255,0.3); padding: 1px 6px;">${l.length}</span>
          </div>
      `),l.forEach(d=>{const p=SecurityUtils.escapeHTML(d.name);i+=`
        <div class="quality-issue-card" data-ignore-id="${d.id}" style="margin-bottom: 2px; padding: 0 10px; min-height: 20px; background: rgba(255, 255, 255, 0.02); border: 1px solid rgba(255, 255, 255, 0.03); border-radius: 4px; display: flex; align-items: center;">
          <div style="display: flex; justify-content: space-between; align-items: center; gap: 12px; width: 100%;">
            <div style="flex: 1; min-width: 0; font-weight: 500; color: rgba(255, 255, 255, 0.9); font-size: 12px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
              ${p}
            </div>
            <div style="display: flex; gap: 2px; align-items: center; flex-shrink: 0;">
              <button class="icon-button focus-btn" onclick="focusOnComponent('${d.id}')" title="Focus on component">
                <span class="material-symbols-outlined" style="font-size: 14px;">filter_center_focus</span>
              </button>
              <button class="icon-button ignore-btn" onclick="ignoreItem('component', '${d.id}', '${p}')" title="Ignore component">
                <span class="material-symbols-outlined" style="font-size: 14px;">visibility_off</span>
              </button>
              <button class="icon-button delete-btn" data-component-id="${d.id}" onclick="deleteComponent('${d.id}', '${p}', 'component')" title="Delete component">
                <span class="material-symbols-outlined" style="font-size: 14px;">delete</span>
              </button>
            </div>
          </div>
        </div>
      `}),a.length>0&&(i+="</div>")),e.ignoredComponents&&e.ignoredComponents.length>0){let d="";e.ignoredComponents.forEach(p=>{if(p.type==="COMPONENT_SET"&&p.unusedVariants){if(p.unusedVariants.forEach(u=>{const g=SecurityUtils.escapeHTML(u.name);d+=`
            <div style="display: flex; align-items: center; gap: 8px; padding: 4px 8px;">
              <span style="flex: 1; font-size: 12px; color: rgba(255,255,255,0.5); overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${SecurityUtils.escapeHTML(p.name)} / ${g}</span>
              <button class="icon-button" onclick="unignoreItem('component', '${u.id}')" title="Restore">
                <span class="material-symbols-outlined" style="font-size: 14px;">visibility</span>
              </button>
            </div>
          `}),p.isFullyUnused||!p.unusedVariants.length){const u=SecurityUtils.escapeHTML(p.name);d+=`
            <div style="display: flex; align-items: center; gap: 8px; padding: 4px 8px;">
              <span style="flex: 1; font-size: 12px; color: rgba(255,255,255,0.5); overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${u} (set)</span>
              <button class="icon-button" onclick="unignoreItem('component-set', '${p.id}')" title="Restore">
                <span class="material-symbols-outlined" style="font-size: 14px;">visibility</span>
              </button>
            </div>
          `}}else{const u=SecurityUtils.escapeHTML(p.name);d+=`
          <div style="display: flex; align-items: center; gap: 8px; padding: 4px 8px;">
            <span style="flex: 1; font-size: 12px; color: rgba(255,255,255,0.5); overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${u}</span>
            <button class="icon-button" onclick="unignoreItem('component', '${p.id}')" title="Restore">
              <span class="material-symbols-outlined" style="font-size: 14px;">visibility</span>
            </button>
          </div>
        `}}),i+=`
      <div id="component-ignored-panel" style="display: none; margin-top: 8px; padding: 8px; background: rgba(255,255,255,0.02); border-radius: 6px; border: 1px solid rgba(255,255,255,0.05);">
        <div style="font-size: 11px; font-weight: 600; color: rgba(255,255,255,0.4); margin-bottom: 8px;">Ignored Items</div>
        ${d}
      </div>
    `}i+=`
        </div>
      </div>
    </div>
  `;const r=document.getElementById("component-hygiene-results-placeholder");r&&(r.innerHTML=`
      <div id="${n}">
        ${i}
      </div>
    `,window.QualityAnimationController&&window.QualityAnimationController.registerData("Unused Components"))}function displayVariableHygieneSection(e){if(!e||!document.getElementById("quality-dashboard-container"))return;const n="variable-hygiene-section",s="unused-variables-section",o=window.qualitySectionStates&&window.qualitySectionStates[s]===!0;window.qualityAnalysisState&&(window.qualityAnalysisState.subScores.variableHygiene=(e.subScores?e.subScores.variableHygiene:0)||0,window.qualityAnalysisState.variableIssues=e.unusedVariableCount||e.unusedCount||0,updateQualityScoreUI());let i=`
    <!-- Section Divider -->
    <div style="height: 1px; background: rgba(255, 255, 255, 0.08); margin: 16px 0;"></div>
    
    <!-- Unused Variables Collapsible Section -->
    <div id="${s}" class="quality-section-collapsible" style="margin-bottom: 16px;">
      <div class="section-header-collapsible" onclick="toggleQualitySection('${s}')" style="cursor: pointer; padding: 8px 0; display: flex; align-items: center; gap: 12px; user-select: none;">
        <span class="material-symbols-outlined section-chevron" style="font-size: 20px; color: rgba(255,255,255,0.4); transition: transform 0.3s ease; ${o?"":"transform: rotate(-90deg);"}">expand_more</span>
        <!-- Stats -->
        ${renderCategoryStats((e.subScores?e.subScores.variableHygiene:0)||0,e.unusedVariableCount||e.unusedCount||0,e.totalVariables||0,"Unused Variables")}
        ${e.ignoredCount>0?`
          <span onclick="event.stopPropagation(); toggleIgnoredPanel('variable-ignored-panel')"
                style="font-size: 10px; color: rgba(255,255,255,0.4); background: rgba(255,255,255,0.06); padding: 2px 8px; border-radius: 10px; cursor: pointer; margin-left: 4px;"
                title="Click to manage ignored items">
            ${e.ignoredCount} ignored
          </span>
        `:""}
      </div>
      <div class="section-content-collapsible" style="display: ${o?"block":"none"};">
        <p style="color: rgba(255, 255, 255, 0.6); font-size: 12px; margin: 0 0 16px 32px;">
          ${e.unusedVariableCount||e.unusedCount||0} unused variable${(e.unusedVariableCount||e.unusedCount)!==1?"s":""} found out of ${e.totalVariables||0} total. Remove unused variables to improve your design system hygiene.
        </p>
        <div style="padding-left: 0;">
  `;const a={};if(e.unusedVariables.forEach(r=>{a[r.collectionName]||(a[r.collectionName]=[]),a[r.collectionName].push(r)}),Object.entries(a).forEach(([r,d],p)=>{const u=`unused-var-group-${p}`,g=SecurityUtils.escapeHTML(r);i+=`
      <div class="variable-collection" style="margin-bottom: 8px;">
        <div class="collection-header collapsed" 
             onclick="this.classList.toggle('collapsed'); const content = document.getElementById('${u}-content'); content.style.display = content.style.display === 'none' ? 'block' : 'none'; const icon = this.querySelector('.collection-toggle-icon'); icon.style.transform = this.classList.contains('collapsed') ? 'rotate(-90deg)' : 'rotate(0deg)';"
             style="display: flex; align-items: center; gap: 10px; cursor: pointer; padding: 6px 10px; background: rgba(255,255,255,0.03); border-radius: 6px; border: 1px solid rgba(255,255,255,0.05);">
          <span class="material-symbols-outlined collection-toggle-icon" style="font-size: 18px; color: rgba(255,255,255,0.4); transition: transform 0.2s; transform: rotate(-90deg);">expand_more</span>
          <span style="font-size: 11px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; color: rgba(255,255,255,0.5); flex: 1;">${g}</span>
          <span style="font-size: 10px; color: rgba(255,255,255,0.3); background: none; border: none; padding: 1px 6px;">${d.length}</span>
          <button
            class="icon-button ignore-btn"
            onclick="event.stopPropagation(); ignoreItem('collection', '${d[0].collectionId}', '${g}')"
            title="Ignore entire collection"
            style="flex-shrink: 0; width: 18px; height: 18px; min-width: 18px;"
          >
            <span class="material-symbols-outlined" style="font-size: 12px;">visibility_off</span>
          </button>
        </div>
        <div id="${u}-content" style="display: none; padding: 4px 0 4px 0;">
    `,d.forEach((f,w)=>{const y=`variable-hygiene-${p}-${w}`,b=SecurityUtils.escapeHTML(f.name),S=/^#(?:[0-9a-fA-F]{3}){1,2}(?:[0-9a-fA-F]{2})?$|^rgb/.test(f.resolvedValue||""),k=(f.resolvedType==="COLOR"||S)&&f.resolvedValue?`<div style="width: 14px; height: 14px; border-radius: 3px; background: ${f.resolvedValue}; border: 1px solid rgba(255,255,255,0.2); flex-shrink: 0; margin-left: 8px;"></div>`:"";i+=`
        <div id="${y}-card" class="quality-issue-card" data-ignore-id="${f.id}" style="margin-bottom: 2px; display: block; padding: 0 10px; min-height: 20px; background: rgba(255, 255, 255, 0.02); border: 1px solid rgba(255, 255, 255, 0.03); border-radius: 4px; display: flex; align-items: center;">
          <div style="display: flex; justify-content: space-between; align-items: center; gap: 12px; width: 100%;">
            <div style="flex: 1; min-width: 0; display: flex; align-items: center;">
              <div style="width: 160px; flex-shrink: 0; font-weight: 500; color: rgba(255, 255, 255, 0.9); font-size: 12px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                ${b}
              </div>
              ${k}
            </div>
            <div style="display: flex; gap: 2px; align-items: center; flex-shrink: 0;">
              <button
                class="icon-button ignore-btn"
                onclick="ignoreItem('variable', '${f.id}', '${b}')"
                title="Ignore variable"
              >
                <span class="material-symbols-outlined" style="font-size: 14px;">visibility_off</span>
              </button>
              <button
                class="icon-button delete-btn"
                data-variable-id="${f.id}"
                onclick="deleteUnusedVariable('${f.id}', '${b}')"
                title="Delete variable"
              >
                <span class="material-symbols-outlined" style="font-size: 14px;">delete</span>
              </button>
            </div>
          </div>
        </div>
      `}),i+="</div></div>"}),e.ignoredVariables&&e.ignoredVariables.length>0){const r=e.ignoredCollectionIds||[],d={};e.ignoredVariables.forEach(u=>{d[u.collectionName]||(d[u.collectionName]=[]),d[u.collectionName].push(u)});let p="";Object.entries(d).forEach(([u,g],f)=>{const w=SecurityUtils.escapeHTML(u),y=g[0].collectionId,b=r.indexOf(y)!==-1,S=`ignored-var-group-${f}`;p+=`
        <div style="margin-bottom: 6px;">
          <div onclick="const c = document.getElementById('${S}-content'); c.style.display = c.style.display === 'none' ? 'block' : 'none'; const ic = this.querySelector('.ig-toggle'); ic.style.transform = c.style.display === 'none' ? 'rotate(-90deg)' : 'rotate(0deg)';"
               style="display: flex; align-items: center; gap: 8px; cursor: pointer; padding: 4px 8px; background: rgba(255,255,255,0.03); border-radius: 4px;">
            <span class="material-symbols-outlined ig-toggle" style="font-size: 14px; color: rgba(255,255,255,0.3); transition: transform 0.2s; transform: rotate(-90deg);">expand_more</span>
            <span style="font-size: 11px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; color: rgba(255,255,255,0.4); flex: 1;">${w}</span>
            <span style="font-size: 10px; color: rgba(255,255,255,0.25); padding: 0 4px;">${g.length}</span>
            ${b?`
              <button class="icon-button" onclick="event.stopPropagation(); unignoreItem('collection', '${y}')" title="Restore entire collection">
                <span class="material-symbols-outlined" style="font-size: 14px;">visibility</span>
              </button>
            `:""}
          </div>
          <div id="${S}-content" style="display: none; padding: 2px 0 2px 0;">
      `,g.forEach(x=>{const k=SecurityUtils.escapeHTML(x.name),M=(x.resolvedType==="COLOR"||/^#(?:[0-9a-fA-F]{3}){1,2}(?:[0-9a-fA-F]{2})?$|^rgb/.test(x.resolvedValue||""))&&x.resolvedValue?`<div style="width: 12px; height: 12px; border-radius: 2px; background: ${x.resolvedValue}; border: 1px solid rgba(255,255,255,0.15); flex-shrink: 0;"></div>`:"";p+=`
          <div style="display: flex; align-items: center; gap: 8px; padding: 3px 8px 3px 30px; min-height: 20px;">
            <span style="flex: 1; font-size: 12px; color: rgba(255,255,255,0.4); overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" title="${k}">${k}</span>
            ${M}
            ${b?"":`
              <button class="icon-button" onclick="unignoreItem('variable', '${x.id}')" title="Restore variable">
                <span class="material-symbols-outlined" style="font-size: 14px;">visibility</span>
              </button>
            `}
          </div>
        `}),p+="</div></div>"}),i+=`
      <div id="variable-ignored-panel" style="display: none; margin-top: 8px; padding: 8px; background: rgba(255,255,255,0.02); border-radius: 6px; border: 1px solid rgba(255,255,255,0.05);">
        <div style="font-size: 11px; font-weight: 600; color: rgba(255,255,255,0.4); margin-bottom: 8px;">Ignored Items</div>
        ${p}
      </div>
    `}i+=`
        </div>
      </div>
    </div>
  `;const l=document.getElementById("variable-hygiene-results-placeholder");l&&(l.innerHTML=`
      <div id="${n}">
        ${i}
      </div>
    `,window.QualityAnimationController&&window.QualityAnimationController.registerData("Unused Variables"))}function getTailwindNamespaceOptions(e){const t=["color","font","text","font-weight","tracking","leading","breakpoint","container","spacing","radius","shadow","inset-shadow","drop-shadow","blur","perspective","aspect","ease","animate"],n=e.toLowerCase().trim(),o={colors:"color",colour:"color",fonts:"font","font-family":"font","font-size":"text","text-size":"text",size:"text",weight:"font-weight","letter-spacing":"tracking","line-height":"leading",line:"leading",space:"spacing",padding:"spacing",margin:"spacing",gap:"spacing","border-radius":"radius",rounded:"radius",shadows:"shadow","box-shadow":"shadow",timing:"ease","timing-function":"ease",transition:"ease",animation:"animate","aspect-ratio":"aspect",breakpoints:"breakpoint",screen:"breakpoint"}[n];let i="";return t.forEach(a=>{i+=`<option value="${a}">${a}</option>`}),i}window.QualityAnimationController={activeCategories:new Set,completedCategories:new Set,categoryBackground:new Map,isRunning:!1,_pollTimeout:null,reset(){console.log("AnimationController: resetting state"),this.activeCategories=new Set,this.completedCategories=new Set,this.categoryBackground=new Map,this.isRunning=!1,this._pollTimeout&&(clearTimeout(this._pollTimeout),this._pollTimeout=null)},registerData(e){console.log("AnimationController: registered",e),this.activeCategories.add(e),this.categoryBackground.set(e,!!window.isBackgroundAnalysis),this.completedCategories.delete(e),this.tryStart()},tryStart(){return j(this,null,function*(){if(this.isRunning)return;this.isRunning=!0;const e=["Missing Variables","Unused Variables","Unused Components","Tailwind Incompatible Variables"];let t=!1,n=!0;for(;n;){n=!1;for(const a of e){if(this.completedCategories.has(a))continue;const l=a.replace(/\s+/g,"-").toLowerCase(),r=document.getElementById(`bar-${l}`);if(this.activeCategories.has(a)&&r){const p=r;yield this.animateCategory(a);const u=document.getElementById(`bar-${l}`);p===u?this.completedCategories.add(a):n=!0,t=!0}}}const s=e.length,o=e.filter(a=>{const l=a.replace(/\s+/g,"-").toLowerCase();return document.getElementById(`bar-${l}`)}).length,i=this.activeCategories.size;this.completedCategories.size>=o&&o>0?this.completedCategories.size>=i?(yield this.animateFinalScore(),this.reset()):(this.isRunning=!1,this._pollTimeout=setTimeout(()=>{this._pollTimeout=null,this.tryStart()},1e3)):(this.isRunning=!1,this._pollTimeout=setTimeout(()=>{this._pollTimeout=null,this.tryStart()},500))})},animateCategory(e){return j(this,null,function*(){const t=e.replace(/\s+/g,"-").toLowerCase(),n=document.getElementById(`count-${t}`),s=document.getElementById(`count-good-${t}`),o=document.getElementById(`bar-${t}`),i=document.getElementById(`percent-${t}`);if(!n||!o||!i)return;console.log("AnimationController: animating",e);const a=parseInt(n.dataset.target)||0,l=s&&parseInt(s.dataset.target)||0,r=parseInt(o.dataset.score)||0,d=parseInt(n.textContent.replace(/[^0-9-]/g,""))||0,p=s&&parseInt(s.textContent.replace(/[^0-9-]/g,""))||0,u=parseInt(i.textContent.replace(/[^0-9-]/g,""))||0,g=d,f=p,w=u,y=[this.animateValue(n,g,a,600),this.animateValue(i,w,r,600,"%")];s&&y.push(this.animateValue(s,f,l,600)),o.style.transition="width 0.6s cubic-bezier(0.4, 0, 0.2, 1)",o.style.width=`${r}%`,yield Promise.all(y),yield new Promise(b=>setTimeout(b,200))})},animateFinalScore(){return j(this,null,function*(){console.log("AnimationController: animating final score");const e=document.getElementById("score-value")||document.querySelector(".quality-gauge-svg text");if(!e)return;const t=window.qualityAnalysisState;if(!t)return;let n=0,s=0;Object.keys(t.subScores).forEach(l=>{const r=parseFloat(t.weights[l])||0;r>0&&(n+=t.subScores[l]*(r/100),s+=r)});const o=s>0?Math.round(n*(100/s)):0;t.score=o,yield new Promise(l=>{const r=document.getElementById("score-gauge-circle-fill");if(r){const d=parseFloat(r.getAttribute("r")),u=2*Math.PI*d*(1-o/100);r.getBoundingClientRect(),r.style.transition="stroke-dashoffset 1.2s cubic-bezier(0.4, 0, 0.2, 1), stroke 0.6s ease",r.style.strokeDashoffset=u,r.style.stroke=getScoreColor(o);const g=document.querySelector(".quality-gauge-svg text");g&&(g.style.fill=getScoreColor(o))}l()});const a=parseInt(e.textContent.replace(/[^0-9-]/g,""))||0;yield this.animateValue(e,a,o,1e3)})},animateValue(e,t,n,s,o=""){return new Promise(i=>{let a=null;const l=r=>{a||(a=r);const d=Math.min((r-a)/s,1),p=Math.floor(d*(n-t)+t);e.textContent=p.toLocaleString()+o,d<1?window.requestAnimationFrame(l):(e.textContent=n.toLocaleString()+o,i())};window.requestAnimationFrame(l)})}};function getQualityCategories(){return[{key:"tokenCoverage",color:"white",label:"Missing Variables"},{key:"tailwindReadiness",color:"white",label:"Incompatible Tailwind Variables"},{key:"componentHygiene",color:"white",label:"Component Hygiene"},{key:"variableHygiene",color:"white",label:"Variable Hygiene"}]}function polarToCartesian(e,t,n,s){const o=(s-90)*Math.PI/180;return{x:e+n*Math.cos(o),y:t+n*Math.sin(o)}}function describeArc(e,t,n,s,o){const i=polarToCartesian(e,t,n,o),a=polarToCartesian(e,t,n,s),l=o-s<=180?"0":"1";return["M",i.x,i.y,"A",n,n,0,l,0,a.x,a.y].join(" ")}function renderSegmentedGauge(e,t,n=150,s={}){const o=s.showLabels!==!1,i=s.showCenterText!==!1,a=s.strokeWidth||(o?10:6),l=window.qualityAnalysisState,r=l?function(){let I=0,E=0;return Object.keys(l.subScores).forEach(T=>{const V=parseFloat(l.weights[T])||0;V>0&&(I+=l.subScores[T]*(V/100),E+=V)}),E>0?Math.round(I*(100/E)):0}():0,d=n/2,p=n/2,u=o?n/2-35:n/2-a/2-2,g=getScoreColor(r),w=[{key:"tokenCoverage",label:"Missing Variables"},{key:"variableHygiene",label:"Unused Variables"},{key:"componentHygiene",label:"Unused Components"},{key:"tailwindReadiness",label:"Tailwind Incompatible Variables"}].filter(I=>e&&e[I.key]!==void 0&&t&&parseFloat(t[I.key])>0),y=w.length,b=15,x=(360-b*y)/y;let k=`<svg width="${n}" height="${n}" viewBox="0 0 ${n} ${n}" class="quality-gauge-svg" style="display: block; margin: 0 auto; overflow: visible;">`;if(i){const I=window.QualityAnimationController&&window.QualityAnimationController.isRunning,E=I?"\u2013":s.initialScore!==void 0?s.initialScore:r;k+=`
      <text id="quality-score-text" x="${d}" y="${p}" text-anchor="middle" dominant-baseline="central"
            style="fill: ${I?"rgba(255,255,255,0.25)":g}; font-size: 32px; font-weight: 800; font-family: 'SF Mono', 'JetBrains Mono', 'Fira Code', monospace; transition: fill 0.6s ease;">
        ${E}
      </text>
    `}const C=2*Math.PI*u,M=s.initialScore!==void 0?s.initialScore:0,P=C*(1-M/100);return k+=`
    <g class="total-score-ring">
      <circle cx="${d}" cy="${p}" r="${u}"
              fill="none"
              stroke="white"
              stroke-width="${a}"
              stroke-opacity="0.08"
              stroke-linecap="round" />
      <circle id="score-gauge-circle-fill" cx="${d}" cy="${p}" r="${u}"
              fill="none"
              stroke="${g}"
              stroke-width="${a}"
              stroke-linecap="round"
              stroke-dasharray="${C}"
              stroke-dashoffset="${P}"
              transform="rotate(-90 ${d} ${p})" />
    </g>
  `,w.forEach((I,E)=>{const T=e[I.key],V=getScoreColor(T),L=E*(x+b),c=L+x,N=x*(T/100);let F="";if(o){const m=L+x/2,h=(m-90)*(Math.PI/180),v=u+28,A=d+v*Math.cos(h),$=p+v*Math.sin(h);let B="middle",z="central";const q=(m%360+360)%360;q>20&&q<160?B="start":q>200&&q<340&&(B="end"),q>110&&q<250?z="hanging":(q>290||q<70)&&(z="alphabetic");const H=I.label.split(" "),U=[];H.length>2?(U.push(H.slice(0,2).join(" ")),U.push(H.slice(2).join(" "))):U.push(I.label),F=`
        <g class="gauge-label" style="opacity: 0; pointer-events: none; transition: all 0.3s ease;">
          ${U.map((R,G)=>`
            <text x="${A}" y="${$+G*12-(U.length-1)*6}"
                  text-anchor="${B}"
                  dominant-baseline="${z}"
                  style="fill: white; font-size: 9px; font-weight: 800; text-transform: uppercase; letter-spacing: 0.6px; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.5));">
              ${R}
            </text>
          `).join("")}
        </g>
      `}k+=`
      <g class="gauge-category" data-category="${I.key}" style="cursor: pointer;">
        <path d="${describeArc(d,p,u,L,c)}"
              fill="none"
              stroke="${V}"
              stroke-width="${a}"
              stroke-opacity="0.15"
              stroke-linecap="round" />

        ${N>0?`
          <path d="${describeArc(d,p,u,L,L+Math.max(1,N))}"
                fill="none"
                stroke="${V}"
                stroke-width="${a}"
                stroke-linecap="round"
                class="gauge-segment" />
        `:""}

        ${F}
      </g>
    `}),k+="</svg>",k}function renderCategoryStats(e,t,n,s){const o=getScoreColor(e),i=e===100,a=s?s.replace(/\s+/g,"-").toLowerCase():"unknown",l=`count-${a}`,r=`count-good-${a}`,d=`bar-${a}`,p=`percent-${a}`,u=typeof t=="number"?t:0;let f=(typeof n=="number"?n:0)-u;return f<0&&(f=0),`
    <h2 style="color: ${i?o:"white"}; display: flex; align-items: center; gap: 10px; font-size: 1.05rem; margin: 0; flex: 1;">
      ${s}
      ${i?`<span class="material-symbols-outlined" style="font-size: 20px; color: ${o}; margin-left: -4px;">check_circle</span>`:""}
    </h2>

    <div style="display: flex; align-items: center; gap: 8px; order: 1;">
        <!-- Good Count (Green) -->
        <span id="${r}" class="quality-animate-count" data-target="${f}" style="color: #4ade80; font-weight: 500; font-family: 'SF Mono', monospace; font-size: 12px; min-width: 20px; text-align: right;">0</span>

        <!-- Progress Bar (Red Background = Bad, Green Fill = Good) -->
        <div style="width: 80px; height: 6px; background: #7f1d1d; border-radius: 3px; overflow: hidden; position: relative;">
            <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: #ef4444;"></div>
            <div id="${d}" class="quality-animate-bar" data-score="${e}" style="position: absolute; top: 0; left: 0; height: 100%; width: 0%; background: #4ade80; border-radius: 3px; z-index: 2;"></div>
        </div>

        <!-- Bad Count (Red) -->
        <span id="${l}" class="quality-animate-count" data-target="${u}" style="color: #f87171; font-weight: 500; font-family: 'SF Mono', monospace; font-size: 12px; min-width: 20px;">0</span>

        <!-- Percent -->
        <span id="${p}" class="quality-animate-percent" data-score="${e}" style="font-size: 13px; font-weight: 700; color: ${o}; width: 36px; text-align: right; font-family: 'SF Mono', monospace;">0%</span>
    </div>
  `}function animateValue(e,t,n,s){if(t===n)return;const o=document.getElementById(e);if(!o)return;const i=n-t;let a=t;const l=n>t?1:-1,r=Math.abs(Math.floor(s/i)),d=setInterval(function(){a+=l,o.innerHTML=a,a==n&&clearInterval(d)},r)}let _updateQualityScoreTimer=null;function updateQualityScoreUI(){_updateQualityScoreTimer||(_updateQualityScoreTimer=requestAnimationFrame(()=>{_updateQualityScoreTimer=null,_updateQualityScoreUIImmediate()}))}function _updateQualityScoreUIImmediate(){const e=window.qualityAnalysisState;if(!e)return;e.totalIssues=(e.tokenIssues||0)+(e.variableIssues||0)+(e.componentIssues||0);let t=0,n=0;Object.keys(e.subScores).forEach(d=>{const p=parseFloat(e.weights[d])||0;p>0&&(t+=e.subScores[d]*(p/100),n+=p)});const s=n>0?Math.round(t*(100/n)):0;e.score=s;const o=e.previousScore||0,i=s>o;e.previousScore=s;const a=window.QualityAnimationController&&window.QualityAnimationController.isRunning,l=document.querySelector(".quality-gauge-wrapper");if(l&&(l.innerHTML=`
            ${renderSegmentedGauge(e.subScores,e.weights,150,{initialScore:o})}
        `),!a&&l){const d=document.getElementById("score-gauge-circle-fill");if(d&&requestAnimationFrame(()=>{requestAnimationFrame(()=>{const p=parseFloat(d.getAttribute("r")),u=2*Math.PI*p;d.style.transition="stroke-dashoffset 1s ease-out, stroke 0.6s ease",d.style.strokeDashoffset=u*(1-s/100),d.style.stroke=getScoreColor(s);const g=document.querySelector(".quality-gauge-svg text");g&&(g.style.fill=getScoreColor(s))})}),o!==s){const p=document.getElementById("quality-score-text");p&&(window.QualityAnimationController.animateValue(p,o,s,600),i&&o>0&&(p.classList.remove("score-celebration"),p.offsetWidth,p.classList.add("score-celebration")))}}const r=document.getElementById("quality-summary-stats");r&&(r.textContent=`${e.totalNodes} nodes \u2022 ${e.totalIssues} issues`)}function resetQualityState(){if(!window.qualityAnalysisState)return;window.qualityAnalysisState.totalIssues=0,window.tokenFixInProgress=!1;const e=document.querySelector(".quality-gauge-wrapper");if(e){const a={tokenCoverage:0,tailwindReadiness:0,componentHygiene:0,variableHygiene:0},l=D({},window.qualityAnalysisState.weights);e.innerHTML=`
            ${renderSegmentedGauge(a,l,150)}
        `}Object.keys(window.qualityAnalysisState.subScores).forEach(a=>{window.qualityAnalysisState.subScores[a]=0}),updateQualityScoreUI(),window.QualityAnimationController&&typeof window.QualityAnimationController.reset=="function"&&window.QualityAnimationController.reset(),console.log("Quality: State reset for re-analysis");const t=document.getElementById("component-hygiene-results-placeholder");t&&(t.innerHTML="");const n=document.getElementById("token-coverage-results");n&&(n.innerHTML="");const s=document.getElementById("variable-hygiene-results-placeholder");s&&(s.innerHTML="");const o=document.getElementById("quality-dashboard-container");o&&!document.getElementById("quality-unified-loader")&&o.insertAdjacentHTML("afterbegin",UIHelper.createQualityLoader());const i=document.getElementById("tailwind-readiness-results-placeholder");i&&(i.innerHTML="")}function displayTokenCoverageResults(e){var u,g,f,w;console.log("displayTokenCoverageResults received:",e),(!e||e.totalNodes===0)&&console.warn("displayTokenCoverageResults: Received 0 nodes. Using fallback if available.");const t=document.getElementById("token-coverage-results"),n=!e||e.totalIssues===0;if(window.qualityAnalysisState){const y=e.totalNodes>0?e.totalNodes:window.qualityAnalysisState.totalNodes||0;window.qualityAnalysisState.totalNodes=y,window.qualityAnalysisState.tokenIssues=e.totalIssues||0,e.subScores&&(window.qualityAnalysisState.subScores.tokenCoverage=e.subScores.tokenCoverage,window.qualityAnalysisState.subScores.tailwindReadiness=e.subScores.tailwindReadiness),e.weights&&(window.qualityAnalysisState.weights=e.weights),updateQualityScoreUI()}const s=["Layout","Fill","Stroke","Appearance"],o=e.issuesByCategory,i=document.getElementById("quality-score-gauge-container");if(i){const y=window.qualityAnalysisState&&window.qualityAnalysisState.previousScore||0;i.innerHTML=`
            <div style="position: relative; width: 120px; height: 120px; display: flex; align-items: center; justify-content: center;" class="quality-gauge-wrapper">
                ${renderSegmentedGauge(window.qualityAnalysisState.subScores,window.qualityAnalysisState.weights,150,{initialScore:y})}
            </div>
      `}if(window.isEditMode&&updateHeaderGauge(),window.isBackgroundAnalysis){console.log("UI: Performing Smart Background Update (Stats Only)");const y=document.getElementById("count-missing-variables"),b=document.getElementById("count-good-missing-variables"),S=document.getElementById("bar-missing-variables"),x=document.getElementById("percent-missing-variables");if(y&&S&&x){const C=e.subScores?e.subScores.tokenCoverage:0,M=e.totalIssues||0,P=e.totalNodes||window.qualityAnalysisState.totalNodes||0,I=Math.max(0,P-M);y.dataset.target=M,b&&(b.dataset.target=I),S.dataset.score=C,x.dataset.score=C,window.QualityAnimationController&&window.QualityAnimationController.registerData("Missing Variables")}if(window.tailwindV4Validation&&window.tailwindV4Validation.invalidGroups&&window.tailwindV4Validation.invalidGroups.length>0){const C=document.getElementById("count-incompatible-tailwind-variables"),M=document.getElementById("count-good-incompatible-tailwind-variables"),P=document.getElementById("bar-incompatible-tailwind-variables"),I=document.getElementById("percent-incompatible-tailwind-variables");if(C&&P&&I){const E=e.subScores?e.subScores.tailwindReadiness:0,T=window.tailwindV4Validation.totalInvalid;C.dataset.target=T,P.dataset.score=E,I.dataset.score=E,window.QualityAnimationController&&window.QualityAnimationController.registerData("Incompatible Tailwind Variables")}}e.issuesByCategory&&["Layout","Fill","Stroke","Appearance"].forEach(M=>{const P=document.getElementById(`coverage-${M}`);if(P){const I=P.querySelector(".collection-header > .subgroup-stats");if(I){const E=(e.issuesByCategory[M]||[]).length;(parseInt(I.textContent)||0)!==E&&(I.textContent=E.toString(),I.style.transition="transform 0.2s ease-out",I.style.transform="scale(1.2)",setTimeout(()=>{I.style.transform="scale(1)"},200))}}}),window.isBackgroundAnalysis=!1;return}e.tailwindValidation&&!(window.tailwindV4Validation&&window.tailwindV4Validation.groups)&&(window.tailwindV4Validation=e.tailwindValidation,e.subScores&&e.subScores.tailwindReadiness!==void 0&&(window.tailwindV4Validation.readinessScore=e.subScores.tailwindReadiness),window.tailwindV4Validation&&(window.tailwindV4Validation.totalVariables=e.totalVariables||(e.subScores?e.subScores.totalVariables:0)||0));let a=`


          <!-- Section Divider (if not first section) -->
          <div style="height: 1px; background: rgba(255, 255, 255, 0.08); margin: 16px 0;"></div>

          <!-- Variable Coverage Collapsible Section -->
          <div id="token-coverage-section" class="quality-section-collapsible" style="margin-bottom: 16px;">
            <div class="section-header-collapsible" onclick="toggleQualitySection('token-coverage-section')" style="cursor: pointer; padding: 8px 0; display: flex; align-items: center; gap: 12px; user-select: none;">
              <span class="material-symbols-outlined section-chevron" style="font-size: 20px; color: rgba(255,255,255,0.4); transition: transform 0.3s ease; transform: rotate(-90deg);">expand_more</span>
              <!-- Stats -->
              ${renderCategoryStats(e.subScores?e.subScores.tokenCoverage:0,e.totalIssues,e.totalNodes||window.qualityAnalysisState.totalNodes||0,"Missing Variables")}
            </div>
            <div class="section-content-collapsible" style="display: ${window.qualitySectionStates&&window.qualitySectionStates["token-coverage-section"]?"block":"none"};">
              <p style="color: rgba(255, 255, 255, 0.6); font-size: 12px; margin: 0 0 16px 32px;">
                Identify elements using hard-coded values instead of design variables.
              </p>
        `;const l=window.scrollY,r=new Set;document.querySelectorAll(".quality-collection:not(.collapsed) .collection-header:not(.collapsed)").forEach(y=>{const b=y.closest(".quality-collection");b&&b.id&&r.add(b.id)}),window.pendingFixContext&&window.pendingFixContext.category&&r.add(`coverage-${window.pendingFixContext.category}`),s.forEach(y=>{const b=o[y]||[];if(b.length===0)return;const S={Layout:'<span class="material-symbols-outlined" style="font-size: 18px; margin-right: 6px; color: var(--purple-light);">design_services</span>',Fill:'<span class="material-symbols-outlined" style="font-size: 18px; margin-right: 6px; color: var(--purple-light);">palette</span>',Stroke:'<span class="material-symbols-outlined" style="font-size: 18px; margin-right: 6px; color: var(--purple-light);">edit</span>',Appearance:'<span class="material-symbols-outlined" style="font-size: 18px; margin-right: 6px; color: var(--purple-light);">auto_awesome</span>'},x=`coverage-${y}`,k=r.has(x);a+=`
            <div id="${x}" class="variable-collection quality-collection" style="margin-bottom: 8px;">
              <div class="collection-header header ${k?"":"collapsed"}" onclick="toggleCollection('${x}')" style="display: flex; align-items: center; justify-content: space-between; padding: 6px 10px; cursor: pointer; background: rgba(255,255,255,0.03); border-radius: 6px; border: 1px solid rgba(255,255,255,0.05);">
                <div style="display: flex; align-items: center; gap: 10px; flex: 1;">
                   <!-- Chevron on the left -->
                   <span class="material-symbols-outlined collection-toggle-icon" style="font-size: 18px; transform: ${k?"rotate(0deg)":"rotate(-90deg)"}; transition: transform 0.2s; color: rgba(255, 255, 255, 0.4);">expand_more</span>
                   
                   <div class="collection-info">
                      <div class="collection-name-title" style="display: flex; align-items: center; gap: 8px; font-size: 11px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; color: rgba(255,255,255,0.5);">
                        ${y}
                      </div>
                   </div>
                </div>
                <span class="subgroup-stats" style="font-size: 10px; color: rgba(255,255,255,0.3); background: none; border: none; padding: 1px 6px;">${b.length}</span>
              </div>
              <div id="${x}-content" class="collection-content ${k?"":"collapsed"}">
                <div style="padding: 12px;">
                  <div id="${x}-issues-container">
          `;const C=10,M=b.slice(0,C),P=b.slice(C),I=(E,T,V)=>{const L=`issue-${y}-${V}`,c=(E.matchingVariables||[]).filter($=>$.matchType==="EXACT"||!$.matchType),N=(E.matchingVariables||[]).filter($=>$.matchType==="NEAR");let F="",m="";c.length===1?(F=c[0].id,m="exact"):c.length===0&&N.length===0&&(F="create-new",m="create-new");let h="";c.length>0&&(h+=`<span class="match-badge" style="background: rgba(139, 92, 246, 0.2); color: #c4b5fd; border: 1px solid rgba(139, 92, 246, 0.3);">${c.length} Exact</span>`),N.length>0&&(h+=`<span class="match-badge match-badge-near">${N.length} Near</span>`);let v=`
              <div id="${L}-card" class="quality-issue-card" style="margin-bottom: 4px; display: block; padding: 0; background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.05); border-radius: 8px;">
                <!-- Accordion Header -->
                <div class="quality-issue-header" onclick="toggleIssueCard('${L}')" style="display: flex; justify-content: space-between; align-items: center; padding: 8px 12px;">
                  <div style="flex: 1; display: flex; align-items: center; gap: 12px; overflow: hidden;">
                    <span id="${L}-chevron" class="material-symbols-outlined quality-issue-chevron" style="font-size: 18px; opacity: 0.7;">chevron_right</span>
                    
                    <!-- Property Name -->
                    <div style="font-weight: 600; color: rgba(255, 255, 255, 0.9); font-size: 13px; white-space: nowrap;">
                      ${E.property}
                    </div>
                    <!-- Value (Inline) -->
                    <div style="font-family: 'SF Mono', Monaco, monospace; color: #a78bfa; font-size: 12px; display: flex; align-items: center; gap: 6px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                        ${SecurityUtils.escapeHTML(E.value)}
                        ${function(){const $=E.value;return/^#(?:[0-9a-fA-F]{3}){1,2}(?:[0-9a-fA-F]{2})?$|^rgb/.test($)?`<div style="width: 16px; height: 16px; border-radius: 4px; background: ${$}; border: 1px solid rgba(255,255,255,0.2); flex-shrink: 0; margin-left: 6px;"></div>`:""}()}
                    </div>
                    
                    <!-- Badges (Restored to Header) -->
                    ${h?`<div class="match-badges-container" style="display: none; gap: 4px; margin-left: 8px;">${h}</div>`:""}
                  </div>
                  
                  <div style="display: flex; align-items: center; gap: 12px;">
                    <div style="display: flex; align-items: center; gap: 4px; opacity: 0.5;">
                        <span class="material-symbols-outlined" style="font-size: 14px;">layers</span>
                        <span style="font-size: 11px; font-weight: 500;">${E.totalNodes||E.count}</span>
                    </div>
                  </div>
                </div>

                <!-- Accordion Body (Hidden by default) -->
                <div id="${L}-body" class="quality-issue-body issue-body">
            `;if(v+=`
                <div class="issue-fix-section">
                  <div class="issue-fix-header">
                    <span class="material-symbols-outlined issue-fix-icon">auto_fix_high</span>
                    <span class="issue-fix-label">Fix Available</span>
                  </div>
            `,c.length===0&&N.length===0)v+=`
                  <div style="display: flex; gap: 8px; align-items: center;">
                    <button 
                      onclick="handleCreateNewVariable('${L}')"
                      class="btn-create-variable"
                    >
                      <span class="material-symbols-outlined" style="font-size: 16px;">add_circle</span>
                      Create New Variable
                    </button>
                  </div>
                </div>
            `;else{let $="(select Token to improve Design system)";if(F){const B=[...c,...N].find(z=>z.id===F);B?$=`${B.collectionName} / ${B.name}`:F==="create-new"&&($="+ Create new variable...")}v+=`
                  <div class="fix-actions-row">
                    <div id="${L}-custom-select" class="custom-select" data-value="${F||""}">
                      <div class="custom-select-trigger" onclick="toggleCustomSelect('${L}')" style="border: 2px solid #8b5cf6;">
                        <span class="trigger-text">${$}</span>
                        <span class="material-symbols-outlined trigger-icon">expand_more</span>
                      </div>
                      <div class="custom-select-menu">
            `,c.length>0&&(v+='<div class="custom-select-group-header exact">Exact Matches</div>',c.forEach(B=>{const z=B.id===F?"selected":"";v+=`
              <div class="custom-select-option ${z}" 
                   onclick="selectCustomOption('${L}', '${B.id}', '${B.collectionName} / ${B.name}', 'exact')">
                ${B.collectionName} / ${B.name}
                ${z?'<span class="material-symbols-outlined" style="font-size: 14px;">check</span>':""}
              </div>`})),v+=`
                      <div class="custom-select-divider"></div>
                      <div class="custom-select-option create-new" 
                           onclick="selectCustomOption('${L}', 'create-new', '+ Create new variable...', '')">
                        + Create new variable...
                      </div>
                    `,N.length>0&&(v+='<div class="custom-select-divider"></div>',v+='<div class="custom-select-group-header near">Near Matches (\xB12px)</div>',N.forEach(B=>{const z=B.id===F?"selected":"";v+=`
              <div class="custom-select-option ${z}" 
                   onclick="selectCustomOption('${L}', '${B.id}', '~ ${B.collectionName} / ${B.name} (${B.resolvedValue})', 'near')">
                ~ ${B.collectionName} / ${B.name} (${B.resolvedValue})
                ${z?'<span class="material-symbols-outlined" style="font-size: 14px;">check</span>':""}
              </div>`})),v+=`
                    </div>
                  </div>
                  <button 
                    id="${L}-apply-btn" 
                    class="token-fix-apply-btn btn-apply-fix" 
                    onclick="applyTokenToSelection('${L}', '${E.property}', '${y}')"
                    data-original-onclick="applyTokenToSelection('${L}', '${E.property}', '${y}')"
                    disabled
                  >
                    <span class="material-symbols-outlined" style="font-size: 14px; vertical-align: middle;">check</span>
                    Apply
                  </button>
                </div>
              </div>
            `}F&&F!=="create-new"&&setTimeout(()=>{updateIssueApplyButtonState(L)},0),v+=`
                <div style="margin-top: 8px;">
                  <div class="nodes-list-header">
                    <label class="label-checkbox">
                        <input type="checkbox" id="${L}-select-all" onchange="toggleAllOccurrences('${L}')" style="cursor: pointer;">
                        <span class="label-text-uppercase">Select All (${E.nodeNames.length} nodes)</span>
                    </label>
                  </div>
                  <div class="quality-nodes-list">
            `;const A={};return E.nodeNames.forEach(($,B)=>{const z=E.nodeFrames?E.nodeFrames[B]:"Unknown Frame";A[z]||(A[z]={count:0,ids:[],frame:z,instances:[]}),A[z].count++,A[z].ids.push(E.nodeIds[B]),A[z].instances.push({id:E.nodeIds[B],name:$})}),Object.values(A).forEach(($,B)=>{const z=`component-group-${y}-${V}-${B}`,q=$.count>0,H=$.frame.includes("Component")||$.frame==="Unknown Frame",U=H?"grid_view":"frame";v+=`
                <div class="quality-node-item" data-issue-id="${L}">
                  <div class="node-header" onclick="toggleQualityNodeGroup('${z}')" style="display: flex; align-items: center; padding: 6px 0; cursor: pointer;">
                    <input type="checkbox" class="occurrence-checkbox" data-issue-id="${L}" data-node-ids='${SecurityUtils.escapeHTML(JSON.stringify($.ids))}' onchange="updateIssueApplyButtonState('${L}')" style="margin-right: 2px; cursor: pointer;" onclick="event.stopPropagation();">
                    <button class="nav-icon" style="width: 24px; height: 24px; border: none; background: transparent; color: rgba(255,255,255,0.4); margin-right: 2px; display: flex; align-items: center; justify-content: center;" id="${z}-toggle">
                         <span class="material-symbols-outlined" style="font-size: 18px;">expand_more</span>
                    </button>
                    ${H?' <svg width="12" height="12" viewBox="0 0 12 12" fill="none"  style="rotate: 45deg; margin-right: 8px;"><path d="M1 1h4v4H1zM7 1h4v4H7zM1 7h4v4H1zM7 7h4v4H7z" stroke="currentColor" stroke-width="1"/></svg>':'<span class="material-symbols-outlined node-icon" style="font-size: 16px; margin-right: 8px; opacity: 0.7; color: #a78bfa;">grid_3x3</span>'}
                    <span class="node-name" title="${SecurityUtils.escapeHTML($.frame)}" style="flex: 1; font-size: 12px; font-weight: 500; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; color: rgba(255,255,255,0.85);">${$.frame}</span>
                    <span class="list-badge" style="height: auto; font-size: 11px; margin-right: 4px; background: transparent; color: rgba(255,255,255,0.5); padding: 0;">${$.count}</span>
                  </div>
                  
                  <div id="${z}" class="node-instances" style="display: none; padding-left: 28px; margin-top: 2px; border-left: 1px solid rgba(255,255,255,0.05); margin-left: 9px;">
                      ${$.instances.map((R,G)=>`
                        <div class="instance-row" style="display: flex; align-items: center; justify-content: space-between; padding: 4px 0;">
                          <div style="display: flex; align-items: center; gap: 6px; overflow: hidden;">
                              <span class="material-symbols-outlined" style="font-size: 14px; opacity: 0.5;">layers</span>
                              <span class="instance-label" title="${SecurityUtils.escapeHTML(R.name)}" style="font-size: 11px; color: rgba(255,255,255,0.6); white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${SecurityUtils.escapeHTML(R.name)}</span>
                          </div>
                          <button class="node-focus-btn" onclick="window.focusOnNode('${R.id}')"><span class="material-symbols-outlined" style="font-size: 16px;">filter_center_focus</span></button>
                        </div>
                      `).join("")}
                  </div>
                </div>
              `}),v+=`                  </div> <!-- End quality-nodes-list -->
                </div> <!-- End Accordion Body Wrapper -->
              </div> <!-- End Accordion Body -->
              </div> <!-- End Card -->
            `,v};window.toggleIssueCard=function(E){const T=document.getElementById(`${E}-card`),V=document.getElementById(`${E}-body`);if(T&&V){const L=V.style.display==="none"||window.getComputedStyle(V).display==="none";if(V.style.display=L?"block":"none",L){T.classList.add("expanded");const c=T.querySelector(".match-badges-container");c&&(c.style.display="flex")}else{T.classList.remove("expanded");const c=T.querySelector(".match-badges-container");c&&(c.style.display="none")}}},M.forEach((E,T)=>{a+=I(E,T,T)}),a+="</div>",P.length>0&&(a+=`
              <div id="${x}-load-more" style="text-align: center; padding-top: 8px;">
                <button onclick="loadMoreIssues('${y}', ${C})" class="btn-secondary" style="width: 100%; font-size: 12px; padding: 8px;">
                  Load ${P.length} more issues
                </button>
              </div>
            `,window.remainingIssuesRaw=window.remainingIssuesRaw||{},window.remainingIssuesRaw[y]=P,window.renderIssueCard=I),a+=`
                </div>
              </div>
            </div>
          `}),a+=`
            </div>
          </div>
        `,t.innerHTML=a,window.QualityAnimationController&&(window.QualityAnimationController.registerData("Missing Variables"),(((u=window.gitSettings)==null?void 0:u.exportFormat)==="tailwind-v4"||((g=window.gitlabSettings)==null?void 0:g.exportFormat)==="tailwind-v4")&&window.tailwindV4Validation&&window.tailwindV4Validation.invalidGroups&&window.tailwindV4Validation.invalidGroups.length>0&&window.QualityAnimationController.registerData("Tailwind Incompatible Variables"));const d=((f=window.gitSettings)==null?void 0:f.exportFormat)==="tailwind-v4"||((w=window.gitlabSettings)==null?void 0:w.exportFormat)==="tailwind-v4",p=document.getElementById("tailwind-readiness-results-placeholder");p&&(d&&window.tailwindV4Validation?(p.innerHTML=renderTailwindReadinessSection(window.tailwindV4Validation),window.QualityAnimationController&&window.QualityAnimationController.registerData("Tailwind Incompatible Variables")):p.innerHTML=""),l>0&&window.scrollTo(0,l),s.forEach(y=>{(o[y]||[]).slice(0,10).forEach((x,k)=>{const C=`issue-${y}-${k}`;setupIssueListeners(C)})}),window.pendingFixIssueId&&(console.log("Restoring view for pending issue:",window.pendingFixIssueId),setTimeout(()=>{let y=window.pendingFixIssueId;if(window.pendingFixContext){const{category:k,value:C}=window.pendingFixContext;if(k&&C&&e&&e.issuesByCategory&&e.issuesByCategory[k]){const P=e.issuesByCategory[k].findIndex(I=>I.value===C);P!==-1&&(y=`issue-${k}-${P}`,console.log(`Found equivalent issue for restoration: ${y} (Context match)`))}}let b=document.getElementById(`${y}-card`);if(!b){const k=y.split("-");if(k.length>=3){const C=k[k.length-1],M=parseInt(C),P=k.slice(1,k.length-1).join("-");if(!isNaN(M)&&P&&window.remainingIssuesRaw&&window.remainingIssuesRaw[P]){console.log(`Pending issue ${y} not found. Attempting to force load for category ${P}, target index ${M}`);let I=0;for(;!document.getElementById(`${y}-card`)&&I<50;){const E=document.getElementById(`coverage-${P}-issues-container`);if(!E)break;const T=E.querySelectorAll(".quality-issue-card").length;if(T>M||!window.remainingIssuesRaw[P]||window.remainingIssuesRaw[P].length===0)break;window.loadMoreIssues(P,T),I++}b=document.getElementById(`${y}-card`)}}}const S=document.getElementById(`${y}-body`);if(b&&S){S.style.display="block",b.classList.add("expanded");const k=document.getElementById(`${y}-chevron`);k&&(k.style.transform="rotate(90deg)",k.style.color="rgba(255, 255, 255, 0.9)")}const x=b||document.querySelector(`[data-issue-id="${y}"]`);if(x){let k=x.parentElement;for(;k;){if(k.classList.contains("collection-content")){k.classList.remove("collapsed");const C=k.previousElementSibling;if(C&&C.classList.contains("collection-header")){C.classList.remove("collapsed");const M=C.querySelector(".collection-toggle-icon");M&&(M.style.transform="rotate(0deg)")}}if(k=k.parentElement,k===document.body)break}setTimeout(()=>{var M,P;x.scrollIntoView({behavior:"smooth",block:"center"}),x.style.transition="background-color 0.5s ease";const C=x.style.backgroundColor;if(x.style.backgroundColor="rgba(139, 92, 246, 0.2)",setTimeout(()=>{x.style.backgroundColor=C},1500),window.pendingFixContext&&window.pendingFixContext.fullVariableName){const I=window.pendingFixContext.fullVariableName,E=document.getElementById(`${y}-custom-select`);if(E){const V=E.querySelectorAll(".custom-select-option:not(.create-new)");for(const L of V)if(L.textContent.trim().includes(I)){const c=(P=(M=L.getAttribute("onclick"))==null?void 0:M.match(/selectCustomOption\('[^']*',\s*'([^']*)'/))==null?void 0:P[1],N=L.textContent.trim();c&&(selectCustomOption(y,c,N,"exact"),console.log(`Auto-selected variable: ${I}`));break}}const T=document.getElementById(`${y}-select-all`);T&&!T.checked&&(T.checked=!0,toggleAllOccurrences(y))}},100)}window.pendingFixIssueId=null},300))}function setupIssueListeners(e){const t=document.getElementById(`${e}-var-select`);t&&t.addEventListener("change",n=>{n.target.value==="create-new"?handleCreateNewVariable(e):updateIssueApplyButtonState(e)})}window.loadMoreIssues=function(e,t){if(!window.remainingIssuesRaw||!window.remainingIssuesRaw[e])return;const n=document.getElementById(`coverage-${e}-issues-container`),s=document.getElementById(`coverage-${e}-load-more`),o=20,i=window.remainingIssuesRaw[e],a=i.slice(0,o),l=i.slice(o);window.remainingIssuesRaw[e]=l;const r=document.createElement("div");for(a.forEach((d,p)=>{const u=t+p;r.innerHTML+=window.renderIssueCard(d,p,u)});r.firstChild;){const d=r.firstChild;if(r.removeChild(d),d.nodeType!==1){n.appendChild(d);continue}n.appendChild(d);const p=new RegExp(`id="(issue-${e}-\\d+)-var-select"`),u=d.innerHTML.match(p)}a.forEach((d,p)=>{const u=t+p;setupIssueListeners(`issue-${e}-${u}`)}),l.length>0?s.innerHTML=`
             <button onclick="loadMoreIssues('${e}', ${t+o})" class="btn-secondary" style="width: 100%; font-size: 12px; padding: 8px;">
               Load ${l.length} more issues
             </button>
          `:s.remove()},window.handleCreateNewVariable=function(e){var o,i,a,l;console.log("handleCreateNewVariable triggered for:",e);let t=null;const n=document.getElementById(`${e}-card`);if(n)t=n;else{const r=document.getElementById(`${e}-var-select`);r?t=r.closest(".quality-issue-card"):t=(o=document.querySelector(`[data-issue-id="${e}"]`))==null?void 0:o.closest(".quality-issue-card")}let s=((i=t==null?void 0:t.querySelector(".issue-value-display"))==null?void 0:i.textContent)||((a=t==null?void 0:t.querySelector('div[style*="SF Mono"]'))==null?void 0:a.textContent)||((l=t==null?void 0:t.querySelector('div[style*="monospace"]'))==null?void 0:l.textContent);if(s&&(s=s.trim()),console.log("Found value to create:",s),!s){console.error("Could not find value display element"),alert("Error: Could not determine the value to create a variable for.");return}openCreateVariableModal(s,e)},window.openCreateVariableModal=function(e,t){const n=document.getElementById("create-variable-modal");if(!n)return;document.getElementById("create-var-value-display").textContent=e,document.getElementById("create-var-issue-id").value=t,document.getElementById("create-var-name").value="";const s=document.getElementById("create-var-new-collection");s&&(s.style.display="none");const o=document.getElementById("create-var-new-group");o&&(o.style.display="none");const i=document.getElementById("create-var-collection");if(i){i.innerHTML="";const a=window.globalVariablesData||[];a.forEach(r=>{const d=document.createElement("option");d.value=r.name,d.text=r.name,i.appendChild(d)});const l=document.createElement("option");l.value="create-new",l.text="Create New Collection...",i.appendChild(l),a.length>0&&(i.selectedIndex=0),handleCollectionChange()}n.style.display="block",document.body.classList.add("modal-open"),setTimeout(()=>{i&&i.value==="create-new"?document.getElementById("create-var-new-collection").focus():document.getElementById("create-var-name").focus()},100)},window.handleCollectionChange=function(){const e=document.getElementById("create-var-collection"),t=document.getElementById("create-var-group"),n=document.getElementById("create-var-new-collection");if(!e||!t)return;const s=e.value;if(s==="create-new"){n.style.display="block",n.focus(),t.innerHTML='<option value="">(No Group)</option><option value="create-new">Create New Group...</option>';return}else n.style.display="none";t.innerHTML="",t.appendChild(new Option("(No Group)",""));const i=(window.globalVariablesData||[]).find(a=>a.name===s);if(i&&i.variables){const a=new Set;i.variables.forEach(l=>{if(l.name.includes("/")){const r=l.name.split("/");r.pop();const d=r.join("/");a.add(d)}}),Array.from(a).sort().forEach(l=>{t.appendChild(new Option(l,l))})}t.appendChild(new Option("Create New Group...","create-new")),handleGroupChange()},window.handleGroupChange=function(){const e=document.getElementById("create-var-group"),t=document.getElementById("create-var-new-group");e.value==="create-new"?(t.style.display="block",t.focus()):t.style.display="none"},window.closeCreateVariableModal=function(){const e=document.getElementById("create-variable-modal");e&&(e.style.display="none",document.body.classList.remove("modal-open"));const t=document.getElementById("create-var-issue-id").value;if(t){const n=document.getElementById(`${t}-var-select`);n&&n.value==="create-new"&&(n.value="")}},window.submitCreateVariable=function(){const e=document.getElementById("create-var-name").value.trim(),t=document.getElementById("create-var-value-display").textContent.trim(),n=document.getElementById("create-var-issue-id").value;let o=document.getElementById("create-var-collection").value;if(o==="create-new"&&(o=document.getElementById("create-var-new-collection").value.trim(),!o)){alert("Please enter a name for the new collection.");return}let a=document.getElementById("create-var-group").value;if(a==="create-new"&&(a=document.getElementById("create-var-new-group").value.trim(),!a)){alert("Please enter a name for the new group.");return}if(!e){alert("Please enter a variable name.");return}if(e.includes(".")){alert("Variable names cannot contain dots (.). Please use hyphens (-) or slashes (/) instead.");const u=document.getElementById("create-var-name");u&&(u.value=e.replace(/\./g,"-"),u.focus());return}let l=e;a&&(l=`${a}/${e}`),console.log("Creating variable:",{fullVariableName:l,value:t,collectionName:o}),window.pendingFixIssueId=n;const r=n.split("-");let d="";r.length>=3&&(d=r.slice(1,r.length-1).join("-")),window.pendingFixContext={category:d,value:t,originalId:n,fullVariableName:l},parent.postMessage({pluginMessage:{type:"create-variable",name:l,value:t,collectionName:o,context:{issueId:n}}},"*");const p=document.getElementById(`${n}-var-select`);if(p){const u=document.createElement("option");u.text=`Creating ${l}...`,u.value="creating",p.add(u),p.value="creating",p.disabled=!0}closeCreateVariableModal()},window.updateTailwindActionButtonsState=function(e,t){const n=document.getElementById(`${e}-namespace-select`),s=document.getElementById(`${e}-add-prefix-btn`),o=document.getElementById(`${e}-replace-btn`),i=n&&n.value;s&&(i?(s.disabled=!1,s.style.opacity="1",s.style.pointerEvents="auto"):(s.disabled=!0,s.style.opacity="0.5",s.style.pointerEvents="none")),o&&(i?(o.disabled=!1,o.style.opacity="1",o.style.pointerEvents="auto"):(o.disabled=!0,o.style.opacity="0.5",o.style.pointerEvents="none"))},window.applyTailwindNamespace=function(e,t,n,s,o){const i=document.getElementById(`${t}-namespace-select`);if(!i||!i.value){alert("Please select a namespace first.");return}const a=i.value,l=o||i.dataset.variableId||null,r=l!==null;let d="",p="",u="";if(r?(p=e,u=`${a}/${e}`,d=`This will add the "${a}" namespace to this variable.

"${p}" \u2192 "${u}"

Continue?`):s==="add-prefix"?(p=`${e}/primary`,u=`${a}/${e}/primary`,d=`This will add "${a}" as an additional prefix to all variables in the "${e}" group.

Example: "${p}" \u2192 "${u}"

This action will affect ${n} variable(s).

Continue?`):(p=`${e}/primary`,u=`${a}/primary`,d=`This will replace the "${e}" group with the "${a}" namespace.

Example: "${p}" \u2192 "${u}"

This action will affect ${n} variable(s).

Continue?`),!confirm(d))return;window.tailwindScrollPosition=window.scrollY||document.documentElement.scrollTop,window.tailwindFixInProgress=!0,window.tailwindFixedGroupName=e;const g=document.getElementById(`${t}-card`);if(g){const b=g.closest(".quality-collection");if(b){const S=b.querySelector(".collection-content"),x=b.querySelector(".collection-header");S&&S.classList.contains("collapsed")&&S.classList.remove("collapsed"),x&&x.classList.contains("collapsed")&&x.classList.remove("collapsed"),window.tailwindActiveCollectionId=b.id}}window.tailwindProcessingItemId=t;const f=document.getElementById(`${t}-add-prefix-btn`),w=document.getElementById(`${t}-replace-btn`);f&&(f.disabled=!0,f.style.opacity="0.5",f.style.pointerEvents="none",(s==="add-prefix"||r)&&(f.innerHTML='<span class="material-symbols-outlined" style="font-size: 14px; vertical-align: middle;">hourglass_empty</span> Processing...')),w&&(w.disabled=!0,w.style.opacity="0.5",w.style.pointerEvents="none",s==="replace"&&(w.innerHTML='<span class="material-symbols-outlined" style="font-size: 14px; vertical-align: middle;">hourglass_empty</span> Processing...'));const y={type:"rename-variable-group",oldGroupName:e,newGroupName:a,action:s};l&&(y.variableId=l),parent.postMessage({pluginMessage:y},"*"),window.lastActiveTailwindGroup=e};function expandAllQuality(){console.log("Expanding all quality groups"),document.querySelectorAll(".quality-collection .collection-header.collapsed").forEach(t=>{const n=t.closest(".quality-collection");n&&n.id&&toggleCollection(n.id)})}function collapseAllQuality(){console.log("Collapsing all quality groups"),document.querySelectorAll(".quality-collection .collection-header:not(.collapsed)").forEach(t=>{const n=t.closest(".quality-collection");n&&n.id&&toggleCollection(n.id)})}function openUserGuide(){document.getElementById("user-guide-modal").style.display="block",document.body.classList.add("modal-open")}function closeUserGuide(){document.getElementById("user-guide-modal").style.display="none",document.body.classList.remove("modal-open")}function openGitHubFeedback(e){const t="1.0.0",n="Figma Desktop";let s="",o="feedback",i="";switch(e){case"bug":s="[BUG] ",o="bug,feedback",i=`- [x] Bug Report
- [ ] Feature Request
- [ ] Improvement Suggestion
- [ ] General Feedback`;break;case"feature":s="[FEATURE REQUEST] ",o="enhancement,feedback",i=`- [ ] Bug Report
- [x] Feature Request
- [ ] Improvement Suggestion
- [ ] General Feedback`;break;case"general":s="[FEEDBACK] ",o="feedback",i=`- [ ] Bug Report
- [ ] Feature Request
- [ ] Improvement Suggestion
- [x] General Feedback`;break}const a=encodeURIComponent(`## Feedback Type
<!-- Please select one -->
${i}

## Your Feedback
<!-- Please describe your feedback in detail -->


## Context
<!-- Optional: What were you trying to do when you thought of this feedback? -->


## Additional Information
<!-- Optional: Any mockups, examples, or additional context -->


---
*Plugin Version:* ${t}
*Figma Version:* ${n}`),r=`https://github.com/laurinscheuber/Bridgy-Plugin/issues/new?title=${encodeURIComponent(s)}&body=${a}&labels=${o}`;window.open(r,"_blank");let d="";switch(e){case"bug":d="Opening GitHub to report a bug...";break;case"feature":d="Opening GitHub to request a feature...";break;case"general":d="Opening GitHub to share your feedback...";break}showNotification("info","Feedback",d,3e3)}function showResetConfirmation(){document.getElementById("reset-confirmation-modal").style.display="block",document.body.classList.add("modal-open")}function closeResetConfirmation(){document.getElementById("reset-confirmation-modal").style.display="none",document.body.classList.remove("modal-open")}function confirmReset(){window.gitlabSettings=null,updateRepositoryLink(),parent.postMessage({pluginMessage:{type:"reset-gitlab-settings"}},"*"),document.getElementById("config-project-id").value="",document.getElementById("config-file-path").value="src/variables.css",document.getElementById("config-export-format").value="css",document.getElementById("config-test-file-path").value="components/{componentName}/{componentName}.spec.ts",document.getElementById("config-token").value="",document.getElementById("config-strategy").value="merge-request",document.getElementById("config-branch").value="feature/variables",document.getElementById("config-test-branch").value="feature/component-tests",document.getElementById("config-save-token").checked=!0,document.getElementById("config-share-team").checked=!0,document.getElementById("config-metadata").style.display="none",closeResetConfirmation(),closeSettingsModal(),showSuccess("Configuration Reset","Configuration has been reset successfully!")}function checkAndShowUserGuide(){(!window.gitlabSettings||!window.gitlabSettings.projectId)&&setTimeout(()=>{openUserGuide()},500)}function selectProvider(e){const t=document.getElementById("config-provider");t&&(t.value=e),document.querySelectorAll(".provider-card").forEach(a=>a.classList.remove("selected"));const n=document.getElementById(`card-${e}`);n&&n.classList.add("selected");const s=document.getElementById("section-connection"),o=document.getElementById("section-structure");s&&s.classList.remove("hidden-section"),o&&o.classList.remove("hidden-section");const i=document.getElementById("settings-accordion");i&&(i.querySelector(".accordion-item.expanded")||toggleAccordion("section-connection")),onProviderChange()}window.selectProvider=selectProvider;function toggleAccordion(e){const t=document.getElementById(e);t&&(t.classList.contains("expanded")?t.classList.remove("expanded"):t.classList.add("expanded"))}window.toggleAccordion=toggleAccordion;function onProviderChange(){const e=document.getElementById("config-provider"),t=e?e.value:"gitlab",n=document.getElementById("gitlab-url-group"),s=document.getElementById("github-url-group"),o=document.getElementById("project-id-label"),i=document.getElementById("project-id-help"),a=document.getElementById("browse-repos-button"),l=document.getElementById("config-project-id"),r=document.getElementById("browse-branches-button"),d=document.getElementById("oauth-login-button"),p=document.getElementById("oauth-status"),u=document.getElementById("token-label"),g=document.getElementById("token-help"),f=document.getElementById("config-token");t==="gitlab"?(n&&(n.style.display="block"),s&&(s.style.display="none"),o&&(o.textContent="Project ID"),l&&(l.placeholder="e.g. 24267 or namespace/project"),a&&(a.style.display="none"),r&&(r.style.display="block"),r&&(r.style.display="none"),d&&(d.style.display="none"),p&&(p.style.display="none"),u&&(u.textContent="Project Access Token"),f&&(f.placeholder="Enter your GitLab private token")):(n&&(n.style.display="none"),s&&(s.style.display="block"),o&&(o.textContent="Repository"),l&&(l.placeholder="e.g. owner/repository"),a&&(a.style.display="block"),r&&(r.style.display="block"),u&&(u.textContent="GitHub Access Token"),f&&(f.placeholder="Enter your GitHub token"),typeof checkOAuthAvailability=="function"&&checkOAuthAvailability())}let cachedRepositories=[];function browseRepositories(){const e=document.getElementById("config-token").value.trim(),t=document.getElementById("config-provider").value;if(!e){showError("Validation Error","Please enter your access token first");return}document.getElementById("repository-browser-modal").style.display="block",document.body.classList.add("modal-open"),loadRepositories(t,e)}function closeRepositoryBrowser(){document.getElementById("repository-browser-modal").style.display="none",document.body.classList.remove("modal-open")}function loadRepositories(e,t){return j(this,null,function*(){const n=document.getElementById("repo-list-container");n.innerHTML=`
          <div class="content-loading">
            <div class="content-loading-spinner"></div>
            <div class="content-loading-text">Loading repositories...</div>
          </div>
        `,parent.postMessage({pluginMessage:{type:"list-repositories",provider:e,token:t}},"*")})}function displayRepositories(e){cachedRepositories=e;const t=document.getElementById("repo-list-container");if(!e||e.length===0){t.innerHTML=`
            <div style="text-align: center; padding: 20px; color: rgba(255, 255, 255, 0.6);">
              No repositories found
            </div>
          `;return}let n='<div style="display: flex; flex-direction: column; gap: 8px;">';e.forEach(s=>{const o=s.updatedAt?new Date(s.updatedAt).toLocaleDateString():"",i=s.stargazers_count||0,a=s.language||"";n+=`
            <div 
              class="repository-item" 
              onclick="selectRepository('${s.fullName||s.name}')"
              style="
                padding: 12px;
                background: rgba(255, 255, 255, 0.05);
                border: 1px solid rgba(255, 255, 255, 0.1);
                border-radius: 8px;
                cursor: pointer;
                transition: all 0.2s ease;
              "
              onmouseover="this.style.background='rgba(139, 92, 246, 0.2)'; this.style.borderColor='rgba(139, 92, 246, 0.3)';"
              onmouseout="this.style.background='rgba(255, 255, 255, 0.05)'; this.style.borderColor='rgba(255, 255, 255, 0.1)';"
            >
              <div style="display: flex; justify-content: space-between; align-items: start;">
                <div style="flex: 1;">
                  <div style="font-weight: 500; color: #c4b5fd; margin-bottom: 4px;">
                    ${s.fullName||s.name}
                  </div>
                  ${s.description?`
                    <div style="font-size: 12px; color: rgba(255, 255, 255, 0.6); margin-bottom: 6px; line-height: 1.3;">
                      ${SecurityUtils.escapeHTML(s.description.substring(0,100))}${s.description.length>100?"...":""}
                    </div>
                  `:""}
                  <div style="display: flex; gap: 12px; align-items: center; font-size: 11px; color: rgba(255, 255, 255, 0.5);">
                    <span>${s.private?"\u{1F512} Private":"\u{1F310} Public"}</span>
                    ${a?`<span>\u{1F4DD} ${a}</span>`:""}
                    ${i>0?`<span>\u2B50 ${i}</span>`:""}
                    ${o?`<span>\u{1F4C5} ${o}</span>`:""}
                  </div>
                </div>
                <div style="margin-left: 8px;">
                  <button 
                    onclick="event.stopPropagation(); showRepositoryDetails('${s.fullName||s.name}')"
                    style="padding: 4px 8px; font-size: 10px; background: rgba(139, 92, 246, 0.2); border: 1px solid rgba(139, 92, 246, 0.3); color: #c4b5fd; cursor: pointer; border-radius: 4px;"
                    title="View repository details"
                  >
                    Details
                  </button>
                </div>
              </div>
            </div>
          `}),n+="</div>",t.innerHTML=n}function filterRepositories(){const e=document.getElementById("repo-search").value.toLowerCase(),t=cachedRepositories.filter(n=>{const s=(n.fullName||n.name).toLowerCase(),o=(n.description||"").toLowerCase();return s.includes(e)||o.includes(e)});displayRepositories(t)}function selectRepository(e){document.getElementById("config-project-id").value=e,closeRepositoryBrowser()}function showRepositoryDetails(e){const t=cachedRepositories.find(a=>(a.fullName||a.name)===e);if(!t)return;const n=t.topics&&t.topics.length>0?t.topics.map(a=>`<span style="background: rgba(139, 92, 246, 0.2); color: #c4b5fd; padding: 2px 6px; border-radius: 3px; font-size: 10px;">${a}</span>`).join(" "):"None",s=t.createdAt?new Date(t.createdAt).toLocaleDateString():"Unknown",o=t.updatedAt?new Date(t.updatedAt).toLocaleDateString():"Unknown",i=`
          <div style="font-family: monospace;">
            <h4 style="margin: 0 0 16px 0; color: #c4b5fd;">${t.fullName||t.name}</h4>
            
            <div style="margin-bottom: 12px;">
              <strong>Description:</strong><br>
              <span style="color: rgba(255, 255, 255, 0.8);">${t.description||"No description available"}</span>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 12px;">
              <div>
                <strong>Language:</strong><br>
                <span style="color: rgba(255, 255, 255, 0.8);">${t.language||"Not specified"}</span>
              </div>
              <div>
                <strong>Visibility:</strong><br>
                <span style="color: rgba(255, 255, 255, 0.8);">${t.private?"\u{1F512} Private":"\u{1F310} Public"}</span>
              </div>
              <div>
                <strong>Stars:</strong><br>
                <span style="color: rgba(255, 255, 255, 0.8);">\u2B50 ${t.stargazers_count||0}</span>
              </div>
              <div>
                <strong>Forks:</strong><br>
                <span style="color: rgba(255, 255, 255, 0.8);">\u{1F374} ${t.forks_count||0}</span>
              </div>
              <div>
                <strong>Created:</strong><br>
                <span style="color: rgba(255, 255, 255, 0.8);">${s}</span>
              </div>
              <div>
                <strong>Last Update:</strong><br>
                <span style="color: rgba(255, 255, 255, 0.8);">${o}</span>
              </div>
            </div>
            
            <div style="margin-bottom: 12px;">
              <strong>Topics:</strong><br>
              <div style="margin-top: 4px;">${n}</div>
            </div>
            
            <div style="margin-bottom: 16px;">
              <strong>Default Branch:</strong><br>
              <span style="color: rgba(255, 255, 255, 0.8); font-family: monospace; background: rgba(255, 255, 255, 0.1); padding: 2px 6px; border-radius: 3px;">${t.defaultBranch}</span>
            </div>
            
            <div style="display: flex; gap: 8px;">
              <button onclick="window.open('${t.webUrl}', '_blank')" 
                      style="padding: 8px 12px; background: rgba(34, 197, 94, 0.2); border: 1px solid rgba(34, 197, 94, 0.3); color: #22c55e; cursor: pointer; border-radius: 6px;">
                Open on GitHub
              </button>
              <button onclick="selectRepository('${t.fullName||t.name}'); closeModal();" 
                      style="padding: 8px 12px; background: rgba(139, 92, 246, 0.2); border: 1px solid rgba(139, 92, 246, 0.3); color: #c4b5fd; cursor: pointer; border-radius: 6px;">
                Select Repository
              </button>
            </div>
          </div>
        `;showModal("Repository Details",i)}function showModal(e,t){const n=document.getElementById("temp-modal");n&&n.remove();const s=document.createElement("div");s.id="temp-modal",s.className="modal",s.style.display="block",s.innerHTML=`
          <div class="modal-content" style="max-width: 600px;">
            <button class="close-modal" onclick="closeModal()">&times;</button>
            <div class="modal-header">
              <h3>${e}</h3>
            </div>
            <div class="modal-body">
              ${t}
            </div>
          </div>
        `,document.body.appendChild(s),document.body.classList.add("modal-open")}function closeModal(){const e=document.getElementById("temp-modal");e&&(e.remove(),document.body.classList.remove("modal-open"))}let cachedBranches=[];function browseBranches(){const e=document.getElementById("config-provider").value,t=document.getElementById("config-token").value.trim(),n=document.getElementById("config-project-id").value.trim();if(!t){showError("Validation Error","Please enter your access token first");return}if(!n){showError("Validation Error","Please select a repository first");return}document.getElementById("branch-browser-modal").style.display="block",document.body.classList.add("modal-open"),loadBranches(e,t,n)}function closeBranchBrowser(){document.getElementById("branch-browser-modal").style.display="none",document.body.classList.remove("modal-open")}function loadBranches(e,t,n){return j(this,null,function*(){const s=document.getElementById("branch-list-container");s.innerHTML=`
          <div class="content-loading">
            <div class="content-loading-spinner"></div>
            <div class="content-loading-text">Loading branches...</div>
          </div>
        `,parent.postMessage({pluginMessage:{type:"list-branches",provider:e,token:t,projectId:n}},"*")})}function displayBranches(e){cachedBranches=e;const t=document.getElementById("branch-list-container");if(!e||e.length===0){t.innerHTML=`
            <div style="text-align: center; padding: 20px; color: rgba(255, 255, 255, 0.6);">
              No branches found
            </div>
          `;return}let n='<div style="display: flex; flex-direction: column; gap: 6px;">';[...e].sort((o,i)=>o.isDefault&&!i.isDefault?-1:!o.isDefault&&i.isDefault?1:o.name.localeCompare(i.name)).forEach(o=>{const i=o.isDefault;n+=`
            <div 
              class="branch-item" 
              onclick="selectBranch('${o.name}')"
              style="
                padding: 10px 12px;
                background: ${i?"rgba(34, 197, 94, 0.1)":"rgba(255, 255, 255, 0.05)"};
                border: 1px solid ${i?"rgba(34, 197, 94, 0.3)":"rgba(255, 255, 255, 0.1)"};
                border-radius: 6px;
                cursor: pointer;
                transition: all 0.2s ease;
                display: flex;
                justify-content: space-between;
                align-items: center;
              "
              onmouseover="this.style.background='rgba(139, 92, 246, 0.2)'; this.style.borderColor='rgba(139, 92, 246, 0.3)';"
              onmouseout="this.style.background='${i?"rgba(34, 197, 94, 0.1)":"rgba(255, 255, 255, 0.05)"}'; this.style.borderColor='${i?"rgba(34, 197, 94, 0.3)":"rgba(255, 255, 255, 0.1)"}';"
            >
              <span style="font-weight: ${i?"500":"normal"}; color: ${i?"#22c55e":"#c4b5fd"};">
                ${o.name}
              </span>
              ${i?'<span style="font-size: 10px; background: rgba(34, 197, 94, 0.2); color: #22c55e; padding: 2px 6px; border-radius: 3px;">DEFAULT</span>':""}
            </div>
          `}),n+="</div>",t.innerHTML=n}function filterBranches(){const e=document.getElementById("branch-search").value.toLowerCase(),t=cachedBranches.filter(n=>n.name.toLowerCase().includes(e));displayBranches(t)}function selectBranch(e){document.getElementById("config-branch").value=e,closeBranchBrowser()}function checkOAuthAvailability(){parent.postMessage({pluginMessage:{type:"check-oauth-status"}},"*")}function displayOAuthStatus(e){const t=document.getElementById("oauth-login-button"),n=document.getElementById("oauth-status"),s=document.getElementById("token-help");!t||!n||!s||(t.style.display="none",n.style.display="none",s.innerHTML="Create a Personal Access Token in your provider settings (GitHub or GitLab)")}function handleOAuthCallback(e){if(e.success&&e.accessToken){const t=document.getElementById("config-token");t&&(t.value=e.accessToken),showNotification("success","OAuth Success","Successfully authenticated with GitHub!",4e3),e.accessToken&&setTimeout(()=>{browseRepositories()},1e3)}else showError("OAuth Error",e.error||"OAuth authentication failed")}function persistSettings(e=!1){try{const t=document.getElementById("config-provider").value,n=t==="gitlab"?document.getElementById("config-gitlab-url"):document.getElementById("config-github-url"),s=document.getElementById("config-project-id"),o=document.getElementById("config-file-path"),i=document.getElementById("config-export-format"),a=document.getElementById("config-test-file-path"),l=document.getElementById("config-token");if(!n||!s||!o||!i||!a||!l)throw new Error("Configuration form elements not found");let r=n.value.trim();r&&!r.startsWith("http://")&&!r.startsWith("https://")&&(r="https://"+r,n.value=r);const d=s.value.trim(),p=o.value.trim()||"src/variables.css",u=i.value,g=a.value.trim()||"components/{componentName}/{componentName}.spec.ts",f=l.value.trim(),w=document.getElementById("config-strategy"),y=document.getElementById("config-branch"),b=document.getElementById("config-test-branch"),S=document.getElementById("config-save-token"),x=document.getElementById("config-share-team");if(!w||!y||!b||!S||!x)throw new Error("Configuration form elements not found");const k=w.value,C=y.value.trim()||"feature/variables",M=b.value.trim()||"feature/component-tests",P=S.checked,I=x.checked;if(!d){e||showError("Validation Error","Please provide a Project ID");return}if(!f){e||showError("Validation Error","Please provide a Project Access Token");return}if(!/^(\d+|[a-zA-Z0-9_.-]+\/[a-zA-Z0-9_.-]+)$/.test(d)){e||showError("Validation Error","Invalid project ID format. Use numeric ID or namespace/project format.");return}if(f.length<8){e||showError("Validation Error","GitLab token must be at least 8 characters long.");return}if(/[\s"'<>]/.test(f)){e||showError("Validation Error","GitLab token contains invalid characters.");return}if(p.includes("..")||p.includes("\\")||p.startsWith("/")){e||showError("Validation Error","Invalid file path - path traversal detected");return}if(t==="gitlab"){if(r&&!SecurityUtils.isValidGitLabURL(r)){e||showError("Validation Error","Invalid GitLab URL. Must be HTTPS and contain 'gitlab' in the domain");return}}else if(r&&!r.includes("github")){e||showError("Validation Error","Invalid GitHub URL. Must contain 'github' in the domain");return}window.gitSettings={provider:t,baseUrl:r||"",projectId:d,filePath:p,exportFormat:u,testFilePath:g,token:f,strategy:k,branchName:C,testBranchName:M,saveToken:P,isPersonal:!I,savedAt:new Date().toISOString(),savedBy:"Current user"},window.gitlabSettings={gitlabUrl:r,projectId:d,filePath:p,exportFormat:u,testFilePath:g,gitlabToken:f,strategy:k,branchName:C,testBranchName:M,saveToken:P,isPersonal:!I,savedAt:new Date().toISOString(),savedBy:"Current user"},parent.postMessage({pluginMessage:{type:"save-git-settings",provider:t,baseUrl:r,projectId:d,filePath:p,exportFormat:u,testFilePath:g,token:f,strategy:k,branchName:C,testBranchName:M,saveToken:P,shareWithTeam:I}},"*"),displayConfigMetadata(),updateExportButtonText(),updateRepositoryLink(),console.log("[DEBUG] persistSettings: exportFormat set to:",u),e?(console.log("[DEBUG] Silent persist. Re-rendering variables..."),window.globalVariablesData&&renderVariables(window.globalVariablesData,window.stylesData||null)):(showSuccess("Settings Saved","Configuration saved successfully!",4e3),closeSettingsModal(),typeof window.refreshData=="function"&&window.refreshData(),typeof window.refreshStats=="function"&&window.refreshStats())}catch(t){console.error("Error saving configuration:",t),e||showError("Configuration Error",t.message||"An unexpected error occurred while saving the configuration.")}}function saveConfiguration(){persistSettings(!1)}function loadConfigurationTab(){try{const e=window.gitSettings||window.gitlabSettings;if(e){const t=e.provider||"gitlab",n={"config-project-id":e.projectId||"","config-file-path":e.filePath||"src/variables.css","config-export-format":e.exportFormat||"css","config-test-file-path":e.testFilePath||"components/{componentName}/{componentName}.spec.ts","config-token":e.token||e.gitlabToken||"","config-strategy":e.strategy||"merge-request","config-branch":e.branchName||"feature/variables","config-test-branch":e.testBranchName||"feature/component-tests"};if(t==="gitlab"){const a=document.getElementById("config-gitlab-url");a&&(a.value=e.baseUrl||e.gitlabUrl||"")}else{const a=document.getElementById("config-github-url");a&&(a.value=e.baseUrl||"")}for(const[a,l]of Object.entries(n)){const r=document.getElementById(a);r?r.value=l:console.warn(`Configuration element not found: ${a}`)}const s=document.getElementById("config-save-token"),o=document.getElementById("config-share-team");s&&(s.checked=window.gitlabSettings.hasOwnProperty("saveToken")?window.gitlabSettings.saveToken:!0),o&&(o.checked=window.gitlabSettings.hasOwnProperty("isPersonal")?!window.gitlabSettings.isPersonal:!0);const i=document.getElementById("config-strategy");if(i){const l=i.value==="merge-request"?"block":"none",r=document.getElementById("config-branch-section"),d=document.getElementById("config-test-branch-section");r&&(r.style.display=l),d&&(d.style.display=l)}displayConfigMetadata(),updateExportButtonText(),updateRepositoryLink(),setTimeout(()=>{selectProvider(t),e.token,toggleAccordion("section-connection")},100)}else{const t=document.getElementById("config-save-token"),n=document.getElementById("config-share-team");t&&(t.checked=!0),n&&(n.checked=!0)}}catch(e){console.error("Error loading configuration:",e),showError("Configuration Error","Failed to load configuration: "+(e.message||"Unknown error"))}}function displayConfigMetadata(){const e=document.getElementById("config-metadata"),t=document.getElementById("config-metadata-text");if(window.gitlabSettings&&(window.gitlabSettings.savedAt||window.gitlabSettings.savedBy)){e.style.display="block";let n="";if(window.gitlabSettings.savedAt){const s=new Date(window.gitlabSettings.savedAt),o=s.toLocaleDateString(),i=s.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});n+=`Last saved: ${o} at ${i}`}window.gitlabSettings.savedBy&&(n+=window.gitlabSettings.savedAt?` by ${window.gitlabSettings.savedBy}`:`Saved by: ${window.gitlabSettings.savedBy}`),window.gitlabSettings.isPersonal?n+=" (Personal settings)":n+=" (Shared with team)",t.textContent=n}else e.style.display="none"}function toggleGitLabCredentialsFields(){const e=document.getElementById("gitlab-credentials-fields"),t=document.getElementById("gitlab-credentials-summary"),n=document.getElementById("security-note-compact"),s=document.getElementById("security-note-full");if(e.style.display==="none")e.style.display="block",t.style.display="none",n.style.display="none",s.style.display="block";else{const o=document.getElementById("gitlab-project-id").value;o&&(e.style.display="none",t.style.display="block",n.style.display="block",s.style.display="none",document.getElementById("project-id-display").textContent=o)}}function openGitLabModal(){document.getElementById("gitlab-modal").style.display="block",document.body.classList.add("modal-open");const e=document.getElementById("gitlab-credentials-fields"),t=document.getElementById("gitlab-credentials-summary"),n=document.getElementById("security-note-compact"),s=document.getElementById("security-note-full");if(e&&(e.style.display="block"),t&&(t.style.display="none"),n&&(n.style.display="none"),s&&(s.style.display="block"),window.gitlabSettings){if(window.gitlabSettings.projectId){const o=document.getElementById("gitlab-project-id");o.value=window.gitlabSettings.projectId,document.getElementById("project-id-display").textContent=window.gitlabSettings.projectId}if(window.gitlabSettings.gitlabToken&&(document.getElementById("gitlab-token").value=window.gitlabSettings.gitlabToken,document.getElementById("save-token").checked=!0),window.gitlabSettings.branchName&&(document.getElementById("branch-name").value=window.gitlabSettings.branchName),window.gitlabSettings.isPersonal||(document.getElementById("share-with-team").checked=!0),window.gitlabSettings.savedBy&&window.gitlabSettings.savedAt){const o=new Date(window.gitlabSettings.savedAt),i=o.toLocaleDateString()+" "+o.toLocaleTimeString(),a=`Last updated by: <strong>${SecurityUtils.escapeHTML(window.gitlabSettings.savedBy)}</strong> on ${SecurityUtils.escapeHTML(i)}`;n.innerHTML=SecurityUtils.sanitizeHTML(a);const l=s.querySelector(".saved-info");l&&(l.innerHTML=SecurityUtils.sanitizeHTML(a))}window.gitlabSettings.projectId&&(e.style.display="none",t.style.display="block",n.style.display="block",s.style.display="none")}document.getElementById("settings-button").onclick=toggleGitLabCredentialsFields}function closeGitLabModal(){const e=document.getElementById("gitlab-modal");if(e){const t=e.querySelector(".success-message");t&&t.remove();const n=e.querySelector(".error-message");n&&n.remove();const s=e.querySelector(".modal-notification");s&&s.remove(),e.style.display="none",document.body.classList.remove("modal-open")}resetCommitButton()}function resetCommitButton(){const e=document.getElementById("commit-submit-button");e&&(e.textContent="Commit",e.disabled=!1,e.onclick=commitToGitLab)}function updateApplyButtonState(e){const t=document.getElementById("apply-fix-btn");t&&(e===0?(t.disabled=!0,t.textContent="Apply Fix to Selection"):(t.disabled=!1,t.textContent=`Apply Fix to ${e} items`))}function commitToGitLab(){const e=document.getElementById("commit-submit-button");try{if(!e){console.error("Commit button not found in DOM"),showError("Interface Error","Unable to find commit button. Please refresh the plugin.");return}e.disabled=!0,e.innerHTML=SecurityUtils.sanitizeHTML(`
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" style="margin-right: 8px; animation: spin 1s linear infinite;">
              <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" stroke-dasharray="31.416" stroke-dashoffset="31.416" opacity="0.3"/>
              <path d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z" fill="currentColor"/>
            </svg>
            Committing...
          `);const t=window.gitlabSettings||window.gitSettings;if(!t)throw new Error("Settings not configured. Please configure your settings in the Config tab first.");if(!t.projectId||!t.projectId.trim())throw new Error("Project/Repository ID is required. Please configure your settings.");const n=t.provider||"gitlab";let s=t.token;if(n==="gitlab"){if(s=t.gitlabToken||t.token,!s||!s.trim())throw new Error("GitLab token is required. Please configure your GitLab settings.")}else if(n==="github"&&(!s||!s.trim()))throw new Error("GitHub token is required. Please configure your GitHub settings.");const o=document.getElementById("commit-message");if(!o)throw new Error("Commit message field not found. Please refresh the plugin.");const i=o.value.trim();if(!i)throw new Error("Commit message is required. Please enter a descriptive commit message.");if(i.length>500)throw new Error("Commit message is too long. Please keep it under 500 characters.");const a=t.filePath||"src/variables.css";if(!a.trim())throw new Error("File path cannot be empty. Please configure a valid file path.");if(a.includes("..")||a.includes("\\")||a.startsWith("/"))throw new Error('Invalid file path. Path must be relative and cannot contain ".." or start with "/".')}catch(t){console.error("Validation error in commitToGitLab:",t),showModalError("gitlab-modal","Validation Error",t.message),resetCommitButton();return}try{const t=window.gitlabSettings||window.gitSettings,n=t.provider||"gitlab",s=t.projectId,o=t.token||t.gitlabToken,i=t.filePath||"src/variables.css",a=t.strategy||"merge-request",l=t.branchName||"feature/variables",r=document.getElementById("commit-message").value.trim()||"feat: update CSS variables",d=a==="merge-request";let p=r,u="Updated CSS variables from Figma",g=!0,f=!1;if(currentCSSData)try{parent.postMessage({pluginMessage:{type:"commit-to-repo",provider:window.gitlabSettings.provider||"gitlab",gitlabUrl:window.gitlabSettings.gitlabUrl,projectId:s,token:o,commitMessage:r,filePath:i,branchName:l,cssData:currentCSSData,createMergeRequest:d,mrTitle:p,mrDescription:u,mrRemoveSourceBranch:g,mrSquash:f}},"*")}catch(w){console.error("Error sending commit message to plugin:",w),showModalError("gitlab-modal","Communication Error","Failed to send commit request to plugin. Please try again."),resetCommitButton()}else try{const w=(t==null?void 0:t.exportFormat)||"css";parent.postMessage({pluginMessage:{type:"export-css",exportFormat:w}},"*");let y=0;const b=50,S=setInterval(()=>{if(y++,currentCSSData){clearInterval(S);try{parent.postMessage({pluginMessage:{type:"commit-to-repo",provider:n,gitlabUrl:t.gitlabUrl,projectId:s,token:o,gitlabToken:o,commitMessage:r,filePath:i,branchName:l,cssData:currentCSSData,createMergeRequest:d,mrTitle:p,mrDescription:u,mrRemoveSourceBranch:g,mrSquash:f}},"*")}catch(x){console.error("Error sending commit message to plugin:",x),showModalError("gitlab-modal","Communication Error","Failed to send commit request to plugin. Please try again."),resetCommitButton()}}else y>=b&&(clearInterval(S),showModalError("gitlab-modal","Generation Timeout","CSS generation timed out. Please try again."),resetCommitButton())},100)}catch(w){console.error("Error requesting CSS export:",w),showModalError("gitlab-modal","Export Error","Failed to request CSS export. Please try again."),resetCommitButton()}}catch(t){console.error("Error in commit process:",t),showModalError("gitlab-modal","Commit Error",t.message||"An unexpected error occurred during commit."),resetCommitButton()}}function loadUnitsSettings(){parent.postMessage({pluginMessage:{type:"get-unit-settings"}},"*")}function renderUnitsSettings(e){const t=document.getElementById("units-settings-container");if(!e||e.collections.length===0&&e.groups.length===0){t.innerHTML="";const s=document.createElement("div");s.className="no-items",s.textContent="No collections or groups found for unit configuration.",t.appendChild(s);return}let n=`
          <div class="units-section" style="background: rgba(34, 197, 94, 0.1); border: 1px solid rgba(34, 197, 94, 0.3); margin-bottom: 24px;">
            <h4 style="color: #22c55e; margin-bottom: 12px;">\u26A1 Settings Hierarchy</h4>
            <div style="color: rgba(255, 255, 255, 0.85); font-size: 13px; line-height: 1.5;">
              <strong>1. Group Settings</strong> (highest priority) \u2192 <strong>2. Collection Settings</strong> \u2192 <strong>3. Smart Defaults</strong> (fallback)
              <br><span style="color: rgba(255, 255, 255, 0.6);">More specific settings always override general ones</span>
            </div>
          </div>
        `;if(e.collections.length>0&&(n+=`
            <div class="units-section">
              <h4>Collections</h4>
              <p style="color: rgba(255, 255, 255, 0.8); font-size: 14px; margin-bottom: 16px;">Set default units for entire collections. These override global smart defaults for all variables in the collection.</p>
          `,e.collections.forEach(s=>{n+=`
              <div class="unit-setting-row">
                <div class="unit-setting-label">${s.name}</div>
                <div class="unit-setting-control">
                  <span class="default-unit-label" title="This unit will be used when 'Smart defaults' is selected">
                    Smart default: <strong>${s.defaultUnit}</strong>
                  </span>
                  <select class="unit-dropdown" data-type="collection" data-name="${s.name}">
                    ${AVAILABLE_UNITS.map(o=>`<option value="${o}" ${o===s.currentUnit?"selected":""}>${o===""?`Smart defaults (${s.defaultUnit})`:o}</option>`).join("")}
                  </select>
                </div>
              </div>
            `}),n+="</div>"),e.groups.length>0){n+=`
            <div class="units-section">
              <h4>Groups</h4>
              <p style="color: rgba(255, 255, 255, 0.8); font-size: 14px; margin-bottom: 16px;">Set specific units for variable groups. These have the highest priority and override both collection settings and smart defaults.</p>
          `;const s={};e.groups.forEach(o=>{s[o.collectionName]||(s[o.collectionName]=[]),s[o.collectionName].push(o)}),Object.keys(s).sort().forEach(o=>{n+=`
              <div class="units-group">
                <h5>${o}</h5>
            `,s[o].forEach(i=>{n+=`
                <div class="unit-setting-row">
                  <div class="unit-setting-label">${i.groupName}</div>
                  <div class="unit-setting-control">
                    <span class="default-unit-label" title="This unit will be used when 'Smart defaults' is selected">
                      Smart default: <strong>${i.defaultUnit}</strong>
                    </span>
                    <select class="unit-dropdown" data-type="group" data-collection="${i.collectionName}" data-group="${i.groupName}">
                      ${AVAILABLE_UNITS.map(a=>`<option value="${a}" ${a===i.currentUnit?"selected":""}>${a===""?`Smart defaults (${i.defaultUnit})`:a}</option>`).join("")}
                    </select>
                  </div>
                </div>
              `}),n+="</div>"}),n+="</div>"}n+=`
          <div class="units-section" style="background: rgba(139, 92, 246, 0.1); backdrop-filter: blur(10px); border: 1px solid rgba(139, 92, 246, 0.3);">
            <h4 style="color: white; margin-bottom: 16px;">\u{1F4CB} Smart Default Rules</h4>
            <p style="color: rgba(255, 255, 255, 0.85); font-size: 14px; margin-bottom: 16px;">
              When "Smart defaults" is selected, these rules determine the unit automatically based on variable names:
            </p>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 16px; margin-bottom: 16px;">
              <div>
                <h5 style="margin-bottom: 8px; color: #c4b5fd;">Typography</h5>
                <div style="font-family: monospace; font-size: 12px; line-height: 1.4;">
                  <div><code style="color: #fbbf24;">font-size</code> \u2192 <span style="color: #06d6a0;">rem</span></div>
                  <div><code style="color: #fbbf24;">text-*</code> \u2192 <span style="color: #06d6a0;">rem</span></div>
                  <div><code style="color: #fbbf24;">letter-spacing</code> \u2192 <span style="color: #06d6a0;">rem</span></div>
                  <div style="color: rgba(255, 255, 255, 0.6); font-size: 11px; margin-top: 4px;">Scalable with root font</div>
                </div>
              </div>
              
              <div>
                <h5 style="margin-bottom: 8px; color: #c4b5fd;">Spacing</h5>
                <div style="font-family: monospace; font-size: 12px; line-height: 1.4;">
                  <div><code style="color: #fbbf24;">margin</code> \u2192 <span style="color: #06d6a0;">rem</span></div>
                  <div><code style="color: #fbbf24;">padding</code> \u2192 <span style="color: #06d6a0;">rem</span></div>
                  <div><code style="color: #fbbf24;">gap</code> \u2192 <span style="color: #06d6a0;">rem</span></div>
                  <div><code style="color: #fbbf24;">space</code> \u2192 <span style="color: #06d6a0;">rem</span></div>
                  <div style="color: rgba(255, 255, 255, 0.6); font-size: 11px; margin-top: 4px;">Consistent with typography</div>
                </div>
              </div>

              <div>
                <h5 style="margin-bottom: 8px; color: #c4b5fd;">Unitless</h5>
                <div style="font-family: monospace; font-size: 12px; line-height: 1.4;">
                  <div><code style="color: #fbbf24;">opacity</code> \u2192 <span style="color: #22c55e;">none</span></div>
                  <div><code style="color: #fbbf24;">z-index</code> \u2192 <span style="color: #22c55e;">none</span></div>
                  <div><code style="color: #fbbf24;">line-height</code> \u2192 <span style="color: #22c55e;">none</span></div>
                  <div><code style="color: #fbbf24;">font-weight</code> \u2192 <span style="color: #22c55e;">none</span></div>
                  <div style="color: rgba(255, 255, 255, 0.6); font-size: 11px; margin-top: 4px;">No units needed</div>
                </div>
              </div>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 16px;">
              <div>
                <h5 style="margin-bottom: 8px; color: #c4b5fd;">Viewport</h5>
                <div style="font-family: monospace; font-size: 12px; line-height: 1.4;">
                  <div><code style="color: #fbbf24;">*-width</code> \u2192 <span style="color: #f59e0b;">vw</span></div>
                  <div><code style="color: #fbbf24;">*-height</code> \u2192 <span style="color: #f59e0b;">vh</span></div>
                  <div><code style="color: #fbbf24;">viewport</code> \u2192 <span style="color: #f59e0b;">vw/vh</span></div>
                  <div style="color: rgba(255, 255, 255, 0.6); font-size: 11px; margin-top: 4px;">Responsive to viewport</div>
                </div>
              </div>
              
              <div>
                <h5 style="margin-bottom: 8px; color: #c4b5fd;">Relative</h5>
                <div style="font-family: monospace; font-size: 12px; line-height: 1.4;">
                  <div><code style="color: #fbbf24;">container-*</code> \u2192 <span style="color: #ef4444;">%</span></div>
                  <div><code style="color: #fbbf24;">sidebar-*</code> \u2192 <span style="color: #ef4444;">%</span></div>
                  <div><code style="color: #fbbf24;">radius-pill</code> \u2192 <span style="color: #ef4444;">%</span></div>
                  <div style="color: rgba(255, 255, 255, 0.6); font-size: 11px; margin-top: 4px;">Relative to parent</div>
                </div>
              </div>

              <div>
                <h5 style="margin-bottom: 8px; color: #c4b5fd;">Default</h5>
                <div style="font-family: monospace; font-size: 12px; line-height: 1.4;">
                  <div><code style="color: #fbbf24;">border</code> \u2192 <span style="color: #a78bfa;">px</span></div>
                  <div><code style="color: #fbbf24;">shadow</code> \u2192 <span style="color: #a78bfa;">px</span></div>
                  <div><code style="color: #fbbf24;">everything else</code> \u2192 <span style="color: #a78bfa;">px</span></div>
                  <div style="color: rgba(255, 255, 255, 0.6); font-size: 11px; margin-top: 4px;">Precise control</div>
                </div>
              </div>
            </div>
            
            <div style="margin-top: 16px; padding: 12px; background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(5px); border-radius: 10px; border: 1px solid rgba(255, 255, 255, 0.1); font-size: 13px; color: rgba(255, 255, 255, 0.85); line-height: 1.6;">
              <strong style="color: #c4b5fd;">Real Examples:</strong><br>
              <code style="color: #fbbf24;">heading-font-size</code> \u2192 <span style="color: #06d6a0;">rem</span> (typography),
              <code style="color: #fbbf24;">section-padding</code> \u2192 <span style="color: #06d6a0;">rem</span> (spacing),<br>
              <code style="color: #fbbf24;">button-opacity</code> \u2192 <span style="color: #22c55e;">none</span> (unitless),
              <code style="color: #fbbf24;">hero-full-width</code> \u2192 <span style="color: #f59e0b;">vw</span> (viewport),<br>
              <code style="color: #fbbf24;">sidebar-width</code> \u2192 <span style="color: #ef4444;">%</span> (relative),
              <code style="color: #fbbf24;">border-width</code> \u2192 <span style="color: #a78bfa;">px</span> (default)
            </div>
          </div>
        `,t.innerHTML=SecurityUtils.sanitizeHTML(n),document.querySelectorAll(".unit-dropdown").forEach(s=>{s.addEventListener("change",function(){const o=document.getElementById("save-units-button"),i=document.getElementById("save-units-button-modal");o&&(o.disabled=!1),i&&(i.disabled=!1)})})}const commitRepoButton=document.getElementById("commit-repo-button");commitRepoButton&&commitRepoButton.addEventListener("click",openGitLabModal);const createMRElement=document.getElementById("create-merge-request");createMRElement&&createMRElement.addEventListener("change",function(){const e=document.getElementById("merge-request-options");if(e)if(this.checked){e.style.display="block";const t=document.getElementById("commit-message").value,n=document.getElementById("mr-title");t&&n&&(n.value=t)}else e.style.display="none"});const commitMessageElement=document.getElementById("commit-message");commitMessageElement&&commitMessageElement.addEventListener("input",function(){const e=document.getElementById("create-merge-request"),t=document.getElementById("mr-title");e&&e.checked&&t&&(t.value=this.value)});const configStrategyElement=document.getElementById("config-strategy");configStrategyElement&&configStrategyElement.addEventListener("change",function(){const e=document.getElementById("config-branch-section"),t=document.getElementById("config-test-branch-section");if(e&&t){const n=this.value==="merge-request"?"block":"none";e.style.display=n,t.style.display=n}});const configExportFormatElement=document.getElementById("config-export-format");configExportFormatElement&&configExportFormatElement.addEventListener("change",function(){typeof persistSettings=="function"&&persistSettings(!0),updateCommitButtonStates()}),window.toggleSubgroup=function(e){try{const t=document.getElementById(e+"-content");if(!t){console.log("Content element not found for groupId:",e);return}const n=t.parentElement,s=n?n.querySelector(".subgroup-header"):null;if(!s){console.log("Header element not found for groupId:",e);return}t.classList.contains("collapsed")?(t.classList.remove("collapsed"),t.classList.add("expanded"),s.classList.remove("collapsed")):(t.classList.remove("expanded"),t.classList.add("collapsed"),s.classList.add("collapsed"))}catch(t){console.error("Error toggling subgroup:",t)}},window.toggleCollection=function(e){try{const t=document.getElementById(e+"-content"),n=document.querySelector(`#${e} .collection-header`);if(!t||!n)return;t.classList.contains("collapsed")?(t.classList.remove("collapsed"),n.classList.remove("collapsed")):(t.classList.add("collapsed"),n.classList.add("collapsed"))}catch(t){console.error("Error toggling collection:",t)}},document.addEventListener("DOMContentLoaded",()=>{});function expandAllSubgroups(e){const t=document.getElementById(e);t&&(t.querySelectorAll(".subgroup-content").forEach(n=>{n.classList.remove("collapsed"),n.classList.add("expanded")}),t.querySelectorAll(".subgroup-header").forEach(n=>{n.classList.remove("collapsed")}))}function collapseAllSubgroups(e){const t=document.getElementById(e);t&&(t.querySelectorAll(".subgroup-content").forEach(n=>{n.classList.remove("expanded"),n.classList.add("collapsed")}),t.querySelectorAll(".subgroup-header").forEach(n=>{n.classList.add("collapsed")}))}function expandAllGroups(){try{document.querySelectorAll(".subgroup-content").forEach(e=>{e.classList.remove("collapsed"),e.classList.add("expanded")}),document.querySelectorAll(".subgroup-header").forEach(e=>{e.classList.remove("collapsed")}),console.log("Expanded all groups")}catch(e){console.error("Error expanding all groups:",e)}}function collapseAllGroups(){try{document.querySelectorAll(".subgroup-content").forEach(e=>{e.classList.remove("expanded"),e.classList.add("collapsed")}),document.querySelectorAll(".subgroup-header").forEach(e=>{e.classList.add("collapsed")}),console.log("Collapsed all groups")}catch(e){console.error("Error collapsing all groups:",e)}}function toggleVariablesList(e){try{const t=document.getElementById(`variables-list-${e}`),n=document.querySelector(`[onclick="toggleVariablesList('${e}')"]`);if(!t){console.warn(`Variables list with ID variables-list-${e} not found`);return}t.style.display==="none"||!t.style.display?(t.style.display="block",n&&(n.innerHTML="\u{1F53C} Hide Variables")):(t.style.display="none",n&&(n.innerHTML="\u{1F53D} Show Variables"))}catch(t){console.error(`Error toggling variables list ${e}:`,t)}}function startOAuthFlow(){return j(this,null,function*(){try{if(document.getElementById("config-provider").value!=="github"){showError("OAuth Error","OAuth authentication is only available for GitHub. Please use Personal Access Token for GitLab.");return}console.log("\u{1F680} Starting GitHub OAuth flow...");const t=document.getElementById("oauth-login-button"),n=document.getElementById("oauth-status");let s="";t&&(s=t.innerHTML,t.disabled=!0,t.innerHTML=`
              <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 4px; animation: spin 1s linear infinite;">
                <circle cx="12" cy="12" r="10" stroke-opacity="0.25"/>
                <path d="M12 2 A10 10 0 0 1 22 12" stroke-opacity="1"/>
              </svg>
              Connecting...
            `,t.style.cssText+="opacity: 0.7; cursor: wait;"),n&&(n.style.display="block",n.innerHTML=`
              <div style="
                color: #fbbf24;
                display: flex;
                align-items: center;
                gap: 6px;
                font-size: 12px;
                animation: pulse 2s ease-in-out infinite;
              ">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="10" stroke-opacity="0.25"/>
                  <path d="M12 2 A10 10 0 0 1 22 12" stroke-opacity="1" style="animation: spin 1s linear infinite;"/>
                </svg>
                Opening secure authentication window...
              </div>
            `);const o=yield startGitHubOAuthFlow();if(o.success&&o.token&&o.user){console.log("\u2705 OAuth flow completed successfully");const i=document.getElementById("config-token");i&&(i.value=o.token,i.style.borderColor="#22c55e",setTimeout(()=>{i.style.borderColor=""},2e3)),n&&(n.innerHTML=`
                <div style="
                  color: #22c55e;
                  display: flex;
                  align-items: center;
                  gap: 6px;
                  font-size: 12px;
                  animation: slideIn 0.3s ease-out;
                ">
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M20 6L9 17l-5-5"/>
                  </svg>
                  Connected as <strong>${o.user.login}</strong>
                </div>
              `),t&&(t.disabled=!1,t.innerHTML=`
                <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor" style="margin-right: 4px;">
                  <path d="M20 6L9 17l-5-5" stroke="currentColor" stroke-width="2" fill="none"/>
                </svg>
                Connected
              `,t.style.cssText+="background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%); opacity: 1;",setTimeout(()=>{t.innerHTML=s,t.style.cssText=""},3e3)),showSuccess("OAuth Success",`Successfully connected as ${o.user.login}! Your GitHub token has been added to the settings.`)}else{if(console.error("\u274C OAuth flow failed:",o.error),n){const i=o.errorType==="POPUP_BLOCKED"||o.errorType==="POPUP_FAILED"?`<button 
                    onclick="window.showPopupBlockerHelp()" 
                    style="
                      margin-left: 8px;
                      padding: 4px 8px;
                      background: rgba(139, 92, 246, 0.2);
                      border: 1px solid rgba(139, 92, 246, 0.3);
                      color: #c4b5fd;
                      border-radius: 4px;
                      font-size: 11px;
                      cursor: pointer;
                    "
                  >
                    Show Help
                  </button>`:"";n.innerHTML=`
                <div style="
                  color: #ef4444;
                  display: flex;
                  align-items: center;
                  gap: 6px;
                  font-size: 12px;
                ">
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"/>
                    <line x1="12" y1="8" x2="12" y2="12"/>
                    <line x1="12" y1="16" x2="12.01" y2="16"/>
                  </svg>
                  ${o.error}
                  ${i}
                </div>
              `}t&&(t.disabled=!1,t.innerHTML=s,t.style.cssText=""),o.showHelp||showError("OAuth Error",o.error||"Failed to authenticate with GitHub")}}catch(e){console.error("\u274C OAuth flow error:",e);const t=document.getElementById("oauth-status"),n=document.getElementById("oauth-login-button");t&&(t.innerHTML=`
              <div style="color: #ef4444; font-size: 12px;">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: inline; margin-right: 4px;">
                  <circle cx="12" cy="12" r="10"/>
                  <line x1="15" y1="9" x2="9" y2="15"/>
                  <line x1="9" y1="9" x2="15" y2="15"/>
                </svg>
                ${e.message}
              </div>
            `),n&&(n.disabled=!1,n.innerHTML=`
              <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor" style="margin-right: 4px;">
                <path d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0 0 24 12c0-6.63-5.37-12-12-12Z"/>
              </svg>
              OAuth
            `,n.style.cssText=""),showError("OAuth Error",e.message||"Failed to start OAuth flow")}})}function detectBrowser(){const e=navigator.userAgent.toLowerCase();return e.indexOf("edg")>-1?"edge":e.indexOf("chrome")>-1?"chrome":e.indexOf("safari")>-1?"safari":e.indexOf("firefox")>-1?"firefox":"other"}function detectPopupBlocker(){return j(this,null,function*(){return new Promise(e=>{try{const t=window.open("about:blank","test","width=1,height=1");if(!t||t.closed||typeof t.closed=="undefined"){e({blocked:!0,reason:"popup_blocked_by_browser"});return}setTimeout(()=>{try{t.close(),e({blocked:!1})}catch(n){e({blocked:!1})}},50)}catch(t){e({blocked:!1})}})})}function getPopupInstructions(e){const t={chrome:`
            <strong>\u{1F310} Chrome:</strong>
            <ol style="margin: 8px 0; padding-left: 20px; line-height: 1.6;">
              <li>Look for the popup blocked icon <strong>\u{1F6AB}</strong> in the address bar</li>
              <li>Click on it and select "Always allow popups from figma.com"</li>
              <li>Click "Done" and try the OAuth button again</li>
            </ol>
          `,firefox:`
            <strong>\u{1F98A} Firefox:</strong>
            <ol style="margin: 8px 0; padding-left: 20px; line-height: 1.6;">
              <li>Look for the preferences icon in the address bar</li>
              <li>Click "Show Blocked Pop-ups"</li>
              <li>Select "Allow pop-ups for figma.com"</li>
              <li>Try the OAuth button again</li>
            </ol>
          `,safari:`
            <strong>\u{1F9ED} Safari:</strong>
            <ol style="margin: 8px 0; padding-left: 20px; line-height: 1.6;">
              <li>Go to Safari \u2192 Preferences \u2192 Websites</li>
              <li>Select "Pop-up Windows" in the left sidebar</li>
              <li>Find figma.com and set it to "Allow"</li>
              <li>Try the OAuth button again</li>
            </ol>
          `,edge:`
            <strong>\u{1F30A} Edge:</strong>
            <ol style="margin: 8px 0; padding-left: 20px; line-height: 1.6;">
              <li>Look for the popup blocked icon in the address bar</li>
              <li>Click on it and select "Always allow"</li>
              <li>Try the OAuth button again</li>
            </ol>
          `,other:`
            <strong>General Instructions:</strong>
            <ol style="margin: 8px 0; padding-left: 20px; line-height: 1.6;">
              <li>Look for a popup blocked notification in your browser</li>
              <li>Add figma.com to your allowed sites</li>
              <li>Try the OAuth button again</li>
            </ol>
          `};return t[e]||t.other}function showPopupBlockerHelp(){const e=detectBrowser(),t=getPopupInstructions(e);showCustomModal("\u{1F513} Enable Popups for OAuth",`
            <div style="text-align: left; color: rgba(255, 255, 255, 0.9);">
              <p style="margin-bottom: 16px;">
                To use GitHub OAuth login, you need to allow popups for this site.
              </p>
              
              ${t}
              
              <div style="
                background: rgba(139, 92, 246, 0.1);
                border: 1px solid rgba(139, 92, 246, 0.3);
                border-radius: 8px;
                padding: 12px;
                margin-top: 16px;
              ">
                <strong style="color: #c4b5fd;">\u{1F4A1} Why popups?</strong><br>
                <span style="font-size: 13px; color: rgba(255, 255, 255, 0.8);">
                  OAuth requires a secure popup window for authentication. 
                  This is a one-time setup and improves security.
                </span>
              </div>

              <div style="
                background: rgba(34, 197, 94, 0.1);
                border: 1px solid rgba(34, 197, 94, 0.3);
                border-radius: 8px;
                padding: 12px;
                margin-top: 12px;
              ">
                <strong style="color: #22c55e;">\u2728 Alternative Options:</strong><br>
                <span style="font-size: 13px; color: rgba(255, 255, 255, 0.8); display: block; margin-bottom: 8px;">
                  1. Use a Personal Access Token instead of OAuth - just enter your GitHub token in the field above.
                </span>
                <span style="font-size: 13px; color: rgba(255, 255, 255, 0.8);">
                  2. Or open GitHub OAuth in a new tab manually.
                </span>
              </div>
            </div>
          `,[{text:"Try Again",primary:!0,action:()=>startOAuthFlow()},{text:"Open in Browser",action:()=>startOAuthFlow()},{text:"Close",action:()=>{}}])}function showCustomModal(e,t,n=[]){const s="custom-modal-"+Date.now(),o=document.createElement("div");o.id=s,o.className="modal",o.style.display="block",o.innerHTML=`
          <div class="modal-content" style="max-width: 550px;">
            <button class="close-modal" onclick="document.getElementById('${s}').remove()">\xD7</button>
            <div class="modal-header">
              <h3>${e}</h3>
            </div>
            <div class="modal-body">
              ${t}
            </div>
            <div class="modal-footer" style="display: flex; gap: 8px; justify-content: flex-end;">
              ${n.map((i,a)=>`
                <button 
                  id="${s}-btn-${a}"
                  class="${i.primary?"btn-primary":""}"
                  style="${i.primary?"background: #667eea;":""}"
                >
                  ${i.text}
                </button>
              `).join("")}
            </div>
          </div>
        `,document.body.appendChild(o),n.forEach((i,a)=>{const l=document.getElementById(`${s}-btn-${a}`);l&&(l.onclick=()=>{i.action&&i.action(),o.remove()})})}function startGitHubOAuthFlow(){return j(this,null,function*(){const e="Ov23liKXGtyeKaklFf0Q",t="https://bridgy-oauth.netlify.app/github/callback",n=["repo","read:user","user:email"];return new Promise(s=>j(null,null,function*(){try{console.log("\u{1F680} Starting GitHub OAuth flow...");const o=generateSecureState(),a=`https://github.com/login/oauth/authorize?${new URLSearchParams({client_id:e,redirect_uri:t,scope:n.join(" "),state:o,response_type:"code"}).toString()}`;console.log("\u{1F517} Opening OAuth in external browser:",a),parent.postMessage({pluginMessage:{type:"open-external",url:a}},"*"),showNotification("\u{1F310} GitHub OAuth opened in your browser. After authorization, copy the token from the callback page and paste it above.","info",12e3),s({success:!0,requiresManualCopy:!0,message:"OAuth opened in external browser. Please copy the token manually.",authUrl:a})}catch(o){console.error("\u{1F4A5} OAuth flow error:",o),s({success:!1,error:o.message||"An unexpected error occurred",errorType:"UNKNOWN_ERROR"})}}))})}function generateSecureState(){const e=new Uint8Array(32);return crypto.getRandomValues(e),Array.from(e,t=>{const n=t.toString(16);return n.length===1?"0"+n:n}).join("")}function initializeVariableImportTab(){const e=document.getElementById("variable-import-container");e&&(e.classList.contains("initialized")||(e.classList.add("initialized"),e.innerHTML=`
          <div class="variable-import-tab">
            <div class="variable-import-header">
              <h2>
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                </svg>
                Variable Import
              </h2>
              <p>Import design tokens from CSS, SCSS or JSON files and sync them with Figma Variables.</p>
            </div>

            <div class="import-section">
              <h3>Input Design Tokens</h3>
              <div class="input-tabs">
                <button class="input-tab active" data-input="manual">Manual Input</button>
                <button class="input-tab" data-input="file">File Upload</button>
              </div>
              
              <div class="input-content active" id="manual-input">
                <div class="input-format-selector">
                  <label>
                    <input type="radio" name="format" value="css" checked>
                    CSS Variables
                  </label>
                  <label>
                    <input type="radio" name="format" value="json">
                    JSON Tokens
                  </label>
                </div>
                <textarea 
                  id="token-input" 
                  placeholder=":root {\\n  --primary-500: #8b5cf6;\\n  --space-4: 1rem;\\n  --text-lg: 1.125rem;\\n}"
                ></textarea>
                <div class="input-actions">
                  <button class="btn btn-primary" onclick="parseTokenInput()">Parse Tokens</button>
                  <button class="btn btn-secondary" onclick="loadSampleData()">Load Sample</button>
                  <button class="btn btn-secondary" onclick="clearInput()">Clear</button>
                </div>
                <div id="parse-status" class="parse-status" style="display: none;"></div>
              </div>
              
              <!-- File Upload Input -->
              <div id="upload-input" class="input-content">
                <div class="file-upload-area" onclick="document.getElementById('file-picker').click()">
                  <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                    <polyline points="14,2 14,8 20,8"/>
                    <line x1="16" y1="13" x2="8" y2="13"/>
                    <line x1="16" y1="17" x2="8" y2="17"/>
                    <polyline points="10,9 9,9 8,9"/>
                  </svg>
                  <p>Click to select or drag & drop your token file</p>
                  <small>Supports .css, .scss, .json files</small>
                </div>
                <input type="file" id="file-picker" accept=".css,.json,.scss" style="display: none;" onchange="handleFileUpload(event)">
              </div>
            </div>

            <div id="preview-section" class="import-section" style="display: none;">
              <h3>Preview & Configure</h3>
              <div id="preview-content">
                <!-- Dynamic content will be inserted here -->
              </div>
            </div>

            <div id="import-section" class="import-section" style="display: none;">
              <h3>Import to Figma</h3>
              <div id="import-content">
                <!-- Dynamic content will be inserted here -->
              </div>
            </div>
          </div>
        `,e.querySelectorAll(".input-tab").forEach(t=>{t.addEventListener("click",()=>{e.querySelectorAll(".input-tab").forEach(s=>s.classList.remove("active")),e.querySelectorAll(".input-content").forEach(s=>s.classList.remove("active")),t.classList.add("active");const n=t.dataset.input+"-input";e.querySelector("#"+n).classList.add("active")})}),loadExistingCollections()))}window.parseTokenInput=function(){const e=document.getElementById("token-input"),t=document.querySelector('input[name="format"]:checked');if(!e||!e.value.trim()){showStatus("Please enter some tokens to parse","warning");return}showStatus("Parsing tokens...","info"),setTimeout(()=>{try{let n=[];t&&t.value==="css"?n=parseCSSTokens(e.value):n=parseJSONTokens(e.value);const s=resolveTokenDependencies(n);window.parsedTokens=s;const o=s.filter(r=>{const d=categorizeToken(r);return d==="color"||d==="numeric"}).length,i=s.filter(r=>{const d=categorizeToken(r);return["gradient","shadow","effect","transition"].includes(d)}).length,a=s.filter(r=>r.isAlias).length;let l=[`${n.length} tokens parsed`];o>0&&l.push(`${o} variables`),i>0&&l.push(`${i} styles`),a>0&&l.push(`${a} references`),showStatus(l.join(" \u2022 "),"success"),showPreview(s),setTimeout(()=>{const r=document.getElementById("preview-section");r&&r.scrollIntoView({behavior:"smooth",block:"start"})},100)}catch(n){console.error("Parse error:",n),showStatus(`Parse error: ${n.message}`,"error")}},200)},window.loadSampleData=function(){const e=`:root {
  /* Primary Colors */
  --primary-50: #f0f9ff;
  --primary-100: #e0e7ff;
  --primary-500: #8b5cf6;
  --primary-600: #7c3aed;
  
  /* Spacing */
  --space-1: 0.25rem;
  --space-2: 0.5rem;
  --space-4: 1rem;
  --space-8: 2rem;
  
  /* Typography */
  --text-sm: 0.875rem;
  --text-base: 1rem;
      --text-lg: 1.125rem;
}`;document.getElementById("token-input").value=e},window.clearInput=function(){const e=document.getElementById("token-input"),t=document.getElementById("import-input"),n=document.getElementById("parse-status"),s=document.getElementById("preview-section"),o=document.getElementById("import-section");e&&(e.value=""),t&&(t.value=""),n&&(n.style.display="none"),s&&(s.style.display="none"),o&&(o.style.display="none")},window.handleFileUpload=function(e){const t=e.target.files[0];window.processFile(t)},window.processFile=function(e){if(!e)return;const t=e.name.toLowerCase();if(!t.endsWith(".css")&&!t.endsWith(".json")&&!t.endsWith(".scss")){showStatus("Please upload a .css, .scss, or .json file","warning");return}const n=new FileReader;n.onload=function(s){const o=s.target.result,i=document.getElementById("token-input");if(i){if(i.value=o,t.endsWith(".json")){const l=document.querySelector('input[name="format"][value="json"]');l&&(l.checked=!0)}else{const l=document.querySelector('input[name="format"][value="css"]');l&&(l.checked=!0)}const a=document.querySelector('.input-tab[data-input="manual"]');a&&a.click(),parseTokenInput()}},n.readAsText(e)};function showStatus(e,t){const n=document.getElementById("parse-status");n.className=`parse-status ${t}`,n.textContent=e,n.style.display="block"}function extractVariableReferences(e){const t=[],n=/var\(\s*--([^,)]+)(?:\s*,\s*([^)]*))?\s*\)/g;let s;for(;(s=n.exec(e))!==null;)t.push(s[1].trim());return t}function resolveTokenDependencies(e){const t=new Map;e.forEach(a=>t.set(a.name,a));const n=new Set,s=new Set,o=[];function i(a){if(n.has(a))return;if(s.has(a)){console.warn("Circular dependency detected for token:",a);return}s.add(a);const l=t.get(a);if(l&&l.references)for(const r of l.references)t.has(r)&&i(r);s.delete(a),n.add(a),l&&o.push(l)}return e.forEach(a=>i(a.name)),o}function parseCSSTokens(e){const t=[],n=e.replace(/\/\*[\s\S]*?\*\//g,"").replace(/^\s*\/\/.*$/gm,"");let s=0;for(;s<n.length;){const o=n.indexOf("--",s);if(o===-1)break;if(o>0&&n[o-1]==="("){s=o+2;continue}const i=n.indexOf(":",o);if(i===-1){s=o+2;continue}const a=n.substring(o+2,i).trim();if(!a||a.includes(`
`)||a.includes("(")||a.includes(")")||a.includes("{")||a.includes("}")||a.includes(";")||a.length>100){s=i+1;continue}let l=i+1,r=l,d=!1,p=!1,u=0;for(;r<n.length;){const f=n[r],w=r>0?n[r-1]:"";if(f==='"'&&w!=="\\"?d=!d:f==="'"&&w!=="\\"&&(p=!p),!d&&!p&&(f==="("?u++:f===")"&&u--,f===";"&&u===0||f==="}"&&u===0))break;r++}const g=n.substring(l,r).trim();if(g){let f=a;const y=(a.startsWith("--")?a.substring(2):a).split("-");if(y.length>1){const S=y[0],x=y.slice(1).join("-");f=`${S}/${x}`}const b={name:f,value:g,type:detectTokenType(g,a),references:extractVariableReferences(g),isAlias:g.trim().startsWith("var(")&&g.trim().match(/^var\([^)]+\)$/)};t.push(b)}s=r+1}if(t.length===0)throw new Error("No valid CSS custom properties found. Make sure your input contains --variable-name: value; declarations.");return t}function parseJSONTokens(e){const t=[],n=JSON.parse(e);function s(o,i=[]){for(const[a,l]of Object.entries(o))if(typeof l=="object"&&l!==null)s(l,[...i,a]);else{const r=[...i,a].join("/");t.push({name:r,value:l.toString(),type:detectTokenType(l.toString(),r)})}}return s(n),t}function detectTokenType(e,t=""){const n=e.trim(),s=t.toLowerCase();return[/^\d+(\.\d+)?$/,/^\d+(\.\d+)?(px|rem|em|ch|ex|vh|vw|vmin|vmax|%|pt|pc|in|cm|mm)$/i,/^-?\d+(\.\d+)?$/,/^\d+(\.\d+)?e[+-]?\d+$/].some(p=>p.test(n))?"NUMBER":[/^#[0-9a-fA-F]{3}$/,/^#[0-9a-fA-F]{6}$/,/^#[0-9a-fA-F]{8}$/,/^rgb\s*\(/,/^rgba\s*\(/,/^hsl\s*\(/,/^hsla\s*\(/,/^var\(--[\w-]+\)$/].some(p=>p.test(n))||["color","bg","background","border","primary","secondary","accent","success","warning","error","danger","info"].some(p=>s.includes(p))?"COLOR":n.includes("linear-gradient")||n.includes("radial-gradient")||n.includes("conic-gradient")?"GRADIENT":n.includes("rgba(")||n.includes("hsla(")||n.includes("rgb(")&&n.includes(",")&&n.includes("/")?"RGBA_COLOR":n.match(/^\d+px\s+\d+px\s+\d+px/)||n.includes("inset")||n.match(/\d+px.*rgb/)?"SHADOW":n.includes("blur(")?"BLUR":n.includes("ease")||n.includes("cubic-bezier")||n.includes("linear")&&n.includes("s")?"TRANSITION":"STRING"}function categorizeToken(e){const t=e.name.toLowerCase(),n=e.value.toLowerCase();return e.type==="COLOR"||e.type==="RGBA_COLOR"?"color":e.type==="NUMBER"?"numeric":e.type==="GRADIENT"?"gradient":e.type==="SHADOW"?"shadow":e.type==="BLUR"?"effect":e.type==="TRANSITION"?"transition":"other"}function showPreview(e){const t=document.getElementById("preview-section"),n=document.getElementById("preview-content");function s(b){if(b.includes("/"))return b.split("/")[0];const x=(b.startsWith("--")?b.slice(2):b).split("-");return x.length>1?x[0]:"misc"}const o={},i=e.filter(b=>{const S=categorizeToken(b);return["color","numeric","gradient","shadow","effect","transition"].includes(S)}),a=i.filter(b=>{const S=categorizeToken(b);return S==="color"||S==="numeric"}),l=i.filter(b=>{const S=categorizeToken(b);return["gradient","shadow","effect","transition"].includes(S)});i.forEach(b=>{const S=s(b.name);o[S]||(o[S]=[]),o[S].push(b)});const r=Object.keys(o),d=i.length,p=a.filter(b=>b.isAlias).length,u=a.length-p,g=`
          <div class="diff-summary" style="padding: 16px; background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.06); border-radius: 10px; margin-bottom: 16px;">
            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 12px;">
              <span class="material-symbols-outlined" style="font-size: 18px; color: #4ade80;">check_circle</span>
              <h4 style="margin: 0; font-size: 13px; color: rgba(255,255,255,0.9);">${d} tokens ready to import</h4>
            </div>
            <div class="diff-stats" style="display: flex; gap: 12px;">
              <div style="display: flex; align-items: center; gap: 6px; padding: 6px 12px; background: rgba(34, 197, 94, 0.08); border: 1px solid rgba(34, 197, 94, 0.12); border-radius: 6px;">
                <span class="material-symbols-outlined" style="font-size: 16px; color: #4ade80;">data_object</span>
                <span style="font-size: 16px; font-weight: 700; color: #4ade80;">${a.length}</span>
                <span style="font-size: 11px; color: rgba(255,255,255,0.5);">Variables</span>
              </div>
              ${l.length>0?`
              <div style="display: flex; align-items: center; gap: 6px; padding: 6px 12px; background: rgba(168, 85, 247, 0.08); border: 1px solid rgba(168, 85, 247, 0.12); border-radius: 6px;">
                <span class="material-symbols-outlined" style="font-size: 16px; color: #c084fc;">palette</span>
                <span style="font-size: 16px; font-weight: 700; color: #c084fc;">${l.length}</span>
                <span style="font-size: 11px; color: rgba(255,255,255,0.5);">Styles</span>
              </div>`:""}
              ${p>0?`
              <div style="display: flex; align-items: center; gap: 6px; padding: 6px 12px; background: rgba(59, 130, 246, 0.08); border: 1px solid rgba(59, 130, 246, 0.12); border-radius: 6px;">
                <span class="material-symbols-outlined" style="font-size: 16px; color: #60a5fa;">link</span>
                <span style="font-size: 16px; font-weight: 700; color: #60a5fa;">${p}</span>
                <span style="font-size: 11px; color: rgba(255,255,255,0.5);">References</span>
              </div>`:""}
            </div>
          </div>

          <div class="import-structure-preview">
            <div class="tab-header" style="margin-bottom: var(--space-2);">
                <h3 style="color: rgba(255, 255, 255, 0.9); display: flex; align-items: center; gap: 10px; font-size: 1.2rem; margin: 0;">
                  <span class="material-symbols-outlined" style="font-size: 22px; color: var(--purple-light);">folder_open</span>
                  Variables Preview
                </h3>
            </div>
            
            <div class="toolbar" style="margin-bottom: 16px; background: rgba(0,0,0,0.2); padding: 8px; border-radius: var(--radius-md); display: flex; justify-content: space-between; align-items: center;">
              <!-- Left: Selection Actions -->
              <div style="display: flex; gap: 4px;">
                <button class="compact-action-btn" onclick="selectAllVariables(true)" data-tooltip="Select All" style="width: 32px; height: 32px; justify-content: center; display: flex; align-items: center;">
                  <span class="material-symbols-outlined" style="font-size: 20px;">select_all</span>
                </button>
                <button class="compact-action-btn" onclick="selectAllVariables(false)" data-tooltip="Deselect All" style="width: 32px; height: 32px; justify-content: center; display: flex; align-items: center;">
                  <span class="material-symbols-outlined" style="font-size: 20px;">deselect</span>
                </button>
              </div>

              <!-- Right: View Actions -->
              <div style="display: flex; gap: 4px;">
                <button class="compact-action-btn" onclick="expandAllImportGroups()" data-tooltip="Expand All" style="width: 32px; height: 32px; justify-content: center; display: flex; align-items: center;">
                  <span class="material-symbols-outlined" style="font-size: 20px;">unfold_more</span>
                </button>
                <button class="compact-action-btn" onclick="collapseAllImportGroups()" data-tooltip="Collapse All" style="width: 32px; height: 32px; justify-content: center; display: flex; align-items: center;">
                  <span class="material-symbols-outlined" style="font-size: 20px;">unfold_less</span>
                </button>
              </div>
            </div>

            <div class="variables-preview">
              <div class="variable-collection">
                <div class="collection-header">
                  <div class="collection-info" style="display: flex; align-items: center;">
                    <span class="material-symbols-outlined" style="font-size: 18px; color: var(--purple-light);">folder</span>
                    <h3 class="collection-name-title" style="margin: 0 8px;">Design Tokens</h3>
                    <span class="subgroup-stats" style="margin: 0;">(Collection)</span>
                  </div>
                </div>
                
                <div class="collection-content">
                ${r.map(b=>{const S=o[b].filter(T=>categorizeToken(T)==="color"||categorizeToken(T)==="numeric");if(S.length===0)return"";const x=`import-group-${b.replace(/[^a-zA-Z0-9]/g,"-")}`,k=S.filter(T=>categorizeToken(T)==="color").length,C=S.filter(T=>categorizeToken(T)==="numeric").length,M=S.filter(T=>T.isAlias).length,P=S.filter(T=>checkDuplicate(T.name)).length,I=S.length-P,E=SecurityUtils.escapeHTML(b.endsWith("/")?b.slice(0,-1):b);return`
                    <div class="variable-subgroup" id="${x}">
                      <div class="subgroup-header collapsed" onclick="toggleSubgroup('${x}')">
                        <span class="material-symbols-outlined subgroup-toggle-icon">expand_more</span>
                        <div class="subgroup-title">
                          <span class="material-symbols-outlined" style="font-size: 16px; margin-right: 6px; color: var(--text-secondary);">folder_open</span>
                          ${E}
                          <span class="subgroup-stats">${S.length} vars \u2022 ${k} colors \u2022 ${C} numeric</span>
                          <div class="group-status" style="display: inline-flex; margin-left: 8px; gap: 4px;">
                             ${I>0?`<span class="status-badge new" style="font-size: 10px; padding: 1px 4px; border-radius: 4px; background: rgba(34, 197, 94, 0.2); color: #4ade80;">${I} new</span>`:""}
                             ${P>0?`<span class="status-badge" style="font-size: 10px; padding: 1px 4px; border-radius: 4px; background: rgba(251, 191, 36, 0.2); color: #fbbf24;">${P} exist</span>`:""}
                             ${M>0?`<span class="status-badge alias" style="font-size: 10px; padding: 1px 4px; border-radius: 4px; background: rgba(168, 85, 247, 0.2); color: #c084fc;">${M} refs</span>`:""}
                          </div>
                        </div>
                      </div>
                      <div class="subgroup-content collapsed" id="${x}-content">
                        <div class="variables-table">
                          ${S.map(T=>{const V=`token-${T.name.replace(/[^a-zA-Z0-9]/g,"-")}`,L=SecurityUtils.escapeHTML(T.name),c=SecurityUtils.escapeHTML(T.value),N=categorizeToken(T),m=N==="color"?`<span class="color-preview" style="background-color: ${c}"></span>${c}`:c,h=checkDuplicate(T.name);return`
                              <div class="variable-row ${h?"duplicate-row":""}">
                                <label class="checkbox-label">
                                  <input type="checkbox" id="${V}" checked class="variable-checkbox" data-token-name="${L}">
                                  <span class="variable-name" style="font-size: 11px;">${L}</span>
                                </label>
                                <span class="variable-type" style="font-size: 11px;">${N}</span>
                                <span class="variable-value" style="font-size: 11px;">${m}</span>
                                ${h?'<span class="status-badge alias duplicate-badge" style="background-color: #fef3c7; color: #d97706; border: 1px solid #fcd34d;">Exists</span>':""}
                                ${T.isAlias?'<span class="alias-badge">ref</span>':""}
                              </div>
                            `}).join("")}
                        </div>
                      </div>
                    </div>
                  `}).filter(Boolean).join("")}
                </div>
              </div>
            </div>
            <div class="summary-stats" style="margin-top: 16px; color: var(--text-secondary); font-size: 11px; display: flex; gap: 8px; align-items: center;">
              <span class="summary-item" style="display: flex; align-items: center; gap: 4px;"><span class="material-symbols-outlined" style="font-size: 14px;">folder</span> 1 collection</span>
              <span class="summary-item" style="display: flex; align-items: center; gap: 4px;"><span class="material-symbols-outlined" style="font-size: 14px;">folder_open</span> ${r.length} groups</span>
              <span class="summary-item" style="display: flex; align-items: center; gap: 4px;"><span class="material-symbols-outlined" style="font-size: 14px;">data_object</span> ${a.length} variables</span>
            </div>
          </div>
          
          ${l.length>0?`
          <div class="import-structure-preview">
            <div class="tab-header" style="margin-bottom: var(--space-2);">
                <h3 style="color: rgba(255, 255, 255, 0.9); display: flex; align-items: center; gap: 10px; font-size: 1.2rem; margin: 0;">
                  Figma Styles Preview
                </h3>
            </div>
            
            <div class="toolbar" style="margin-bottom: 16px; background: rgba(0,0,0,0.2); padding: 8px; border-radius: var(--radius-md); display: flex; justify-content: space-between; align-items: center;">
              <!-- Left: Selection Actions -->
              <div style="display: flex; gap: 4px;">
                <button class="compact-action-btn" onclick="selectAllStyles(true)" data-tooltip="Select All" style="width: 32px; height: 32px; justify-content: center; display: flex; align-items: center;">
                  <span class="material-symbols-outlined" style="font-size: 20px;">select_all</span>
                </button>
                <button class="compact-action-btn" onclick="selectAllStyles(false)" data-tooltip="Deselect All" style="width: 32px; height: 32px; justify-content: center; display: flex; align-items: center;">
                  <span class="material-symbols-outlined" style="font-size: 20px;">deselect</span>
                </button>
              </div>

              <!-- Right: View Actions -->
              <div style="display: flex; gap: 4px;">
                <button class="compact-action-btn" onclick="expandAllStyleGroups()" data-tooltip="Expand All" style="width: 32px; height: 32px; justify-content: center; display: flex; align-items: center;">
                  <span class="material-symbols-outlined" style="font-size: 20px;">unfold_more</span>
                </button>
                <button class="compact-action-btn" onclick="collapseAllStyleGroups()" data-tooltip="Collapse All" style="width: 32px; height: 32px; justify-content: center; display: flex; align-items: center;">
                  <span class="material-symbols-outlined" style="font-size: 20px;">unfold_less</span>
                </button>
              </div>
            </div>

            <div class="styles-preview">
              ${["gradient","shadow","effect","transition"].map(b=>{const S=l.filter(M=>categorizeToken(M)===b);if(S.length===0)return"";const x={gradient:"palette",shadow:"blur_on",effect:"auto_fix_high",transition:"animation"},k={gradient:"Paint Styles",shadow:"Effect Styles",effect:"Effect Styles",transition:"Transitions"},C=`style-group-${b}`;return`
                  <div class="variable-subgroup" id="${C}">
                    <div class="subgroup-header collapsed" onclick="toggleSubgroup('${C}')">
                      <span class="material-symbols-outlined subgroup-toggle-icon">expand_more</span>
                      <div class="subgroup-title">
                        <span class="material-symbols-outlined" style="font-size: 16px; margin-right: 6px; color: var(--text-secondary);">${x[b]}</span>
                        ${k[b]}
                        <span class="subgroup-stats">${S.length} styles</span>
                        <div class="group-status" style="display: inline-flex; margin-left: 8px;">
                          <span class="status-badge new" style="font-size: 10px; padding: 1px 4px; border-radius: 4px; background: rgba(34, 197, 94, 0.2); color: #4ade80;">${S.length} new</span>
                        </div>
                      </div>
                    </div>

                    <div class="subgroup-content collapsed" id="${C}-content">
                      <div class="styles-table">
                        ${S.map(M=>{const P=`style-${M.name.replace(/[^a-zA-Z0-9]/g,"-")}`,I=SecurityUtils.escapeHTML(M.name),E=SecurityUtils.escapeHTML(M.value);return`
                            <div class="variable-row">
                              <label class="checkbox-label">
                                <input type="checkbox" id="${P}" checked class="style-checkbox" data-token-name="${I}">
                                <span class="variable-name" style="font-size: 11px;">${I}</span>
                              </label>
                              <span class="variable-type" style="font-size: 11px;">${b}</span>
                              <span class="variable-value" style="font-size: 11px;">${E}</span>
                            </div>
                          `}).join("")}
                      </div>
                    </div>
                  </div>
                `}).join("")}
            </div>
            <div class="summary-stats" style="margin-top: 16px; color: var(--text-secondary); font-size: 11px;">
               <span class="summary-item">\u{1F3A8} ${l.length} styles ready to import</span>
            </div>
          </div>
          `:""}
          
          <div class="options-grid">
            <div class="option-group">
              <h4>Import Destination</h4>
              <div class="destination-selector" style="display: flex; gap: 16px; margin-bottom: 12px;">
                <label class="radio-option" style="display: flex; align-items: center; gap: 6px; cursor: pointer;">
                   <input type="radio" name="import-destination" value="new" id="dest-radio-new" checked>
                   <span>New Collection</span>
                </label>
                <label class="radio-option" style="display: flex; align-items: center; gap: 6px; cursor: pointer;">
                   <input type="radio" name="import-destination" value="existing" id="dest-radio-existing">
                   <span>Existing Collection</span>
                </label>
              </div>

              <div id="new-collection-group" class="input-group">
                <label>Collection Name <span class="material-symbols-outlined help-icon" data-tooltip="Name of the variable collection to create in Figma">help</span></label>
                <input type="text" id="collection-name" value="Design Tokens" placeholder="Enter collection name">
              </div>

              <div id="existing-collection-group" class="input-group" style="display: none;">
                <label>Select Collection <span class="material-symbols-outlined help-icon" data-tooltip="Choose an existing variable collection to merge into">help</span></label>
                <select id="existing-collection-select">
                  <option value="">Loading collections...</option>
                </select>
              </div>

              <div style="height: 1px; background: rgba(255,255,255,0.1); margin: 16px 0;"></div>

              <h4>Settings</h4>
              <div style="display: flex; flex-direction: column; gap: 8px;">
                <label class="toggle-switch">
                  <input type="checkbox" class="toggle-input" id="organize-by-categories" checked>
                  <div class="toggle-slider"></div>
                  <span class="settings-label" style="margin-bottom: 0;">Organize by categories</span>
                  <span class="material-symbols-outlined" style="font-size: 14px; opacity: 0.4; cursor: help;" data-tooltip="Auto-group variables using slashes (e.g. color/blue)">help</span>
                </label>

                <label class="toggle-switch">
                  <input type="checkbox" class="toggle-input" id="overwrite-existing">
                  <div class="toggle-slider"></div>
                  <span class="settings-label" style="margin-bottom: 0;">Overwrite existing variables</span>
                  <span class="material-symbols-outlined" style="font-size: 14px; opacity: 0.4; cursor: help;" data-tooltip="If a variable with the same name already exists, replace its value. Otherwise, skip duplicates.">help</span>
                </label>
              </div>
            </div>
          </div>
          
          <div class="import-actions">
            <button class="btn btn-primary btn-large" onclick="simulateImport()">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                <polyline points="7,10 12,15 17,10"/>
                <line x1="12" y1="15" x2="12" y2="3"/>
              </svg>
              Import to Figma
            </button>
            <button class="btn btn-secondary" onclick="clearInput()">Cancel</button>
          </div>
        `;n.innerHTML=g,t.style.display="block";const f=document.getElementById("dest-radio-new"),w=document.getElementById("dest-radio-existing");f&&f.addEventListener("change",function(){this.checked&&toggleImportDestination("new")}),w&&w.addEventListener("change",function(){this.checked&&toggleImportDestination("existing")});const y=document.getElementById("collection-name");y&&y.addEventListener("input",updateCollectionNamePreview),loadExistingCollections()}function checkDuplicate(e){if(!window.existingCollections)return!1;for(const t of window.existingCollections)if(t.variables&&t.variables.some(n=>n.name===e))return!0;return!1}function updateCollectionNamePreview(){const e=document.getElementById("collection-name"),t=document.querySelector(".collection-name-preview");if(e&&t){const n=e.value.trim()||"Design Tokens";t.textContent=n}}window.toggleImportDestination=function(e){const t=document.getElementById("new-collection-group"),n=document.getElementById("existing-collection-group");e==="new"?(t&&(t.style.display="block"),n&&(n.style.display="none")):(t&&(t.style.display="none"),n&&(n.style.display="block"),loadExistingCollections())};function loadExistingCollections(){document.getElementById("existing-collection-select")&&parent.postMessage({pluginMessage:{type:"get-existing-collections"}},"*")}window.simulateImport=function(){const e=document.getElementById("import-section"),t=document.getElementById("import-content");if(!e||!t){alert("Please navigate to the Import tab and parse tokens first");return}const n=document.querySelector('input[name="import-destination"]:checked'),s=document.getElementById("organize-by-categories"),o=document.getElementById("overwrite-existing");if(!n||!s||!o){alert("Please parse tokens first to see import options");return}const i=n.value,a=s.checked,l=o.checked;let r="Design Tokens",d=null;if(i==="new"){const x=document.getElementById("collection-name");r=x&&x.value||"Design Tokens"}else{const x=document.getElementById("existing-collection-select");if(x&&x.value)d=x.value,r=x.options[x.selectedIndex].text;else{alert('Please select an existing collection or enable "Create new collection"');return}}const p=[],u=[];document.querySelectorAll(".variable-checkbox:checked").forEach(x=>{const k=x.dataset.tokenName,C=(window.parsedTokens||[]).find(M=>M.name===k);C&&p.push(C)}),document.querySelectorAll(".style-checkbox:checked").forEach(x=>{const k=x.dataset.tokenName,C=(window.parsedTokens||[]).find(M=>M.name===k);C&&u.push(C)});const g=[...p,...u];if(g.length===0){alert("Please select at least one variable or style to import.");return}t.innerHTML=`
          <div class="apply-summary">
            <h4>Importing to Figma...</h4>
            <div class="import-progress">
              <div class="progress-bar">
                <div class="progress-fill" id="progress-fill"></div>
              </div>
              <div class="progress-text" id="progress-text">Starting import...</div>
            </div>
          </div>
        `,e.style.display="block";const f={pluginMessage:{type:"import-tokens",tokens:g,options:{collectionName:r,collectionId:d,strategy:l?"overwrite":"merge",organizeByCategories:a}}};parent.postMessage(f,"*");const w=document.getElementById("progress-fill"),y=document.getElementById("progress-text");let b=0;const S=setInterval(()=>{b+=Math.random()*10,b>90&&(b=90),w&&(w.style.width=b+"%"),y&&(y.textContent=`Importing tokens... ${Math.round(b)}%`)},300);window.importProgressControl={fill:w,text:y,interval:S,complete:function(x){clearInterval(this.interval),this.fill&&(this.fill.style.width="100%"),this.text&&(this.text.textContent="Import completed!"),setTimeout(()=>showImportComplete(x),400)},error:function(x){clearInterval(this.interval),this.fill&&(this.fill.style.width="100%",this.fill.style.backgroundColor="#f87171"),this.text&&(this.text.textContent="Import failed"),setTimeout(()=>showImportError(x),400)}}};function showImportComplete(e={}){const t=document.getElementById("variable-import-container");if(!t)return;const n=e.importedCount||0,s=e.importedStyleCount||0,o=e.collectionName||"Design Tokens",i=e.groupsCreated||0,a=e.errors||[],l=n+s;let r="";n>0&&(r+=`
      <div style="display: flex; align-items: center; gap: 10px; padding: 10px 14px; background: rgba(34, 197, 94, 0.08); border: 1px solid rgba(34, 197, 94, 0.15); border-radius: 8px;">
        <span class="material-symbols-outlined" style="font-size: 20px; color: #4ade80;">data_object</span>
        <div>
          <div style="font-size: 18px; font-weight: 700; color: #4ade80;">${n}</div>
          <div style="font-size: 10px; color: rgba(255,255,255,0.5); text-transform: uppercase; letter-spacing: 0.05em;">Variables</div>
        </div>
      </div>`),s>0&&(r+=`
      <div style="display: flex; align-items: center; gap: 10px; padding: 10px 14px; background: rgba(168, 85, 247, 0.08); border: 1px solid rgba(168, 85, 247, 0.15); border-radius: 8px;">
        <span class="material-symbols-outlined" style="font-size: 20px; color: #c084fc;">palette</span>
        <div>
          <div style="font-size: 18px; font-weight: 700; color: #c084fc;">${s}</div>
          <div style="font-size: 10px; color: rgba(255,255,255,0.5); text-transform: uppercase; letter-spacing: 0.05em;">Styles</div>
        </div>
      </div>`),i>0&&(r+=`
      <div style="display: flex; align-items: center; gap: 10px; padding: 10px 14px; background: rgba(59, 130, 246, 0.08); border: 1px solid rgba(59, 130, 246, 0.15); border-radius: 8px;">
        <span class="material-symbols-outlined" style="font-size: 20px; color: #60a5fa;">folder_open</span>
        <div>
          <div style="font-size: 18px; font-weight: 700; color: #60a5fa;">${i}</div>
          <div style="font-size: 10px; color: rgba(255,255,255,0.5); text-transform: uppercase; letter-spacing: 0.05em;">Groups</div>
        </div>
      </div>`);let d="";a.length>0&&(d=`
      <div style="margin-top: 12px; padding: 10px 14px; background: rgba(248, 113, 113, 0.06); border: 1px solid rgba(248, 113, 113, 0.12); border-radius: 8px;">
        <div style="font-size: 11px; font-weight: 600; color: #f87171; margin-bottom: 6px;">${a.length} token${a.length!==1?"s":""} skipped</div>
        <div style="max-height: 80px; overflow-y: auto; font-size: 11px; color: rgba(255,255,255,0.4); line-height: 1.6;">
          ${a.slice(0,5).map(p=>`<div>${SecurityUtils.escapeHTML(typeof p=="string"?p:p.message||String(p))}</div>`).join("")}
          ${a.length>5?`<div style="color: rgba(255,255,255,0.3);">...and ${a.length-5} more</div>`:""}
        </div>
      </div>`),t.innerHTML=`
    <div class="variable-import-tab" style="display: flex; flex-direction: column; align-items: center; padding: 32px 16px;">
      <span class="material-symbols-outlined" style="font-size: 48px; color: #4ade80; margin-bottom: 12px;">check_circle</span>
      <h3 style="margin: 0 0 4px 0; color: rgba(255,255,255,0.95); font-size: 16px;">Import Complete</h3>
      <p style="margin: 0 0 20px 0; color: rgba(255,255,255,0.5); font-size: 12px;">
        ${l} token${l!==1?"s":""} imported into <strong style="color: rgba(255,255,255,0.7);">${SecurityUtils.escapeHTML(o)}</strong>
      </p>

      <div style="display: flex; gap: 10px; flex-wrap: wrap; justify-content: center; margin-bottom: 16px; width: 100%;">
        ${r}
      </div>

      ${d}

      <div style="margin-top: 20px; display: flex; gap: 8px;">
        <button class="btn btn-primary" onclick="resetImportView()">Import More Tokens</button>
      </div>
    </div>
  `,t.scrollIntoView({behavior:"smooth",block:"start"})}function resetImportView(){console.log("[UI] Resetting import view");try{const e=document.getElementById("variable-import-container");if(!e){console.error("[UI] Import content container not found");return}e.classList.remove("initialized"),currentImportPreview=null,initializeVariableImportTab()}catch(e){console.error("[UI] Error resetting import view:",e),showError("UI Error","Failed to reset import view. Please reload the plugin.")}}window.resetImportView=resetImportView;function showImportError(e){const t=document.getElementById("variable-import-container");if(!t)return;const n=typeof e=="string"?e:e&&e.message?e.message:"An unknown error occurred during import.";t.innerHTML=`
          <div class="import-result">
            <div class="result-summary error">
              <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                <span class="material-symbols-outlined" style="font-size: 24px; color: #f87171;">error</span>
                <h4 style="margin: 0;">Import Failed</h4>
              </div>
              <p class="error-message" style="color: rgba(255,255,255,0.7); font-size: 12px; margin: 8px 0;">${SecurityUtils.escapeHTML(n)}</p>
              <p style="color: rgba(255,255,255,0.4); font-size: 11px; margin: 4px 0;">Check that your token syntax is correct and try again.</p>
            </div>
            <div class="apply-actions" style="margin-top: 16px;">
              <button class="btn btn-secondary" onclick="resetImportView()">Try Again</button>
            </div>
          </div>
        `}window.addEventListener("message",function(e){if(e.data.pluginMessage){const t=e.data.pluginMessage;t.type==="import-complete"&&window.importProgressControl?(window.importProgressControl.complete(t.result),delete window.importProgressControl):t.type==="import-error"&&window.importProgressControl?(window.importProgressControl.error(t.error),delete window.importProgressControl):t.type==="existing-collections"&&updateExistingCollectionsDropdown(t.collections)}});function updateExistingCollectionsDropdown(e){window.existingCollections=e||[],[{id:"existing-collection-select",element:document.getElementById("existing-collection-select")},{id:"import-collection-select",element:document.getElementById("import-collection-select")}].forEach(n=>{if(!n.element)return;if(n.element.innerHTML="",!e||e.length===0){n.element.innerHTML='<option value="">New Collection...</option>';return}const s=document.createElement("option");s.value="",s.textContent="New Collection...",n.element.appendChild(s);const o=document.createElement("option");o.disabled=!0,o.textContent="\u2500\u2500\u2500\u2500\u2500 Existing Collections \u2500\u2500\u2500\u2500\u2500",n.element.appendChild(o),e.forEach(i=>{const a=document.createElement("option");a.value=i.id,a.textContent=i.name,n.element.appendChild(a)})}),window.parsedTokens&&window.existingCollections&&document.querySelectorAll(".variable-checkbox").forEach(n=>{const s=n.dataset.tokenName,o=n.closest(".variable-row");if(!o)return;const i=checkDuplicate(s),a=o.querySelector(".duplicate-badge");if(i&&!a){o.classList.add("duplicate-row");const l=document.createElement("span");l.className="status-badge alias duplicate-badge",l.style.cssText="background-color: #fef3c7; color: #d97706; border: 1px solid #fcd34d;",l.textContent="Exists",o.appendChild(l)}else!i&&a&&(o.classList.remove("duplicate-row"),a.remove())})}window.openSettingsModal=openSettingsModal,window.closeSettingsModal=closeSettingsModal,window.onProviderChange=onProviderChange,window.openUserGuide=openUserGuide,window.closeUserGuide=closeUserGuide,window.toggleSubgroup=toggleSubgroup,window.scrollToGroupById=scrollToGroupById,window.generateTest=generateTest,window.toggleVariablesList=toggleVariablesList,window.expandAllGroups=expandAllGroups,window.collapseAllGroups=collapseAllGroups,window.expandAllSubgroups=expandAllSubgroups,window.collapseAllSubgroups=collapseAllSubgroups,window.deleteVariable=deleteVariable,window.deleteStyle=deleteStyle,window.deleteComponent=deleteComponent,window.deleteUnusedVariable=deleteUnusedVariable,window.focusOnComponent=focusOnComponent,window.deleteAllUnusedVariants=deleteAllUnusedVariants,window.scrollToVariable=scrollToVariable,window.expandAllImportGroups=expandAllImportGroups,window.expandAllStyles=()=>{document.querySelectorAll("#styles-container .collection-content").forEach(e=>{e.classList.add("expanded");const t=document.getElementById(`icon-${e.id}`);t&&(t.textContent="expand_more")})},window.collapseAllStyles=()=>{document.querySelectorAll("#styles-container .collection-content").forEach(e=>{e.classList.remove("expanded");const t=document.getElementById(`icon-${e.id}`);t&&(t.textContent="chevron_right")})},window.collapseAllImportGroups=collapseAllImportGroups,window.expandAllStyleGroups=expandAllStyleGroups,window.collapseAllStyleGroups=collapseAllStyleGroups,window.selectAllVariables=selectAllVariables,window.selectAllStyles=selectAllStyles,window.browseRepositories=browseRepositories,window.browseBranches=browseBranches,window.closeRepositoryBrowser=closeRepositoryBrowser,window.closeBranchBrowser=closeBranchBrowser,window.startOAuthFlow=startOAuthFlow,window.openImportModal=openImportModal,window.closeImportModal=closeImportModal,window.openUnitsModal=openUnitsModal,window.closeUnitsModal=closeUnitsModal,window.saveUnitsAndCloseModal=saveUnitsAndCloseModal,window.switchToQualityTab=switchToQualityTab,window.showPopupBlockerHelp=showPopupBlockerHelp,window.detectBrowser=detectBrowser;let currentImportPreview=null;function initializeImportTab(){console.log("Initializing Import Tab"),loadExistingCollections();const e=document.getElementById("import-collection-select");e&&(e.innerHTML='<option value="">New Collection...</option>',window.existingCollections&&window.existingCollections.length>0&&updateExistingCollectionsDropdown(window.existingCollections))}(W=document.getElementById("import-input"))==null||W.addEventListener("input",function(e){const t=document.getElementById("preview-import-btn");t&&(t.disabled=!e.target.value.trim())}),(Z=document.getElementById("preview-import-btn"))==null||Z.addEventListener("click",function(){const e=document.getElementById("import-input").value,t=document.getElementById("import-collection-select").value;e&&(showButtonLoading(this,"Analyzing..."),parent.postMessage({pluginMessage:{type:"preview-import",content:e,options:{collectionId:t}}},"*"))}),(K=document.getElementById("cancel-import-btn"))==null||K.addEventListener("click",function(){document.getElementById("import-preview-section").classList.add("hidden"),document.getElementById("preview-import-btn").disabled=!1,document.getElementById("import-input").disabled=!1}),(J=document.getElementById("confirm-import-btn"))==null||J.addEventListener("click",function(){if(!currentImportPreview)return;const e=document.getElementById("overwrite-existing"),t=document.getElementById("organize-by-categories"),n=e&&e.checked?"overwrite":"merge",s=t&&t.checked||!1,o=document.getElementById("import-collection-select"),i=o.value,a=i?o.options[o.selectedIndex].text:"Imported Variables";showButtonLoading(this,"Importing...");const l=[...currentImportPreview.added,...currentImportPreview.modified.map(r=>r.token),...currentImportPreview.unchanged,...currentImportPreview.conflicts.map(r=>r.token)];parent.postMessage({pluginMessage:{type:"import-tokens",tokens:l,options:{collectionId:i,collectionName:a,strategy:n,organizeByCategories:s}}},"*")});function handleImportPreview(e){if(hideButtonLoading(document.getElementById("preview-import-btn")),!e.diff){showError("Import Error","Failed to generate preview");return}currentImportPreview=e.diff;const{added:t,modified:n,unchanged:s,conflicts:o}=e.diff,i=t.length+n.length+s.length+o.length;document.getElementById("preview-stat-total").querySelector("span:last-child").textContent=i,document.getElementById("preview-stat-new").querySelector("span:last-child").textContent=t.length,document.getElementById("preview-stat-update").querySelector("span:last-child").textContent=n.length,document.getElementById("preview-stat-conflict").querySelector("span:last-child").textContent=o.length;const a=document.getElementById("preview-table-body");a.innerHTML="";const l=u=>{const g=(u||"").toLowerCase();return g.includes("color")?'<span class="material-symbols-outlined" style="font-size: 14px; color: #a78bfa;">palette</span>':g.includes("number")||g.includes("numeric")||g.includes("float")?'<span class="material-symbols-outlined" style="font-size: 14px; color: #60a5fa;">123</span>':g.includes("string")?'<span class="material-symbols-outlined" style="font-size: 14px; color: #4ade80;">text_fields</span>':g.includes("boolean")?'<span class="material-symbols-outlined" style="font-size: 14px; color: #fbbf24;">toggle_on</span>':'<span class="material-symbols-outlined" style="font-size: 14px; color: rgba(255,255,255,0.5);">data_object</span>'},r=u=>({new:'<span style="display: inline-flex; align-items: center; gap: 2px; background: rgba(34,197,94,0.2); color: #4ade80; padding: 2px 6px; border-radius: 4px; font-size: 10px; font-weight: 600;"><span class="material-symbols-outlined" style="font-size: 12px;">add</span>NEW</span>',update:'<span style="display: inline-flex; align-items: center; gap: 2px; background: rgba(234,179,8,0.2); color: #facc15; padding: 2px 6px; border-radius: 4px; font-size: 10px; font-weight: 600;"><span class="material-symbols-outlined" style="font-size: 12px;">sync</span>UPD</span>',conflict:'<span style="display: inline-flex; align-items: center; gap: 2px; background: rgba(239,68,68,0.2); color: #f87171; padding: 2px 6px; border-radius: 4px; font-size: 10px; font-weight: 600;"><span class="material-symbols-outlined" style="font-size: 12px;">warning</span>!</span>',ignore:'<span style="display: inline-flex; align-items: center; gap: 2px; background: rgba(255,255,255,0.1); color: rgba(255,255,255,0.5); padding: 2px 6px; border-radius: 4px; font-size: 10px; font-weight: 600;"><span class="material-symbols-outlined" style="font-size: 12px;">remove</span>SKIP</span>'})[u]||u.toUpperCase(),d=(u,g,f=null)=>{const w=document.createElement("tr"),y=g==="update"||g==="conflict"?`<span style="color: rgba(255,255,255,0.4); font-size: 10px; text-decoration: line-through;">${SecurityUtils.escapeHTML(String(f).substring(0,20))}</span>
             <span style="color: var(--purple-light);"> \u2192 ${SecurityUtils.escapeHTML(String(u.value).substring(0,25))}</span>`:`<span style="font-family: monospace; font-size: 11px;">${SecurityUtils.escapeHTML(String(u.value).substring(0,30))}</span>`;w.innerHTML=`
            <td style="font-size: 11px; font-family: monospace;">${SecurityUtils.escapeHTML(u.name)}</td>
            <td style="text-align: center;">${l(u.type)}</td>
            <td style="font-size: 11px;">${y}</td>
            <td style="text-align: center;">${r(g)}</td>
          `,a.appendChild(w)};t.forEach(u=>d(u,"new")),n.forEach(u=>d(u.token,"update",u.oldValue)),o.forEach(u=>d(u.token,"conflict",u.existingValue)),s.forEach(u=>d(u,"ignore"));const p=document.getElementById("import-preview-section");p.classList.remove("hidden"),setTimeout(()=>{p.scrollIntoView({behavior:"smooth",block:"start"})},100)}function handleImportComplete(e){const t=document.getElementById("confirm-import-btn");hideButtonLoading(t),e.result.success?(showSuccess("Import Successful",`Imported ${e.result.success} variables.`),document.getElementById("import-preview-section").classList.add("hidden"),document.getElementById("import-input").value="",refreshData()):showError("Import Failed",e.error||"Unknown error")}window.addEventListener("message",function(e){if(e.data.pluginMessage){const t=e.data.pluginMessage;t.type==="pages-list"?window.MultiPageSelector&&window.MultiPageSelector.handlePagesList(t.pages,t.currentPageId):t.type==="preview-import-result"?handleImportPreview(t):t.type==="preview-import-error"?(hideButtonLoading(document.getElementById("preview-import-btn")),showError("Preview Failed",t.message)):t.type==="import-complete"&&window.importProgressControl?(window.importProgressControl.complete(t.result),delete window.importProgressControl):t.type==="import-error"&&window.importProgressControl&&(window.importProgressControl.error(t.error),delete window.importProgressControl)}}),document.addEventListener("click",function(e){const t=e.target.closest(".sub-tab-item");t&&t.dataset.subTab==="import"&&(console.log("Import tab clicked"),setTimeout(initializeImportTab,50))});function expandAllVariables(){console.log("Expanding all variable collections"),document.querySelectorAll(".variable-collection").forEach(t=>{const n=t.querySelector(".collection-content"),s=t.querySelector(".collection-header");n&&n.classList.remove("collapsed"),s&&s.classList.remove("collapsed");const o=t.getAttribute("data-collection-id");o&&(typeof expandAllSubgroups=="function"?expandAllSubgroups(o):window.expandAllSubgroups&&window.expandAllSubgroups(o))})}window.expandAllVariables=expandAllVariables;function collapseAllVariables(){console.log("Collapsing all variable collections"),document.querySelectorAll(".variable-collection").forEach(t=>{const n=t.querySelector(".collection-content"),s=t.querySelector(".collection-header");n&&n.classList.add("collapsed"),s&&s.classList.add("collapsed");const o=t.getAttribute("data-collection-id");o&&(typeof collapseAllSubgroups=="function"?collapseAllSubgroups(o):window.collapseAllSubgroups&&window.collapseAllSubgroups(o))})}window.collapseAllVariables=collapseAllVariables;function toggleSearchBar(e){const t=document.getElementById(e);if(t&&t.classList.toggle("expanded")){const s=t.querySelector("input");s&&s.focus()}}window.toggleSearchBar=toggleSearchBar,window.expandAllComponents=function(){console.log("Expanding all component sets"),document.querySelectorAll(".component-set").forEach(t=>{const n=t.querySelector(".component-set-children"),s=t.querySelector(".component-set-header");n&&n.classList.add("expanded"),s&&s.classList.add("expanded")})},window.collapseAllComponents=function(){console.log("Collapsing all component sets"),document.querySelectorAll(".component-set").forEach(t=>{const n=t.querySelector(".component-set-children"),s=t.querySelector(".component-set-header");n&&n.classList.remove("expanded"),s&&s.classList.remove("expanded")})},window.showFeedbackInSettings=function(){const e=document.getElementById("settings-modal");e&&(e.style.display="flex",setTimeout(()=>{const t=document.getElementById("settings-feedback-section");t&&t.scrollIntoView({behavior:"smooth",block:"start"})},100))},window.toggleFeedback=function(){console.log("Toggling feedback section");const e=document.getElementById("feedback-section");if(e){const t=e.style.display==="none"||!e.style.display;e.style.display=t?"block":"none",t||parent.postMessage({pluginMessage:{type:"set-client-storage",key:"feedbackDismissed",value:!0}},"*")}else console.error("Feedback section not found HTML element")},setTimeout(()=>{const e=document.querySelector(".beta-badge");e&&(e.onclick=window.toggleFeedback,console.log("Beta badge listener attached"))},500);function updateVariablesSummary(e,t){const n=document.getElementById("variables-summary");n&&(n.innerHTML=`
            <div class="summary-badge" data-tooltip="Total Variables">
               <span>${e} Variables</span>
            </div>
            <div class="summary-badge" data-tooltip="Collections">
               <span>${t} Collections</span>
            </div>
          `,n.style.display="flex")}window.updateVariablesSummary=updateVariablesSummary;function updateComponentsSummary(e,t){const n=document.getElementById("components-summary");n&&(n.innerHTML=`
            <div class="summary-badge" data-tooltip="Total Components">
               <span>${e} Components</span>
            </div>
            <div class="summary-badge" data-tooltip="Component Sets">
               <span>${t} Sets</span>
            </div>
          `,n.style.display="flex")}window.updateComponentsSummary=updateComponentsSummary;function setupQualitySearch(){console.log("\u2705 Setting up Quality Search (Event Delegation)")}document.addEventListener("input",function(e){e.target&&e.target.id==="quality-search"&&(console.log("\u{1F50D} Quality search input:",e.target.value),filterQualityResults(e.target.value))}),document.addEventListener("click",function(e){if(e.target.closest("#clear-quality-search")){console.log("\u{1F9F9} Quality search cleared");const n=document.getElementById("quality-search");n&&(n.value="",filterQualityResults("")),typeof clearSearch=="function"&&clearSearch("quality-search")}});function filterQualityResults(e){const t=document.getElementById("token-coverage-results");if(!t){console.warn("\u26A0\uFE0F Token coverage results container not found");return}const n=e?e.toLowerCase().trim():"";console.log(`Filtering quality results for: "${n}"`);let s=0,o=0;const i=t.querySelectorAll(".quality-breakdown-row");let a=0;i.forEach(u=>{if(!n){u.style.setProperty("display","flex","important"),a++;return}u.textContent.toLowerCase().includes(n)?(u.style.setProperty("display","flex","important"),a++):u.style.setProperty("display","none","important")});const l=document.getElementById("quality-breakdown-content");if(l&&n&&a>0){l.style.display="block";const u=document.getElementById("breakdown-toggle-icon");u&&(u.style.transform="rotate(180deg)")}t.querySelectorAll(".variable-collection").forEach(u=>{const g=u.querySelectorAll(".quality-issue-card");let f=!1;const w=u.querySelector(".collection-content"),y=u.querySelector(".collection-header");let b=!1;if(y&&n){const S=y.querySelector(".collection-name-title");S&&S.textContent.toLowerCase().includes(n)&&(b=!0)}g.forEach(S=>{if(s++,!n||b){S.style.setProperty("display","block","important"),f=!0,o++;return}let x="";const k=S.querySelector(".quality-issue-header");if(k){x+=k.textContent.toLowerCase();const M=S.querySelector(".quality-nodes-list");M&&(x+=" "+M.textContent.toLowerCase())}else x=S.textContent.toLowerCase();x.includes(n)?(S.style.setProperty("display","block","important"),f=!0,o++):S.style.setProperty("display","none","important")}),f?(u.style.display="block",n&&w&&w.classList.remove("collapsed"),n&&y&&y.classList.remove("collapsed")):u.style.display="none"}),console.log(`Search complete. Visible cards: ${o} / ${s}, Visible breakdown: ${a}`);let d=t.querySelector(".no-results-message");const p=o>0||a>0;n&&!p?(d||(d=document.createElement("div"),d.className="no-results-message",d.style.textAlign="center",d.style.padding="40px",d.style.color="rgba(255, 255, 255, 0.5)",d.innerText="No matching issues found.",t.appendChild(d)),d.style.display="block"):d&&(d.style.display="none")}function toggleQualityNodeGroup(e){console.log("toggleQualityNodeGroup called with:",e);const t=document.getElementById(e),n=document.getElementById(e+"-toggle");if(console.log("Container found:",!!t,"Toggle found:",!!n),t){const s=t.style.display!=="none";t.style.display=s?"none":"block",n&&(n.style.transform=s?"rotate(0deg)":"rotate(180deg)")}}window.qualitySectionStates=window.qualitySectionStates||{"token-coverage-section":!1,"tailwind-readiness-section":!1,"unused-components-section":!1,"unused-variables-section":!1};function toggleQualitySection(e){console.log("toggleQualitySection called with:",e);const t=document.getElementById(e);if(!t){console.warn("Section not found:",e);return}const n=t.querySelector(".section-content-collapsible"),s=t.querySelector(".section-chevron");if(!n){console.warn("Content not found in section:",e);return}const o=n.style.display!=="none";n.style.display=o?"none":"block",s&&(s.style.transform=o?"rotate(-90deg)":"rotate(0deg)"),window.qualitySectionStates[e]=!o,console.log(`Section ${e} ${o?"collapsed":"expanded"}`)}function focusOnNode(e){if(console.log("focusOnNode called with:",e),!e){console.warn("focusOnNode: No nodeId provided");return}console.log("Sending focus-node message to plugin"),parent.postMessage({pluginMessage:{type:"focus-node",nodeId:e}},"*")}window.setupQualitySearch=setupQualitySearch,window.filterQualityResults=filterQualityResults,window.toggleQualityNodeGroup=toggleQualityNodeGroup,window.toggleQualitySection=toggleQualitySection;function toggleComponentHygieneGroup(e){console.log("toggleComponentHygieneGroup called with:",e);const t=document.getElementById(e),n=document.getElementById(e+"-toggle");if(console.log("Container found:",!!t,"Toggle found:",!!n),t){const s=t.style.display!=="none";if(t.style.display=s?"none":"block",n){const o=n.querySelector(".material-symbols-outlined");o&&(o.style.transform=s?"rotate(0deg)":"rotate(180deg)")}}}window.toggleComponentHygieneGroup=toggleComponentHygieneGroup,window.focusOnNode=focusOnNode,window.expandAllQuality=expandAllQuality,window.collapseAllQuality=collapseAllQuality;function toggleSubgroup(e){const t=document.getElementById(e);if(!t)return;const n=t.querySelector(".subgroup-header"),s=document.getElementById(e+"-content"),o=n?n.querySelector(".subgroup-toggle-icon"):null;n&&s&&(n.classList.toggle("collapsed"),s.classList.toggle("collapsed"),o&&(o.innerHTML=n.classList.contains("collapsed")?"expand_more":"expand_less"))}function expandAllImportGroups(){document.querySelectorAll(".variables-preview .variable-subgroup").forEach(t=>{const n=t.querySelector(".subgroup-header"),s=t.querySelector(".subgroup-content"),o=t.querySelector(".subgroup-toggle-icon");n&&n.classList.remove("collapsed"),s&&s.classList.remove("collapsed"),o&&(o.innerHTML="expand_less")})}function collapseAllImportGroups(){document.querySelectorAll(".variables-preview .variable-subgroup").forEach(t=>{const n=t.querySelector(".subgroup-header"),s=t.querySelector(".subgroup-content"),o=t.querySelector(".subgroup-toggle-icon");n&&n.classList.add("collapsed"),s&&s.classList.add("collapsed"),o&&(o.innerHTML="expand_more")})}function selectAllVariables(e){document.querySelectorAll(".variables-preview .variable-checkbox").forEach(n=>n.checked=e)}function expandAllStyleGroups(){document.querySelectorAll(".styles-preview .variable-subgroup").forEach(t=>{const n=t.querySelector(".subgroup-header"),s=t.querySelector(".subgroup-content"),o=t.querySelector(".subgroup-toggle-icon");n&&n.classList.remove("collapsed"),s&&s.classList.remove("collapsed"),o&&(o.innerHTML="expand_less")})}function collapseAllStyleGroups(){document.querySelectorAll(".styles-preview .variable-subgroup").forEach(t=>{const n=t.querySelector(".subgroup-header"),s=t.querySelector(".subgroup-content"),o=t.querySelector(".subgroup-toggle-icon");n&&n.classList.add("collapsed"),s&&s.classList.add("collapsed"),o&&(o.innerHTML="expand_more")})}function selectAllStyles(e){document.querySelectorAll(".styles-preview .style-checkbox").forEach(n=>n.checked=e)}window.toggleSubgroup=toggleSubgroup,window.expandAllImportGroups=expandAllImportGroups,window.collapseAllImportGroups=collapseAllImportGroups,window.selectAllVariables=selectAllVariables,window.expandAllStyleGroups=expandAllStyleGroups,window.collapseAllStyleGroups=collapseAllStyleGroups,window.selectAllStyles=selectAllStyles;function toggleAllOccurrences(e){const t=document.getElementById(`${e}-select-all`);document.querySelectorAll(`.occurrence-checkbox[data-issue-id="${e}"]`).forEach(s=>{s.checked=t.checked}),updateIssueApplyButtonState(e)}function toggleCustomSelect(e){const t=document.getElementById(`${e}-custom-select`);if(!t)return;const n=t.querySelector(".custom-select-trigger"),s=t.querySelector(".custom-select-menu");document.querySelectorAll(".custom-select-menu.show").forEach(o=>{o!==s&&(o.classList.remove("show"),o.previousElementSibling.classList.remove("active"))}),s.classList.toggle("show"),n.classList.toggle("active"),event.stopPropagation()}function selectCustomOption(e,t,n,s){const o=document.getElementById(`${e}-custom-select`);if(!o)return;const i=o.querySelector(".custom-select-trigger"),a=i.querySelector(".trigger-text"),l=o.querySelector(".custom-select-menu");if(o.dataset.value=t,a.textContent=n,l.classList.remove("show"),i.classList.remove("active"),t==="create-new"&&handleCreateNewVariable(e),updateIssueApplyButtonState(e),t&&t!=="create-new"){const r=document.getElementById(`${e}-select-all`);r&&!r.checked&&(r.checked=!0,toggleAllOccurrences(e))}}document.addEventListener("click",e=>{e.target.closest(".custom-select")||document.querySelectorAll(".custom-select-menu.show").forEach(t=>{t.classList.remove("show"),t.previousElementSibling.classList.remove("active")})});function updateIssueApplyButtonState(e){const t=document.getElementById(`${e}-apply-btn`);if(!t)return;const n=document.getElementById(`${e}-var-select`),s=document.getElementById(`${e}-custom-select`);let o="";n?o=n.value:s&&(o=s.dataset.value||"");const i=document.querySelectorAll(`.occurrence-checkbox[data-issue-id="${e}"]`),a=Array.from(i).some(p=>p.checked),l=o==="create-new";a&&o!==""?(t.disabled=!1,t.style.opacity="1",t.style.pointerEvents="auto",l?(t.innerHTML='<span class="material-symbols-outlined" style="font-size: 14px; vertical-align: middle;">add</span> Create',t.onclick=p=>{p.stopPropagation(),handleCreateNewVariable(e)},t.title="Create a new variable for this value",t.style.background="linear-gradient(135deg, #059669 0%, #10b981 100%)"):(t.innerHTML='<span class="material-symbols-outlined" style="font-size: 14px; vertical-align: middle;">check</span> Apply',t.dataset.originalOnclick&&t.setAttribute("onclick",t.dataset.originalOnclick),t.title="Apply selected variable",t.style.background="linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%)")):(t.disabled=!0,t.style.opacity="0.5",t.style.pointerEvents="none",t.innerHTML='<span class="material-symbols-outlined" style="font-size: 14px; vertical-align: middle;">check</span> Apply',t.style.background="linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%)");const d=document.getElementById(`${e}-select-all`);if(d){const p=Array.from(i).every(g=>g.checked),u=Array.from(i).some(g=>g.checked);d.checked=p,d.indeterminate=u&&!p}}function applyTokenToSelection(e,t,n){const s=document.getElementById(`${e}-var-select`),o=document.getElementById(`${e}-custom-select`);let i="";if(s?i=s.value:o&&(i=o.dataset.value||""),!i){console.warn("No variable selected");return}const a=document.querySelectorAll(`.occurrence-checkbox[data-issue-id="${e}"]:checked`),l=[];if(a.forEach(p=>{try{const u=JSON.parse(p.dataset.nodeIds||"[]");Array.isArray(u)&&l.push(...u)}catch(u){console.error("Failed to parse node IDs:",u)}}),l.length===0){console.warn("No nodes selected");return}console.log("Applying token:",{variableId:i,property:t,category:n,nodeIds:l}),window.tokenFixScrollPosition=window.scrollY||document.documentElement.scrollTop,window.tokenFixInProgress=!0,window.tokenFixIssueId=e;const r=document.getElementById(`${e}-card`);if(r){const p=r.closest(".quality-collection");if(p){const u=p.querySelector(".collection-content"),g=p.querySelector(".collection-header");u&&u.classList.contains("collapsed")&&u.classList.remove("collapsed"),g&&g.classList.contains("collapsed")&&g.classList.remove("collapsed"),window.tokenFixActiveCollectionId=p.id}}const d=document.getElementById(`${e}-apply-btn`);window.lastApplyButtonId=`${e}-apply-btn`,d.disabled=!0,d.classList.add("btn-loading"),d.innerHTML="",parent.postMessage({pluginMessage:{type:"apply-token-to-nodes",nodeIds:l,variableId:i,property:t,category:n,suppressNotification:!0}},"*"),setTimeout(()=>{d&&d.classList.contains("btn-loading")&&(d.classList.remove("btn-loading"),d.innerHTML='<span class="material-symbols-outlined" style="font-size: 14px; vertical-align: middle;">check</span> Apply',updateIssueApplyButtonState(e))},5e3)}window.toggleAllOccurrences=toggleAllOccurrences,window.updateIssueApplyButtonState=updateIssueApplyButtonState,window.applyTokenToSelection=applyTokenToSelection,document.addEventListener("DOMContentLoaded",()=>{if(window.MultiPageSelector&&typeof window.MultiPageSelector.init=="function")try{window.MultiPageSelector.init()}catch(e){console.error("Failed to initialize MultiPageSelector:",e)}setTimeout(()=>{const e=document.querySelector(".tab.active");e&&e.dataset.tab==="quality"&&(window.qualityScanPerformed||(window.qualityAnalysisState&&window.qualityAnalysisState.totalNodes>0?(console.log("[Initialize] Quality tab active - Data already present, skipping initial reset/scan."),window.qualityScanPerformed=!0):(console.log("[Initialize] Quality tab active - Triggering initial scan..."),resetQualityState(),setTimeout(()=>{try{typeof analyzeTokenCoverage=="function"&&analyzeTokenCoverage("SMART_SCAN"),window.qualityScanPerformed=!0}catch(n){console.error("Error in initial quality scan:",n)}},100))))},200)});

    </script>
  </body>
</html>
