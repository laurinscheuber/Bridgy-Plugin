<!-- Initial Loading Overlay -->
<div id="plugin-loading-overlay" class="plugin-loading-overlay">
  <div class="plugin-loading-content">
    <div class="plugin-loading-spinner"></div>
    <div class="plugin-loading-title">Bridgy</div>
    <div id="plugin-loading-status" class="plugin-loading-status">Initializing plugin...</div>
    <div class="plugin-loading-progress">
      <div id="plugin-loading-progress-bar" class="plugin-loading-progress-bar"></div>
    </div>
  </div>
</div>

<!-- Notification Container -->


<div class="container">
  <!-- Modern Header -->
  <header class="header">
    <div class="header-content">
      <div class="header-title">
        <h1>Bridgy</h1>
        <div
          class="beta-badge"
          onclick="toggleFeedback()"
          style="cursor: pointer"
          data-tooltip="Click to show feedback"
        >
          BETA
        </div>
      </div>
      <div class="header-actions">
        <button
          id="refresh-btn"
          onclick="refreshData()"
          class="refresh-button"
          data-tooltip="Refresh variables and components"
        >
          <span class="material-symbols-outlined">refresh</span>
        </button>
        <button
          id="units-icon-btn"
          onclick="openUnitsModal()"
          class="icon-btn-square"
          data-tooltip="Units Configuration"
        >
          <span class="material-symbols-outlined">straighten</span>
        </button>
        <button
          id="help-icon-btn"
          onclick="openUserGuide()"
          class="icon-btn-square"
          data-tooltip="User Guide"
        >
          <span class="material-symbols-outlined">help</span>
        </button>
        <button
          id="settings-icon-btn"
          onclick="openSettingsModal()"
          class="icon-btn-square"
          data-tooltip="Settings"
        >
          <span class="material-symbols-outlined">settings</span>
        </button>
        <a
          id="repo-link-button"
          class="repo-link-button"
          href="#"
          target="_blank"
          style="display: none"
        >
          <span class="material-symbols-outlined repo-link-icon">link</span>
          <span>Repository</span>
        </a>
      </div>
    </div>
  </header>

  <!-- Toggleable Feedback Section -->
  <div id="feedback-section" class="feedback-section" style="display: none">
    <div class="feedback-header">
      <div class="feedback-title">
        <span class="material-symbols-outlined" style="font-size: 20px">campaign</span>
        Welcome to Bridgy BETA!
      </div>
      <div style="display: flex; align-items: center; gap: var(--space-2)">
        <a href="https://bridgy-plugin.com/" target="_blank" class="feedback-website-link">
          Visit our website
          <span class="material-symbols-outlined" style="font-size: 14px; margin-left: 2px"
            >open_in_new</span
          >
        </a>
        <button class="feedback-close-btn" onclick="dismissFeedback()" title="Dismiss">
          <span class="material-symbols-outlined">close</span>
        </button>
      </div>
    </div>
    <p class="feedback-description">
      Thank you for trying Bridgy! We're actively improving based on your feedback.
    </p>
    <div class="feedback-buttons">
      <button class="feedback-button" onclick="openGitHubFeedback('bug')">
        <span class="feedback-button-icon">üêõ</span>
        <span>Report Bug</span>
      </button>
      <button class="feedback-button" onclick="openGitHubFeedback('feature')">
        <span class="feedback-button-icon">üí°</span>
        <span>Request Feature</span>
      </button>
      <button class="feedback-button" onclick="openGitHubFeedback('general')">
        <span class="feedback-button-icon">üí≠</span>
        <span>General Feedback</span>
      </button>
    </div>
  </div>

  <div class="tabs">
    <div class="tab active" data-tab="quality">Quality</div>
    <div class="tab" data-tab="variables">Variables</div>
    <div class="tab" data-tab="stats">Components</div>
  </div>

  <div class="tab-content" id="variables-content">
    <div class="content-padding">
      <div id="variables-warning-container"></div>

      <div class="toolbar">
        <div class="toolbar-group">
          <button
            id="import-icon-button"
            class="btn-primary"
            onclick="openImportModal()"
            title="Import variables"
          >
            <span class="material-symbols-outlined">input</span>
            <span class="toolbar-btn-text">Import</span>
          </button>
          <button id="export-css-button" class="btn-secondary" disabled title="Download CSS">
            <span class="material-symbols-outlined">download</span>
            <span class="toolbar-btn-text">Download</span>
          </button>
          <button
            id="commit-repo-button"
            class="btn-warning"
            disabled
            title="Commit to repository"
          >
            <span class="material-symbols-outlined">commit</span>
            <span class="toolbar-btn-text">Commit</span>
          </button>
        </div>

        <div id="variable-search-wrapper" class="search-wrapper-collapsible">
          <div class="search-input-wrapper" style="flex: 1">
            <input
              type="text"
              class="search-input"
              id="variable-search"
              placeholder="Search variables..."
            />
            <button
              class="search-clear-btn"
              id="clear-variable-search"
              onclick="clearSearch('variable-search')"
            >
              <span class="material-symbols-outlined" style="font-size: 16px">close</span>
            </button>
          </div>
        </div>

        <div class="toolbar-group">
          <button
            class="icon-btn-square"
            onclick="toggleSearchBar('variable-search-wrapper')"
            data-tooltip="Search variables"
          >
            <span class="material-symbols-outlined">search</span>
          </button>
          <button class="icon-btn-square" onclick="expandAllVariables()" data-tooltip="Expand all">
            <span class="material-symbols-outlined">unfold_more</span>
          </button>
          <button
            class="icon-btn-square"
            onclick="collapseAllVariables()"
            data-tooltip="Collapse all"
          >
            <span class="material-symbols-outlined">unfold_less</span>
          </button>
        </div>
      </div>

      <!-- Tab Header -->
      <div class="tab-header" style="margin-bottom: var(--space-2)">
        <div style="display: flex; align-items: baseline; gap: 12px; margin-bottom: 8px">
          <h2
            style="
              color: rgba(255, 255, 255, 0.9);
              display: flex;
              align-items: center;
              gap: 10px;
              font-size: 1.2rem;
              margin: 0;
            "
          >
            <span
              class="material-symbols-outlined"
              style="font-size: 22px; color: var(--purple-light)"
              >data_object</span
            >
            Variables
          </h2>
          <div id="variables-summary" class="header-summary">
            <span id="variables-count">0 vars</span> ‚Ä¢ <span id="collections-count">0 cols</span>
          </div>
        </div>
      </div>

      <div id="variables-container">
        <div class="content-loading">
          <div class="content-loading-spinner"></div>
          <div class="content-loading-text">Loading variables and design tokens...</div>
        </div>
      </div>
    </div>
  </div>

  <div class="tab-content active" id="quality-content">
    <div class="content-padding">
      <!-- Tab Header -->

      <div class="toolbar">
        <div class="toolbar-group">
          <!-- Analyze button removed -->

          <div class="select-wrapper">
            <select
              id="analysis-scope-select"
              class="toolbar-select"
              onchange="updateAnalysisScope(this.value)"
            >
              <option value="PAGE" selected>Current Page</option>
              <option value="ALL">All Pages</option>
            </select>
          </div>
        </div>

        <div id="quality-search-wrapper" class="search-wrapper-collapsible">
          <div class="search-input-wrapper" style="flex: 1">
            <input
              type="text"
              class="search-input"
              id="quality-search"
              placeholder="Search issues..."
            />
            <button
              class="search-clear-btn"
              id="clear-quality-search"
              onclick="clearSearch('quality-search')"
            >
              <span class="material-symbols-outlined" style="font-size: 16px">close</span>
            </button>
          </div>
        </div>

        <div class="toolbar-group">
          <button
            class="icon-btn-wide"
            onclick="toggleSearchBar('quality-search-wrapper')"
            title="Toggle Search"
            data-tooltip="Search"
          >
            <span class="material-symbols-outlined">search</span>
          </button>
          <button
            class="icon-btn-wide"
            id="expand-all-quality-btn"
            title="Expand all issues"
            data-tooltip="Expand all"
          >
            <span class="material-symbols-outlined">unfold_more</span>
          </button>
          <button
            class="icon-btn-wide"
            id="collapse-all-quality-btn"
            title="Collapse all issues"
            data-tooltip="Collapse all"
          >
            <span class="material-symbols-outlined">unfold_less</span>
          </button>
        </div>
      </div>

      <div id="token-coverage-results">
        <div class="content-loading" style="display: none">
          <div class="content-loading-spinner"></div>
          <div class="content-loading-text">Analyzing token coverage...</div>
        </div>
      </div>
    </div>
  </div>

  <div class="tab-content" id="stats-content">
    <div class="content-padding">
      <!-- Tab Header -->
      <div class="tab-header" style="margin-bottom: var(--space-2)">
        <div style="display: flex; align-items: baseline; gap: 12px; margin-bottom: 8px">
          <h2
            style="
              color: rgba(255, 255, 255, 0.9);
              display: flex;
              align-items: center;
              gap: 10px;
              font-size: 1.2rem;
              margin: 0;
            "
          >
            <span
              class="material-symbols-outlined"
              style="font-size: 22px; color: var(--purple-light)"
              >analytics</span
            >
            Components
          </h2>
        </div>
        <p style="color: rgba(255, 255, 255, 0.6); font-size: 12px; margin: 0">
          Overview of all components and their usage frequency in the current document.
        </p>
      </div>

      <div class="toolbar" style="margin-bottom: 12px">
        <div class="toolbar-group">
          <!-- Refresh button removed -->
        </div>

        <div id="stats-search-wrapper" class="search-wrapper-collapsible">
          <div class="search-input-wrapper" style="flex: 1">
            <input
              type="text"
              class="search-input"
              id="stats-search"
              placeholder="Search components..."
              oninput="filterStats(this.value)"
            />
            <button
              class="search-clear-btn"
              id="clear-stats-search"
              onclick="clearSearch('stats-search'); filterStats('')"
            >
              <span class="material-symbols-outlined" style="font-size: 16px">close</span>
            </button>
          </div>
        </div>

        <div class="toolbar-group">
          <button
            class="icon-btn-wide"
            onclick="toggleSearchBar('stats-search-wrapper')"
            title="Toggle Search"
            data-tooltip="Search"
          >
            <span class="material-symbols-outlined">search</span>
          </button>
        </div>
      </div>

      <div id="stats-container">
        <div class="content-loading">
          <div class="plugin-loading-spinner"></div>
          <div class="content-loading-text">Loading stats...</div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- GitLab Commit Modal -->
<div id="gitlab-modal" class="modal">
  <div class="modal-content">
    <button class="close-modal" onclick="closeGitLabModal()">
      <span class="material-symbols-outlined">close</span>
    </button>
    <div class="modal-header">
      <h3>Commit to Repository</h3>
    </div>
    <div class="modal-body">
      <p>
        Configuration is managed in the Config tab. You can go there to set up your repository
        settings.
      </p>

      <div class="form-group">
        <label for="commit-message">Change Message</label>
        <textarea
          id="commit-message"
          rows="4"
          placeholder="Optional: Describe the changes"
        ></textarea>
      </div>
    </div>
    <div class="modal-footer" style="justify-content: space-between;">
      <button class="btn-secondary" onclick="closeGitLabModal()">Cancel</button>
      <button
        id="commit-submit-button"
        class="commit-all-variants-button btn-warning"
        onclick="commitToGitLab()"
      >
        Commit
      </button>
    </div>
  </div>
</div>

<!-- Settings Modal -->
<div id="settings-modal" class="modal" style="display: none">
  <div class="modal-content">
    <button class="close-modal" onclick="closeSettingsModal()">
      <span class="material-symbols-outlined">close</span>
    </button>
    <div class="modal-header">
      <h3>Settings</h3>
    </div>
    <div class="modal-body">
      <h4>Repository Configuration</h4>
      <!-- New UX: 1. Provider Selection -->
      <div class="provider-cards">
        <div class="provider-card" id="card-gitlab" onclick="selectProvider('gitlab')">
          <div class="provider-icon" style="color: #fc6d26">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
              <path
                d="M22.65 14.39L12 22.13 1.35 14.39a.84.84 0 0 1-.3-.94l1.22-3.78 2.44-7.51A.42.42 0 0 1 4.82 2a.43.43 0 0 1 .41.26l2.47 7.6h8.6l2.47-7.6a.43.43 0 0 1 .41-.26.42.42 0 0 1 .11.02l2.44 7.51 1.22 3.78a.84.84 0 0 1-.3.94z"
              />
            </svg>
          </div>
          <div style="font-weight: 600; color: #fff">GitLab</div>
        </div>

        <div class="provider-card" id="card-github" onclick="selectProvider('github')">
          <div class="provider-icon" style="color: #fff">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
              <path
                d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0 0 24 12c0-6.63-5.37-12-12-12Z"
              />
            </svg>
          </div>
          <div style="font-weight: 600; color: #fff">GitHub</div>
        </div>
      </div>

      <input type="hidden" id="config-provider" value="" />

      <!-- New UX: 2. Staged Disclosure Accordion -->
      <div class="settings-accordion" id="settings-accordion">
        <!-- SECTION 1: CONNECTION -->
        <div class="accordion-item" id="section-connection">
          <div class="accordion-header" onclick="toggleAccordion('section-connection')">
            <div class="accordion-title">
              <span class="material-symbols-outlined accordion-icon">link</span>
              Connection & Access
            </div>
            <span class="material-symbols-outlined accordion-arrow">expand_more</span>
          </div>
          <div class="accordion-content">
            <!-- GitLab URL -->
            <div class="settings-input-group" id="gitlab-url-group">
              <label class="settings-label" for="config-gitlab-url">GitLab Instance URL</label>
              <input
                type="text"
                id="config-gitlab-url"
                placeholder="https://gitlab.company.com (leave empty for GitLab.com)"
              />
              <div class="settings-helper">
                Supports Enterprise/Self-Hosted. Leave empty for GitLab.com
              </div>
            </div>

            <!-- GitHub URL -->
            <div class="settings-input-group" id="github-url-group" style="display: none">
              <label class="settings-label" for="config-github-url">GitHub Enterprise URL</label>
              <input
                type="text"
                id="config-github-url"
                placeholder="https://github.com (leave empty for Cloud)"
              />
              <div class="settings-helper">
                Enter custom URL for Enterprise, or leave empty for GitHub.com
              </div>
            </div>

            <!-- Project ID -->
            <div class="settings-input-group">
              <label class="settings-label" for="config-project-id" id="project-id-label"
                >Project ID / Repository</label
              >
              <div style="display: flex; gap: 8px">
                <input
                  type="text"
                  id="config-project-id"
                  style="flex: 1"
                  placeholder="e.g. 24267 or owner/repo"
                />
                <button
                  id="browse-repos-button"
                  onclick="browseRepositories()"
                  class="compact-action-btn"
                  title="Browse Repositories"
                  style="width: auto; padding: 0 12px; gap: 4px"
                >
                  <span class="material-symbols-outlined" style="font-size: 16px">search</span>
                  Browse
                </button>
              </div>
            </div>

            <!-- Auth Token -->
            <div class="settings-input-group">
              <label class="settings-label" for="config-token" id="token-label">Access Token</label>
              <div style="display: flex; gap: 8px">
                <input
                  type="password"
                  id="config-token"
                  style="flex: 1"
                  placeholder="Enter Personal/Project Access Token"
                />
                <button
                  id="oauth-login-button"
                  onclick="startOAuthFlow()"
                  class="compact-action-btn"
                  style="
                    width: auto;
                    padding: 0 12px;
                    gap: 4px;
                    display: none;
                    background: rgba(34, 197, 94, 0.1);
                    border-color: rgba(34, 197, 94, 0.3);
                    color: #4ade80;
                  "
                >
                  <span class="material-symbols-outlined" style="font-size: 16px">security</span>
                  OAuth
                </button>
              </div>
              <div class="settings-helper">Recommended: Use a scoped project access token.</div>
              <div
                id="oauth-status"
                style="margin-top: 4px; display: none; color: #4ade80; font-size: 11px"
              >
                ‚úì OAuth login available
              </div>
            </div>
          </div>
        </div>

        <!-- SECTION 2: PROJECT STRUCTURE -->
        <div class="accordion-item" id="section-structure">
          <div class="accordion-header" onclick="toggleAccordion('section-structure')">
            <div class="accordion-title">
              <span class="material-symbols-outlined accordion-icon">folder_open</span>
              Project Structure
            </div>
            <span class="material-symbols-outlined accordion-arrow">expand_more</span>
          </div>
          <div class="accordion-content">
            <div class="settings-input-group">
              <label class="settings-label" for="config-file-path">Variables File Path</label>
              <input type="text" id="config-file-path" placeholder="src/styles/variables.css" />
              <div class="settings-helper">Where should we write the CSS variables?</div>
            </div>

            <div class="settings-input-group">
              <label class="settings-label" for="config-test-file-path"
                >Component Test Template</label
              >
              <input
                type="text"
                id="config-test-file-path"
                placeholder="components/{componentName}/{componentName}.spec.ts"
              />
              <div class="settings-helper">Use {componentName} as placeholder.</div>
            </div>
          </div>
        </div>

        <!-- SECTION 3: WORKFLOW -->
        <div class="accordion-item" id="section-workflow">
          <div class="accordion-header" onclick="toggleAccordion('section-workflow')">
            <div class="accordion-title">
              <span class="material-symbols-outlined accordion-icon">call_split</span>
              Workflow & Export
            </div>
            <span class="material-symbols-outlined accordion-arrow">expand_more</span>
          </div>
          <div class="accordion-content">
            <div class="settings-input-group">
              <label class="settings-label" for="config-export-format">Export Format</label>
              <select id="config-export-format" style="width: 100%">
                <option value="css">CSS Variables (Standard)</option>
                <option value="scss">SCSS Variables</option>
                <option value="tailwind-v4">Tailwind v4 (@theme)</option>
              </select>
            </div>

            <div class="settings-input-group">
              <label class="settings-label" for="config-strategy">Commit Strategy</label>
              <select id="config-strategy" style="width: 100%">
                <option value="merge-request" selected>Create Merge Request / Pull Request</option>
                <option value="direct">Commit Directly to Branch</option>
              </select>
            </div>

            <div class="settings-input-group" id="config-branch-section">
              <label class="settings-label" for="config-branch">CSS Variables Branch</label>
              <div style="display: flex; gap: 8px">
                <input
                  type="text"
                  id="config-branch"
                  placeholder="feature/design-tokens"
                  style="flex: 1"
                />
                <button
                  onclick="browseBranches()"
                  class="compact-action-btn"
                  title="Browse Branches"
                  style="width: auto; padding: 0 10px"
                >
                  <span class="material-symbols-outlined" style="font-size: 16px">list</span>
                </button>
              </div>
            </div>

            <div class="settings-input-group" id="config-test-branch-section">
              <label class="settings-label" for="config-test-branch">Test Branch Prefix</label>
              <input type="text" id="config-test-branch" placeholder="feature/test-{component}" />
            </div>
          </div>
        </div>

        <!-- SECTION 4: TEAM & ADVANCED -->
        <div class="accordion-item" id="section-advanced">
          <div class="accordion-header" onclick="toggleAccordion('section-advanced')">
            <div class="accordion-title">
              <span class="material-symbols-outlined accordion-icon">settings_suggest</span>
              Team & Advanced
            </div>
            <span class="material-symbols-outlined accordion-arrow">expand_more</span>
          </div>
          <div class="accordion-content">
            <label class="toggle-switch">
              <input type="checkbox" id="config-save-token" class="toggle-input" checked />
              <div class="toggle-slider"></div>
              <span style="font-size: 13px; color: rgba(255, 255, 255, 0.9)"
                >Save Token locally (Recommended)</span
              >
            </label>

            <label class="toggle-switch">
              <input type="checkbox" id="config-share-team" class="toggle-input" checked />
              <div class="toggle-slider"></div>
              <span style="font-size: 13px; color: rgba(255, 255, 255, 0.9)"
                >Share configuration with team</span
              >
            </label>

            <!-- Config Metadata -->
            <div
              id="config-metadata"
              style="
                margin-top: 16px;
                background: rgba(255, 255, 255, 0.05);
                border-radius: 8px;
                padding: 10px;
                font-size: 11px;
                color: rgba(255, 255, 255, 0.6);
                display: none;
              "
            >
              <div style="display: flex; align-items: center; gap: 8px">
                <span class="material-symbols-outlined" style="font-size: 14px">history</span>
                <span id="config-metadata-text">Last saved: Never</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Feedback Section - ALWAYS VISIBLE (Outside Accordion) -->
      <div
        id="settings-feedback-section"
        style="
          border-top: 1px solid rgba(139, 92, 246, 0.2);
          padding-top: var(--space-4);
          margin-top: var(--space-4);
        "
      >
        <h4 style="margin-bottom: var(--space-2)">Feedback & Support</h4>
        <p style="font-size: 13px; color: rgba(255, 255, 255, 0.7); margin-bottom: var(--space-3)">
          We're actively improving Bridgy based on your feedback!
        </p>
        <div style="display: flex; gap: var(--space-2); flex-wrap: wrap">
          <button
            class="feedback-button"
            onclick="openGitHubFeedback('bug')"
            style="flex: 1; min-width: 100px"
          >
            <span class="feedback-button-icon">üêõ</span>
            <span>Report Bug</span>
          </button>
          <button
            class="feedback-button"
            onclick="openGitHubFeedback('feature')"
            style="flex: 1; min-width: 100px"
          >
            <span class="feedback-button-icon">üí°</span>
            <span>Request Feature</span>
          </button>
          <button
            class="feedback-button"
            onclick="openGitHubFeedback('general')"
            style="flex: 1; min-width: 100px"
          >
            <span class="feedback-button-icon">üí≠</span>
            <span>General Feedback</span>
          </button>
        </div>

        <!-- User Guide and Website Links -->
        <div
          style="
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: var(--space-3);
          "
        >
          <button
            onclick="openUserGuide()"
            style="
              background: transparent;
              border: 1px solid rgba(139, 92, 246, 0.3);
              color: #a78bfa;
              padding: 6px 12px;
              border-radius: 20px;
              font-size: 11px;
              cursor: pointer;
            "
          >
            Open User Guide
          </button>

          <a
            href="https://bridgy-plugin.com/"
            target="_blank"
            style="
              display: inline-flex;
              align-items: center;
              gap: 4px;
              color: #c4b5fd;
              font-size: 13px;
              text-decoration: none;
            "
          >
            Visit Website
            <span class="material-symbols-outlined" style="font-size: 14px">open_in_new</span>
          </a>
        </div>
      </div>
    </div>
    <div
      class="modal-footer"
      style="display: flex; justify-content: space-between; align-items: center"
    >
      <div style="display: flex; gap: var(--space-2)">
        <button
          onclick="showResetConfirmation()"
          class="btn-error"
          title="Reset all configuration"
          style="display: flex; align-items: center; gap: 6px"
        >
          <svg
            width="14"
            height="14"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <polyline points="3,6 5,6 21,6"></polyline>
            <path
              d="M19,6V20A2,2 0 0,1 17,20H7A2,2 0 0,1 5,20V6M8,6V4A2,2 0 0,1 10,4H14A2,2 0 0,1 16,4V6"
            ></path>
            <line x1="10" y1="11" x2="10" y2="17"></line>
            <line x1="14" y1="11" x2="14" y2="17"></line>
          </svg>
          Reset
        </button>
      </div>
      <div style="display: flex; gap: var(--space-2)">
        <button onclick="closeSettingsModal()" class="btn-secondary">Cancel</button>
        <button id="config-save-btn" onclick="saveConfiguration()" class="btn-primary" disabled>
          Save Configuration
        </button>
      </div>
    </div>
  </div>
</div>

<!-- User Guide Modal -->
<div id="user-guide-modal" class="modal" style="display: none">
  <div class="modal-content" style="max-width: 800px">
    <button class="close-modal" onclick="closeUserGuide()">
      <span class="material-symbols-outlined">close</span>
    </button>
    <div class="modal-header">
      <h3>üé® Bridgy - User Guide</h3>
      <p style="margin: 4px 0 0; color: rgba(255, 255, 255, 0.6); font-size: 13px">
        Bridging the gap between designers and developers
      </p>
    </div>

    <div class="modal-body" style="padding: 24px; max-height: 70vh; overflow-y: auto">
      <!-- Welcome Banner -->
      <div
        style="
          background: linear-gradient(135deg, rgba(88, 28, 135, 0.8), rgba(124, 58, 237, 0.6));
          border-radius: 12px;
          padding: 20px;
          margin-bottom: 24px;
          border: 1px solid rgba(139, 92, 246, 0.3);
        "
      >
        <h4 style="margin: 0 0 8px 0; font-size: 16px; color: white">üöÄ Welcome to Bridgy!</h4>
        <p style="margin: 0; font-size: 13px; color: rgba(255, 255, 255, 0.9); line-height: 1.5">
          This plugin helps designers and developers work together seamlessly. Export Figma
          variables as CSS, generate component tests, and commit changes directly to your
          repository.
        </p>
      </div>

      <!-- Collaboration Process -->
      <h4
        style="
          margin: 0 0 16px 0;
          font-size: 14px;
          color: var(--text-primary);
          display: flex;
          align-items: center;
          gap: 8px;
        "
      >
        <span
          class="material-symbols-outlined"
          style="font-size: 18px; color: rgba(255, 255, 255, 0.8)"
          >assignment</span
        >
        Collaboration Process
      </h4>

      <div
        class="collaboration-guide"
        style="display: flex; flex-direction: column; gap: 12px; margin-bottom: 32px"
      >
        <!-- Step 1 -->
        <div
          class="guide-step-card"
          style="
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 16px;
          "
        >
          <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px">
            <div
              style="
                background: var(--purple-600);
                color: white;
                width: 24px;
                height: 24px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                font-weight: bold;
                font-size: 13px;
              "
            >
              1
            </div>
            <h4 style="margin: 0; font-size: 14px; color: var(--text-primary)">
              Initial Setup (One-time)
            </h4>
          </div>
          <div
            style="
              margin-left: 36px;
              font-size: 13px;
              color: rgba(255, 255, 255, 0.8);
              line-height: 1.6;
            "
          >
            <p style="margin: 0 0 8px 0">
              <strong style="color: #a78bfa">üë®‚Äçüíª Developer:</strong> Sets up project configuration in
              the settings (‚öôÔ∏è icon):
            </p>
            <ul
              style="
                margin: 0;
                padding-left: 16px;
                list-style-type: disc;
                color: rgba(255, 255, 255, 0.7);
              "
            >
              <li>GitLab Project ID and Access Token</li>
              <li>File path for CSS variables</li>
              <li>Branch naming strategy</li>
              <li>Commit vs. Merge Request workflow</li>
            </ul>
          </div>
        </div>

        <!-- Step 2 -->
        <div
          class="guide-step-card"
          style="
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 16px;
          "
        >
          <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px">
            <div
              style="
                background: var(--purple-600);
                color: white;
                width: 24px;
                height: 24px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                font-weight: bold;
                font-size: 13px;
              "
            >
              2
            </div>
            <h4 style="margin: 0; font-size: 14px; color: var(--text-primary)">
              Testing & Validation
            </h4>
          </div>
          <div
            style="
              margin-left: 36px;
              font-size: 13px;
              color: rgba(255, 255, 255, 0.8);
              line-height: 1.6;
            "
          >
            <p style="margin: 0 0 8px 0">
              <strong style="color: #a78bfa">üé® Designer:</strong> Tests the setup by making a small
              change and committing it:
            </p>
            <ul
              style="
                margin: 0;
                padding-left: 16px;
                list-style-type: disc;
                color: rgba(255, 255, 255, 0.7);
              "
            >
              <li>Ensures variables sync correctly</li>
              <li>Verifies the commit process works</li>
              <li>Confirms the file appears in the repository</li>
            </ul>
          </div>
        </div>

        <!-- Step 3 -->
        <div
          class="guide-step-card"
          style="
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 16px;
          "
        >
          <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px">
            <div
              style="
                background: var(--purple-600);
                color: white;
                width: 24px;
                height: 24px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                font-weight: bold;
                font-size: 13px;
              "
            >
              3
            </div>
            <h4 style="margin: 0; font-size: 14px; color: var(--text-primary)">Daily Workflow</h4>
          </div>
          <div
            style="
              margin-left: 36px;
              font-size: 13px;
              color: rgba(255, 255, 255, 0.8);
              line-height: 1.6;
            "
          >
            <div style="margin-bottom: 12px">
              <p style="margin: 0 0 4px 0">
                <strong style="color: #a78bfa">üé® Designer ‚Äì Update & Sync Designs</strong>
              </p>
              <ul
                style="
                  margin: 0;
                  padding-left: 16px;
                  list-style-type: disc;
                  color: rgba(255, 255, 255, 0.7);
                "
              >
                <li>Make design changes in Figma (colors, spacing, typography, etc.)</li>
                <li>Open the Bridgy plugin</li>
                <li>Review changes in the Variables tab</li>
                <li>Commit to Repository with a clear, descriptive message</li>
              </ul>
            </div>
            <div>
              <p style="margin: 0 0 4px 0">
                <strong style="color: #a78bfa">üë®‚Äçüíª Developer ‚Äì Generate Tests & Implement</strong>
              </p>
              <ul
                style="
                  margin: 0;
                  padding-left: 16px;
                  list-style-type: disc;
                  color: rgba(255, 255, 255, 0.7);
                "
              >
                <li>Open the Bridgy plugin</li>
                <li>Generate comprehensive component tests from the Figma designs</li>
                <li>Commit tests to a dedicated feature branch</li>
                <li>
                  Check out the branch & implement components using a test-driven development
                  approach
                </li>
                <li>Review & integrate CSS variable changes from the designer</li>
              </ul>
            </div>
          </div>
        </div>
      </div>

      <!-- Key Features -->
      <h4
        style="
          margin: 0 0 16px 0;
          font-size: 14px;
          color: var(--text-primary);
          display: flex;
          align-items: center;
          gap: 8px;
        "
      >
        <span
          class="material-symbols-outlined"
          style="font-size: 18px; color: rgba(255, 255, 255, 0.8)"
          >stars</span
        >
        Key Features
      </h4>
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 32px">
        <div
          style="
            background: rgba(255, 255, 255, 0.03);
            padding: 12px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.05);
          "
        >
          <h5 style="margin: 0 0 4px 0; font-size: 13px; color: #a78bfa">üé® Variables Export</h5>
          <p style="margin: 0; font-size: 11px; color: rgba(255, 255, 255, 0.6); line-height: 1.4">
            Export Figma variables as CSS custom properties, ready for development use.
          </p>
        </div>
        <div
          style="
            background: rgba(255, 255, 255, 0.03);
            padding: 12px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.05);
          "
        >
          <h5 style="margin: 0 0 4px 0; font-size: 13px; color: #a78bfa">üß™ Test Generation</h5>
          <p style="margin: 0; font-size: 11px; color: rgba(255, 255, 255, 0.6); line-height: 1.4">
            Generate Angular component tests to ensure designs match implementation.
          </p>
        </div>
        <div
          style="
            background: rgba(255, 255, 255, 0.03);
            padding: 12px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.05);
          "
        >
          <h5 style="margin: 0 0 4px 0; font-size: 13px; color: #a78bfa">üì° GitLab Integration</h5>
          <p style="margin: 0; font-size: 11px; color: rgba(255, 255, 255, 0.6); line-height: 1.4">
            Commit changes directly to GitLab with automatic merge request creation.
          </p>
        </div>
        <div
          style="
            background: rgba(255, 255, 255, 0.03);
            padding: 12px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.05);
          "
        >
          <h5 style="margin: 0 0 4px 0; font-size: 13px; color: #a78bfa">üîç Search & Filter</h5>
          <p style="margin: 0; font-size: 11px; color: rgba(255, 255, 255, 0.6); line-height: 1.4">
            Easily find and review specific variables and components before export.
          </p>
        </div>
      </div>

      <!-- Workflow Strategies -->
      <h4
        style="
          margin: 0 0 16px 0;
          font-size: 14px;
          color: var(--text-primary);
          display: flex;
          align-items: center;
          gap: 8px;
        "
      >
        <span
          class="material-symbols-outlined"
          style="font-size: 18px; color: rgba(255, 255, 255, 0.8)"
          >settings</span
        >
        Workflow Strategies
      </h4>
      <div style="display: flex; flex-direction: column; gap: 12px; margin-bottom: 32px">
        <div
          style="
            background: rgba(255, 255, 255, 0.03);
            border-left: 3px solid #34d399;
            padding: 12px;
            border-radius: 0 8px 8px 0;
          "
        >
          <h5 style="margin: 0 0 4px 0; font-size: 13px; color: #34d399">
            üîÑ Merge Request Strategy (Recommended)
          </h5>
          <p style="margin: 0; font-size: 12px; color: rgba(255, 255, 255, 0.7); line-height: 1.5">
            Each commit creates a merge request. Multiple commits to the same feature get added to
            the same MR. Perfect for collaborative review and controlled integration.
          </p>
        </div>
        <div
          style="
            background: rgba(255, 255, 255, 0.03);
            border-left: 3px solid #fbbf24;
            padding: 12px;
            border-radius: 0 8px 8px 0;
          "
        >
          <h5 style="margin: 0 0 4px 0; font-size: 13px; color: #fbbf24">
            ‚ö° Direct Commit Strategy
          </h5>
          <p style="margin: 0; font-size: 12px; color: rgba(255, 255, 255, 0.7); line-height: 1.5">
            Changes go directly to the main branch. Faster but requires more trust in the design
            changes. Best for mature teams with established processes.
          </p>
        </div>
      </div>

      <!-- Pro Tips -->
      <div
        style="
          background: rgba(139, 92, 246, 0.1);
          border: 1px solid rgba(139, 92, 246, 0.3);
          border-radius: 12px;
          padding: 16px;
        "
      >
        <h4
          style="
            margin: 0 0 12px 0;
            font-size: 14px;
            color: #c4b5fd;
            display: flex;
            align-items: center;
            gap: 8px;
          "
        >
          <span class="material-symbols-outlined" style="font-size: 18px">lightbulb</span>
          Pro Tips
        </h4>
        <ul
          style="
            margin: 0;
            padding-left: 20px;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
            line-height: 1.6;
            list-style-type: circle;
          "
        >
          <li>
            Use descriptive commit messages (e.g., "Update primary colors for better accessibility")
          </li>
          <li>Review variables before committing to catch any unintended changes</li>
          <li>Coordinate with developers for major design system changes</li>
          <li>Test the setup with small changes before making large updates</li>
          <li>Keep your Figma variable names consistent and descriptive</li>
        </ul>
      </div>

      <div
        style="
          text-align: right;
          margin-top: 24px;
          padding-top: 16px;
          border-top: 1px solid rgba(255, 255, 255, 0.1);
        "
      >
        <button onclick="closeUserGuide()" class="btn-primary" style="padding: 8px 24px">
          Got It!
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Reset Confirmation Modal -->
<div id="reset-confirmation-modal" class="modal" style="display: none">
  <div class="modal-content" style="max-width: 500px">
    <button class="close-modal" onclick="closeResetConfirmation()">
      <span class="material-symbols-outlined">close</span>
    </button>
    <div class="modal-header">
      <h3 style="color: #dc3545; display: flex; align-items: center; gap: 10px">
        <svg
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <circle cx="12" cy="12" r="10"></circle>
          <line x1="15" y1="9" x2="9" y2="15"></line>
          <line x1="9" y1="9" x2="15" y2="15"></line>
        </svg>
        Reset Configuration
      </h3>
    </div>
    <div class="modal-body">
      <div
        style="
          background: rgba(251, 191, 36, 0.1);
          backdrop-filter: blur(10px);
          border: 1px solid rgba(251, 191, 36, 0.3);
          border-radius: 15px;
          padding: 16px;
          margin-bottom: 20px;
          box-shadow: 0 8px 32px rgba(251, 191, 36, 0.1);
        "
      >
        <p style="margin: 0; color: #fbbf24; font-weight: 500">
          ‚ö†Ô∏è Warning: This action cannot be undone!
        </p>
      </div>

      <p style="margin-bottom: 16px; line-height: 1.5">
        This will permanently delete
        <strong>all configuration data</strong> for this Figma project, including:
      </p>

      <ul style="margin: 0 0 20px 20px; line-height: 1.6; color: rgba(255, 255, 255, 0.85)">
        <li>GitLab Project ID and access token</li>
        <li>File path and branch settings</li>
        <li>Strategy preferences (commit vs merge request)</li>
        <li>All saved metadata (who saved, when)</li>
      </ul>

      <p style="margin: 0; color: rgba(255, 255, 255, 0.8); font-style: italic">
        After reset, you'll need to reconfigure everything from scratch.
      </p>
    </div>
    <div class="modal-footer">
      <button onclick="closeResetConfirmation()">Cancel</button>
      <button
        onclick="confirmReset()"
        style="
          background: #dc3545;
          color: white;
          border: none;
          padding: 10px 16px;
          border-radius: var(--radius-lg);
          cursor: pointer;
          font-weight: 500;
        "
      >
        Yes, Reset Everything
      </button>
    </div>
  </div>
</div>

<!-- Repository Browser Modal -->
<div id="repository-browser-modal" class="modal" style="display: none">
  <div class="modal-content" style="max-width: 600px">
    <button class="close-modal" onclick="closeRepositoryBrowser()">
      <span class="material-symbols-outlined">close</span>
    </button>
    <div class="modal-header">
      <h3>Select Repository</h3>
    </div>
    <div class="modal-body">
      <div class="search-container" style="margin-bottom: 16px">
        <input
          type="text"
          id="repo-search"
          class="search-input"
          placeholder="Search repositories..."
          onkeyup="filterRepositories()"
          style="width: 100%"
        />
      </div>
      <div id="repo-list-container" style="max-height: 400px; overflow-y: auto">
        <div class="content-loading">
          <div class="content-loading-spinner"></div>
          <div class="content-loading-text">Loading repositories...</div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Branch Browser Modal -->
<div id="branch-browser-modal" class="modal" style="display: none">
  <div class="modal-content" style="max-width: 500px">
    <button class="close-modal" onclick="closeBranchBrowser()">
      <span class="material-symbols-outlined">close</span>
    </button>
    <div class="modal-header">
      <h3>Select Branch</h3>
    </div>
    <div class="modal-body">
      <div class="search-container" style="margin-bottom: 16px">
        <input
          type="text"
          id="branch-search"
          class="search-input"
          placeholder="Search branches..."
          onkeyup="filterBranches()"
          style="width: 100%"
        />
      </div>
      <div id="branch-list-container" style="max-height: 300px; overflow-y: auto">
        <div class="content-loading">
          <div class="content-loading-spinner"></div>
          <div class="content-loading-text">Loading branches...</div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Success message (hidden by default) -->
<div id="success-message" class="success-message" style="display: none">
  <p>Successfully committed to GitLab repository!</p>
</div>

<!-- Import Variables Modal -->
<div id="import-modal" class="modal" style="display: none">
  <div class="modal-content" style="max-width: 800px">
    <button class="close-modal" onclick="closeImportModal()">
      <span class="material-symbols-outlined">close</span>
    </button>
    <div class="modal-header">
      <h3>Import Variables</h3>
    </div>
    <div class="modal-body">
      <div id="variable-import-container">
        <div class="import-section">
          <div class="import-header">
            <p>Paste CSS, SCSS, or Tailwind configuration to import variables.</p>
          </div>

          <div class="import-input-area">
            <textarea
              id="import-input"
              placeholder="Paste your code here...&#10;CSS/SCSS: :root { --primary: #3b82f6; }&#10;Tailwind Config: { theme: { colors: { primary: '#3b82f6' } } }"
              spellcheck="false"
            ></textarea>
          </div>

          <div class="import-actions-bar">
            <div class="import-options">
              <select id="import-collection-select" class="select-input">
                <!-- Populated dynamically -->
                <option value="">New Collection...</option>
              </select>
            </div>
            <button id="preview-import-btn" class="btn-primary" disabled>Preview Import</button>
          </div>

          <!-- Preview Section (Hidden by default) -->
          <div id="import-preview-section" class="import-preview-section hidden">
            <div class="preview-header">
              <h4 style="display: flex; align-items: center; gap: 8px">
                <span
                  class="material-symbols-outlined"
                  style="font-size: 18px; color: var(--purple-light)"
                  >preview</span
                >
                Import Preview
              </h4>
              <div class="preview-stats">
                <span
                  id="preview-stat-total"
                  class="badge"
                  style="display: flex; align-items: center; gap: 4px"
                >
                  <span class="material-symbols-outlined" style="font-size: 14px">functions</span>
                  <span>0</span>
                </span>
                <span
                  id="preview-stat-new"
                  class="badge badge-success"
                  style="display: flex; align-items: center; gap: 4px"
                >
                  <span class="material-symbols-outlined" style="font-size: 14px">add_circle</span>
                  <span>0</span>
                </span>
                <span
                  id="preview-stat-update"
                  class="badge badge-warning"
                  style="display: flex; align-items: center; gap: 4px"
                >
                  <span class="material-symbols-outlined" style="font-size: 14px">sync</span>
                  <span>0</span>
                </span>
                <span
                  id="preview-stat-conflict"
                  class="badge badge-danger"
                  style="display: flex; align-items: center; gap: 4px"
                >
                  <span class="material-symbols-outlined" style="font-size: 14px">warning</span>
                  <span>0</span>
                </span>
              </div>
            </div>

            <div
              class="preview-toolbar"
              style="
                display: flex;
                gap: 2px;
                margin-bottom: 12px;
                padding: 8px;
                background: rgba(0, 0, 0, 0.2);
                border-radius: var(--radius-md);
                align-items: center;
              "
            >
              <button
                class="compact-action-btn"
                id="select-all-import"
                data-tooltip="Select All"
                style="
                  display: flex;
                  align-items: center;
                  justify-content: center;
                  width: 32px;
                  height: 32px;
                  padding: 0;
                "
              >
                <span class="material-symbols-outlined" style="font-size: 18px">select_all</span>
              </button>
              <button
                class="compact-action-btn"
                id="deselect-all-import"
                data-tooltip="Deselect All"
                style="
                  display: flex;
                  align-items: center;
                  justify-content: center;
                  width: 32px;
                  height: 32px;
                  padding: 0;
                "
              >
                <span class="material-symbols-outlined" style="font-size: 18px">deselect</span>
              </button>
              <div
                style="border-left: 1px solid rgba(255, 255, 255, 0.1); height: 16px; margin: 0 4px"
              ></div>
              <button
                class="compact-action-btn"
                id="expand-all-import"
                data-tooltip="Expand All Groups"
                style="width: 32px; height: 32px; justify-content: center"
              >
                <span class="material-symbols-outlined" style="font-size: 18px">unfold_more</span>
              </button>
              <button
                class="compact-action-btn"
                id="collapse-all-import"
                data-tooltip="Collapse All Groups"
                style="width: 32px; height: 32px; justify-content: center"
              >
                <span class="material-symbols-outlined" style="font-size: 18px">unfold_less</span>
              </button>
            </div>

            <div
              class="import-settings"
              style="
                margin-bottom: 16px;
                background: rgba(255, 255, 255, 0.03);
                padding: 12px;
                border-radius: var(--radius-md);
                border: 1px solid rgba(255, 255, 255, 0.05);
              "
            >
              <h5
                style="
                  margin: 0 0 12px 0;
                  font-size: 11px;
                  text-transform: uppercase;
                  letter-spacing: 0.5px;
                  opacity: 0.6;
                  font-weight: 600;
                "
              >
                Settings
              </h5>

              <div style="display: flex; flex-direction: column; gap: 8px">
                <label class="toggle-switch">
                  <input type="checkbox" class="toggle-input" id="organize-by-categories" checked />
                  <div class="toggle-slider"></div>
                  <span class="settings-label" style="margin-bottom: 0"
                    >Organize by categories</span
                  >
                  <span
                    class="material-symbols-outlined"
                    style="font-size: 14px; opacity: 0.4; cursor: help"
                    data-tooltip="Group variables into categories based on their names (e.g. 'color/primary' -> 'color' group)"
                    >help</span
                  >
                </label>

                <label class="toggle-switch">
                  <input
                    type="checkbox"
                    class="toggle-input"
                    id="overwrite-existing"
                    onchange="
                      document.getElementById('overwrite-warning').style.display = this.checked
                        ? 'flex'
                        : 'none'
                    "
                  />
                  <div class="toggle-slider"></div>
                  <span class="settings-label" style="margin-bottom: 0"
                    >Overwrite existing variables</span
                  >
                  <span
                    class="material-symbols-outlined"
                    style="font-size: 14px; opacity: 0.4; cursor: help"
                    data-tooltip="If checked, existing variables with the same name will be overwritten."
                    >help</span
                  >
                </label>
              </div>

              <div
                id="overwrite-warning"
                class="info-banner warning"
                style="
                  margin-top: 12px;
                  display: none;
                  font-size: 11px;
                  padding: 8px 12px;
                  border-radius: 6px;
                  background: rgba(234, 179, 8, 0.1);
                  color: #facc15;
                  align-items: flex-start;
                  gap: 8px;
                  line-height: 1.4;
                "
              >
                <span class="material-symbols-outlined" style="font-size: 16px">warning</span>
                <span
                  >Existing variables with the exact same name will be updated with new
                  values.</span
                >
              </div>
            </div>

            <div class="preview-table-container" style="max-height: 250px">
              <table class="preview-table">
                <thead>
                  <tr>
                    <th style="width: 40%">Variable</th>
                    <th style="width: 15%">Type</th>
                    <th style="width: 30%">Value</th>
                    <th style="width: 15%">Status</th>
                  </tr>
                </thead>
                <tbody id="preview-table-body">
                  <!-- Populated dynamically -->
                </tbody>
              </table>
            </div>

            <div class="import-confirmation-actions" style="margin-top: 12px">
              <button id="cancel-import-btn" class="btn-secondary">Cancel</button>
              <button
                id="confirm-import-btn"
                class="btn-primary"
                style="display: flex; align-items: center; gap: 6px"
              >
                <span class="material-symbols-outlined" style="font-size: 18px">upload</span>
                Import Variables
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Units Configuration Modal -->
<div id="units-modal" class="modal" style="display: none">
  <div class="modal-content" style="max-width: 700px">
    <button class="close-modal" onclick="closeUnitsModal()">
      <span class="material-symbols-outlined">close</span>
    </button>
    <div class="modal-header">
      <h3>Variable Units Settings</h3>
    </div>
    <div class="modal-body">
      <p style="color: rgba(255, 255, 255, 0.8); margin-bottom: 16px">
        Configure units for numeric variables. Collections override defaults, groups override
        collections.
      </p>
      <div style="display: flex; gap: 10px; margin-bottom: 16px">
        <button
          id="reset-units-button-modal"
          style="background-color: #f44336"
          onclick="window.resetUnitsSettings()"
        >
          Reset to Smart Defaults
        </button>
        <button id="save-units-button-modal" disabled onclick="saveUnitsAndCloseModal()">
          Save Unit Settings
        </button>
      </div>
      <div id="units-settings-container">
        <div class="loading">Loading unit settings...</div>
      </div>
    </div>
  </div>
</div>

<!-- Error message (hidden by default) -->
<div id="error-message" class="error-message" style="display: none">
  <p>
    <strong>Error committing to GitLab:</strong>
    <span id="error-details"></span>
  </p>
  <p class="error-help">Please check your credentials and try again.</p>
</div>

<!-- Create Variable Modal -->
<div id="create-variable-modal" class="modal">
  <div class="modal-content">
    <button class="close-modal" onclick="closeCreateVariableModal()">
      <span class="material-symbols-outlined">close</span>
    </button>
    <div class="modal-header">
      <h3>Create New Variable</h3>
    </div>
    <div class="modal-body">
      <p>
        Create a new variable for value:
        <strong
          id="create-var-value-display"
          style="color: var(--purple-light); font-family: monospace"
        ></strong>
      </p>

      <!-- Collection Section -->
      <div class="form-group">
      <!-- Collection Section -->
      <div class="form-group">
        <label for="create-var-collection">Collection</label>
        <select
          id="create-var-collection"
          onchange="handleCollectionChange()"
          class="select-field"
        >
          <!-- Populated by JS -->
        </select>
        <input
          type="text"
          id="create-var-new-collection"
          placeholder="New Collection Name"
          class="input-field"
          style="display: none; margin-top: 4px;"
        />
        <div class="settings-helper">Select target collection</div>
      </div>

      <!-- Group Section -->
      <div class="form-group">
        <label for="create-var-group">Group</label>
        <select
          id="create-var-group"
          onchange="handleGroupChange()"
          class="select-field"
        >
          <option value="">(No Group)</option>
          <option value="create-new">Create New Group...</option>
        </select>
        <input
          type="text"
          id="create-var-new-group"
          class="input-field"
          placeholder="New Group Name (e.g. colors/primary)"
          style="display: none; margin-top: 4px;"
        />
        <div class="settings-helper">Select existing group or create new</div>
      </div>

      <!-- Variable Name Section -->
      <div class="form-group">
        <label for="create-var-name">Variable Name</label>
            <input 
              type="text" 
              id="create-var-name" 
              placeholder="e.g. primary-500" 
              oninput="this.value = this.value.replace(/\./g, '-')"
              class="input-variable-name"
            />
        <div class="settings-helper" style="margin-top: 8px;">Final variable name (will be combined with group)</div>
      </div>

      <input type="hidden" id="create-var-issue-id" />
    </div>
    <div class="modal-footer modal-footer-seamless">
      <button onclick="closeCreateVariableModal()" class="btn-secondary-glass">Cancel</button>
      <button onclick="submitCreateVariable()" class="btn-primary-gradient">Create Variable</button>
    </div>
  </div>
  </div>
</div>

<!-- Notification Container (Moved to end for stacking context) -->
<div id="notification-container" class="notification-container"></div>
