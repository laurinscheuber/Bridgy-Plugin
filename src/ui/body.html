    <!-- Initial Loading Overlay -->
    <div id="plugin-loading-overlay" class="plugin-loading-overlay">
      <div class="plugin-loading-content">
        <div class="plugin-loading-spinner"></div>
        <div class="plugin-loading-title">Bridgy</div>
        <div id="plugin-loading-status" class="plugin-loading-status">Initializing plugin...</div>
        <div class="plugin-loading-progress">
          <div id="plugin-loading-progress-bar" class="plugin-loading-progress-bar"></div>
        </div>
      </div>
    </div>

    <!-- Notification Container -->
    <div id="notification-container" class="notification-container"></div>
    
    <div class="container">
      <!-- Modern Header -->
      <header class="header">
        <div class="header-content">
          <div class="header-title">
            <h1>Bridgy</h1>
            <div class="beta-badge" onclick="toggleFeedback()" style="cursor: pointer;" data-tooltip="Click to show feedback">BETA</div>
          </div>
          <div class="header-actions">
            <button
              id="refresh-btn"
              onclick="refreshData()"
              class="refresh-button"
              data-tooltip="Refresh variables and components"
            >
              <span class="material-symbols-outlined">refresh</span>
            </button>
            <button
              id="units-icon-btn"
              onclick="openUnitsModal()"
              class="settings-icon"
              data-tooltip="Units Configuration"
            >
              <span class="material-symbols-outlined">straighten</span>
            </button>
            <button
              id="help-icon-btn"
              onclick="openUserGuide()"
              class="settings-icon"
              data-tooltip="User Guide"
            >
              <span class="material-symbols-outlined">help</span>
            </button>
            <button
              id="settings-icon-btn"
              onclick="openSettingsModal()"
              class="settings-icon"
              data-tooltip="Settings"
            >
              <span class="material-symbols-outlined">settings</span>
            </button>
            <a
              id="repo-link-button"
              class="repo-link-button"
              href="#"
              target="_blank"
              data-tooltip="Open Repository"
              style="display: none;"
            >
              <span class="material-symbols-outlined repo-link-icon">link</span>
              <span>Repository</span>
            </a>
          </div>
        </div>
      </header>

      <!-- Toggleable Feedback Section -->
      <div id="feedback-section" class="feedback-section" style="display: none;">
        <div class="feedback-header">
          <div class="feedback-title">
            <span class="material-symbols-outlined" style="font-size: 20px;">campaign</span>
            Welcome to Bridgy BETA!
          </div>
          <div style="display: flex; align-items: center; gap: var(--space-2);">
            <a href="https://bridgy-plugin.com/" target="_blank" class="feedback-website-link">
              Visit our website
              <span class="material-symbols-outlined" style="font-size: 14px; margin-left: 2px;">open_in_new</span>
            </a>
            <button class="feedback-close-btn" onclick="dismissFeedback()" title="Dismiss">
              <span class="material-symbols-outlined">close</span>
            </button>
          </div>
        </div>
        <p class="feedback-description">
          Thank you for trying Bridgy! We're actively improving based on your feedback.
        </p>
        <div class="feedback-buttons">
          <button class="feedback-button" onclick="openGitHubFeedback('bug')">
            <span class="feedback-button-icon">üêõ</span>
            <span>Report Bug</span>
          </button>
          <button class="feedback-button" onclick="openGitHubFeedback('feature')">
            <span class="feedback-button-icon">üí°</span>
            <span>Request Feature</span>
          </button>
          <button class="feedback-button" onclick="openGitHubFeedback('general')">
            <span class="feedback-button-icon">üí≠</span>
            <span>General Feedback</span>
          </button>
        </div>
      </div>

      <div class="tabs">
        <div class="tab active" data-tab="variables">Variables</div>
        <div class="tab" data-tab="components">Components</div>
        <div class="tab" data-tab="quality">Quality</div>
      </div>

      <div class="tab-content active" id="variables-content">
        <div class="content-padding">
          <!-- Tab Header -->
          <div class="tab-header" style="margin-bottom: var(--space-2);">
            <div style="display: flex; align-items: baseline; gap: 12px; margin-bottom: 8px;">
              <h2 style="color: rgba(255, 255, 255, 0.9); display: flex; align-items: center; gap: 10px; font-size: 1.2rem; margin: 0;">
                <span class="material-symbols-outlined" style="font-size: 22px; color: var(--purple-light);">data_object</span>
                Design Variables
              </h2>
              <div id="variables-summary" class="header-summary">
                <span id="variables-count">0 vars</span> ‚Ä¢ <span id="collections-count">0 cols</span>
              </div>
            </div>
            <p style="color: rgba(255, 255, 255, 0.6); font-size: 12px; margin: 0;">
              View and manage your Figma design tokens. Export to CSS or commit directly to your repository.
            </p>
          </div>

          <div class="toolbar">
            <div class="toolbar-group">
              <button id="export-css-button" class="compact-action-btn" disabled title="Download CSS" style="width: auto; padding: 0 8px;">
                <span class="material-symbols-outlined">download</span>
                <span class="toolbar-btn-text">Download</span>
              </button>
              <button id="commit-repo-button" class="compact-action-btn" disabled title="Commit to repository" style="width: auto; padding: 0 8px;">
                <span class="material-symbols-outlined">commit</span>
                <span class="toolbar-btn-text">Commit</span>
              </button>
              <button id="import-icon-button" class="compact-action-btn" onclick="openImportModal()" title="Import variables" style="width: auto; padding: 0 8px;">
                <span class="material-symbols-outlined">input</span>
                <span class="toolbar-btn-text">Import</span>
              </button>
            </div>

            <div id="variable-search-wrapper" class="search-wrapper-collapsible">
              <div class="search-input-wrapper" style="flex: 1;">
                <input
                  type="text"
                  class="search-input"
                  id="variable-search"
                  placeholder="Search variables..."
                />
                <button class="search-clear-btn" id="clear-variable-search" onclick="clearSearch('variable-search')">
                  <span class="material-symbols-outlined" style="font-size: 16px;">close</span>
                </button>
              </div>
            </div>

            <div class="toolbar-group">
              <button class="compact-action-btn" onclick="toggleSearchBar('variable-search-wrapper')" title="Toggle Search">
                <span class="material-symbols-outlined">search</span>
              </button>
              <button class="compact-action-btn" onclick="expandAllVariables()" title="Expand all collections">
                <span class="material-symbols-outlined">unfold_more</span>
              </button>
              <button class="compact-action-btn" onclick="collapseAllVariables()" title="Collapse all collections">
                <span class="material-symbols-outlined">unfold_less</span>
              </button>
            </div>
          </div>
          <div id="variables-container">
            <div class="content-loading">
              <div class="content-loading-spinner"></div>
              <div class="content-loading-text">Loading variables and design tokens...</div>
            </div>
          </div>
        </div>
      </div>

      <div class="tab-content" id="quality-content">
        <div class="content-padding">
          <!-- Tab Header -->
          <div class="tab-header" style="margin-bottom: var(--space-2);">
            <div style="display: flex; align-items: baseline; gap: 12px; margin-bottom: 8px;">
               <h2 style="color: rgba(255, 255, 255, 0.9); display: flex; align-items: center; gap: 10px; font-size: 1.2rem; margin: 0;">
                <span class="material-symbols-outlined" style="font-size: 22px; color: var(--purple-light);">fact_check</span>
                Token Coverage
              </h2>
            </div>
            <p style="color: rgba(255, 255, 255, 0.6); font-size: 12px; margin: 0;">
              Identify elements using hard-coded values instead of design tokens.
            </p>
          </div>

          <div class="toolbar">
            <div class="toolbar-group">
              <button id="analyze-token-coverage-btn" class="compact-action-btn" onclick="analyzeTokenCoverage()" title="Analyze Current Page" style="width: auto; padding: 0 8px;">
                <span class="material-symbols-outlined">refresh</span>
                <span class="toolbar-btn-text">Analyze</span>
              </button>
            </div>

            <div id="quality-search-wrapper" class="search-wrapper-collapsible">
              <div class="search-input-wrapper" style="flex: 1;">
                <input
                  type="text"
                  class="search-input"
                  id="quality-search"
                  placeholder="Search issues..."
                />
                <button class="search-clear-btn" id="clear-quality-search" onclick="clearSearch('quality-search')">
                  <span class="material-symbols-outlined" style="font-size: 16px;">close</span>
                </button>
              </div>
            </div>

            <div class="toolbar-group">
              <button class="compact-action-btn" onclick="toggleSearchBar('quality-search-wrapper')" title="Toggle Search">
                <span class="material-symbols-outlined">search</span>
              </button>
              <button class="compact-action-btn" onclick="expandAllQuality()" title="Expand all issues">
                <span class="material-symbols-outlined">unfold_more</span>
              </button>
              <button class="compact-action-btn" onclick="collapseAllQuality()" title="Collapse all issues">
                <span class="material-symbols-outlined">unfold_less</span>
              </button>
            </div>
          </div>

          <div id="token-coverage-results">
            <div class="content-loading" style="display: none;">
              <div class="content-loading-spinner"></div>
              <div class="content-loading-text">Analyzing token coverage...</div>
            </div>
          </div>
        </div>
      </div>

      <div class="tab-content" id="components-content">
        <div class="content-padding">
          <!-- Tab Header -->
          <div class="tab-header" style="margin-bottom: var(--space-2);">
            <div style="display: flex; align-items: baseline; gap: 12px; margin-bottom: 8px;">
              <h2 style="color: rgba(255, 255, 255, 0.9); display: flex; align-items: center; gap: 10px; font-size: 1.2rem; margin: 0;">
                <span class="material-symbols-outlined" style="font-size: 22px; color: var(--purple-light);">widgets</span>
                Components
              </h2>
              <div id="components-summary" class="header-summary">
                <span id="components-count">0 comps</span> ‚Ä¢ <span id="component-sets-count">0 sets</span>
              </div>
            </div>
            <p style="color: rgba(255, 255, 255, 0.6); font-size: 12px; margin: 0;">
              Browse your component library. Generate CSS or commit component styles to your repository.
            </p>
          </div>

          <div class="toolbar">
            <div class="toolbar-group">
              <div style="width: 8px;"></div>
            </div>

            <div id="component-search-wrapper" class="search-wrapper-collapsible">
              <div class="search-input-wrapper" style="flex: 1;">
                <input
                  type="text"
                  class="search-input"
                  id="component-search"
                  placeholder="Search components..."
                />
                <button class="search-clear-btn" id="clear-component-search" onclick="clearSearch('component-search')">
                  <span class="material-symbols-outlined" style="font-size: 16px;">close</span>
                </button>
              </div>
            </div>

            <div class="toolbar-group">
              <button class="compact-action-btn" onclick="toggleSearchBar('component-search-wrapper')" title="Toggle Search">
                <span class="material-symbols-outlined">search</span>
              </button>
              <button class="compact-action-btn" onclick="expandAllComponents()" title="Expand all component sets">
                <span class="material-symbols-outlined">unfold_more</span>
              </button>
              <button class="compact-action-btn" onclick="collapseAllComponents()" title="Collapse all component sets">
                <span class="material-symbols-outlined">unfold_less</span>
              </button>
            </div>
          </div>

          <div id="components-container">
            <div class="content-loading">
              <div class="content-loading-spinner"></div>
              <div class="content-loading-text">Scanning document for components...</div>
            </div>
          </div>
        </div>
      </div>

    </div>

    <!-- GitLab Commit Modal -->
    <div id="gitlab-modal" class="modal">
      <div class="modal-content">
        <button class="close-modal" onclick="closeGitLabModal()">
          <span class="material-symbols-outlined">close</span>
        </button>
        <div class="modal-header">
          <h3>Commit to Repository</h3>
        </div>
        <div class="modal-body">
          <p>
            Configuration is managed in the Config tab. You can go there to set
            up your repository settings.
          </p>

          <div class="form-group">
            <label for="commit-message">Change Message</label>
            <textarea
              id="commit-message"
              rows="4"
              placeholder="Optional: Describe the changes"
            ></textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button onclick="closeGitLabModal()">Cancel</button>
          <button
            id="commit-submit-button"
            class="commit-all-variants-button"
            onclick="commitToGitLab()"
          >
            Commit
          </button>
        </div>
      </div>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="modal" style="display: none">
      <div class="modal-content">
        <button class="close-modal" onclick="closeSettingsModal()">
          <span class="material-symbols-outlined">close</span>
        </button>
        <div class="modal-header">
          <h3>Settings</h3>
        </div>
        <div class="modal-body">
          <h4>Repository Configuration</h4>
          <p>
            Configure your repository settings. This configuration will
            be shared with your team.
          </p>

          <div class="form-group">
            <label for="config-provider">Git Provider</label>
            <select id="config-provider" onchange="onProviderChange()">
              <option value="gitlab">GitLab</option>
              <option value="github">GitHub</option>
            </select>
          </div>

          <div class="form-group" id="gitlab-url-group">
            <label for="config-gitlab-url">GitLab Instance URL</label>
            <input
              type="text"
              id="config-gitlab-url"
              placeholder="https://gitlab.company.com (leave empty for GitLab.com)"
            />
            <small style="color: rgba(255, 255, 255, 0.8); font-size: 12px; display: block; margin-top: 4px;">
              Enter your GitLab instance URL (e.g., gitlab.company.com, git.organization.edu). Supports most enterprise and self-hosted GitLab instances. Leave empty to use GitLab.com.
            </small>
          </div>

          <div class="form-group" id="github-url-group" style="display: none;">
            <label for="config-github-url">GitHub Instance URL</label>
            <input
              type="text"
              id="config-github-url"
              placeholder="https://github.com (or your GitHub Enterprise URL)"
            />
            <small style="color: rgba(255, 255, 255, 0.8); font-size: 12px; display: block; margin-top: 4px;">
              Leave empty for GitHub.com or enter your GitHub Enterprise URL.
            </small>
          </div>

          <div class="form-group">
            <label for="config-project-id">
              <span id="project-id-label">Project ID</span>
            </label>
            <div style="display: flex; gap: 8px; align-items: center;">
              <input
                type="text"
                id="config-project-id"
                placeholder="e.g. 24267"
                style="flex: 1;"
              />
              <button 
                id="browse-repos-button" 
                onclick="browseRepositories()" 
                style="display: none; padding: 8px 12px; font-size: 12px; background: rgba(139, 92, 246, 0.2); border: 1px solid rgba(139, 92, 246, 0.3); color: #c4b5fd; cursor: pointer; border-radius: 6px; white-space: nowrap;"
                title="Browse repositories"
              >
                Browse
              </button>
            </div>
            <small id="project-id-help" style="color: rgba(255, 255, 255, 0.8); font-size: 12px; display: block; margin-top: 4px;">
              For GitLab: Use numeric ID or namespace/project format
            </small>
          </div>

          <div class="form-group">
            <label for="config-file-path">Variables File Path</label>
            <input
              type="text"
              id="config-file-path"
              placeholder="src/variables.css"
            />
          </div>

          <div class="form-group">
            <label for="config-export-format">Export Format</label>
            <select id="config-export-format">
              <option value="css">CSS (variables.css)</option>
              <option value="scss">SCSS (variables.scss)</option>
              <option value="tailwind-v4">Tailwind v4 (@theme)</option>
            </select>
          </div>

          <div class="form-group">
            <label for="config-test-file-path"
              >Component Test File Path Template</label
            >
            <input
              type="text"
              id="config-test-file-path"
              placeholder="components/{componentName}/{componentName}.spec.ts"
            />
            <div style="font-size: 12px; color: rgba(255, 255, 255, 0.8); margin-top: 4px">
              <i>Use {componentName} as a placeholder for the component name</i>
            </div>
          </div>

          <div class="form-group">
            <label for="config-token">
              <span id="token-label">Project Access Token</span>
            </label>
            <div style="display: flex; gap: 8px; align-items: center;">
              <input
                type="password"
                id="config-token"
                placeholder="Enter your GitLab private token"
                style="flex: 1;"
              />
              <button 
                id="oauth-login-button" 
                onclick="startOAuthFlow()" 
                style="display: none; padding: 8px 12px; font-size: 12px; background: rgba(34, 197, 94, 0.2); border: 1px solid rgba(34, 197, 94, 0.3); color: #22c55e; cursor: pointer; border-radius: 6px; white-space: nowrap;"
                title="Login with GitHub OAuth (opens in your browser)"
              >
                <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor" style="margin-right: 4px;">
                  <path d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0 0 24 12c0-6.63-5.37-12-12-12Z"/>
                </svg>
                OAuth
              </button>
            </div>
            <div id="oauth-status" style="margin-top: 4px; display: none;">
              <small style="color: rgba(34, 197, 94, 0.8); font-size: 12px;">
                ‚úì OAuth login available for better security
              </small>
            </div>
            <small id="token-help" style="color: rgba(255, 255, 255, 0.8); font-size: 12px; display: block; margin-top: 4px;">
              For GitLab: Use project access token
            </small>
          </div>

          <div class="form-group">
            <label for="config-strategy">Strategy</label>
            <select id="config-strategy">
              <option value="direct">Direct Commit</option>
              <option value="merge-request" selected>Merge Request</option>
            </select>
          </div>

          <div id="config-branch-section" class="form-group">
            <label for="config-branch">CSS Variables Branch Name</label>
            <div style="display: flex; gap: 8px; align-items: center;">
              <input
                type="text"
                id="config-branch"
                placeholder="feature/variables"
                style="flex: 1;"
              />
              <button 
                id="browse-branches-button" 
                onclick="browseBranches()" 
                style="display: none; padding: 8px 12px; font-size: 12px; background: rgba(139, 92, 246, 0.2); border: 1px solid rgba(139, 92, 246, 0.3); color: #c4b5fd; cursor: pointer; border-radius: 6px; white-space: nowrap;"
                title="Browse branches"
              >
                Browse
              </button>
            </div>
          </div>

          <div id="config-test-branch-section" class="form-group">
            <label for="config-test-branch">Component Tests Branch Name</label>
            <input
              type="text"
              id="config-test-branch"
              placeholder="feature/component-tests"
            />
            <p class="help-text">
              Each component will create a separate branch:
              {branch-name}-{component-name}
            </p>
          </div>

          <div class="form-group checkbox-group">
            <input type="checkbox" id="config-save-token" checked />
            <label for="config-save-token"
              >Save token (recommended for convenience)</label
            >
          </div>

          <div class="form-group checkbox-group">
            <input type="checkbox" id="config-share-team" checked />
            <label for="config-share-team">Share settings with team</label>
          </div>

          <div
            style="
              background: rgba(139, 92, 246, 0.1);
              border: 1px solid rgba(139, 92, 246, 0.3);
              border-radius: 12px;
              padding: 12px 16px;
              margin: 16px 0;
              font-size: 13px;
              color: #c4b5fd;
              display: flex;
              align-items: center;
              gap: 10px;
              backdrop-filter: blur(10px);
            "
          >
            <div style="
              background: rgba(139, 92, 246, 0.2);
              width: 24px;
              height: 24px;
              border-radius: 50%;
              display: flex;
              align-items: center;
              justify-content: center;
              flex-shrink: 0;
              font-size: 12px;
            ">‚ÑπÔ∏è</div>
            <p style="margin: 0; font-weight: 500; color: rgba(255, 255, 255, 0.9)">Can only be changed by Dev Team</p>
          </div>

          <!-- Configuration Metadata -->
          <div
            id="config-metadata"
            style="
              background: rgba(255, 255, 255, 0.05);
              border: 1px solid rgba(255, 255, 255, 0.1);
              border-radius: 12px;
              padding: 12px 16px;
              margin: 16px 0;
              font-size: 13px;
              color: rgba(255, 255, 255, 0.8);
              display: none;
              backdrop-filter: blur(10px);
            "
          >
            <div style="display: flex; align-items: center; gap: 10px">
              <div style="
                background: rgba(255, 255, 255, 0.1);
                width: 32px;
                height: 32px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                flex-shrink: 0;
              ">
                <svg
                  width="16"
                  height="16"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="rgba(196, 181, 253, 0.8)"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <circle cx="12" cy="12" r="10"></circle>
                  <polyline points="12 6 12 12 16 14"></polyline>
                </svg>
              </div>
              <span id="config-metadata-text" style="font-weight: 400; line-height: 1.5;">Last saved: Loading...</span>
            </div>
          </div>

          <!-- Feedback Section -->
          <div id="settings-feedback-section" style="border-top: 1px solid rgba(139, 92, 246, 0.2); padding-top: var(--space-4); margin-top: var(--space-4);">
            <h4 style="margin-bottom: var(--space-2);">Feedback & Support</h4>
            <p style="font-size: 13px; color: rgba(255, 255, 255, 0.7); margin-bottom: var(--space-3);">
              We're actively improving Bridgy based on your feedback!
            </p>
            <div style="display: flex; gap: var(--space-2); flex-wrap: wrap;">
              <button class="feedback-button" onclick="openGitHubFeedback('bug')" style="flex: 1; min-width: 100px;">
                <span class="feedback-button-icon">üêõ</span>
                <span>Report Bug</span>
              </button>
              <button class="feedback-button" onclick="openGitHubFeedback('feature')" style="flex: 1; min-width: 100px;">
                <span class="feedback-button-icon">üí°</span>
                <span>Request Feature</span>
              </button>
              <button class="feedback-button" onclick="openGitHubFeedback('general')" style="flex: 1; min-width: 100px;">
                <span class="feedback-button-icon">üí≠</span>
                <span>General Feedback</span>
              </button>
            </div>
            <a href="https://bridgy-plugin.com/" target="_blank" style="display: inline-flex; align-items: center; gap: 4px; margin-top: var(--space-3); color: #c4b5fd; font-size: 13px; text-decoration: none;">
              Visit our website
              <span class="material-symbols-outlined" style="font-size: 14px;">open_in_new</span>
            </a>
          </div>
        </div>
        <div
          class="modal-footer"
          style="
            display: flex;
            justify-content: space-between;
            align-items: center;
          "
        >
          <button
            onclick="showResetConfirmation()"
            style="
              background: #dc3545;
              color: white;
              border: none;
              padding: 8px 12px;
              border-radius: var(--radius-lg);
              cursor: pointer;
              display: flex;
              align-items: center;
              gap: 6px;
            "
            title="Reset all configuration"
          >
            <svg
              width="14"
              height="14"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <polyline points="3,6 5,6 21,6"></polyline>
              <path
                d="M19,6V20A2,2 0 0,1 17,20H7A2,2 0 0,1 5,20V6M8,6V4A2,2 0 0,1 10,4H14A2,2 0 0,1 16,4V6"
              ></path>
              <line x1="10" y1="11" x2="10" y2="17"></line>
              <line x1="14" y1="11" x2="14" y2="17"></line>
            </svg>
            Reset
          </button>
          <div>
            <button onclick="closeSettingsModal()">Cancel</button>
            <button onclick="saveConfiguration()" class="btn-primary">
              Save Configuration
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- User Guide Modal -->
    <div id="user-guide-modal" class="modal" style="display: none">
      <div class="modal-content" style="max-width: 800px">
        <button class="close-modal" onclick="closeUserGuide()">
          <span class="material-symbols-outlined">close</span>
        </button>
        <div class="modal-header">
          <h3>üé® Bridgy - User Guide</h3>
          <p style="margin: 8px 0 0; color: rgba(255, 255, 255, 0.8); font-size: 14px">
            Bridging the gap between designers and developers
          </p>
        </div>
        <div class="modal-body" style="max-height: 70vh; overflow-y: auto">
          <!-- Introduction -->
          <div
            style="
              background: linear-gradient(135deg, #5e72e4 0%, #825ee4 100%);
              color: white;
              padding: 20px;
              border-radius: 15px;
              margin-bottom: 24px;
              box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            "
          >
            <h4 style="margin: 0 0 12px; font-size: 18px; color: white; font-weight: 600">
              üöÄ Welcome to Bridgy!
            </h4>
            <p style="margin: 0; line-height: 1.5; color: rgba(255, 255, 255, 0.95); font-size: 14px">
              This plugin helps designers and developers work together
              seamlessly. Export Figma variables as CSS, generate component
              tests, and commit changes directly to your repository.
            </p>
          </div>

          <!-- Process Overview -->
          <div style="margin-bottom: 24px">
            <h4 style="color: white; margin-bottom: 16px; font-weight: 600;">
              üìã Collaboration Process
            </h4>

            <!-- Step 1 -->
            <div
              style="
                display: flex;
                margin-bottom: 16px;
                padding: 16px;
                background: rgba(255, 255, 255, 0.05);
                backdrop-filter: blur(10px);
                border-radius: 15px;
                border: 1px solid rgba(255, 255, 255, 0.1);
                border-left: 4px solid #22c55e;
                box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
              "
            >
              <div
                style="
                  background: #22c55e;
                  color: white;
                  border-radius: 50%;
                  width: 24px;
                  height: 24px;
                  display: flex;
                  align-items: center;
                  justify-content: center;
                  margin-right: 16px;
                  font-weight: bold;
                  font-size: 12px;
                  flex-shrink: 0;
                "
              >
                1
              </div>
              <div>
                <h5 style="margin: 0 0 8px; color: #22c55e; font-weight: 600;">
                  Initial Setup (One-time)
                </h5>
                <p style="margin: 0; line-height: 1.5; color: rgba(255, 255, 255, 0.85);"
                  <strong>üë®‚Äçüíª Developer:</strong> Sets up project configuration
                  in the settings (‚öôÔ∏è icon):<br />
                  ‚Ä¢ GitLab Project ID and Access Token<br />
                  ‚Ä¢ File path for CSS variables<br />
                  ‚Ä¢ Branch naming strategy<br />
                  ‚Ä¢ Commit vs. Merge Request workflow
                </p>
              </div>
            </div>

            <!-- Step 2 -->
            <div
              style="
                display: flex;
                margin-bottom: 16px;
                padding: 16px;
                background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(10px);
                border-radius: 15px;
                border-left: 4px solid #007bff;
              "
            >
              <div
                style="
                  background: #007bff;
                  color: white;
                  border-radius: 50%;
                  width: 24px;
                  height: 24px;
                  display: flex;
                  align-items: center;
                  justify-content: center;
                  margin-right: 16px;
                  font-weight: bold;
                  font-size: 12px;
                  flex-shrink: 0;
                "
              >
                2
              </div>
              <div>
                <h5 style="margin: 0 0 8px; color: #c4b5fd">
                  Testing & Validation
                </h5>
                <p style="margin: 0; line-height: 1.5; color: rgba(255, 255, 255, 0.85)">
                  <strong>üé® Designer:</strong> Tests the setup by making a
                  small change and committing it:<br />
                  ‚Ä¢ Ensures variables sync correctly<br />
                  ‚Ä¢ Verifies the commit process works<br />
                  ‚Ä¢ Confirms the file appears in the repository
                </p>
              </div>
            </div>

            <!-- Step 4 -->
            <div
              style="
                display: flex;
                margin-bottom: 16px;
                padding: 16px;
                background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(10px);
                border-radius: 15px;
                border-left: 4px solid #fd7e14;
              "
            >
              <div
                style="
                  background: #fd7e14;
                  color: white;
                  border-radius: 50%;
                  width: 24px;
                  height: 24px;
                  display: flex;
                  align-items: center;
                  justify-content: center;
                  margin-right: 16px;
                  font-weight: bold;
                  font-size: 12px;
                  flex-shrink: 0;
                "
                              >
                3
              </div>
              <div>
                <h5 style="margin: 0 0 8px; color: #fd7e14">
                  Daily Workflow
                </h5>
                <div style="margin-bottom: 12px;">
                  <p style="margin: 0 0 8px; line-height: 1.5; color: rgba(255, 255, 255, 0.85)">
                    <strong>üé® Designer ‚Äì Update & Sync Designs</strong><br />
                    ‚Ä¢ Make design changes in Figma (colors, spacing, typography, etc.)<br />
                    ‚Ä¢ Open the Bridgy plugin<br />
                    ‚Ä¢ Review changes in the Variables tab<br />
                    ‚Ä¢ Commit to Repository with a clear, descriptive message
                  </p>
                </div>
                <div>
                  <p style="margin: 0; line-height: 1.5; color: rgba(255, 255, 255, 0.85)">
                    <strong>üë®‚Äçüíª Developer ‚Äì Generate Tests & Implement</strong><br />
                    ‚Ä¢ Open the Bridgy plugin<br />
                    ‚Ä¢ Generate comprehensive component tests from the Figma designs<br />
                    ‚Ä¢ Commit tests to a dedicated feature branch<br />
                    ‚Ä¢ Check out the branch & implement components using a test-driven development approach<br />
                    ‚Ä¢ Review & integrate CSS variable changes from the designer
                  </p>
                </div>
              </div>
            </div>
          </div>

          <!-- Key Features -->
          <div style="margin-bottom: 24px">
            <h4 style="color: white; margin-bottom: 16px">‚ú® Key Features</h4>
            <div
              style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px"
            >
              <div
                style="
                  padding: 16px;
                  border: 1px solid #e0e0e0;
                  border-radius: 15px;
                "
              >
                <h5 style="margin: 0 0 8px; color: #c4b5fd">
                  üé® Variables Export
                </h5>
                <p style="margin: 0; font-size: 14px; color: rgba(255, 255, 255, 0.8)">
                  Export Figma variables as CSS custom properties, ready for
                  development use.
                </p>
              </div>
              <div
                style="
                  padding: 16px;
                  border: 1px solid #e0e0e0;
                  border-radius: 15px;
                "
              >
                <h5 style="margin: 0 0 8px; color: #22c55e">
                  üß™ Test Generation
                </h5>
                <p style="margin: 0; font-size: 14px; color: rgba(255, 255, 255, 0.8)">
                  Generate Angular component tests to ensure designs match
                  implementation.
                </p>
              </div>
              <div
                style="
                  padding: 16px;
                  border: 1px solid #e0e0e0;
                  border-radius: 15px;
                "
              >
                <h5 style="margin: 0 0 8px; color: #dc3545">
                  üì° GitLab Integration
                </h5>
                <p style="margin: 0; font-size: 14px; color: rgba(255, 255, 255, 0.8)">
                  Commit changes directly to GitLab with automatic merge request
                  creation.
                </p>
              </div>
              <div
                style="
                  padding: 16px;
                  border: 1px solid #e0e0e0;
                  border-radius: 15px;
                "
              >
                <h5 style="margin: 0 0 8px; color: #6f42c1">
                  üîç Search & Filter
                </h5>
                <p style="margin: 0; font-size: 14px; color: rgba(255, 255, 255, 0.8)">
                  Easily find and review specific variables and components
                  before export.
                </p>
              </div>
            </div>
          </div>

          <!-- Workflow Strategies -->
          <div style="margin-bottom: 24px">
            <h4 style="color: white; margin-bottom: 16px">
              ‚öôÔ∏è Workflow Strategies
            </h4>

            <div
              style="
                background: rgba(34, 197, 94, 0.1);
                backdrop-filter: blur(10px);
                border: 1px solid rgba(34, 197, 94, 0.3);
                border-radius: 15px;
                padding: 16px;
                margin-bottom: 12px;
                box-shadow: 0 8px 32px rgba(34, 197, 94, 0.1);
              "
            >
              <h5 style="margin: 0 0 8px; color: #22c55e; font-weight: 600;">
                üîÑ Merge Request Strategy (Recommended)
              </h5>
              <p style="margin: 0; color: rgba(255, 255, 255, 0.85); line-height: 1.5">
                Each commit creates a merge request. Multiple commits to the
                same feature get added to the same MR. Perfect for collaborative
                review and controlled integration.
              </p>
            </div>

            <div
              style="
                background: rgba(251, 191, 36, 0.1);
                backdrop-filter: blur(10px);
                border: 1px solid rgba(251, 191, 36, 0.3);
                border-radius: 15px;
                padding: 16px;
                box-shadow: 0 8px 32px rgba(251, 191, 36, 0.1);
              "
            >
              <h5 style="margin: 0 0 8px; color: #fbbf24; font-weight: 600;">
                ‚ö° Direct Commit Strategy
              </h5>
              <p style="margin: 0; color: rgba(255, 255, 255, 0.85); line-height: 1.5">
                Changes go directly to the main branch. Faster but requires more
                trust in the design changes. Best for mature teams with
                established processes.
              </p>
            </div>
          </div>

          <!-- Tips -->
          <div
            style="
              background: rgba(139, 92, 246, 0.1);
              backdrop-filter: blur(10px);
              border: 1px solid rgba(139, 92, 246, 0.3);
              border-radius: 15px;
              padding: 16px;
              box-shadow: 0 8px 32px rgba(139, 92, 246, 0.1);
            "
          >
            <h4 style="margin: 0 0 12px; color: #c4b5fd">üí° Pro Tips</h4>
            <ul style="margin: 0; padding-left: 20px; color: rgba(255, 255, 255, 0.85)">
              <li style="margin-bottom: 8px">
                Use descriptive commit messages (e.g., "Update primary colors
                for better accessibility")
              </li>
              <li style="margin-bottom: 8px">
                Review variables before committing to catch any unintended
                changes
              </li>
              <li style="margin-bottom: 8px">
                Coordinate with developers for major design system changes
              </li>
              <li style="margin-bottom: 8px">
                Test the setup with small changes before making large updates
              </li>
              <li>Keep your Figma variable names consistent and descriptive</li>
            </ul>
          </div>
        </div>
        <div class="modal-footer">
          <button onclick="closeUserGuide()" class="btn-primary">
            Got it!
          </button>
        </div>
      </div>
    </div>

    <!-- Reset Confirmation Modal -->
    <div id="reset-confirmation-modal" class="modal" style="display: none">
      <div class="modal-content" style="max-width: 500px">
        <button class="close-modal" onclick="closeResetConfirmation()">
          <span class="material-symbols-outlined">close</span>
        </button>
        <div class="modal-header">
          <h3
            style="
              color: #dc3545;
              display: flex;
              align-items: center;
              gap: 10px;
            "
          >
            <svg
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <circle cx="12" cy="12" r="10"></circle>
              <line x1="15" y1="9" x2="9" y2="15"></line>
              <line x1="9" y1="9" x2="15" y2="15"></line>
            </svg>
            Reset Configuration
          </h3>
        </div>
        <div class="modal-body">
          <div
            style="
              background: rgba(251, 191, 36, 0.1);
              backdrop-filter: blur(10px);
              border: 1px solid rgba(251, 191, 36, 0.3);
              border-radius: 15px;
              padding: 16px;
              margin-bottom: 20px;
              box-shadow: 0 8px 32px rgba(251, 191, 36, 0.1);
            "
          >
            <p style="margin: 0; color: #fbbf24; font-weight: 500">
              ‚ö†Ô∏è Warning: This action cannot be undone!
            </p>
          </div>

          <p style="margin-bottom: 16px; line-height: 1.5">
            This will permanently delete
            <strong>all configuration data</strong> for this Figma project,
            including:
          </p>

          <ul style="margin: 0 0 20px 20px; line-height: 1.6; color: rgba(255, 255, 255, 0.85)">
            <li>GitLab Project ID and access token</li>
            <li>File path and branch settings</li>
            <li>Strategy preferences (commit vs merge request)</li>
            <li>All saved metadata (who saved, when)</li>
          </ul>

          <p style="margin: 0; color: rgba(255, 255, 255, 0.8); font-style: italic">
            After reset, you'll need to reconfigure everything from scratch.
          </p>
        </div>
        <div class="modal-footer">
          <button onclick="closeResetConfirmation()">Cancel</button>
          <button
            onclick="confirmReset()"
            style="
              background: #dc3545;
              color: white;
              border: none;
              padding: 10px 16px;
              border-radius: var(--radius-lg);
              cursor: pointer;
              font-weight: 500;
            "
          >
            Yes, Reset Everything
          </button>
        </div>
      </div>
    </div>


    <!-- Repository Browser Modal -->
    <div id="repository-browser-modal" class="modal" style="display: none">
      <div class="modal-content" style="max-width: 600px">
        <button class="close-modal" onclick="closeRepositoryBrowser()">
          <span class="material-symbols-outlined">close</span>
        </button>
        <div class="modal-header">
          <h3>Select Repository</h3>
        </div>
        <div class="modal-body">
          <div class="search-container" style="margin-bottom: 16px;">
            <input
              type="text"
              id="repo-search"
              class="search-input"
              placeholder="Search repositories..."
              onkeyup="filterRepositories()"
              style="width: 100%;"
            />
          </div>
          <div id="repo-list-container" style="max-height: 400px; overflow-y: auto;">
            <div class="content-loading">
              <div class="content-loading-spinner"></div>
              <div class="content-loading-text">Loading repositories...</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Branch Browser Modal -->
    <div id="branch-browser-modal" class="modal" style="display: none">
      <div class="modal-content" style="max-width: 500px">
        <button class="close-modal" onclick="closeBranchBrowser()">
          <span class="material-symbols-outlined">close</span>
        </button>
        <div class="modal-header">
          <h3>Select Branch</h3>
        </div>
        <div class="modal-body">
          <div class="search-container" style="margin-bottom: 16px;">
            <input
              type="text"
              id="branch-search"
              class="search-input"
              placeholder="Search branches..."
              onkeyup="filterBranches()"
              style="width: 100%;"
            />
          </div>
          <div id="branch-list-container" style="max-height: 300px; overflow-y: auto;">
            <div class="content-loading">
              <div class="content-loading-spinner"></div>
              <div class="content-loading-text">Loading branches...</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Success message (hidden by default) -->
    <div id="success-message" class="success-message" style="display: none">
      <p>Successfully committed to GitLab repository!</p>
    </div>

    <!-- Import Variables Modal -->
    <div id="import-modal" class="modal" style="display: none">
      <div class="modal-content" style="max-width: 800px">
        <button class="close-modal" onclick="closeImportModal()">
          <span class="material-symbols-outlined">close</span>
        </button>
        <div class="modal-header">
          <h3>Import Variables</h3>
        </div>
        <div class="modal-body">
          <div id="variable-import-container">
            <div class="import-section">
              <div class="import-header">
                <p>Paste CSS, SCSS, or Tailwind configuration to import variables.</p>
              </div>
              
              <div class="import-input-area">
                <textarea 
                  id="import-input" 
                  placeholder="Paste your code here...&#10;CSS/SCSS: :root { --primary: #3b82f6; }&#10;Tailwind Config: { theme: { colors: { primary: '#3b82f6' } } }"
                  spellcheck="false"
                ></textarea>
              </div>

              <div class="import-actions-bar">
                <div class="import-options">
                   <select id="import-collection-select" class="select-input">
                     <!-- Populated dynamically -->
                     <option value="">New Collection...</option>
                   </select>
                </div>
                <button id="preview-import-btn" class="btn-primary" disabled>
                  Preview Import
                </button>
              </div>

              <!-- Preview Section (Hidden by default) -->
              <div id="import-preview-section" class="import-preview-section hidden">
                <div class="preview-header">
                  <h4>Import Preview</h4>
                  <div class="preview-stats">
                    <span id="preview-stat-total" class="badge">0 Total</span>
                    <span id="preview-stat-new" class="badge badge-success">0 New</span>
                    <span id="preview-stat-update" class="badge badge-warning">0 Updates</span>
                    <span id="preview-stat-conflict" class="badge badge-danger">0 Conflicts</span>
                  </div>
                </div>

                <div class="import-strategy-selector">
                  <label>Conflict Strategy:</label>
                  <div class="radio-group">
                    <label>
                      <input type="radio" name="import-strategy" value="merge" checked>
                      <span>Merge (Keep Existing)</span>
                    </label>
                    <label>
                      <input type="radio" name="import-strategy" value="overwrite">
                      <span>Overwrite Existing</span>
                    </label>
                  </div>
                </div>

                <div class="preview-table-container">
                  <table class="preview-table">
                    <thead>
                      <tr>
                        <th>Variable Name</th>
                        <th>Type</th>
                        <th>New Value</th>
                        <th>Status</th>
                        <th>Action</th>
                      </tr>
                    </thead>
                    <tbody id="preview-table-body">
                      <!-- Populated dynamically -->
                    </tbody>
                  </table>
                </div>

                <div class="import-confirmation-actions">
                  <button id="cancel-import-btn" class="btn-secondary">Cancel</button>
                  <button id="confirm-import-btn" class="btn-primary">
                    Import Variables
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Units Configuration Modal -->
    <div id="units-modal" class="modal" style="display: none">
      <div class="modal-content" style="max-width: 700px">
        <button class="close-modal" onclick="closeUnitsModal()">
          <span class="material-symbols-outlined">close</span>
        </button>
        <div class="modal-header">
          <h3>Variable Units Settings</h3>
        </div>
        <div class="modal-body">
          <p style="color: rgba(255, 255, 255, 0.8); margin-bottom: 16px">
            Configure units for numeric variables. Collections override
            defaults, groups override collections.
          </p>
          <div style="display: flex; gap: 10px; margin-bottom: 16px">
            <button
              id="reset-units-button-modal"
              style="background-color: #f44336"
              onclick="window.resetUnitsSettings()"
            >
              Reset to Smart Defaults
            </button>
            <button
              id="save-units-button-modal"
              disabled
              onclick="saveUnitsAndCloseModal()"
            >
              Save Unit Settings
            </button>
          </div>
          <div id="units-settings-container">
            <div class="loading">Loading unit settings...</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Error message (hidden by default) -->
    <div id="error-message" class="error-message" style="display: none">
      <p>
        <strong>Error committing to GitLab:</strong>
        <span id="error-details"></span>
      </p>
      <p class="error-help">Please check your credentials and try again.</p>
    </div>


